ALTER TABLE `Dashboard Widget Bridge` ADD `Dashboard Widget Name` VARCHAR(128) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL , ADD `Dashboard Widget Description` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL , ADD INDEX (`Dashboard Widget Name`) ;
ALTER TABLE `user right scope bridge` CHANGE `Scope` `Scope` ENUM('Store','Warehouse','Supplier','Website','Project','Service') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'Store';
ALTER TABLE `Site Dimension` CHANGE `Site Store Key` `Site Store Key` SMALLINT(5) UNSIGNED NULL DEFAULT NULL;
ALTER TABLE `Site Dimension` ADD `Site Service Project Key` MEDIUMINT UNSIGNED NULL DEFAULT NULL AFTER `Site Store Key`, ADD `Site Service Key` MEDIUMINT UNSIGNED NULL DEFAULT NULL AFTER `Site Service Project Key`;
ALTER TABLE `Site Dimension` CHANGE `Site Service Key` `Site Project Key` MEDIUMINT(8) UNSIGNED NULL DEFAULT NULL;
// add indexed to prev 2 fields
ALTER TABLE `Site Dimension` CHANGE `Site Default Number See Also Links` `Site Default Number See Also Links` TINYINT(4) UNSIGNED NULL DEFAULT NULL;
ALTER TABLE `Site Dimension` ADD `Site Parent` ENUM('Store','Project') NOT NULL DEFAULT 'Store' AFTER `Site Key`, ADD INDEX (`Site Parent`) ;
ALTER TABLE `Page Store Dimension` CHANGE `Page Store Key` `Page Store Key` SMALLINT(5) UNSIGNED NULL DEFAULT NULL; 
ALTER TABLE `Page Store Dimension` ADD `Page Site Parent` ENUM('Store','Project') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'Store' AFTER `Page Site Key`, ADD INDEX (`Page Site Parent`) ;
ALTER TABLE `Page Store Dimension` ADD `Page Service Project Key` SMALLINT UNSIGNED NULL DEFAULT NULL AFTER `Page Store Key`, ADD `Page Project Key` SMALLINT UNSIGNED NULL DEFAULT NULL AFTER `Page Service Project Key`;
// add indexed to prev 2 fields
ALTER TABLE `Account Dimension` ADD `Google API Client ID` VARCHAR(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL , ADD `Google API Service Account Name` VARCHAR(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ;
ALTER TABLE `Site Dimension` ADD `Site Google Analytics Profile ID` VARCHAR(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL ;

//=====

ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component XHTML Name Label` `Deal Component XHTML Name Label` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component XHTML Terms Description Label` `Deal Component XHTML Terms Description Label` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component XHTML Allowance Description Label` `Deal Component XHTML Allowance Description Label` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Replace` `Deal Component Replace` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 

ALTER TABLE `Deal Dimension` CHANGE `Deal Terms Type` `Deal Terms Type` ENUM('Every Order','Family For Every Quantity Any Product Ordered','Department For Every Quantity Any Product Ordered','Voucher AND Order Interval','Amount AND Order Number','Amount AND Order Interval','Voucher AND Order Number','Voucher AND Amount','Amount','Order Total Net Amount','Order Total Net Amount AND Order Number','Order Total Net Amount AND Shipping Country','Order Total Net Amount AND Order Interval','Order Items Net Amount','Order Items Net Amount AND Order Number','Order Items Net Amount AND Shipping Country','Order Items Net Amount AND Order Interval','Order Total Amount','Order Total Amount AND Order Number','Order Total Amount AND Shipping Country','Order Total Amount AND Order Interval','Order Interval','Product Quantity Ordered','Family Quantity Ordered','Order Number','Shipping Country','Voucher','Department For Every Quantity Ordered','Family For Every Quantity Ordered','Product For Every Quantity Ordered')CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Terms Type` `Deal Component Terms Type` ENUM('Every Order','Family For Every Quantity Any Product Ordered','Department For Every Quantity Any Product Ordered','Voucher AND Order Interval','Amount AND Order Number','Amount AND Order Interval','Voucher AND Order Number','Voucher AND Amount','Amount','Order Total Net Amount','Order Total Net Amount AND Order Number','Order Total Net Amount AND Shipping Country','Order Total Net Amount AND Order Interval','Order Items Net Amount','Order Items Net Amount AND Order Number','Order Items Net Amount AND Shipping Country','Order Items Net Amount AND Order Interval','Order Total Amount','Order Total Amount AND Order Number','Order Total Amount AND Shipping Country','Order Total Amount AND Order Interval','Order Interval','Product Quantity Ordered','Family Quantity Ordered','Order Number','Shipping Country','Voucher','Department For Every Quantity Ordered','Family For Every Quantity Ordered','Product For Every Quantity Ordered') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL; 

ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Trigger` `Deal Component Trigger` ENUM('Family','Product','Order','Customer') CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 

ALTER TABLE `Order Transaction Fact` CHANGE `Current Dispatching State` `Current Dispatching State` ENUM('Out of Stock in Basket','In Process by Customer','Submitted by Customer','In Process','Ready to Pick','Picking','Ready to Pack','Ready to Ship','Dispatched','Unknown','Packing','Packed','Packed Done','Cancelled','No Picked Due Out of Stock','No Picked Due No Authorised','No Picked Due Not Found','No Picked Due Other','Suspended','Cancelled by Customer') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'Unknown';

ALTER TABLE `Deal Component Dimension` ADD `Deal Component Allowance Target Type` ENUM('Items','No Items') NOT NULL DEFAULT 'Items' AFTER `Deal Component Allowance Target`, ADD INDEX (`Deal Component Allowance Target Type`) ;
update `Deal Component Dimension`  set  `Deal Component Allowance Target Type`='No Items' where `Deal Component Allowance Target` in ('Shipping', 'Charges') ;
update `Deal Component Dimension`  set  `Deal Component Allowance Target Type`='No Items' where `Deal Component Allowance Description` in ('Get one from family') ;
update `Deal Component Dimension` set `Deal Component Status`='Finish' where `Deal Component Record Type`='Historic';
ALTER TABLE `Order No Product Transaction Fact` CHANGE `Transaction Type` `Transaction Type` ENUM('Credit','Unknown','Refund','Shipping','Charges','Adjust','Other','Deal','Insurance','Discount') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'Unknown'; 
ALTER TABLE `Order Dimension` ADD `Order Deal Amount Off` DECIMAL(12,2) NOT NULL DEFAULT '0.00' COMMENT 'Net' AFTER `Order Insurance Tax Amount`; 
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Allowance Type` `Deal Component Allowance Type` ENUM('Get Cheapest Free','Amount Off','Percentage Off','Get Free','Get Same Free','Credit') CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL; 
ALTER TABLE `Order Dimension` ADD `Order Deal Amount Off` DECIMAL(12,2) NOT NULL DEFAULT '0.00' COMMENT 'Net' AFTER `Order Insurance Tax Amount`; 
ALTER TABLE `Deal Dimension` CHANGE `Deal Trigger` `Deal Trigger` ENUM('Order','Department','Family','Product','Customer','Customer Category','Customer List') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL; 
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Trigger` `Deal Component Trigger` ENUM('Family','Product','Order','Customer','Customer Category','Customer List') CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;
ALTER TABLE `Deal Dimension` ADD `Deal Term Allowances` TEXT NULL AFTER `Deal Description`; 
update `Deal Component Dimension` set `Deal Component XHTML Terms Description Label`=`Deal Component Terms Description` where `Deal Component XHTML Terms Description Label`='';
ALTER TABLE `Deal Dimension` CHANGE `Deal Terms Type` `Deal Terms Type` ENUM('Department Quantity Ordered','Every Order','Family For Every Quantity Any Product Ordered','Department For Every Quantity Any Product Ordered','Voucher AND Order Interval','Amount AND Order Number','Amount AND Order Interval','Voucher AND Order Number','Voucher AND Amount','Amount','Order Total Net Amount','Order Total Net Amount AND Order Number','Order Total Net Amount AND Shipping Country','Order Total Net Amount AND Order Interval','Order Items Net Amount','Order Items Net Amount AND Order Number','Order Items Net Amount AND Shipping Country','Order Items Net Amount AND Order Interval','Order Total Amount','Order Total Amount AND Order Number','Order Total Amount AND Shipping Country','Order Total Amount AND Order Interval','Order Interval','Product Quantity Ordered','Family Quantity Ordered','Order Number','Shipping Country','Voucher','Department For Every Quantity Ordered','Family For Every Quantity Ordered','Product For Every Quantity Ordered') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;

ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Trigger` `Deal Component Trigger` ENUM('Department','Family','Product','Order','Customer','Customer Category','Customer List') CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;
ALTER TABLE `Deal Component Dimension` CHANGE `Deal Component Terms Type` `Deal Component Terms Type` ENUM('Department Quantity Ordered','Every Order','Family For Every Quantity Any Product Ordered','Department For Every Quantity Any Product Ordered','Voucher AND Order Interval','Amount AND Order Number','Amount AND Order Interval','Voucher AND Order Number','Voucher AND Amount','Amount','Order Total Net Amount','Order Total Net Amount AND Order Number','Order Total Net Amount AND Shipping Country','Order Total Net Amount AND Order Interval','Order Items Net Amount','Order Items Net Amount AND Order Number','Order Items Net Amount AND Shipping Country','Order Items Net Amount AND Order Interval','Order Total Amount','Order Total Amount AND Order Number','Order Total Amount AND Shipping Country','Order Total Amount AND Order Interval','Order Interval','Product Quantity Ordered','Family Quantity Ordered','Order Number','Shipping Country','Voucher','Department For Every Quantity Ordered','Family For Every Quantity Ordered','Product For Every Quantity Ordered') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;


CREATE TABLE IF NOT EXISTS `Voucher Dimension` (
  `Voucher Key` mediumint(8) unsigned NOT NULL,
  `Voucher Store Key` mediumint(8) unsigned NOT NULL,
  `Voucher Deal Key` mediumint(8) unsigned DEFAULT NULL,
  `Voucher Code` varchar(32) NOT NULL,
  `Voucher Type` enum('Public','Private') NOT NULL DEFAULT 'Public',
  `Voucher Subject Type` enum('Order','Customer') NOT NULL DEFAULT 'Order',
  `Voucher Subject Key Metadata` mediumint(8) unsigned DEFAULT NULL,
  `Voucher Usage Limit per Customer` smallint(5) unsigned DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `Voucher Order Bridge` (
  `Voucher Key` mediumint(8) unsigned NOT NULL,
  `Order Key` mediumint(8) unsigned NOT NULL,
  `Date` datetime DEFAULT NULL,
  `Deal Key` mediumint(8) unsigned NOT NULL,
  `Customer Key` mediumint(8) unsigned DEFAULT NULL,
  `State` enum('In Process','Cancelled','Consolidated') NOT NULL DEFAULT 'In Process'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


//important:
//Order Transaction Deal Bridge: add Deal Component Key to primary key!!!!! do it manually in phpmuyadmin
//NOW that can be more than one Transaction Deal Bridge check oif adding discuanst manually actually worls plis

ALTER TABLE `Order Dimension` ADD `Order Invoiced Items Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Order Invoiced Items Amount`;
ALTER TABLE `Order Dimension` ADD `Order Invoiced Shipping Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Order Invoiced Shipping Amount`;
ALTER TABLE `Order Dimension` ADD `Order Invoiced Charges Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Order Invoiced Charges Amount`;
ALTER TABLE `Order Dimension` ADD `Order Invoiced Insurance Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Order Invoiced Insurance Amount`;
ALTER TABLE `Order Dimension` ADD `Order Invoiced Items Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Order Invoiced Items Amount`;


UPDATE `Table Dimension` SET `Table Export Fields` = '`Product Main Department Code`|1,`Product Family Code`|1,P.`Product ID`|1,`Product Code`|1,`Product Units Per Case`|1,`Product Name`|1,`Product Price`|1,`Product RRP`|1,Image URL|0,`Product Tariff Code`|0,`Product Duty Rate`|0,`Product Total Acc Invoiced Amount`|0,`Product 1 Year Acc Invoiced Amount`|0' WHERE `Table Dimension`.`Table Key` = 9; 
UPDATE `Table Dimension` SET `Table Export Fields` = '`Product Department Code`|1,`Product Department Name`|1,`Product Department Total Acc Invoiced Amount`|0,`Product Department 1 Year Acc Invoiced Amount`|0' WHERE `Table Dimension`.`Table Key` = 7; 
UPDATE `Table Dimension` SET `Table Export Fields` = '`Product Family Code`|1,`Product Family Name`|1,`Product Family Total Acc Invoiced Amount`|0,`Product Family 1 Year Acc Invoiced Amount`|0' WHERE `Table Dimension`.`Table Key` = 8; 

from here 25/04/2015 09:19
ALTER TABLE `Order Transaction Fact` ADD `Refund Quantity` FLOAT NOT NULL DEFAULT '0' AFTER `Invoice Quantity`; 
ALTER TABLE `Order Post Transaction Dimension` CHANGE `Delivery Note Key` `Delivery Note Key` MEDIUMINT(8) UNSIGNED NULL DEFAULT NULL; 
ALTER TABLE `Order No Product Transaction Fact` ADD `Transaction Refund Net Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Transaction Invoice Tax Amount`, ADD `Transaction Refund Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Transaction Refund Net Amount`;
ALTER TABLE `Order Post Transaction Dimension` ADD `Refund Key` MEDIUMINT UNSIGNED NULL DEFAULT NULL AFTER `Delivery Note Key`; 
ALTER TABLE `Invoice Dimension` ADD `Invoice Credit Net Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Invoice Insurance Net Amount`; 
ALTER TABLE `Invoice Dimension` ADD `Invoice Credit Tax Amount` DECIMAL(16,2) NOT NULL DEFAULT '0.00' AFTER `Invoice Insurance Tax Amount`; 


//====here

run fix_supplier_products_data.php


ALTER TABLE `Supplier Product History Dimension` ADD `SPH Currency` VARCHAR(3) NOT NULL DEFAULT 'GBP' AFTER `SPH Case Cost`; 


ALTER TABLE `Part Dimension` CHANGE `Part Cost` `Part Cost` DECIMAL(12,4) NULL DEFAULT '0.0000';





ALTER TABLE `Store Data Dimension` ADD `Store Total Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Total Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 3 Year Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 3 Year Acc Invoices` ;

ALTER TABLE `Store Data Dimension` ADD `Store 1 Year Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Year Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Year To Day Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Year To Day Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Month To Day Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Month To Day Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Week To Day Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Week To Day Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 6 Month Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 6 Month Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Quarter Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Quarter Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Month Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Month Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 10 Day Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 10 Day Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Week Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Week Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Today Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Today Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Yesterday Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Yesterday Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Last Week Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Last Week Acc Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Last Month Acc Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Last Month Acc Invoices` ;

ALTER TABLE `Store Data Dimension` ADD `Store 1 Year Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Year Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Year To Day Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Year To Day Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Month To Day Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Month To Day Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Week To Day Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Week To Day Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 6 Month Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 6 Month Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Quarter Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Quarter Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Month Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Month Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 10 Day Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 10 Day Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store 1 Week Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store 1 Week Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Today Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Today Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Yesterday Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Yesterday Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Last Week Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Last Week Acc 1YB Invoices` ;
ALTER TABLE `Store Data Dimension` ADD `Store Last Month Acc 1YB Refunds` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Store Last Month Acc 1YB Invoices` ;






CREATE TABLE IF NOT EXISTS `Order History Bridge` (
  `Order Key` mediumint(8) unsigned NOT NULL,
  `History Key` int(10) unsigned NOT NULL,
  `Deletable` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Strikethrough` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Type` enum('Notes','Changes','Attachments') CHARACTER SET latin1 NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `Order History Bridge`
  ADD PRIMARY KEY (`Order Key`,`History Key`),
  ADD KEY `Order Key` (`Order Key`),
  ADD KEY `Deletable` (`Deletable`),
  ADD KEY `History Key` (`History Key`),
  ADD KEY `Type` (`Type`);
  
  CREATE TABLE IF NOT EXISTS `Delivery Note History Bridge` (
  `Delivery Note Key` mediumint(8) unsigned NOT NULL,
  `History Key` int(10) unsigned NOT NULL,
  `Deletable` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Strikethrough` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Type` enum('Notes','Changes','Attachments') CHARACTER SET latin1 NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `Delivery Note History Bridge`
  ADD PRIMARY KEY (`Delivery Note Key`,`History Key`),
  ADD KEY `Delivery Note Key` (`Delivery Note Key`),
  ADD KEY `Deletable` (`Deletable`),
  ADD KEY `History Key` (`History Key`),
  ADD KEY `Type` (`Type`);



CREATE TABLE IF NOT EXISTS `Invoice History Bridge` (
  `Invoice Key` mediumint(8) unsigned NOT NULL,
  `History Key` int(10) unsigned NOT NULL,
  `Deletable` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Strikethrough` enum('Yes','No') CHARACTER SET latin1 NOT NULL DEFAULT 'No',
  `Type` enum('Notes','Changes','Attachments') CHARACTER SET latin1 NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `Invoice History Bridge`
  ADD PRIMARY KEY (`Invoice Key`,`History Key`),
  ADD KEY `Invoice Key` (`Invoice Key`),
  ADD KEY `Deletable` (`Deletable`),
  ADD KEY `History Key` (`History Key`),
  ADD KEY `Type` (`Type`);
  
  ALTER TABLE `Attachment Bridge` CHANGE `Subject` `Subject` ENUM('Customer Communications','Customer History Attachment','Product History Attachment','Part History Attachment','Part MSDS','Product MSDS','Supplier Product MSDS','Product Info Sheet','Purchase Order History Attachment','Purchase Order','Supplier Delivery Note History Attachment','Supplier Delivery Note','Supplier Invoice History Attachment','Supplier Invoice','Order Note History Attachment','Delivery Note History Attachment','Invoice History Attachment') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;

ALTER TABLE `Invoice Dimension` DROP `Invoice XHTML Ship Tos`;


//============================from: 31/05/2015 12:00


ALTER TABLE `Order Transaction Fact` DROP `Current Manufacturing Quantity`,  DROP `Current On Shelf Quantity`,  DROP `Current On Box Quantity`;
//=============================


ALTER TABLE `Page Store Dimension` DROP INDEX `Page Store Source`;
ALTER TABLE `Page Store Dimension` DROP INDEX `Page Store Title`;
ALTER TABLE `Page Store Dimension` DROP INDEX `Page Store Resume`;


ALTER TABLE `Order Transaction Fact` DROP INDEX `Refund Metadata`;
ALTER TABLE `Order Transaction Fact` DROP INDEX `Metadata`;
ALTER TABLE `Order Transaction Fact` ADD INDEX (`Product Family Key`, `Customer Key`);
ALTER TABLE `Order Transaction Fact` ADD INDEX (`Product ID`, `Customer Key`);

ALTER TABLE `Product Dimension`
  DROP `Product XHTML Package Dimensions`,
  DROP `Product XHTML Unit Dimensions`;
  
  ALTER TABLE `Product Family Dimension` ADD `Product Family Web Products` ENUM('With Products For Sale','Empty') NOT NULL DEFAULT 'With Products For Sale' AFTER `Product Family Availability`, ADD INDEX (`Product Family Web Products`);

ALTER TABLE `Deal Dimension`   ADD `Deal Terms Description` VARCHAR(255) NOT NULL  AFTER `Deal Terms Type`,  ADD `Deal XHTML Terms Description Label` TEXT NOT NULL  AFTER `Deal Terms Description`,  ADD `Deal Terms` VARCHAR(256) NOT NULL  AFTER `Deal XHTML Terms Description Label`;
ALTER TABLE `Deal Campaign Dimension` DROP `Deal Campaign Code`;
ALTER TABLE `Deal Campaign Dimension` CHANGE `Deal Campaign Name` `Deal Campaign Name` VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL; 

ALTER TABLE `Deal Campaign Dimension` ADD UNIQUE (`Deal Campaign Store Key`, `Deal Campaign Name`(50));***
ALTER TABLE `Deal Dimension` DROP `Deal Code`;
ALTER TABLE `Deal Dimension` CHANGE `Deal Terms Description` `Deal Terms Description` VARCHAR(255) CHARACTER SET utf8 COLLATE utf8_general_ci NULL, CHANGE `Deal XHTML Terms Description Label` `Deal XHTML Terms Description Label` TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL, CHANGE `Deal Terms` `Deal Terms` VARCHAR(256) CHARACTER SET utf8 COLLATE utf8_general_ci NULL; 
ALTER TABLE `Deal Dimension` ADD `Deal Label` VARCHAR(255) NULL DEFAULT NULL AFTER `Deal Name`; 
update `Deal Dimension` set `Deal Label`=`Deal Name`;
ALTER TABLE `Deal Component Dimension` ADD `Deal Component Mirror Key` MEDIUMINT UNSIGNED NULL DEFAULT NULL AFTER `Deal Component Public`, ADD INDEX (`Deal Component Mirror Key`); 
ALTER TABLE `Deal Dimension` ADD `Deal Mirror Key` MEDIUMINT UNSIGNED NULL DEFAULT NULL AFTER `Deal Allowance Target Type`, ADD INDEX (`Deal Mirror Key`); 
ALTER TABLE `Voucher Dimension` ADD `Voucher Status` ENUM('Active','Finish') NOT NULL DEFAULT 'Active' AFTER `Voucher Code`, ADD INDEX (`Voucher Status`); 
run fix_voucher_status.php
ALTER TABLE `Deal Component Dimension` DROP `Deal Component Name`;
ALTER TABLE `Deal Component Dimension` DROP `Deal Component XHTML Name Label`;
ALTER TABLE `Deal Component Dimension` DROP `Deal Component Campaign Schema Key`;
ALTER TABLE `Deal Component Dimension` DROP `Deal Component Record Type`;
ALTER TABLE `Deal Component Dimension` DROP `Deal Component Trigger XHTML Label`;
ALTER TABLE `Deal Component Dimension` ADD `Deal Component Allowance XHTML Description` VARCHAR(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL AFTER `Deal Component Allowance Description`; 

ALTER TABLE `Deal Component Dimension` ADD `Deal Component Allowance Plain Description` VARCHAR(256) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL AFTER `Deal Component Allowance Description`; 
php fix_deal_component.php 

//

TRUNCATE `Product Material Bridge`;
TRUNCATE `Part Material Bridge`;
TRUNCATE `Material Dimension`;

ALTER TABLE `Part Material Bridge` CHANGE `Part Material Key` `Part Material Key` INT UNSIGNED NOT NULL AUTO_INCREMENT; 
ALTER TABLE `Product Material Bridge` CHANGE `Product Material Key` `Product Material Key` INT UNSIGNED NOT NULL AUTO_INCREMENT; 
ALTER TABLE `Part Material Bridge` ADD UNIQUE (`Part SKU`, `Material Key`);
ALTER TABLE `Product Material Bridge` ADD UNIQUE (`Product ID`, `Material Key`);

ALTER TABLE `Product Department Dimension` ADD `Product Department Active Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Department Active Customers More 0.5 Share`; 
ALTER TABLE `Product Department Dimension` ADD `Product Department Active Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Department Active Customers`; 


ALTER TABLE `Product Department Dimension` CHANGE `Product Department Unknown Sales State Products` `Product Department Historic Products` SMALLINT(5) UNSIGNED NOT NULL DEFAULT '0'; 

ALTER TABLE `Product Department Data Dimension`  DROP `Product Department Active Customers`,  DROP `Product Department Active Customers More 0.5 Share`;
ALTER TABLE `Product Department Dimension`  ADD `Product Department Losing Customers` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Active Customers More 0.25 Share`,  ADD `Product Department Losing Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Losing Customers`,  ADD `Product Department Losing Customers More 0.5 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Losing Customers More 0.75 Share`,  ADD `Product Department Losing Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Losing Customers More 0.5 Share`,  ADD `Product Department Lost Customers` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Losing Customers More 0.25 Share`,  ADD `Product Department Lost Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Lost Customers`,  ADD `Product Department Lost Customers More 0.5 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Lost Customers More 0.75 Share`,  ADD `Product Department Lost Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0'  AFTER `Product Department Lost Customers More 0.5 Share`;



ALTER TABLE `Product Family Dimension` CHANGE `Product Family Unknown Sales State Products` `Product Family Historic Products` SMALLINT(5) UNSIGNED NOT NULL DEFAULT '0'; 


ALTER TABLE `Product Family Dimension` ADD `Product Family Lost Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Lost Customers More 0.5 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Lost Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Lost Customers` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 


ALTER TABLE `Product Family Dimension` ADD `Product Family Losing Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Losing Customers More 0.5 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Losing Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Losing Customers` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 


ALTER TABLE `Product Family Dimension` ADD `Product Family Active Customers More 0.25 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Active Customers More 0.5 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Active Customers More 0.75 Share` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 
ALTER TABLE `Product Family Dimension` ADD `Product Family Active Customers` MEDIUMINT UNSIGNED NOT NULL DEFAULT '0' AFTER `Product Family Unknown Stock Products`; 

ALTER TABLE `Product Family Dimension` CHANGE `Product Family Record Type` `Product Family Record Type` ENUM('Normal','Discontinued','NoSale','Private') CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT 'Normal'; 

update `Product Family Dimension` set `Product Family Record Type`='NoSale';



INSERT INTO `dw`.`Payment Service Provider Dimension` (`Payment Service Provider Key`, `Payment Service Provider Code`, `Payment Service Provider Name`, `Payment Service Provider Type`, `Service Provider Last Used Date`) VALUES (NULL, 'BTree', 'Braintree', 'EPS', NULL); 

