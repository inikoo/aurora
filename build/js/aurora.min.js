function change_browser_history_state(a){void 0!=a&&("/"!==a.charAt(0)&&(a="/"+a),window.top.history.pushState({request:a},"",a))}function change_tab(a){$("#maintabs .tab").removeClass("selected"),$("#tab_"+a.replace(/(:|\.|\[|\])/g,"$1")).addClass("selected"),change_view(state.request+"&tab="+a)}function change_subtab(a){$("#maintabs .subtab").removeClass("selected"),$("#subtab_"+a.replace(/(:|\.|\[|\])/g,"$1")).addClass("selected"),change_view(state.request+"&subtab="+a)}function help(){change_view(state.request,{help:!0})}function change_view(a,b){void 0==b&&(b={});var c="/ar_views.php?tipo=views&request="+a+"&metadata="+JSON.stringify(b)+"&old_state="+JSON.stringify(state);$.getJSON(c,function(a){console.log(a),state=a.state,"undefined"!=typeof a.navigation&&null!==a.navigation&&""!=a.navigation&&$("#navigation").html(a.navigation),"undefined"!=typeof a.tabs&&null!==a.tabs&&$("#tabs").html(a.tabs),"undefined"!=typeof a.menu&&null!==a.menu&&$("#menu").html(a.menu),"undefined"!=typeof a.logout_label&&null!==a.logout_label&&$("#logout_label").html(a.logout_label),"undefined"!=typeof a.view_position&&null!==a.view_position&&$("#view_position").html(a.view_position),"undefined"!=typeof a.object_showcase&&null!==a.object_showcase&&""!=a.object_showcase?($("#object_showcase").removeClass("hide"),$("#object_showcase").html(a.object_showcase)):$("#object_showcase").addClass("hide"),"undefined"!=typeof a.tab&&null!==a.tab&&$("#tab").html(a.tab),"undefined"!=typeof a.structure&&null!==a.structure&&(structure=a.structure),change_browser_history_state(a.state.request)})}function logout(){window.location.href="/logout.php"}function decodeEntities(a){return a}function htmlEncode(a){return $("<div/>").text(a).html()}function key_press(a){switch(a.keyCode){case 37:navigate(a,"left");break;case 38:navigate(a,"up");case 39:navigate(a,"right");break;case 40:navigate(a,"down");break;case 13:enter_hit(a)}}function navigate(a,b){if(key_scope)switch(key_scope.type){case"search":navigate_search(a,b);break;case"option":navigate_option(a,key_scope.field,b);break;case"dropdown_select":navigate_dropdown_select(a,key_scope.field,b)}}function navigate_dropdown_select(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_results .result.selected").prev();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"));break;case"down":a.preventDefault();var d=$("#"+b+"_results .result.selected").next();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"))}}function navigate_search(a,b){switch(b){case"up":a.preventDefault();var c=$("#results .result.selected").prev();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"));break;case"down":a.preventDefault();var c=$("#results .result.selected").next();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"))}}function navigate_option(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_options  li.selected").prev();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"));break;case"down":a.preventDefault();var d=$("#"+b+"_options  li.selected").next();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"))}}function enter_hit(a){if(key_scope)switch(key_scope.type){case"search":var b=$("#results .result.selected").attr("view");b&&change_view(b);break;case"dropdown_select":var c=$("#"+key_scope.field+"_results .result.selected").attr("field"),d=$("#"+key_scope.field+"_results .result.selected").attr("value"),e=$("#"+key_scope.field+"_results .result.selected").attr("formatted_value");c&&select_dropdown_option(c,d,e);break;case"option":case"radio_option":case"string":case"telephone":case"email":case"anything":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"date":case"pin":case"password":save_field(key_scope.object,key_scope.key,key_scope.field);break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+key_scope.field+"_confirm").hasClass("hide")?confirm_field(key_scope.field):save_field(key_scope.object,key_scope.key,key_scope.field)}}function delayed_search(a,b){var c=a.val();key_scope={type:"search"},c.length>0?$("#clear_search").removeClass("hide"):$("#clear_search").addClass("hide"),window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){search(c)},b))}function search(a){var b="/ar_search.php?tipo=search&query="+fixedEncodeURIComponent(a)+"&state="+JSON.stringify(state);$.getJSON(b,function(a){console.log(a),a.number_results>0?$("#results_container_shifted").removeClass("hide"):$("#results_container_shifted").addClass("hide"),$("#results .result").remove();var b=!0;for(var c in a.results){var d=$("#search_result_template").clone();d.prop("id","result_"+c),d.addClass("result").removeClass("hide"),d.attr("view",a.results[c].view),b&&(d.addClass("selected"),b=!1),d.children(".label").html(a.results[c].label),d.children(".details").html(a.results[c].details),$("#results").append(d)}})}function clear_search(){$("#search").val(""),$("#clear_search").addClass("hide"),$("#results_container_shifted").removeClass("show"),$("#results .result").remove()}function show_filter(){$("#show_filter").addClass("hide"),$(".filter").removeClass("hide"),$("#filter input").focus()}function show_results_per_page(){var a=$("#results_per_page");a.hasClass("showing_options")?(a.removeClass("showing_options"),$(".results_per_page").addClass("hide")):(a.addClass("showing_options"),$(".results_per_page").removeClass("hide"))}function change_results_per_page(a){$(".results_per_page").removeClass("selected"),$("#results_per_page_"+a).addClass("selected"),rows.setPageSize(a),$("#results_per_page").attr("title",$("#results_per_page").attr("title").replace(/\(.*\)/g,"("+a+")"))}function change_period(a){var b=jQuery.parseJSON(rows.parameters);if("date"==a)b.from=$("#select_date").val(),b.to=$("#select_date").val();else if("interval"==a){var c=$("#select_interval_from").val().split(/\//);b.from=c[2]+"-"+c[0]+"-"+c[1],c=$("#select_interval_to").val().split(/\//),b.to=c[2]+"-"+c[0]+"-"+c[1]}$("#date_chooser div").removeClass("selected"),$("#"+a).addClass("selected"),$("#select_date_control_panel").addClass("hide"),$("#select_interval_control_panel").addClass("hide"),b.period=a,rows.parameters=JSON.stringify(b),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),with_elements&&get_elements_numbers(rows.tab,rows.parameters)}function get_elements_numbers(a,b){var c="/ar_elements.php?tab="+a+"&parameters="+b;$.getJSON(c,function(a){if(200==a.state)for(element in a.elements_numbers)for(item in a.elements_numbers[element])$("#element_qty_"+item).html("("+a.elements_numbers[element][item]+")")})}function show_elements_types(){var a=$("#element_type"),b=$("#element_type .fa");if(b.hasClass("fa-bars")){b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=a.position(),d=a.height();$("#elements_chooser").removeClass("hide").offset({top:c.top+d,left:c.left})}else b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide")}function change_elements_type(a){$("#elements .elements_group").addClass("hide"),$("#elements_group_"+a).removeClass("hide"),$("#elements_chooser  div").removeClass("selected"),$("#element_group_option_"+a).addClass("selected"),$("#elements_chooser  i").removeClass("fa-circle"),$("#elements_chooser  i").addClass("fa-circle-o"),$("#element_group_option_"+a+" i").addClass("fa-circle"),$("#element_group_option_"+a+" i").removeClass("fa-circle-o");var b=$("#element_type .fa");b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide");var c=jQuery.parseJSON(rows.parameters);c.elements_type=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0})}function change_table_element(a,b){a.altKey?($("#elements i").removeClass("fa-check-square-o"),$("#elements i").addClass("fa-square-o"),$("#elements .element").removeClass("selected"),$("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square-o"),$("#element_checkbox_"+b).addClass("fa-check-square-o")):$("#element_"+b).hasClass("selected")?($("#element_"+b).removeClass("selected"),$("#element_checkbox_"+b).removeClass("fa-check-square-o"),$("#element_checkbox_"+b).addClass("fa-square-o")):($("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square-o"),$("#element_checkbox_"+b).addClass("fa-check-square-o"));var c=jQuery.parseJSON(rows.parameters);$("#elements_group_"+c.elements_type+" .element").each(function(a){c.elements[c.elements_type].items[$(this).attr("item_key")].selected=$(this).hasClass("selected")}),rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0})}function show_export_dialog(){$("#export_dialog").hasClass("hide")?($("#export_dialog").removeClass("hide"),$("#export_dialog").css("left",-1*$("#export_dialog").width()),$("#export_dialog").css("top",$("#show_export_dialog").height())):hide_export_dialog()}function hide_export_dialog(){$("#export_dialog").addClass("hide"),hide_export_config_dialog(),$(".export_download").addClass("hide").attr("title","").click(function(){}),$(".export_progress_bar_bg").addClass("hide").html(""),$(".export_progress_bar").css("width","0px").removeClass("hide").attr("title","").html("")}function open_export_config(){$("#export_dialog_config").hasClass("hide")?($("#export_dialog_config").removeClass("hide"),$("#export_dialog_config").css("left",-1*($("#export_dialog_config").width()+40+$("#export_dialog").width())),$("#export_dialog_config").css("top",$("#show_export_dialog").height())):hide_export_config_dialog()}function hide_export_config_dialog(){$("#export_dialog_config").addClass("hide")}function toggle_export_field(a){var b=$("#field_export_"+a);b.hasClass("fa-check-square-o")?(b.removeClass("fa-check-square-o"),b.addClass("fa-square-o")):(b.addClass("fa-check-square-o"),b.removeClass("fa-square-o"))}function export_table(a){$("#export_progress_bar_bg_"+a).removeClass("hide").html("&nbsp;"+$("#export_queued_msg").html()),$("#export_table_excel").removeClass("link").addClass("disabled"),$("#export_table_csv").removeClass("link").addClass("disabled"),$(".field_export").removeClass("button").addClass("disabled"),$("#stop_export_table_"+a).removeClass("hide"),$("#stop_export_table_"+a).attr("stop",0);var b=[];$("#export_dialog_config .field_export i").each(function(a,c){$(c).hasClass("fa-check-square-o")&&b.push($(c).attr("key"))});var c="/ar_export.php?ar_file="+rows.ar_file+"&tipo="+rows.tipo+"&parameters="+rows.parameters+"&type="+a+"&state="+JSON.stringify(state)+"&fields="+JSON.stringify(b);$.getJSON(c,function(b){200==b.state&&get_export_process_bar(b.fork_key,b.tipo,a)})}function stop_export(a){$("#stop_export_table_"+a).attr("stop",1)}function get_export_process_bar(a,b,c){request="/ar_fork.php?tipo=get_process_bar&fork_key="+a+"&tag="+b,$.getJSON(request,function(a){if(200==a.state){if(1==$("#stop_export_table_"+c).attr("stop"))return $(".export_download").addClass("hide").attr("title","").click(function(){}),$(".export_progress_bar_bg").addClass("hide").html(""),$(".export_progress_bar").css("width","0px").removeClass("hide").attr("title","").html(""),$("#export_table_excel").addClass("link").removeClass("disabled"),$("#export_table_csv").addClass("link").removeClass("disabled"),$(".field_export").addClass("button").removeClass("disabled"),void $("#stop_export_table_"+c).addClass("hide");"Queued"==a.fork_state?setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c)},100):"In Process"==a.fork_state?($("#export_download_"+c).addClass("hide"),$("#export_progress_bar_bg_"+c).removeClass("hide").html("&nbsp;"+a.download_info),$("#export_progress_bar_"+c).css("width",a.percentage).removeClass("hide").attr("title",a.progress).html("&nbsp;"+a.download_info),setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c)},250)):"Finished"==a.fork_state&&($("#download_"+c).attr("href","/download.php?file="+a.result),$("#export_download_"+c).removeClass("hide").attr("title",a.result_info).click(function(){$("#download_"+c)[0].click()}),$("#export_progress_bar_bg_"+c).addClass("hide").html(""),$("#export_progress_bar_"+c).css("width","0px").removeClass("hide").attr("title","").html(""),$("#export_table_excel").addClass("link").removeClass("disabled"),$("#export_table_csv").addClass("link").removeClass("disabled"),$(".field_export").addClass("button").removeClass("disabled"),$("#stop_export_table_"+c).addClass("hide"))}})}function validate_field(a,b,c,d,e,f,g,h,i){var j=client_validation(c,d,b,a);if("valid"==j["class"]&&""!=e){var k=JSON.parse(e);if("check_for_duplicates"==k.tipo&&""==b)return j;var j={"class":"waiting",type:""};server_validation(k,f,g,h,i,a,b)}return j}function validate_address(a){var b={"class":"valid",type:""},c=0;return $("#"+a+" input.address_input_field").each(function(a,d){var e=$(d).closest("tr"),f=e.find(".fa-asterisk");f.hasClass("hide")||(""==$(d).val()?(c++,e.find(".show_buttons").removeClass("super_discret success").addClass("error"),"Address Recipient"==$(d).attr("field_name")?valid_state_type="missing_recipient":"Address Line 1"==$(d).attr("field_name")?valid_state_type="missing_addressLine1":"Address Postal Code"==$(d).attr("field_name")?valid_state_type="missing_postalCode":valid_state_type="missing_field",b={"class":"invalid",type:valid_state_type}):e.find(".show_buttons").addClass(" success").removeClass("super_discret error"))}),c>1&&(b={"class":"invalid",type:"missing_fields"}),b}function client_validation(a,b,c,d){var e={"class":"valid",type:""};if(""==c)return b?{"class":"invalid",type:"empty"}:{"class":"valid",type:""};switch(a){case"string":break;case"handle":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"pin":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"password":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"password_with_confirmation":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"date":break;case"telephone":if(1==c.length)return $.isNumeric(c)?{"class":"potentially_valid",type:"short"}:{"class":"invalid",type:"invalid"};if(!$("#"+d).intlTelInput("isValidNumber")){var f=$("#"+d).intlTelInput("getValidationError");if(f==intlTelInputUtils.validationError.TOO_SHORT)return{"class":"potentially_valid",type:"short"};if(f==intlTelInputUtils.validationError.TOO_LONG)return{"class":"invalid",type:"long"};if(f==intlTelInputUtils.validationError.NOT_A_NUMBER)return{"class":"invalid",type:"invalid"};if(f==intlTelInputUtils.validationError.INVALID_COUNTRY_CODE)return{"class":"invalid",type:"invalid_code"}}break;case"email":case"new_email":var g=c.replace(/"[^"]*"/g,"");if(g.match(/"/g));else{if(g.match(/\s/g))return{"class":"invalid",type:"spaces"};if(g.match(/\(|\)|\,|:|;|<|>|\[|\]/g))return g.match(/,/g)?{"class":"invalid",type:"comma"}:{"class":"invalid",type:"invalid_character"};if(g.match(/^([^@]*@){2,}[^@]*$/g))return console.log("error"),{"class":"invalid",type:"double_at"}}var h=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,63})?$/;if(!h.test(c))return{"class":"potentially_valid",type:"invalid"};break;case"time":var i=/^[0-9\:]+$/;if(!i.test(c))return{"class":"invalid",type:"invalid"};if(c.length>5)return{"class":"invalid",type:"invalid"};if(1==c.length){var j=/^[0-9]$/;if(!j.test(c))return{"class":"invalid",type:"invalid"}}else if(2==c.length){var j=/^(1?[0-9]|2[0-3])|[0-9]:$/;if(!j.test(c))return{"class":"invalid",type:"invalid"}}else if(4==c.length){var i=/^(1?[0-9]|2[0-3]|0[0-9])[0-5][0-9]$/;if(i.test(c))return{"class":"valid",type:"valid"};var i=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5]$/;if(i.test(c))return{"class":"potentially_valid",type:"invalid"}}var i=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5][0-9]$/;return i.test(c)?{"class":"valid",type:""}:5==c.length||4==c.length?{"class":"invalid",type:"invalid"}:{"class":"potentially_valid",type:"invalid"};case"smallint_unsigned":var k=validate_signed_integer(c,65535);if(k)return k;break;case"int_unsigned":var k=validate_signed_integer(c,4294967295);if(k)return k;break;case"minutes_in_day":var k=validate_signed_integer(c,1440);if(k)return k;break;case"minutes_in_break":if(0==c)return{"class":"invalid",type:"invalid_break_duration"};var k=validate_signed_integer(c,1440);if(k)return k;break;case"seconds_in_day":var k=validate_signed_integer(c,86400);if(k)return k;break;case"seconds_in_hour":var k=validate_signed_integer(c,3600);if(k)return k;break;case"day_of_month":if(0==c)return{"class":"invalid",type:"invalid_day_of_month"};var k=validate_signed_integer(c,31);if(k)return k;break;case"amount":var l=/^[1-9]\d*(((,\d{3}){1})?(\.\d{0,2})?)$/;if(!l.test(c))return{"class":"invalid",type:"invalid_amount"}}return e}function validate_signed_integer(a,b){return $.isNumeric(a)?a>b?{"class":"invalid",type:"too_big"}:0>a?{"class":"invalid",type:"negative"}:Math.floor(a)!=a?{"class":"invalid",type:"not_integer"}:!1:{"class":"invalid",type:"not_integer"}}function server_validation(a,b,c,d,e,f,g){if(console.log(a.setup),null!=a.parent&&(b=a.parent),null!=a.parent_key&&(c=a.parent_key),null!=a.parent_key_field&&(c=$("#"+a.parent_key_field).val()),$("#"+f+"_editor").addClass("waiting"),null!=a.setup)var h="/ar_setup.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;else var h="/ar_validation.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;console.log(h),$.getJSON(h,function(a){if($("#"+f+"_field").removeClass("waiting invalid valid"),$("#"+f+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud"),$("#"+f+"_formatted_value").hasClass("hide")){if(200==a.state)var b=a.validation,c=a.msg;else var b="invalid",c="Error, can't verify value on server";if($("#"+f+"_msg").html(c),$("#"+f+"_field").addClass(b),$("#fields").hasClass("new_object")){var d=get_form_validation_state();process_form_validation(d)}}})}function open_edit_this_field(a){open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function open_edit_field(a,b,c){var d=$("#"+c+"_container").attr("field_type");switch($("#"+c+"_formatted_value").addClass("hide"),$("#"+c+"_edit_button").addClass("hide"),$("#"+c+"_reset_button").removeClass("hide"),$("#"+c+"_msg").html("").removeClass("success error"),d){case"string":case"handle":case"textarea":case"email":case"new_email":case"numeric":case"amount":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"dimensions":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide");break;case"dropdown_select":$("#"+c+"_dropdown_select_label").removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide");break;case"telephone":case"new_telephone":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});case"address":case"country":case"new_delivery_address":$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});break;case"other_delivery_address":$("#"+c+"_field").removeClass("hide"),$("#show_new_delivery_address_field").addClass("hide"),$("#other_delivery_addresses_field").addClass("hide"),$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+c).removeClass("hide"),$("#"+c+"_confirm_button").removeClass("hide"),$("#"+c).focus();break;case"option":$("#"+c+"_options").removeClass("hide"),$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"radio_option":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_options").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"date":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_datepicker").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"working_hours":$("#working_hours").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"salary":$("#salary").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"parts_list":$("#parts_list").removeClass("hide")}key_scope={type:d,object:a,key:b,field:c}}function close_edit_this_field(a){close_edit_field($(a).closest("tr").attr("field"))}function close_edit_field(a){var b=$("#"+a+"_container").attr("field_type");switch($("#"+a+"_formatted_value").removeClass("hide"),$("#"+a+"_edit_button").removeClass("hide"),$("#"+a+"_reset_button").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),b){case"string":case"handle":case"email":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"textarea":case"numeric":case"amount":case"dimensions":$("#"+a).addClass("hide");break;case"dropdown_select":$("#"+a+"_dropdown_select_label").addClass("hide");break;case"new_email":$("#new_email_formatted_value").html(""),$("#new_email_value").val(""),$("#new_email").val(""),on_changed_value("new_email",""),$("#new_email_field").addClass("hide"),$("#show_new_email_field").removeClass("hide");break;case"telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"}),$("#new_telephone_field").addClass("hide"),$("#show_new_telephone_field").removeClass("hide");break;case"address":case"country":$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"other_delivery_address":$("#"+a+"_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide"),$("#other_delivery_addresses_field").removeClass("hide"),$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_delivery_address":$("#new_delivery_address_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide");break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").addClass("hide");break;case"option":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li.selected").removeClass("selected"),$("#"+a+"_option_"+$("#"+a+"_value").val()).addClass("selected"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");break;case"radio_option":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li").attr("is_selected",0),$("#"+a+"_options li  .checkbox").removeClass("fa-check-square-o").addClass("fa-square-o");for(var c=$("#"+a+"_value").val().split(","),d=0;d<c.length;d++)$("#"+a+"_option_"+c[d]).attr("is_selected",1),$("#"+a+"_option_"+c[d]+" .checkbox").addClass("fa-check-square-o").removeClass("fa-square-o");$("#"+a+"_editor").removeClass("changed");break;case"date":$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_datepicker").addClass("hide"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");var e=chrono.parseDate($("#"+a+"_formatted").val());e.toISOString().slice(0,10);$("#"+a+"_datepicker").datepicker("setDate",e);break;case"working_hours":$("#working_hours").addClass("hide");break;case"salary":$("#salary").addClass("hide");break;case"parts_list":$("#parts_list").addClass("hide")}$("#"+a+"_editor").removeClass("invalid valid"),$("#"+a+"_msg").hasClass("success")||$("#"+a+"_msg").html("").addClass("hide"),key_scope=!1}function delayed_on_change_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_value(c,e)},b))}function on_changed_confirm_value(a,b){""!=b?$("#"+a+"_editor").addClass("changed"):$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_editor").removeClass("invalid valid");var c=$("#"+a).val();if(c==b?validation="valid":c.substring(0,b.length)==b?validation="potentially_valid":validation="invalid",$("#"+a+"_editor").addClass(validation),"invalid"==validation){if($("#"+a+"_no_match_invalid_msg").length)var d=$("#"+a+"_no_match_invalid_msg").html();else var d=$("#not_match_invalid_msg").html();d+=" "}else var d="";$("#"+a+"_msg").html(d)}function on_changed_value(a,b){var c=$("#fields").attr("object");$("#"+c+"_save").hasClass("hide")&&reset_controls();var d=$("#"+a+"_container"),e=d.attr("field_type");if("date"==e&&(b=b+" "+$("#"+a+"_time").val()),b!=$("#"+a+"_value").val());else;$("#"+a+"_field").removeClass("invalid valid potentially_valid"),$("#"+a+"_field").addClass("changed");var f=validate(a,b);process_validation(f,a,!1)}function validate(a,b){var c=$("#"+a+"_container");$("#"+a+"_field").addClass("waiting_validation changed"),$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var d=c.attr("server_validation"),e=c.attr("parent"),f=c.attr("parent_key"),g=c.attr("object"),h=c.attr("key"),i=c.attr("field_type"),j=c.attr("_required");return"salary"==i?validate_salary_components():validate_field(a,b,i,j,d,e,f,g,h)}function process_validation(a,b,c){var d=$("#"+b+"_container"),e=d.attr("field_type");if("potentially_valid"==a["class"]&&c&&(a["class"]="invalid","salary"==e&&$("#salary  input.salary_input_field").each(function(a,b){$(b).hasClass("potentially_valid")&&$(b).removeClass("potentially_valid").addClass("invalid")})),"waiting"!=a["class"]){$("#"+b+"_field").removeClass("waiting_validation"),$("#"+b+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud");var f="";if("valid"==a["class"]?($("#"+b).attr("has_been_valid",1),$("#"+b+"_field").removeClass("invalid potentially_valid").addClass("valid")):"invalid"==a["class"]&&($("#"+b+"_field").removeClass("valid").addClass("invalid"),f=$("#"+b+"_"+a.type+"_invalid_msg").length?$("#"+b+"_"+a.type+"_invalid_msg").html():$("#invalid_msg").html()),$("#"+b+"_msg").html(f),$("#fields").hasClass("new_object")){$("#"+$("#"+b+"_container").attr("object")+"_msg").html("");var g=get_form_validation_state();process_form_validation(g)}void 0!=$("#inline_new_object").attr("object")&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(f).addClass(a["class"]).removeClass("hide"),$("#inline_new_object").removeClass("invalid valid potentially_valid"),$("#inline_new_object").addClass(a["class"]))}}function show_invalid_messages(a){var b=validate(a,$("#"+a).val(),$("#"+a+"_container"));process_validation(b,a,!0)}function select_option(a,b,c){$("#"+a).val(b),$("#"+a+"_formatted").val(c),$("#"+a+"_options li").removeClass("selected"),$("#"+a+"_option_"+b.replace(".",".")).addClass("selected"),$("#"+a+"_container").hasClass("new")&&$("#"+a+"_options").addClass("hide"),on_changed_value(a,b)}function select_radio_option(a,b,c){var d=$("#"+a+"_option_"+b);1==d.attr("is_selected")?($("#"+a+"_option_"+b+" .checkbox").removeClass("fa-check-square-o").addClass("fa-square-o"),d.attr("is_selected",0)):($("#"+a+"_option_"+b+" .checkbox").addClass("fa-check-square-o").removeClass("fa-square-o"),d.attr("is_selected",1));var e=0,f=[],g=[];$("#"+a+"_options li").each(function(){1==$(this).attr("is_selected")&&(e++,f.push($(this).attr("value")),g.push($(this).attr("label")))}),$("#"+a+"_container").hasClass("new")&&$("#"+a+"_formatted").val(g.sort().join()),$("#"+a).val(f.sort().join()),on_changed_value(a,f.sort().join())}function set_this_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function set_as_main(a,b,c){var d="/ar_edit.php?tipo=set_as_main&object="+a+"&key="+b+"&field="+c;$.getJSON(d,function(a){if(200==a.state){if("new_field"==a.action&&a.new_fields)for(var b in a.new_fields)create_new_field(a.new_fields[b]);if(""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")),a.other_fields)for(var b in a.other_fields)update_field(a.other_fields[b]);post_set_as_main(a)}else 400==a.state})}function post_set_as_main(a){}function save_this_field(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function save_this_address(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("table").attr("field"))}function save_field(a,b,c){var d=$("#"+c+"_container"),e=d.attr("field_type");required=d.attr("_required");var f=$("#"+c),g=f.val();if(!$("#"+c+"_field").hasClass("changed"))return void console.log("no_change");if(!$("#"+c+"_field").hasClass("valid"))return console.log("invalid x"),void show_invalid_messages(c);if(!$("#"+c+"_save_button").hasClass("fa-cloud"))return void console.log("waiting for validation");if($("#"+c+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin"),$("#"+c+"_save_button").hasClass("potentially_valid")){var h=d.attr("server_validation"),i=d.attr("parent"),j=d.attr("parent_key"),k=d.attr("object"),b=d.attr("key"),l=validate_field(c,g,e,required,h,i,j,k,b);if($("#"+c).attr("has_been_valid",1),"password_with_confirmation"!=e&&"in_with_confirmation"!=e||$("#"+c+"_confirm").hasClass("hide"))if($("#"+c+"_"+l.type+"_invalid_msg").length)var m=$("#"+c+"_"+l.type+"_invalid_msg").html();else var m=$("#invalid_msg").html();else{if($("#"+c+"_no_match_invalid_msg").length)var m=$("#"+c+"_no_match_invalid_msg").html();else var m=$("#not_match_invalid_msg").html();m+=$("#"+c+"_cancel_confirm_button").html()}return $("#"+c+"_msg").html(m),$("#"+c+"_field").addClass("invalid"),void $("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}var n={};"date"==e?g=g+" "+$("#"+c+"_time").val():"address"==e||"new_delivery_address"==e?g=get_address_value(c):"password"==e||"password_with_confirmation"==e||"password_with_confirmation_paranoid"==e||"pin"==e||"pin_with_confirmation"==e||"pin_with_confirmation_paranoid"==e?g=sha256_digest(g):"telephone"==e&&(g=$("#"+c).intlTelInput("getNumber"),n={extra_fields:[{field:c+"_Formatted",value:fixedEncodeURIComponent($("#"+c).intlTelInput("getNumber",intlTelInputUtils.numberFormat.INTERNATIONAL))}]});var o="/ar_edit.php?tipo=edit_field&object="+a+"&key="+b+"&field="+c+"&value="+fixedEncodeURIComponent(g)+"&metadata="+JSON.stringify(n);$.getJSON(o,function(a){if($("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200==a.state){if($("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),$("#"+c+"_value").val(a.value),$("."+c).html(a.formatted_value),"option"==e?($("#"+c+"_options li .current_mark").removeClass("current"),$("#"+c+"_option_"+g+" .current_mark").addClass("current")):"radio_option"==e?($("#"+c+"_options li .current_mark").removeClass("current"),$("#"+c+"_option_"+g+" .current_mark").addClass("current")):"dropdown_select"==e?$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"):$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),"deleted"==a.action&&($("#"+c+"_edit_button").parent(".show_buttons").css("visibility","hidden"),$("#"+c+"_label").find(".button").addClass("hide")),
""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")),"new_field"==a.action&&a.new_fields)for(var b in a.new_fields)create_new_field(a.new_fields[b]);if(close_edit_field(c),a.other_fields)for(var b in a.other_fields)update_field(a.other_fields[b]);if(a.deleted_fields)for(var b in a.deleted_fields)delete_field(a.deleted_fields[b]);post_save_actions(c,a)}else 400==a.state&&($("#"+c+"_editor").removeClass("valid potentially_valid").addClass("invalid"),$("#"+c+"_msg").html(a.msg).removeClass("hide"))})}function post_save_actions(a,b){switch(a){case"User_Preferred_Locale":change_view(state.request,{reload:!0})}}function create_new_field(a){var b=a.field,c=$("#"+a.clone_from+"_field").clone();if(c.prop("id",b+"_field"),c.attr("field",b),$("#"+a.clone_from+"_field").after(c),c.find(".label").prop("id",b+"_label"),c.find("i.reset_button").prop("id",b+"_reset_button"),c.find("i.edit_button").prop("id",b+"_edit_button"),c.find("td.container").prop("id",b+"_container"),c.find("span.editor").prop("id",b+"_editor"),c.find("span.formatted_value").prop("id",b+"_formatted_value").removeClass(a.clone_from).addClass(b).html(a.formatted_value),c.find("input.unformatted_value").prop("id",b+"_value").val(a.value),"string"==a.edit||"email"==a.edit||"new_email"==a.edit||"int_unsigned"==a.edit||"smallint_unsigned"==a.edit||"mediumint_unsigned"==a.edit||"int"==a.edit||"smallint"==a.edit||"mediumint"==a.edit||"anything"==a.edit||"numeric"==a.edit)c.removeClass("hide"),c.find("input.input_field").prop("id",b).val(a.value),c.find("i.save").prop("id",b+"_save_button").addClass(a.edit),c.find("span.msg").prop("id",b+"_msg");else if("address"==a.edit){c.find("table").prop("id",b).attr("field",b),c.find("tr.recipient ").prop("id",b+"_recipient"),c.find("tr.organization ").prop("id",b+"_organization"),c.find("tr.addressLine1 ").prop("id",b+"_addressLine1"),c.find("tr.addressLine2 ").prop("id",b+"_addressLine2"),c.find("tr.sortingCode ").prop("id",b+"_sortingCode"),c.find("tr.postalCode ").prop("id",b+"_postalCode"),c.find("tr.dependentLocality ").prop("id",b+"_dependentLocality"),c.find("tr.locality ").prop("id",b+"_locality"),c.find("tr.administrativeArea ").prop("id",b+"_administrativeArea"),c.find("tr.country ").prop("id",b+"_country"),c.find("input.country_select ").prop("id",b+"_country_select");var d=jQuery.parseJSON(a.value);$("#"+b+"_recipient  input ").val(decodeEntities(d["Address Recipient"])),$("#"+b+"_organization  input ").val(decodeEntities(d["Address Organization"])),$("#"+b+"_addressLine1  input ").val(decodeEntities(d["Address Line 1"])),$("#"+b+"_addressLine2  input ").val(decodeEntities(d["Address Line 2"])),$("#"+b+"_sortingCode  input ").val(decodeEntities(d["Address Sorting Code"])),$("#"+b+"_postalCode  input ").val(decodeEntities(d["Address Postal Code"])),$("#"+b+"_dependentLocality  input ").val(decodeEntities(d["Address Dependent Locality"])),$("#"+b+"_locality  input ").val(decodeEntities(d["Address Locality"])),$("#"+b+"_administrativeArea  input ").val(decodeEntities(d["Address Administrative Area"]));var e=d["Address Country 2 Alpha Code"].toLowerCase();$("#"+b+"_country_select").intlTelInput({initialCountry:e,preferredCountries:$("#preferred_countries").val().split(",")}),$("#"+b+"_country_select").on("country-change",function(a,c){var d=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").name,e=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").iso2.toUpperCase();d=d.match(/\)\s+\(.+\)$/)?d.replace(/\)\s+\(.+\)$/,")"):d.replace(/\s+\(.+\)$/,""),$("#"+b+"_country  input.address_input_field ").val(e),update_address_fields(b,e,hide_recipient_fields=!1),$("#"+b+"_country_select").val(d),"init"!=c&&on_changed_address_value(b,b+"_country",e)}),$("#"+b+"_country_select").trigger("country-change","init")}void 0!=a.label&&$("#"+b+"_label").html(a.label)}function delete_field(a){var b=a.field;$("#"+b+"_field").addClass("hide")}function update_field(a){var b=a.field,c=$("#"+b+"_container").attr("field_type");a.render?$("#"+b+"_field").removeClass("hide"):($("#"+b+"_field").addClass("hide"),close_edit_field(b)),void 0!=a.label&&$("#"+b+"_label").html(a.label),void 0!=a.value&&("date"==c&&($("."+b).html(a.formatted_value),$("#"+b+"_datepicker").datepicker("setDate",new Date(a.formatted_value)),$("#"+b).val(a.value),$("#"+b+"_formatted").val(a.formatted_value)),"option"==c?($("#"+b+"_formatted_value").html(a.formatted_value),$("#"+b).val(a.value),$("#"+b+"_options li").removeClass("selected").removeClass("current"),$("#"+b+"_option_"+a.value.replace(".",".")).addClass("selected").addClass("current")):($("."+b).html(a.formatted_value),$("#"+b).val(a.value))),post_update_field(a)}function post_update_field(a){}function hide_edit_field_msg(a){$("#"+a+"_msg").html("").addClass("hide")}function confirm_field(a){$("#"+a).addClass("hide"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").removeClass("hide"),$("#"+a+"_save_button").removeClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_confirm").focus()}function cancel_confirm_field(a){$("#"+a).removeClass("hide"),$("#"+a+"_confirm_button").removeClass("hide"),$("#"+a+"_confirm").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_msg").html(""),$("#"+a).val(""),$("#"+a).attr("has_been_valid",0),$("#"+a).focus()}function fixedEncodeURIComponent(a){return encodeURIComponent(a).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}function addZero2dateComponent(a){return 10>a&&(a="0"+a),a}function clean_time(a){var b=/^[0-9]{4}$/;if(b.test(a))c=[a.substring(0,2),a.substring(2,4)];else var c=a.split(":");var d=addZero2dateComponent(parseInt(c[0])),e=addZero2dateComponent(parseInt(c[1])),f="00";return d+":"+e+":"+f}function add_minutes_to_time(a,b){var c=a.split(":"),d=new Date(2e3,0,1,c[0],parseInt(c[1])+parseInt(b),c[2]);return a=addZero2dateComponent(d.getHours())+":"+addZero2dateComponent(d.getMinutes())+":00"}function update_address_fields(a,b,c){var d="/ar_address.php?tipo=fields_data&country_code="+b;console.log(d),$.getJSON(d,function(b){if(200==b.state)for(var d in b.fields){var e=$("#"+a+"_"+d),f=b.fields[d];e.find(".label").html(f.label),f.required?e.find(".fa-asterisk").removeClass("hide"):e.find(".fa-asterisk").addClass("hide"),!f.render||c&&("recipient"==d||"organization"==d)?e.addClass("hide"):e.removeClass("hide"),e.insertBefore("#"+a+"_country")}else 400==b.state})}function delayed_on_change_address_field(a,b){var c=a.closest("table").attr("field"),d=a.closest("tr").attr("id"),e=a.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_address_value(c,d,e)},b))}function get_address_value(a){var b={"Address Recipient":null,"Address Organization":null,"Address Line 1":null,"Address Line 2":null,"Address Sorting Code":null,"Address Postal Code":null,"Address Dependent Locality":null,"Address Locality":null,"Address Administrative Area":null,"Address Country 2 Alpha Code":null};return $("#"+a+" input.address_input_field").each(function(a,c){var d=$(c);""!=d.val()&&(b[d.attr("field_name")]=d.val())}),JSON.stringify(b)}function on_changed_address_value(a,b,c){var d=get_address_value(a);if(d!=$("#"+a+"_value").val()){$("#"+a+"_editor").addClass("changed");var e=!0}else{$("#"+a+"_editor").removeClass("changed");var e=!1}if($("#"+a+"_save_button").removeClass("invalid valid potentially_valid"),$("#"+a+"_msg").removeClass("invalid valid potentially_valid"),$("#"+a+"_validation").removeClass("invalid valid potentially_valid"),e){$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var f=validate_address(a);process_validation(f,a,!0)}else $("#"+a+"_msg").html("")}function set_directory_item_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),a)}function show_directory_item_edit(a){open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),a)}function delete_directory_item(a,b){var c="/ar_edit.php?tipo=delete_object_component&object="+$("#fields").attr("object")+"&key="+$("#fields").attr("key")+"&field="+b;$.getJSON(c,function(a){200==a.state?""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")):400==a.state})}function show_sticky_note_edit_dialog(a){if(console.log("=============="),$("#edit_sticky_note_dialog").hasClass("hide"))if($("#edit_sticky_note_dialog").removeClass("hide"),$("#sticky_note_value").focus(),"sticky_note_button"==a){var b=$("#"+a).position();$("#edit_sticky_note_dialog").css({left:b.left-$("#edit_sticky_note_dialog").width(),top:b.top+$("#"+a).height()})}else{var b=$("#showcase_sticky_note .sticky_note").position();$("#edit_sticky_note_dialog").css({left:b.left,top:b.top})}else close_sticky_note_dialog()}function close_sticky_note_dialog(){$("#edit_sticky_note_dialog").addClass("hide")}function save_sticky_note(){var a=$("#sticky_note_value").val(),b=$("#edit_sticky_note_dialog").attr("object"),c=$("#edit_sticky_note_dialog").attr("key"),d=$("#edit_sticky_note_dialog").attr("field"),e="/ar_edit.php?tipo=edit_field&object="+b+"&key="+c+"&field="+d+"&value="+fixedEncodeURIComponent(a);console.log(e),$.getJSON(e,function(a){200==a.state?(console.log(a),$("#sticky_note_value").val(a.value),$("#showcase_sticky_note .sticky_note").html(a.formatted_value),""==a.value?($("#showcase_sticky_note").addClass("hide"),$("#sticky_note_button").removeClass("hide")):($("#showcase_sticky_note").removeClass("hide"),$("#sticky_note_button").addClass("hide")),close_sticky_note_dialog()):400==a.state})}function delayed_on_change_dropdown_select_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();key_scope={type:"dropdown_select",field:d.attr("field")},window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_dropdown_select(c,e)},b))}function get_dropdown_select(a,b){var c=$("#"+a).attr("scope"),d=$("#"+a).attr("field"),e="/ar_find.php?tipo=find_object&query="+fixedEncodeURIComponent(b)+"&scope="+c+"&state="+JSON.stringify(state);$.getJSON(e,function(a){a.number_results>0?$("#"+d+"_results_container").removeClass("hide").addClass("show"):($("#"+d+"_results_container").addClass("hide").removeClass("show"),$("#"+d).val(""),on_changed_value(d,"")),$("#"+d+"_results .result").remove();var b=!0;for(var c in a.results){var e=$("#"+d+"_search_result_template").clone();e.prop("id",d+"_result_"+c),e.addClass("result").removeClass("hide"),e.attr("value",a.results[c].value),e.attr("formatted_value",a.results[c].formatted_value),e.attr("field",d),b&&(e.addClass("selected"),b=!1),e.children(".code").html(a.results[c].code),e.children(".label").html(a.results[c].description),$("#"+d+"_results").append(e)}})}function select_dropdown_option(a,b,c){$("#"+a+"_dropdown_select_label").val(c),$("#"+a).val(b),on_changed_value(a,b),$("#"+a+"_results_container").addClass("hide").removeClass("show")}function toggle_options(a){$("#"+a+"_options").hasClass("hide")?$("#"+a+"_options").removeClass("hide"):$("#"+a+"_options").addClass("hide")}function show_options(a){$("#"+a+"_options").removeClass("hide")}function hide_options(a){$("#"+a+"_options").addClass("hide")}function get_form_validation_state(a){return form_validation="valid",$(".value").each(function(a){var b=$(this).attr("field");$("#"+b+"_field").hasClass("invalid")?component_validation="invalid":$("#"+b+"_field").hasClass("valid")?component_validation="valid":component_validation="potentially_valid","invalid"==component_validation&&(form_validation="invalid"),"invalid"!=form_validation&&"potentially_valid"==component_validation&&(form_validation="potentially_valid")}),form_validation}function process_form_validation(a,b){b&&"potentially_valid"==a&&(a="invalid"),$("#fields").removeClass("invalid valid potentially_valid").addClass(a)}function check_if_form_is_valid(){var a=$("#fields").attr("object"),b=!0;$(".value").each(function(a){var c=$(this).attr("field");$("#"+c).val();$("#"+c+"_validation").hasClass("valid")||(b=!1)}),b?$("#"+a+"_save").addClass("valid").removeClass("invalid"):$("#"+a+"_save").removeClass("valid").addClass("invalid")}function save_new_object(a,b){var c=get_form_validation_state();if(process_form_validation(c,!0),$("#fields").hasClass("valid")){$("#fields").removeClass("valid").addClass("waiting"),$("#"+a+"_save_icon").removeClass("fa-cloud"),$("#"+a+"_save_icon").addClass("fa-spinner fa-spin"),$("#save_label").addClass("hide"),$("#saving_label").removeClass("hide");var d={},e=new RegExp("_","g"),f=new FormData;if($(".value").each(function(a){var b=$(this).attr("field"),c=$(this).attr("field_type");if("time"==c)g=clean_time($("#"+b).val());else if("password"==c||"password_with_confirmation"==c||"password_with_confirmation_paranoid"==c||"pin"==c||"pin_with_confirmation"==c||"pin_with_confirmation_paranoid"==c)g=sha256_digest($("#"+b).val());else if("attachment"==c)f.append("file",$("#"+b).prop("files")[0]),g="";else var g=$("#"+b).val();d[b.replace(e," ")]=g}),"setup"==b)return void save_setup(a,d);var g="/ar_edit.php?tipo=new_object&object="+a+"&parent="+$("#fields").attr("parent")+"&parent_key="+$("#fields").attr("parent_key")+"&fields_data="+JSON.stringify(d);console.log(g),f.append("tipo",""!=b?b:"new_object"),f.append("object",a),f.append("parent",$("#fields").attr("parent")),f.append("parent_key",$("#fields").attr("parent_key")),f.append("fields_data",JSON.stringify(d));var g=$.ajax({url:"/ar_edit.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(b){if(console.log(b),$("#"+a+"_save_icon").addClass("fa-cloud"),$("#"+a+"_save_icon").removeClass("fa-spinner fa-spin"),$("#save_label").removeClass("hide"),$("#saving_label").addClass("hide"),$("#fields").removeClass("waiting"),200==b.state){$("#result").html(b.pcard).removeClass("hide"),$("#fields").addClass("hide");for(var c in b.updated_data)$("."+c).html(b.updated_data[c]);post_new_actions(a,b)}else 400==b.state&&($("#fields").addClass("error"),$("#"+a+"_msg").html(b.msg).removeClass("hide"))}),g.fail(function(b,c){console.log(c),console.log(b.responseText),$("#"+a+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#fields").removeClass("waiting").addClass("valid"),$("#save_label").removeClass("hide"),$("#saving_label").addClass("hide"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function post_new_actions(a,b){switch(a){case"Timesheet_Record":rows.fetch({reset:!0})}}function save_inline_new_object(a){var b=$("#inline_new_object").attr("object"),c=$("#inline_new_object").attr("parent"),d=$("#inline_new_object").attr("parent_key"),e=$("#inline_new_object").attr("field"),f=$("#"+e+"_container").attr("field_type");if($("#inline_new_object").hasClass("valid")){$("#inline_new_object").removeClass("valid "),$("#"+b+"_save").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var g={},h=new RegExp("_","g");if("time"==f)i=clean_time($("#"+e).val()),i=$("#"+e+"_date").val()+" "+i;else var i=$("#"+e).val();g[e.replace(h," ")]=i;var j=new FormData;j.append("tipo","new_object"),j.append("object",b),j.append("parent",c),j.append("parent_key",d),j.append("fields_data",JSON.stringify(g));var k=$.ajax({url:"/ar_edit.php",data:j,processData:!1,contentType:!1,type:"POST",dataType:"json"});k.done(function(c){if($("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200==c.state){$("#inline_new_object_msg").html(c.msg).addClass("success"),$("#inline_new_object").addClass("hide"),$("#icon_"+a).addClass("fa-plus"),$("#icon_"+a).removeClass("fa-times"),$("#"+e).val("").attr("has_been_valid",0),$("#inline_new_object").addClass("potentially_valid");for(var d in c.updated_data)$("."+d).html(c.updated_data[d]);rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0})}else 400==c.state&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(c.msg).addClass("invalid"),$("#inline_new_object").addClass("invalid"))}),k.fail(function(a,c){console.log(c),console.log(a.responseText),$("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function toggle_inline_new_object_form(a){var b=$("#inline_new_object").attr("field");$("#"+b+"_container").attr("field_type");$("#inline_new_object_msg").html("").removeClass("error success"),$("#icon_"+a).hasClass("fa-plus")?($("#inline_new_object").removeClass("hide"),$("#icon_"+a).removeClass("fa-plus").addClass("fa-times"),$("#"+b).val("")):($("#inline_new_object").addClass("hide"),$("#icon_"+a).addClass("fa-plus").removeClass("fa-times"))}function clone_it(){$("#result").html(""),$("#fields").removeClass("hide"),$("#result").addClass("hide")}function change_to_new_object_view(){var a=$("#fields").attr("object");request=$("#"+a+"_go_new").attr("request"),change_view(request)}function reset_controls(){var a=$("#fields").attr("object");$("#"+a+"_save").removeClass("hide"),$(".results").addClass("hide"),$("#"+a+"_msg").html("").addClass("hide").removeClass("success"),$("#"+a+"_go_new").attr("request","")}function update_new_address_fields(a,b,c,d){var e="/ar_address.php?tipo=fields_data&country_code="+b;$.getJSON(e,function(b){if(200==b.state){for(var e in b.fields){var f=$("#"+a+"_"+e+"_field"),g=$("#"+a+"_"+e+"_container"),h=b.fields[e];f.find(".label").html(h.label),console.log(h),h.required?(g.attr("_required",1),f.find(".fa-asterisk").addClass("required")):(g.attr("_required",0),f.find(".fa-asterisk").removeClass("required")),!h.render||c&&("recipient"==e||"organization"==e)?f.addClass("hide"):f.removeClass("hide"),f.insertBefore("#"+a+"_country_field")}$(".address_value").each(function(a){var b=$(this).attr("field"),c=$("#"+b).val(),e=$("#"+b+"_container"),f=e.attr("field_type"),g=e.attr("server_validation"),h=e.attr("parent"),i=e.attr("parent_key"),j=e.attr("object"),k=e.attr("key");if(1==e.attr("_required"))var l=!0;else var l=!1;var m=validate_field(b,c,f,l,g,h,i,j,k);"init"==d&&"invalid"==m["class"]&&""==c&&(m["class"]="potentially_valid"),$("#"+b+"_field").removeClass("invalid potentially_valid valid").addClass(m["class"])})}else 400==b.state})}var key_scope=!1;window.addEventListener("popstate",function(a){change_view(a.state.request)});var isAdvancedUpload=function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&"FormData"in window&&"FileReader"in window}();$(document).on("input propertychange","#search",function(){var a=200;window.event&&"propertychange"==event.type&&"value"!=event.propertyName||delayed_search($(this),a)});