function delayed_save_whiteboard_content(a,b){window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){save_whiteboard_content(a)},b))}function save_whiteboard_content(a){var b=new FormData;b.append("tipo","save_whiteboard"),b.append("state",JSON.stringify(state)),b.append("content",$(a).html()),b.append("block",$(a).data("block")),$.ajax({url:"/ar_edit_help.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state||"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function get_real_time_users(){var a="/ar_real_time.php?tipo=users";$.getJSON(a,function(a){$(".real_time_users.side_content  .content").html(a.html).removeClass("hide")})}function help(){var a="/ar_help.php?state="+JSON.stringify(state);$.getJSON(a,function(a){"undefined"!=typeof a.help.title&&null!==a.help.title&&""!=a.help.title?$("#help  .help_title").html(a.help.title).removeClass("hide"):$("#help  .help_title").html("").addClass("hide"),"undefined"!=typeof a.help.content&&null!==a.help.content&&""!=a.help.content?($("#help  .content").html(a.help.content).removeClass("hide"),1==$("#help  .content .question").length&&show_answer($("#help  .content .question")[0])):$("#help  .content").html("").addClass("hide"),$("#whiteboard_content").html(a.whiteboard.content).removeClass("hide").data("empty",a.whiteboard.empty),$("#whiteboard_content_tab").html(a.whiteboard.content_tab).removeClass("hide").data("empty",a.whiteboard.empty_tab),$("#whiteboard_content_title").html(a.whiteboard.page_title),$("#whiteboard_content_tab_title").html(a.whiteboard.tab_title),a.whiteboard.has_tab?$("#whiteboard_content_tab").removeClass("hide"):$("#whiteboard_content_tab").addClass("hide")})}function show_answer(a){$(a).next().hasClass("hide")?($("#help .answer").addClass("hide"),$(a).find(".fa-caret-right.bullet").removeClass("fa-caret-right").addClass("fa-caret-down"),$(a).next().removeClass("hide")):($("#help .answer").addClass("hide"),$(a).find(".fa-caret-down.bullet").removeClass("fa-caret-down").addClass("fa-caret-right"))}function show_side_content(a){switch($(".side_content").addClass("hide"),$(".side_content_icon").removeClass("selected"),$("#notifications ."+a+"_button").addClass("selected"),$(".side_content."+a).removeClass("hide"),a){case"help":help();break;case"real_time_users":get_real_time_users()}var b="/ar_edit_help.php?tipo=side_block&value="+a;$.getJSON(b,function(a){})}function key_press(a){switch(a.keyCode){case 37:navigate(a,"left");break;case 38:navigate(a,"up");case 39:navigate(a,"right");break;case 40:navigate(a,"down");break;case 13:enter_hit(a)}}function navigate(a,b){if(key_scope)switch(key_scope.type){case"search":navigate_search(a,b);break;case"option":navigate_option(a,key_scope.field,b);break;case"dropdown_select":navigate_dropdown_select(a,key_scope.field,b)}}function navigate_dropdown_select(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_results .result.selected").prev();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"));break;case"down":a.preventDefault();var d=$("#"+b+"_results .result.selected").next();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"))}}function navigate_search(a,b){switch(b){case"up":a.preventDefault();var c=$("#results .result.selected").prev();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"));break;case"down":a.preventDefault();var c=$("#results .result.selected").next();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"))}}function navigate_option(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_options  li.selected").prev();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"));break;case"down":a.preventDefault();var d=$("#"+b+"_options  li.selected").next();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"))}}function enter_hit(a){if(key_scope)switch(key_scope.type){case"search":var b=$("#results .result.selected").attr("view");b&&change_view(b);break;case"dropdown_select":var c=$("#"+key_scope.field+"_results .result.selected").attr("field"),d=$("#"+key_scope.field+"_results .result.selected").attr("value"),e=$("#"+key_scope.field+"_results .result.selected").attr("formatted_value");c&&select_dropdown_option(c,d,e);break;case"option":case"option_multiple_choices":case"string":case"telephone":case"email":case"anything":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"date":case"pin":case"password":save_field(key_scope.object,key_scope.key,key_scope.field);break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+key_scope.field+"_confirm").hasClass("hide")?confirm_field(key_scope.field):save_field(key_scope.object,key_scope.key,key_scope.field)}}function open_edit_this_field(a){var b=$(a).closest("tr").attr("field");$("#"+b+"_lock").hasClass("hide")&&open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),b)}function open_edit_field(a,b,c){console.log(a),console.log(b),console.log(c);var d=$("#"+c+"_container").attr("field_type");switch($("#"+c+"_formatted_value").addClass("hide"),$("#"+c+"_edit_button").addClass("hide"),$("#"+c+"_reset_button").removeClass("hide"),$("#"+c+"_msg").html("").removeClass("success error"),console.log(d),d){case"string":case"handle":case"textarea":case"email":case"new_email":case"numeric":case"amount":case"amount_margin":case"amount_percentage":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"numeric_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"dimensions":case"percentage":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide");break;case"editor":$("#editor_container_"+c).removeClass("hide");break;case"upload":$("#edit_object_upload_"+c).removeClass("hide");break;case"html_editor":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide");break;case"barcode":""==$("#"+c+"_value").val()&&$("#"+c+"_assign_available_barcode").removeClass("hide"),$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide");break;case"dropdown_select":$("#"+c+"_dropdown_select_label").removeClass("hide").focus(),$("#"+c+"_save_button").removeClass("hide");break;case"country_select":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"telephone":case"new_telephone":$("#"+c).removeClass("hide"),$("#"+c).focus(),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});case"address":case"country":case"new_delivery_address":$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"other_delivery_address":$("#"+c+"_field").removeClass("hide"),$("#show_new_delivery_address_field").addClass("hide"),$("#other_delivery_addresses_field").addClass("hide"),$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+c).removeClass("hide"),$("#"+c+"_confirm_button").removeClass("hide"),$("#"+c).focus();break;case"option":$("#"+c+"_add_other_option").removeClass("hide"),$("#"+c+"_options").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"option_multiple_choices":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_options").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"date":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_datepicker").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),"yes"==$("#"+c+"_eraser").attr("display")&&""!=$("#"+c+"_formatted").val()&&$("#"+c+"_eraser").removeClass("hide");break;case"working_hours":$("#working_hours").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"salary":$("#salary").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"parts_list":$("#parts_list").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"mixed_recipients":$("#"+c+"_container").find(".mixed_recipients_container").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"webpage_see_also":$("#webpage_see_also").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"webpage_related_products":$("#webpage_related_products").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide")}key_scope={type:d,object:a,key:b,field:c}}function show_add_other_option(a){$("#"+a+"_add_other_option").hasClass("fa-plus")?($("#"+a).removeClass("hide"),$("#"+a+"_options").addClass("hide"),$("#"+a+"_add_other_option").removeClass("fa-plus").addClass("fa-list-ul")):($("#"+a).addClass("hide"),$("#"+a+"_options").removeClass("hide"),$("#"+a+"_add_other_option").addClass("fa-plus").removeClass("fa-list-ul"))}function close_edit_this_field(a){close_edit_field($(a).closest("tr").attr("field"))}function close_edit_field(a){console.log(a);var b=$("#"+a+"_container").attr("field_type");switch($("#"+a+"_formatted_value").removeClass("hide"),$("#"+a+"_edit_button").removeClass("hide"),$("#"+a+"_reset_button").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),b){case"string":case"handle":case"email":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"textarea":case"numeric":case"amount":case"amount_margin":case"amount_percentage":case"dimensions":case"percentage":case"numeric_unsigned":$("#"+a).addClass("hide");break;case"editor":$("#editor_container_"+a).addClass("hide");break;case"upload":$("#edit_object_upload_"+a).addClass("hide");break;case"html_editor":$("#"+a).addClass("hide");break;case"barcode":$("#"+a+"_assign_available_barcode").addClass("hide"),$("#"+a).addClass("hide");break;case"country_select":$("#"+a+"_field div.country-select.inside .flag-dropdown").css({display:"none"}),$("#"+a).addClass("hide");break;case"dropdown_select":$("#"+a+"_dropdown_select_label").addClass("hide"),$("#"+a+"_results_container").addClass("hide").removeClass("show");break;case"new_email":$("#new_email_formatted_value").html(""),$("#new_email_value").val(""),$("#new_email").val(""),on_changed_value("new_email",""),$("#new_email_field").addClass("hide"),$("#show_new_email_field").removeClass("hide");break;case"telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"}),$("#new_telephone_field").addClass("hide"),$("#show_new_telephone_field").removeClass("hide");break;case"address":case"country":$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"other_delivery_address":$("#"+a+"_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide"),$("#other_delivery_addresses_field").removeClass("hide"),$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_delivery_address":$("#new_delivery_address_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide");break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").addClass("hide");break;case"option":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li.selected").removeClass("selected"),$("#"+a+"_option_"+$("#"+a+"_value").val()).addClass("selected"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");break;case"option_multiple_choices":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li").attr("is_selected",0),$("#"+a+"_options li  .checkbox").removeClass("fa-check-square").addClass("fa-square");for(var c=$("#"+a+"_value").val().split(","),d=0;d<c.length;d++)$("#"+a+"_option_"+c[d]).attr("is_selected",1),$("#"+a+"_option_"+c[d]+" .checkbox").addClass("fa-check-square").removeClass("fa-square");$("#"+a+"_editor").removeClass("changed");break;case"date":$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_datepicker").addClass("hide"),$("#"+a+"_eraser").addClass("hide"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");var e=chrono.parseDate($("#"+a+"_formatted").val());e.toISOString().slice(0,10);$("#"+a+"_datepicker").datepicker("setDate",e);break;case"working_hours":$("#working_hours").addClass("hide");break;case"salary":$("#salary").addClass("hide");break;case"parts_list":$("#parts_list").addClass("hide");break;case"mixed_recipients":$("#"+a+"_container").find(".mixed_recipients_container").addClass("hide");break;case"webpage_see_also":$("#webpage_see_also").addClass("hide");break;case"webpage_related_products":$("#webpage_related_products").addClass("hide")}$("#"+a+"_editor").removeClass("invalid valid"),$("#"+a+"_msg").hasClass("success")||$("#"+a+"_msg").html("").addClass("hide"),key_scope=!1}function delayed_on_change_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_value(c,e)},b))}function on_changed_confirm_value(a,b){""!=b?$("#"+a+"_editor").addClass("changed"):$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_editor").removeClass("invalid valid");var c=$("#"+a).val();if(c==b?validation="valid":c.substring(0,b.length)==b?validation="potentially_valid":validation="invalid",$("#"+a+"_editor").addClass(validation),"invalid"==validation){if($("#"+a+"_no_match_invalid_msg").length)var d=$("#"+a+"_no_match_invalid_msg").html();else var d=$("#not_match_invalid_msg").html();d+=" "}else var d="";$("#"+a+"_msg").html(d)}function on_changed_value(a,b){var c=$("#fields").attr("object");$("#"+c+"_save").hasClass("hide")&&reset_controls();var d=$("#"+a+"_container"),e=d.attr("field_type");"date"!=e&&"date_interval"!=e||(b=b+" "+$("#"+a+"_time").val()),$("#"+a).closest("tbody.address_fields").attr("has_been_changed",1),$("#"+a).attr("has_been_changed",1),$("#"+a+"_field").removeClass("invalid valid potentially_valid");var f=validate(a,b);process_validation(f,a,!1)}function validate(a,b){var c=$("#"+a+"_container");$("#"+a+"_field").addClass("waiting_validation changed"),$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var d=c.attr("server_validation"),e=c.attr("parent"),f=c.attr("parent_key"),g=c.attr("object"),h=c.attr("key"),i=c.attr("field_type");if(c.hasClass("address_value"))var j=c.closest("tbody.address_fields").attr("_required");else var j=c.attr("_required");return"salary"==i?validate_salary_components():validate_field(a,b,i,j,d,e,f,g,h)}function process_validation(a,b,c){var d=$("#"+b+"_container"),e=d.attr("field_type");if("potentially_valid"==a["class"]&&c&&(a["class"]="invalid","salary"==e&&$("#salary  input.salary_input_field").each(function(a,b){$(b).hasClass("potentially_valid")&&$(b).removeClass("potentially_valid").addClass("invalid")})),"waiting"!=a["class"]){$("#"+b+"_field").removeClass("waiting_validation"),$("#"+b+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud");var f="";if("valid"==a["class"]?($("#"+b).attr("has_been_valid",1),$("#"+b+"_field").removeClass("invalid potentially_valid").addClass("valid")):"invalid"==a["class"]&&($("#"+b+"_field").removeClass("valid").addClass("invalid"),f=$("#"+b+"_"+a.type+"_invalid_msg").length?$("#"+b+"_"+a.type+"_invalid_msg").html():$("#invalid_msg").html()),$("#"+b+"_msg").html(f),$("#fields").hasClass("new_object")){$("#"+$("#"+b+"_container").attr("object")+"_msg").html("");var g=get_form_validation_state();process_form_validation(g)}void 0!=$("#inline_new_object").attr("object")&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(f).addClass(a["class"]).removeClass("hide"),$("#inline_new_object").removeClass("invalid valid potentially_valid"),$("#inline_new_object").addClass(a["class"]))}}function show_invalid_messages(a){var b=validate(a,$("#"+a).val(),$("#"+a+"_container"));process_validation(b,a,!0)}function select_option(a,b,c){$("#"+b).val(c),$("#"+b+"_options li").removeClass("selected"),$(a).addClass("selected"),$("#fields").hasClass("new_object"),on_changed_value(b,c)}function select_option_multiple_choices(a,b,c){var d=$("#"+a+"_option_"+b);1==d.attr("is_selected")?($("#"+a+"_option_"+b+" .checkbox").removeClass("fa-check-square").addClass("fa-square"),d.attr("is_selected",0)):($("#"+a+"_option_"+b+" .checkbox").addClass("fa-check-square").removeClass("fa-square"),d.attr("is_selected",1));var e=0,f=[],g=[];$("#"+a+"_options li").each(function(){1==$(this).attr("is_selected")&&(e++,f.push($(this).attr("value")),g.push($(this).attr("label")))}),$("#"+a+"_container").hasClass("new")&&$("#"+a+"_formatted").val(g.sort().join()),$("#"+a).val(f.sort().join()),on_changed_value(a,f.sort().join())}function set_this_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function set_as_main(a,b,c){var d="/ar_edit.php?tipo=set_as_main&object="+a+"&key="+b+"&field="+c;$.getJSON(d,function(a){if(console.log(a),200==a.state){if("new_field"==a.action&&a.new_fields)for(var b in a.new_fields)create_new_field(a.new_fields[b]);if(""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")),a.other_fields)for(var b in a.other_fields)update_field(a.other_fields[b]);post_set_as_main(a)}else 400==a.state})}function post_set_as_main(a){}function save_this_field(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function save_this_address(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("table").attr("field"))}function save_field(a,b,c){var d=$("#"+c+"_container"),e=d.attr("field_type");required=d.attr("_required");var f=$("#"+c),g=f.val();if(!$("#"+c+"_field").hasClass("changed"))return console.log($("#"+c+"_field")),void console.log("no_change :("+c);if(!$("#"+c+"_field").hasClass("valid"))return console.log("field invalid x"),void show_invalid_messages(c);if(!$("#"+c+"_save_button").hasClass("fa-cloud"))return void console.log("waiting for validation");if($("#"+c+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin"),$("#"+c+"_save_button").hasClass("potentially_valid")){var h=d.attr("server_validation"),i=d.attr("parent"),j=d.attr("parent_key"),k=d.attr("object"),b=d.attr("key"),l=validate_field(c,g,e,required,h,i,j,k,b);if($("#"+c).attr("has_been_valid",1),"password_with_confirmation"!=e&&"in_with_confirmation"!=e||$("#"+c+"_confirm").hasClass("hide"))if($("#"+c+"_"+l.type+"_invalid_msg").length)var m=$("#"+c+"_"+l.type+"_invalid_msg").html();else var m=$("#invalid_msg").html();else{if($("#"+c+"_no_match_invalid_msg").length)var m=$("#"+c+"_no_match_invalid_msg").html();else var m=$("#not_match_invalid_msg").html();m+=$("#"+c+"_cancel_confirm_button").html()}return $("#"+c+"_msg").html(m),$("#"+c+"_field").addClass("invalid"),void $("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}var n={};if(console.log(e),"date"==e)g=g+" "+$("#"+c+"_time").val();else if("address"==e||"new_delivery_address"==e||"other_delivery_address"==e)g=get_address_value(c);else if("password"==e||"password_with_confirmation"==e||"password_with_confirmation_paranoid"==e||"pin"==e||"pin_with_confirmation"==e||"pin_with_confirmation_paranoid"==e)g=sha256_digest(g);else if("telephone"==e)g=$("#"+c).intlTelInput("getNumber");else if("country_select"==e)g=$("#"+c).countrySelect("getSelectedCountryData").code;else if("parts_list"==e){var o=[];$("#parts_list_items  tr.part_tr").each(function(a,b){if(!$(b).find(".sku").val())return!0;if($(b).hasClass("very_discreet"))var c=0;else var c=$(b).find(".parts_per_product").val();var d={Key:$(b).find(".product_part_key").val(),"Part SKU":$(b).find(".sku").val(),Ratio:c,Note:$(b).find(".note").val()};o.push(d)}),g=JSON.stringify(o)}else if("webpage_see_also"==e){var p={};$("#see_also_type").hasClass("fa-toggle-on")?p.type="Auto":p.type="Manual",p.number_links=$("#see_also_number_links").val(),p.manual_links=[],$("#manual_links  input.webpage_key").each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&p.manual_links.push($(b).val())}),g=JSON.stringify(p),console.log(g)}else if("webpage_related_products"==e)webpage_related_products=[],$("#webpage_related_products  input.product_id").each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&webpage_related_products.push($(b).val())}),g=JSON.stringify(webpage_related_products);else if("mixed_recipients"==e){external_emails=[],user_keys=[];var q=$("#"+c+"_field").find(".mixed_recipients_container");$(".external_email_mixed_recipients_value",q).each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&external_emails.push($(b).val())}),$(".user_key",q).each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&user_keys.push($(b).val())});var r={external_emails:external_emails,user_keys:user_keys};g=JSON.stringify(r)}if("setup"==$("#fields").attr("form_type")){var s="/ar_upload.php";"/ar_setup.php?tipo=edit_field&object="+a+"&key="+b+"&field="+c+"&value="+fixedEncodeURIComponent(g)+"&metadata="+JSON.stringify(n)}else{var s="/ar_edit.php";"/ar_edit.php?tipo=edit_field&object="+a+"&key="+b+"&field="+c+"&value="+fixedEncodeURIComponent(g)+"&metadata="+JSON.stringify(n)}var t=new FormData;t.append("tipo","edit_field"),t.append("object",a),t.append("key",b),t.append("field",c),t.append("value",g),t.append("metadata",JSON.stringify(n)),$.ajax({url:s,type:"POST",data:t,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if(console.log(a),$("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),100==a.state&&pre_save_actions(c,a),200==a.state){if($("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),$("#"+c+"_value").val(a.value),$("#"+c+"_field").removeClass("changed"),$("#"+c+"_field").removeClass("valid"),$("."+c).html(a.formatted_value),"option"==e?($("#"+c+"_options li i.current_mark").removeClass("current"),$("#"+c+"_options li.selected  i.current_mark").addClass("current")):"option_multiple_choices"==e?($("#"+c+"_options li .current_mark").removeClass("current"),$("#"+c+"_option_"+g+" .current_mark").addClass("current")):"dropdown_select"==e?$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"):$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),"deleted"==a.action&&($("#"+c+"_edit_button").parent(".show_buttons").css("visibility","hidden"),$("#"+c+"_label").find(".button").addClass("hide")),""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")),"new_field"==a.action&&a.new_fields)for(var b in a.new_fields)create_new_field(a.new_fields[b]);if(close_edit_field(c),a.other_fields)for(var b in a.other_fields)update_field(a.other_fields[b]);if(a.deleted_fields)for(var b in a.deleted_fields)delete_field(a.deleted_fields[b]);for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide");post_save_actions(c,a)}else 400==a.state&&($("#"+c+"_editor").removeClass("valid potentially_valid").addClass("invalid"),$("#"+c+"_msg").html(a.msg).removeClass("hide"))},error:function(){}})}function pre_save_actions(a,b){}function post_save_actions(a,b){switch(a){case"Prospect_Customer_Key":change_view(state.request,{reload_showcase:1});break;case"Webpage_See_Also":$(".webpage_see_also_editor").html(b.update_metadata.webpage_see_also_editor);break;case"Webpage_Related_Products":$(".webpage_related_products_editor").html(b.update_metadata.webpage_related_products_editor);break;case"User_Preferred_Locale":change_view(state.request,{reload:!0});break;case"Product_Parts":post_save_product_parts(b);break;case"Staff_Type":"contractor"==state.section&&"Contractor"!=b.value&&change_view("/employee/"+state.key),"employee"==state.section&&"Contractor"==b.value&&change_view("/contractor/"+state.key);break;case"Staff_Currently_Working":"employee"==state.section&&change_view("/employee/"+state.key,{reload_showcase:1}),"contractor"==state.section&&change_view("/contractor/"+state.key,{reload_showcase:1});break;case"Supplier_Part_Supplier_Key":change_view(b.update_metadata.request,{reload_showcase:1})}}function create_new_field(a){var b=a.field,c=$("#"+a.clone_from+"_field").clone();if(c.prop("id",b+"_field"),c.removeClass("hide"),c.attr("field",b),$("#"+a.clone_from+"_field").after(c),c.find(".label").prop("id",b+"_label"),c.find("i.reset_button").prop("id",b+"_reset_button"),c.find("i.edit_button").prop("id",b+"_edit_button"),c.find("i.lock").prop("id",b+"_lock"),c.find("td.container").prop("id",b+"_container"),c.find("span.editor").prop("id",b+"_editor"),c.find("span.formatted_value").prop("id",b+"_formatted_value").removeClass(a.clone_from).addClass(b).html(a.formatted_value),c.find("input.unformatted_value").prop("id",b+"_value").val(a.value),"string"==a.edit||"email"==a.edit||"new_email"==a.edit||"int_unsigned"==a.edit||"smallint_unsigned"==a.edit||"mediumint_unsigned"==a.edit||"int"==a.edit||"smallint"==a.edit||"mediumint"==a.edit||"anything"==a.edit||"numeric"==a.edit)c.removeClass("hide"),c.find("input.input_field").prop("id",b).val(a.value),c.find("i.save").prop("id",b+"_save_button").addClass(a.edit),c.find("span.msg").prop("id",b+"_msg");else if("telephone"==a.edit||"new_telephone"==a.edit)c.removeClass("hide"),c.find("input.input_field").prop("id",b).val(a.value),c.find("i.save").prop("id",b+"_save_button").addClass(a.edit),c.find("span.msg").prop("id",b+"_msg"),$("#"+b).intlTelInput({utilsScript:"/js/libs/telephone_utils.js",defaultCountry:"GB",preferredCountries:["GB","US"]}),$("#"+b).intlTelInput("setNumber",a.value);else if("address"==a.edit){c.find("table").prop("id",b).attr("field",b),c.find("tr.recipient ").prop("id",b+"_recipient"),c.find("tr.organization ").prop("id",b+"_organization"),c.find("tr.addressLine1 ").prop("id",b+"_addressLine1"),c.find("tr.addressLine2 ").prop("id",b+"_addressLine2"),c.find("tr.sortingCode ").prop("id",b+"_sortingCode"),c.find("tr.postalCode ").prop("id",b+"_postalCode"),c.find("tr.dependentLocality ").prop("id",b+"_dependentLocality"),c.find("tr.locality ").prop("id",b+"_locality"),c.find("tr.administrativeArea ").prop("id",b+"_administrativeArea"),c.find("tr.country ").prop("id",b+"_country"),c.find("input.country_select ").prop("id",b+"_country_select");var d=JSON.parse(a.value);$("#"+b+"_recipient  input ").val(decodeEntities(d["Address Recipient"])),$("#"+b+"_organization  input ").val(decodeEntities(d["Address Organization"])),$("#"+b+"_addressLine1  input ").val(decodeEntities(d["Address Line 1"])),$("#"+b+"_addressLine2  input ").val(decodeEntities(d["Address Line 2"])),$("#"+b+"_sortingCode  input ").val(decodeEntities(d["Address Sorting Code"])),$("#"+b+"_postalCode  input ").val(decodeEntities(d["Address Postal Code"])),$("#"+b+"_dependentLocality  input ").val(decodeEntities(d["Address Dependent Locality"])),$("#"+b+"_locality  input ").val(decodeEntities(d["Address Locality"])),$("#"+b+"_administrativeArea  input ").val(decodeEntities(d["Address Administrative Area"]));var e=d["Address Country 2 Alpha Code"].toLowerCase();$("#"+b+"_country_select").intlTelInput({initialCountry:e,preferredCountries:$("#preferred_countries").val().split(",")}),$("#"+b+"_country_select").on("country-change",function(a,c){var d=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").name,e=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").iso2.toUpperCase();d=d.match(/\)\s+\(.+\)$/)?d.replace(/\)\s+\(.+\)$/,")"):d.replace(/\s+\(.+\)$/,""),$("#"+b+"_country  input.address_input_field ").val(e),update_address_fields(b,e,hide_recipient_fields=!1),$("#"+b+"_country_select").val(d),"init"!=c&&on_changed_address_value(b,b+"_country",e)}),$("#"+b+"_country_select").trigger("country-change","init")}void 0!=a.label&&$("#"+b+"_label").html(a.label),post_create_action(a)}function post_create_action(a){}function delete_field(a){var b=a.field;$("#"+b+"_field").addClass("hide")}function update_field(a){var b=a.field,c=$("#"+b+"_container").attr("c");console.log(a),console.log(b),a.render?$("#"+b+"_field").removeClass("hide"):($("#"+b+"_field").addClass("hide"),close_edit_field(b)),void 0!=a.label&&$("#"+b+"_label").html(a.label),void 0!=a.required&&(a.required?$("#"+b+"_validation").addClass("required"):$("#"+b+"_validation").removeClass("required"),$("#"+b+"_container").attr("_required",a.required)),void 0!=a.placeholder&&$("#"+b).attr("placeholder",a.placeholder),void 0!=a.server_validation&&$("#"+b+"_container").attr("server_validation",a.server_validation),void 0!=a.options&&$("#"+b+"_options ul ").html(a.options),void 0!=a.locked&&(1==a.locked?($("#"+b+"_validation").addClass("hide"),$("#"+b+"_locked_tag").removeClass("hide"),$("#"+b).attr("readonly",!0)):($("#"+b+"_validation").removeClass("hide"),$("#"+b+"_locked_tag").addClass("hide"),$("#"+b).attr("readonly",!1))),console.log(c),void 0!=a.value&&("date"==c&&($("."+b).html(a.formatted_value),$("#"+b+"_datepicker").datepicker("setDate",new Date(a.formatted_value)),$("#"+b).val(a.value),$("#"+b+"_formatted").val(a.formatted_value)),"option"==c?($("#"+b+"_formatted_value").html(a.formatted_value),$("#"+b).val(a.value),$("#"+b+"_options li").removeClass("selected").removeClass("current"),$("#"+b+"_option_"+a.value.replace(".",".")).addClass("selected").addClass("current")):($("."+b).html(a.formatted_value),$("#"+b).val(a.value))),post_update_field(a)}function post_update_field(a){}function hide_edit_field_msg(a){$("#"+a+"_msg").html("").addClass("hide")}function confirm_field(a){$("#"+a).addClass("hide"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").removeClass("hide"),$("#"+a+"_save_button").removeClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_confirm").focus()}function cancel_confirm_field(a){$("#"+a).removeClass("hide"),$("#"+a+"_confirm_button").removeClass("hide"),$("#"+a+"_confirm").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_msg").html(""),$("#"+a).val(""),$("#"+a).attr("has_been_valid",0),$("#"+a).focus()}function addZero2dateComponent(a){return a<10&&(a="0"+a),a}function clean_time(a){var b=/^[0-9]{4}$/;if(b.test(a))c=[a.substring(0,2),a.substring(2,4)];else var c=a.split(":");var d=addZero2dateComponent(parseInt(c[0])),e=addZero2dateComponent(parseInt(c[1])),f="00";return d+":"+e+":"+f}function add_minutes_to_time(a,b){
var c=a.split(":"),d=new Date(2e3,0,1,c[0],parseInt(c[1])+parseInt(b),c[2]);return a=addZero2dateComponent(d.getHours())+":"+addZero2dateComponent(d.getMinutes())+":00"}function update_address_fields(a,b,c){var d="/ar_address.php?tipo=fields_data&country_code="+b;$.getJSON(d,function(b){if(200==b.state)for(var d in b.fields){var e=$("#"+a+"_"+d),f=b.fields[d];e.find(".label").html(f.label),f.required?e.find(".fa-asterisk").removeClass("hide"):e.find(".fa-asterisk").addClass("hide"),!f.render||c&&("recipient"==d||"organization"==d)?e.addClass("hide"):e.removeClass("hide"),e.insertBefore("#"+a+"_country")}else 400==b.state})}function delayed_on_change_address_field(a,b){var c=a.closest("table").attr("field"),d=a.closest("tr").attr("id"),e=a.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_address_value(c,d,e)},b))}function get_address_value(a){var b={"Address Recipient":null,"Address Organization":null,"Address Line 1":null,"Address Line 2":null,"Address Sorting Code":null,"Address Postal Code":null,"Address Dependent Locality":null,"Address Locality":null,"Address Administrative Area":null,"Address Country 2 Alpha Code":null};return $("#"+a+" input.address_input_field").each(function(a,c){var d=$(c);""!=d.val()&&(b[d.attr("field_name")]=d.val())}),JSON.stringify(b)}function on_changed_address_value(a,b,c){var d=get_address_value(a);if(d!=$("#"+a+"_value").val()){$("#"+a+"_editor").addClass("changed");var e=!0;$("#"+a+"_address_fields").attr("has_been_changed",1)}else{$("#"+a+"_editor").removeClass("changed");var e=!1;$("#"+a+"_address_fields").attr("has_been_changed",0)}if($("#"+a+"_save_button").removeClass("invalid valid potentially_valid"),$("#"+a+"_msg").removeClass("invalid valid potentially_valid"),$("#"+a+"_validation").removeClass("invalid valid potentially_valid"),e){$("#"+a+"_field").addClass("waiting_validation changed"),$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var f=validate_address(a);process_validation(f,a,!0)}else $("#"+a+"_msg").html("")}function set_directory_item_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),a)}function show_directory_item_edit(a){open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),a)}function delete_directory_item(a,b){var c="/ar_edit.php?tipo=delete_object_component&object="+$("#fields").attr("object")+"&key="+$("#fields").attr("key")+"&field="+b;$.getJSON(c,function(a){200==a.state?""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")):400==a.state})}function delayed_on_change_dropdown_select_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();key_scope={type:"dropdown_select",field:d.attr("field")},window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_dropdown_select(c,e)},b))}function get_dropdown_select(a,b){var c=$("#"+a).attr("parent_key"),d=$("#"+a).attr("parent"),e=$("#"+a).attr("scope"),f=$("#"+a).attr("field"),g=$("#"+a).data("metadata");console.log(g),void 0==g&&(g={});var h="/ar_find.php?tipo=find_objects&query="+fixedEncodeURIComponent(b)+"&scope="+e+"&parent="+d+"&parent_key="+c+"&metadata="+JSON.stringify(g)+"&state="+JSON.stringify(state);void 0!=$("#"+a).attr("action")&&(h+="&action="+$("#"+a).attr("action")),console.log(h),$.getJSON(h,function(c){c.number_results>0?($("#"+f+"_results_container").removeClass("hide").addClass("show"),$("#"+f+"_msg").html("").addClass("hide"),$("#"+f).val(""),on_changed_value(f,b)):b.length>0?(console.log("caca"),1==$("#"+a).attr("create_new")?$("#"+f+"_new_object_invalid_msg").length&&(msg=$("#"+f+"_new_object_invalid_msg").html(),$("#"+f+"_msg").html(msg).removeClass("hide")):($("#"+f+"_results_container").addClass("hide").removeClass("show"),$("#"+f).val(""),on_changed_value(f,"__error__"))):($("#"+f+"_results_container").addClass("hide").removeClass("show"),$("#"+f).val(""),on_changed_value(f,"")),$("#"+f+"_results .result").remove();var d=!0;for(var e in c.results){var g=$("#"+f+"_search_result_template").clone();g.prop("id",f+"_result_"+e),g.addClass("result").removeClass("hide"),g.attr("value",c.results[e].value),g.attr("formatted_value",c.results[e].formatted_value),g.data("metadata",c.results[e].metadata),g.attr("field",f),d&&(g.addClass("selected"),d=!1),g.children(".code").html(c.results[e].code),g.children(".label").html(c.results[e].description),$("#"+f+"_results").append(g)}})}function select_dropdown_option(a){if(field=$(a).attr("field"),value=$(a).attr("value"),formatted_value=$(a).attr("formatted_value"),metadata=$(a).data("metadata"),$("#"+field+"_dropdown_select_label").val(formatted_value),$("#"+field).val(value),on_changed_value(field,value),$("#"+field+"_results_container").addClass("hide").removeClass("show"),console.log(metadata),void 0!=metadata&&metadata.other_fields)for(var b in metadata.other_fields)update_field(metadata.other_fields[b])}function assign_available_barcode(a){var b="/ar_edit.php?tipo=get_available_barcode";$.getJSON(b,function(b){200==b.state?""==b.barcode_number||($("#"+a).val(b.barcode_number),$("#"+a+"_field").addClass("changed").addClass("valid"),save_field($("#fields").attr("object"),$("#fields").attr("key"),a)):400==b.state})}function toggle_unlock_delete_object(a){$(a).hasClass("fa-lock")?($(a).removeClass("fa-lock").addClass("fa-unlock"),$(a).nextAll("span:first").removeClass("disabled").addClass("button")):($(a).addClass("fa-lock").removeClass("fa-unlock"),$(a).nextAll("span:first").addClass("disabled").removeClass("button"))}function toggle_prospect_link_to_customer(a){var b="Prospect_Customer_Key";$(a).hasClass("fa-lock")?($(a).removeClass("fa-lock").addClass("fa-unlock"),$(a).nextAll("span:first").removeClass("disabled").addClass("button"),open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),b)):($(a).addClass("fa-lock").removeClass("fa-unlock"),$(a).nextAll("span:first").addClass("disabled").removeClass("button"),close_edit_field(b))}function delete_object(a){save_object_operation("delete",a)}function clean_cache(a){save_object_operation("clean_cache",a)}function approve_object(a){save_object_operation("approve",a)}function reject_object(a){save_object_operation("reject",a)}function suspend_object(a){save_object_operation("suspend",a)}function activate_object(a){save_object_operation("activate",a)}function finish_object(a){save_object_operation("finish",a)}function suspend_parent_object(a){save_object_operation("suspend_parent",a)}function activate_parent_object(a){save_object_operation("activate_parent",a)}function reset_object(a){save_object_operation("reset",a)}function reindex_object(a){save_object_operation("reindex",a)}function archive_object(a){save_object_operation("archive",a)}function unarchive_object(a){save_object_operation("unarchive",a)}function unlink_customer_object(a){save_object_operation("unlink_customer",a)}function save_object_operation(a,b,c){if(!$(b).hasClass("disabled")){if("delete"==a)var d="fa-trash-alt";else if("archive"==a)var d="fa-archive";else if("unarchive"==a)var d="fa-folder-open";$(b).find("i").removeClass(d).addClass("fa-spinner fa-spin");var e="/ar_edit.php?tipo=object_operation&operation="+a+"&object="+$(b).data("data").object+"&key="+$(b).data("data").key+"&state="+JSON.stringify(state);void 0!=c&&(e=e+"&metadata="+JSON.stringify(c)),$.getJSON(e,function(a){200==a.state?(console.log(a),void 0!=a.request?change_view(a.request):change_view(state.request,{reload_showcase:1})):400==a.state&&$(b).find("i").addClass(d).removeClass("fa-spinner fa-spin")})}}function delete_attachment(a){if(!$(a).hasClass("disabled")&&$(a).find("i.fa").removeClass("fa-trash")){$(a).find("i.fa").removeClass("fa-trash").addClass("fa-spinner fa-spin");var b="/ar_edit.php?tipo=delete_attachment&attachment_bridge_key="+$(a).data("data").attachment_bridge_key;$.getJSON(b,function(b){200==b.state?(console.log(b),change_view(void 0!=b.request?b.request:state.request)):400==b.state&&$(a).find("i.fa").addClass("fa-trash").removeClass("fa-spinner fa-spin")})}}function publish(a,b){var c=$(a).find("i");if(!c.hasClass("fa-spin")){c.addClass("fa-spinner fa-spin");var d="/ar_edit_website.php?tipo="+b+"&parent_key="+$(a).attr("webpage_key");console.log(d),$.getJSON(d,function(a){if("publish_webpage"==b?(c.addClass("fa-rocket").removeClass("fa-spinner fa-spin"),$("#publish").removeClass("changed valid")):"set_webpage_as_ready"==b?c.addClass("fa-check-circle").removeClass("fa-spinner fa-spin"):"set_webpage_as_not_ready"==b?c.addClass("fa-child").removeClass("fa-spinner fa-spin"):"unpublish_webpage"==b&&(c.addClass("fa-rocket").removeClass("fa-spinner fa-spin"),$("#publish").addClass("changed valid")),console.log(a),a.other_fields)for(var d in a.other_fields)update_field(a.other_fields[d]);if(a.deleted_fields)for(var d in a.deleted_fields)delete_field(a.deleted_fields[d]);for(var d in a.update_metadata.class_html)console.log("."+d),console.log(a.update_metadata.class_html[d]),$("."+d).html(a.update_metadata.class_html[d]);for(var d in a.update_metadata.hide_by_id)$("#"+a.update_metadata.hide_by_id[d]).addClass("hide");for(var d in a.update_metadata.show_by_id)$("#"+a.update_metadata.show_by_id[d]).removeClass("hide");for(var d in a.update_metadata.visible_by_id)$("#"+a.update_metadata.visible_by_id[d]).removeClass("invisible");for(var d in a.update_metadata.invisible_by_id)$("#"+a.update_metadata.invisible_by_id[d]).addClass("invisible")})}}function erase_date_field(a){console.log(a),$("#"+a).val(""),$("#"+a+"_formatted").val(""),on_changed_value(a,$("#".field).val())}function toggle_field_value(a){var b=$(a).find("i");b.hasClass("fa-toggle-on")?b.removeClass("fa-toggle-on").addClass("fa-toggle-off").next("span").addClass("discreet"):b.hasClass("fa-toggle-off")&&b.removeClass("fa-toggle-off").addClass("fa-toggle-on").next("span").removeClass("discreet")}function check_field_value(a){var b=$(a).find("i");b.hasClass("fa-check-square")?b.removeClass("fa-check-square").addClass("fa-square").next("span").addClass("discreet"):b.hasClass("fa-square")&&b.removeClass("fa-square").addClass("fa-check-square").next("span").removeClass("discreet")}function delayed_search(a,b){var c=a.val();key_scope={type:"search"},c.length>0?$("#clear_search").removeClass("hide"):$("#clear_search").addClass("hide"),window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){search(c)},b))}function search(a){var b="/ar_search.php?tipo=search&query="+fixedEncodeURIComponent(a)+"&state="+JSON.stringify(state);$.getJSON(b,function(a){console.log(a),a.number_results>0?$("#results_container_shifted").removeClass("hide"):$("#results_container_shifted").addClass("hide"),$("#results .result").remove();var b=!0;for(var c in a.results){var d=$("#search_result_template").clone();d.prop("id","result_"+c),d.addClass("result").removeClass("hide"),d.attr("view",a.results[c].view),b&&(d.addClass("selected"),b=!1),void 0!=a.show_stores&&a.show_stores&&""!=a.results[c].store&&d.children(".store").html(a.results[c].store).removeClass("hide"),d.children(".label").html(a.results[c].label),d.children(".details").html(a.results[c].details),$("#results").append(d)}})}function clear_search(){$("#search").val(""),$("#clear_search").addClass("hide"),$("#results_container_shifted").removeClass("show"),$("#results .result").remove()}function show_filter(){$("#show_filter").addClass("hide"),$(".filter").removeClass("hide"),$("#filter input").focus()}function show_results_per_page(){var a=$("#results_per_page");a.hasClass("showing_options")?(a.removeClass("showing_options"),$(".results_per_page").addClass("hide")):(a.addClass("showing_options"),$(".results_per_page").removeClass("hide"))}function change_results_per_page(a){$(".results_per_page").removeClass("selected"),$("#results_per_page_"+a).addClass("selected"),rows.setPageSize(a),$("#results_per_page").attr("title",$("#results_per_page").attr("title").replace(/\(.*\)/g,"("+a+")"))}function change_period(a){var b=JSON.parse(rows.parameters);if("date"==a)b.from=$("#select_date").val(),b.to=$("#select_date").val();else if("interval"==a){var c=$("#select_interval_from").val().split(/\//);b.from=c[2]+"-"+c[0]+"-"+c[1],c=$("#select_interval_to").val().split(/\//),b.to=c[2]+"-"+c[0]+"-"+c[1]}$("#date_chooser div").removeClass("selected"),$("#"+a).addClass("selected"),$("#select_date_control_panel").addClass("hide"),$("#select_interval_control_panel").addClass("hide"),b.period=a,rows.parameters=JSON.stringify(b),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),with_elements&&get_elements_numbers(rows.tab,rows.parameters)}function get_elements_numbers(a,b){var c="/ar_elements.php?tab="+a+"&parameters="+b;$.getJSON(c,function(a){if(200==a.state){for(element in a.elements_numbers)for(item in a.elements_numbers[element])$("#element_qty_"+item).html("("+a.elements_numbers[element][item]+")");if(void 0!=a.class_html)for(var b in a.class_html)$("."+b).html(a.class_html[b])}})}function close_columns_period_options(){var a=$("#columns_period .fa");a.addClass("fa-bars"),a.removeClass("fa-chevron-up"),$("#columns_period_chooser").addClass("hide")}function close_columns_frequency_options(){var a=$("#columns_frequency .fa");a.addClass("fa-bars"),a.removeClass("fa-chevron-up"),$("#columns_frequency_chooser").addClass("hide")}function show_columns_period_options(){var a=$("#columns_period"),b=$("#columns_period .fa");if(b.hasClass("fa-bars")){b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=$("#columns_period .fa").position(),d=a.height();$("#columns_period_chooser").removeClass("hide").offset({top:$("#columns_period").position().top+d,left:c.left-$("#columns_period_chooser").width()+b.width()+20})}else close_columns_period_options()}function show_columns_frequency_options(){var a=$("#columns_frequency"),b=$("#columns_frequency .fa");if(b.hasClass("fa-bars")){b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=$("#columns_frequency .fa").position(),d=a.height();console.log($("#columns_frequency").position().top+d),console.log(c.left-$("#columns_frequency_chooser").width()+b.width()+20),$("#columns_frequency_chooser").removeClass("hide").offset({top:$("#columns_frequency").position().top+d,left:c.left-$("#columns_frequency_chooser").width()+b.width()+20})}else close_columns_frequency_options()}function show_f_options(a){if($("#filter_field").hasClass("button"))if($("#f_options_chooser").hasClass("hide")){var b=$("#filter_field").position(),c=$("#filter_field").height();$("#f_options_chooser").removeClass("hide").offset({top:b.top+c,left:b.left-27.2})}else $("#f_options_chooser").addClass("hide")}function change_f_option(a){$(a).hasClass("selected")||($("#f_options_chooser div").removeClass("selected"),$("#f_options_chooser div i").removeClass("fa-circle").addClass("fa-circle"),$(a).addClass("selected"),$(a).find("i").addClass("fa-circle"),$("#filter").attr("f_field",$(a).attr("f_field")).find("input").val(""),$("#filter_field .label").html($(a).find(".label").html()),rows.fetch({reset:!0}),show_f_options())}function show_elements_types(){var a=$("#element_type"),b=$("#element_type .fa");if(b.hasClass("fa-bars")){$("#f_options_chooser").addClass("hide"),b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=a.position(),d=a.height();$("#elements_chooser").removeClass("hide").offset({top:c.top+d,left:c.left})}else b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide")}function change_columns_frequency(a,b){$("#columns_frequency span.label").html(b);var c=JSON.parse(rows.parameters);c.frequency=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),close_columns_frequency_options(),$("#columns_frequency_chooser div").removeClass("selected"),$("#columns_frequency_chooser .fa").removeClass("fa-circle").addClass("fa-circle"),$("#element_group_option_"+a).addClass("selected"),$("#element_group_option_"+a+" .fa").removeClass("fa-circle").addClass("fa-circle")}function change_columns_period(a,b){$("#columns_period span.label").html(b);var c=JSON.parse(rows.parameters);c.f_period=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),close_columns_period_options(),$("#columns_period_chooser div").removeClass("selected"),$("#columns_period_chooser .fa").removeClass("fa-circle").addClass("fa-circle"),$("#element_group_option_"+a).addClass("selected"),$("#element_group_option_"+a+" .fa").removeClass("fa-circle").addClass("fa-circle")}function change_elements_type(a){$("#elements .elements_group").addClass("hide"),$("#elements_group_"+a).removeClass("hide"),$("#elements_chooser  div").removeClass("selected"),$("#element_group_option_"+a).addClass("selected"),$("#elements_chooser  i").removeClass("fa").addClass("far"),$("#element_group_option_"+a+" i").addClass("fa"),$("#element_group_option_"+a+" i").removeClass("far");var b=$("#element_type .fa");b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide");var c=JSON.parse(rows.parameters);c.elements_type=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0})}function change_table_element(a,b){"double_click"==a?($("#elements i.element_checkbox").removeClass("fa-check-square").addClass("fa-square"),$("#elements .element").removeClass("selected"),$("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square"),$("#element_checkbox_"+b).addClass("fa-check-square")):$("#element_"+b).hasClass("selected")?($("#element_"+b).removeClass("selected"),$("#element_checkbox_"+b).removeClass("fa-check-square"),$("#element_checkbox_"+b).addClass("fa-square")):($("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square"),$("#element_checkbox_"+b).addClass("fa-check-square"));var c=JSON.parse(rows.parameters);$("#elements_group_"+c.elements_type+" .element").each(function(a){c.elements[c.elements_type].items[$(this).attr("item_key")].selected=$(this).hasClass("selected")}),rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),post_table_rendered()}function show_export_dialog_left_button(a){var b=$(a).closest("div").next(".export_dialog_container").find(".export_dialog");b.hasClass("hide")?(b.removeClass("hide"),b.css("top",$(a).closest(".square_button").height())):hide_export_dialog(b)}function show_download_edit_items_dialog(a){var b=$(a).closest("div.edit_table_dialog").next(".export_dialog_container").find(".export_dialog"),c=$(a).closest("div.edit_table_dialog").next(".export_dialog_container").find(".export_dialog_config");b.hasClass("hide")?(b.removeClass("hide"),c.removeClass("hide"),b.css("top",$(a).closest(".square_button").height()),b.offset({top:$("#edit_table_dialog").offset().top,left:$("#edit_table_dialog").offset().left+$("#edit_table_dialog").width()-b.width()}),c.offset({top:$("#edit_table_dialog").offset().top,left:b.offset().left-c.width()-30})):hide_export_dialog(b)}function hide_export_dialog(a){$(a).addClass("hide"),hide_export_config_dialog($(a).closest(".export_dialog_container").find(".export_dialog_config")),$(a).find(".export_download").addClass("hide").attr("title","").on("click",function(){}),$(a).find(".export_progress_bar_bg").addClass("hide").html(""),$(a).find(".export_progress_bar").css("width","0px").removeClass("hide").attr("title","").html("")}function show_edit_table_dialog(){if($("#edit_table_dialog").hasClass("hide")){$("#edit_table_dialog").removeClass("hide");var a=$("#show_edit_table_dialog_button").closest("div");$("#edit_table_dialog").offset({top:a.offset().top+a.height(),left:$("#show_edit_table_dialog_button").offset().left-$("#edit_table_dialog").width()+20})}else $("#edit_table_dialog").addClass("hide")}function table_edit_view(){$("#table .table_item_editable").attr("contenteditable",!0).addClass("editing"),$("#inline_edit_table_items_buttons").removeClass("hide"),$("#show_edit_table_dialog_button").addClass("hide"),$(".table_item_editable.editing").each(function(a,b){$(b).attr("ovalue",$(b).html())}),show_edit_table_dialog()}function open_export_config(){$("#export_dialog_config").hasClass("hide")?($("#export_dialog_config").removeClass("hide"),$("#export_dialog_config").css("left",-1*($("#export_dialog_config").width()+40+$("#export_dialog").width())),$("#export_dialog_config").css("top",$("#show_export_dialog").height())):hide_export_config_dialog()}function open_export_config_left_button(a){var b=$(a).closest(".export_dialog_container").find(".export_dialog");$(a).hasClass("hide")?($(a).removeClass("hide"),$(a).css("left",b.offset().left+b.width()),$(a).css("top",b.position().top)):hide_export_config_dialog(a)}function hide_export_config_dialog(a){$(a).addClass("hide")}function toggle_all_export_fields(a){var b=$(a).closest("table");$(a).hasClass("fa-check-square")?($(a).removeClass("fa-check-square"),$(a).addClass("fa-square"),b.find(".export_fields i").removeClass("fa-check-square"),b.find(".export_fields i").addClass("fa-square")):($(a).addClass("fa-check-square"),$(a).removeClass("fa-square"),b.find(".export_fields i").addClass("fa-check-square"),b.find(".export_fields i").removeClass("fa-square"))}function toggle_export_field(a){field_element=$(a),field_element.hasClass("fa-check-square")?(field_element.removeClass("fa-check-square"),field_element.addClass("fa-square")):(console.log("unckeced"),field_element.addClass("fa-check-square"),field_element.removeClass("fa-square"))}function export_table(a){var b=$(a).data("type"),c=$(a).closest(".export_dialog_container");$(a).removeClass("link").addClass("disabled"),c.find(".field_export").removeClass("button").addClass("disabled"),c.find(".stop_export").removeClass("hide").data("stop",0);var d=[];c.find(".field_export i").each(function(a,b){$(b).hasClass("fa-check-square")&&d.push($(b).attr("key"))});var e="/ar_export.php?ar_file="+rows.ar_file+"&tipo="+rows.tipo+"&parameters="+rows.parameters+"&type="+b+"&state="+JSON.stringify(state)+"&fields="+JSON.stringify(d);$.getJSON(e,function(a){200==a.state&&(c.find(".export_progress_bar_bg").removeClass("hide").html("&nbsp;"+a.txt),c.closest(".export_dialog_container").attr("id","download_"+a.download_key))})}function get_editable_data(a){var b=$(a).data("type");_data=$(a).data("data");var c=$(a).closest(".export_dialog_container");$(a).removeClass("link").addClass("disabled"),c.find(".field_export").removeClass("button").addClass("disabled"),c.find(".stop_export").removeClass("hide").data("stop",0);var d=[];c.find(".export_fields .field_export i").each(function(a,b){$(b).hasClass("fa-check-square")&&d.push($(b).attr("key"))});var e=$("#edit_table_dialog").data("metadata"),f="/ar_export_edit_template.php?parent="+_data.parent+"&parent_key="+_data.parent_key+"&parent_code="+_data.parent_code+"&objects="+_data.object+"&fields="+JSON.stringify(d)+"&type="+b+"&metadata="+JSON.stringify(e);$.getJSON(f,function(a){200==a.state&&(c.find(".export_progress_bar_bg").removeClass("hide").html("&nbsp;"+a.txt),c.closest(".export_dialog_container").attr("id","download_"+a.download_key))})}function change_export_as(a,b){$(a).closest(".export_type_options").find("span").addClass("very_discreet"),$(a).removeClass("very_discreet");var c=$(a).closest(".export_dialog_container").find(".export_button");c.data("type",b),console.log(b),"Excel"==b?(c.find("i").addClass("fa-file-excel").removeClass("fa-table"),c.find("span.excel").removeClass("hide"),c.find("span.csv").addClass("hide")):(c.find("i").removeClass("fa-file-excel").addClass("fa-table"),c.find("span.excel").addClass("hide"),c.find("span.csv").removeClass("hide"))}function stop_export(a){$("#stop_export_table_"+a+"_export").attr("stop",1)}function get_export_process_bar(a,b,c,d){request="/ar_fork.php?tipo=get_process_bar&fork_key="+a+"&tag="+b,$.getJSON(request,function(a){200==a.state&&("In Progress"==a.state?setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c,d)},100):"In Process"==a.fork_state?($("#export_download_"+c+d).addClass("hide"),$("#export_progress_bar_bg_"+c+d).removeClass("hide").html("&nbsp;"+a.progress_info),$("#export_progress_bar_"+c+d).css("width",a.percentage).removeClass("hide").attr("title",a.progress).html("&nbsp;"+a.forks_info),setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c,d)},250)):"Finished"==a.fork_state&&($("#download_"+c+d).attr("href","/download.php?file="+a.result),$("#export_download_"+c+d).removeClass("hide").attr("title",a.result_info).on("click",function(){download_exported_file(c,d)}),$("#export_progress_bar_bg_"+c+d).addClass("hide").html(""),$("#export_progress_bar_"+c+d).css("width","0px").removeClass("hide").attr("title","").html(""),$("#export_table_excel").addClass("link").removeClass("disabled"),$("#export_table_csv").addClass("link").removeClass("disabled"),$(".field_export").addClass("button").removeClass("disabled"),$("#stop_export_table_"+c+d).addClass("hide")))})}function download_exported_file(a){var b=$(a).closest(".export_dialog_container");b.find(".download_export")[0].click()}function edit_category_subject(a){if(!$(a).hasClass("wait")){$(a).hasClass("fa-unlink")?($(a).removeClass("fa-unlink very_discreet").addClass("fa-link wait"),operation="link"):($(a).addClass("fa-unlink very_discreet wait").removeClass("fa-link"),operation="unlink");var b="/ar_edit.php?tipo=edit_category_subject&category_key="+state.key+"&subject_key="+$(a).attr("key")+"&operation="+operation;$.getJSON(b,function(b){$(a).removeClass("wait"),200==b.state||400==b.state&&("link"==operation?$(a).addClass("fa-unlink very_discreet wait").removeClass("fa-link"):$(a).removeClass("fa-unlink very_discreet").addClass("fa-link wait"))})}}function post_table_rendered(a){switch(console.log("hello"),console.log(state.tab),state.tab){case"order.input_picking_sheet":validate_data_entry_picking_aid();break;case"location.parts":$(".table_edit_cell").awesomeCursor("pencil",{color:"rgba(0, 0, 0, 0.5)",hotspot:"bottom left"});break;case"intrastat":get_intrastat_totals();break;case"intrastat_orders":get_intrastat_orders_totals();break;case"intrastat_products":get_intrastat_products_totals();break;case"ec_sales_list":get_ec_sales_list_totals();break;case"store.payment_accounts":console.log(a);break;case"refund.new.items":$(".new_refund_item").each(function(a,b){if(""!=$(b).val()){var c;""!=$(b).val()&&validate_number($(b).val(),0,$(b).attr("max"))?($(b).addClass("error"),c=!0):($(this).removeClass("error"),c=!1);var d=$(b).closest("tr").find(".set_otf_feedback_button").removeClass("hide");$(b).val()>0&&!c?d.removeClass("hide"):d.addClass("hide"),update_new_refund_totals()}})}}function export_omega_invoices(){window.open("/invoices.omega.txt.php","_blank")}function validate_field(a,b,c,d,e,f,g,h,i){var j=client_validation(c,d,b,a);if("valid"==j["class"]&&void 0!=e&&""!=e){var k=JSON.parse(e);if("check_for_duplicates"==k.tipo&&""==b)return post_validate_field(j,a),j;var j={"class":"waiting",type:""};server_validation(k,f,g,h,i,a,b)}return post_validate_field(j,a),j}function post_validate_field(a,b){}function validate_address(a){var b={"class":"valid",type:""},c=0;return $("#"+a+" input.address_input_field").each(function(a,d){var e=$(d).closest("tr"),f=e.find(".fa-asterisk");f.hasClass("hide")||(""==$(d).val()?(c++,e.find(".show_buttons").removeClass("super_discreet success").addClass("error"),"Address Recipient"==$(d).attr("field_name")?valid_state_type="missing_recipient":"Address Line 1"==$(d).attr("field_name")?valid_state_type="missing_addressLine1":"Address Postal Code"==$(d).attr("field_name")?valid_state_type="missing_postalCode":valid_state_type="missing_field",b={"class":"invalid",type:valid_state_type}):e.find(".show_buttons").addClass(" success").removeClass("super_discreet error"))}),c>1&&(b={"class":"invalid",type:"missing_fields"}),b}function client_validation(a,b,c,d){console.log(a+" "+c+" "+d+" required:"+b);var e={"class":"valid",type:""};if(""==c)return b?"dropdown_select"==a?""==$("#"+d+"_dropdown_select_label").val()?{"class":"invalid",type:"empty"}:{"class":"invalid",type:"not_found"}:{"class":"invalid",type:"empty"}:{"class":"valid",type:""};switch(a){case"dropdown_select":if("__error__"==c&&""==$("#"+d).val())return{"class":"invalid",type:"not_found"};if(""==$("#"+d).val())return{"class":"potentially_valid",type:"not_selected"};break;case"string":break;case"handle":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"pin":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"password":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"password_with_confirmation":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"date":case"date_interval":break;case"barcode":var f=validate_ean_barcode(c);if(f)return f;break;case"barcode_range":if(c.match(/\-/g)){if(barcodes=c.split("-"),barcodes.length>2)return{"class":"invalid",type:"invalid"};var f=validate_barcode(barcodes[0],12,12);if(f)return{"class":"invalid",type:f.type};if(""==barcodes[1])return{"class":"potentially_valid",type:"short"};if(f=validate_barcode(barcodes[1],12,12))return f;if(barcodes[1]<barcodes[0])return{"class":"invalid",type:"range_minmax"}}else{var f=validate_barcode(c,12,13);if(f)return f}break;case"telephone":if(c=c.replace(/(\s|\-|\(|\))/g,""),c.length<4)return c=c.replace(/^\+/g,""),""==c||$.isNumeric(c)?{"class":"potentially_valid",type:"short"}:{"class":"invalid",type:"invalid"};if(!$("#"+d).intlTelInput("isValidNumber")){var g=$("#"+d).intlTelInput("getValidationError");if(g==intlTelInputUtils.validationError.TOO_SHORT)return{"class":"potentially_valid",type:"short"};if(g==intlTelInputUtils.validationError.TOO_LONG)return{"class":"invalid",type:"long"};if(g==intlTelInputUtils.validationError.NOT_A_NUMBER)return{"class":"invalid",type:"invalid"};if(g==intlTelInputUtils.validationError.INVALID_COUNTRY_CODE)return{"class":"invalid",type:"invalid_code"}}break;case"email":case"new_email":var h=c.replace(/"[^"]*"/g,"");if(h.match(/"/g));else{if(h.match(/\s/g))return{"class":"invalid",type:"spaces"};if(h.match(/\(|\)|\,|:|;|<|>|\[|\]/g))return h.match(/,/g)?{"class":"invalid",type:"comma"}:{"class":"invalid",type:"invalid_character"};if(h.match(/^([^@]*@){2,}[^@]*$/g))return{"class":"invalid",type:"double_at"}}var i=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,63})?$/;if(!i.test(c))return{"class":"potentially_valid",type:"invalid"};break;case"time":var j=/^[0-9\:]+$/;if(!j.test(c))return{"class":"invalid",type:"invalid"};if(c.length>5)return{"class":"invalid",type:"invalid"};if(1==c.length){var k=/^[0-9]$/;if(!k.test(c))return{"class":"invalid",type:"invalid"}}else if(2==c.length){var k=/^(1?[0-9]|2[0-3])|[0-9]:$/;if(!k.test(c))return{"class":"invalid",type:"invalid"}}else if(4==c.length){var j=/^(1?[0-9]|2[0-3]|0[0-9])[0-5][0-9]$/;if(j.test(c))return{"class":"valid",type:"valid"};var j=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5]$/;if(j.test(c))return{"class":"potentially_valid",type:"invalid"}}var j=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5][0-9]$/;return j.test(c)?{"class":"valid",type:""}:5==c.length||4==c.length?{"class":"invalid",type:"invalid"}:{"class":"potentially_valid",type:"invalid"};case"positive_integer_more_than_zero":var f=validate_integer(c,1,65535);if(f)return f;break;case"smallint_unsigned":var f=validate_signed_integer(c,65535);if(f)return f;break;case"int_unsigned":var f=validate_signed_integer(c,4294967295);if(f)return f;break;case"minutes_in_day":var f=validate_signed_integer(c,1440);if(f)return f;break;case"numeric_unsigned":var f=validate_number(c,0,4294967295);if(f)return f;break;case"minutes_in_break":if(0==c)return{"class":"invalid",type:"invalid_break_duration"
};var f=validate_signed_integer(c,1440);if(f)return f;break;case"seconds_in_day":var f=validate_signed_integer(c,86400);if(f)return f;break;case"seconds_in_hour":var f=validate_signed_integer(c,3600);if(f)return f;break;case"day_of_month":if(0==c)return{"class":"invalid",type:"invalid_day_of_month"};var f=validate_signed_integer(c,31);if(f)return f;break;case"amount":var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}$/;if(!o.test(c))return{"class":"invalid",type:"invalid_amount"};break;case"percentage":var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}\%$/;if(o.test(c))return{"class":"valid",type:"valid"};var o=/^\d*\.?\d{0,6}$/;return o.test(c)?{"class":"potentially_valid",type:"invalid"}:{"class":"invalid",type:"invalid_amount"};case"amount_margin":c=c.replace(/\%$/g,"");var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}$/;if(!o.test(c))return{"class":"invalid",type:"invalid_amount"}}return e}function checkEan(a){var b="0123456789";for(i=0;i<a.length;i++)if(digit=a.charAt(i),b.indexOf(digit)==-1)return!1;if(8==a.length)a="00000"+a;else if(13!=a.length)return!1;return originalCheck=a.substring(a.length-1),a=a.substring(0,a.length-1),even=Number(a.charAt(1))+Number(a.charAt(3))+Number(a.charAt(5))+Number(a.charAt(7))+Number(a.charAt(9))+Number(a.charAt(11)),even*=3,odd=Number(a.charAt(0))+Number(a.charAt(2))+Number(a.charAt(4))+Number(a.charAt(6))+Number(a.charAt(8))+Number(a.charAt(10)),total=even+odd,checksum=total%10,0!=checksum&&(checksum=10-checksum),checksum==originalCheck}function validate_ean_barcode(a){return""!=a&&($.isNumeric(a)?a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a?{"class":"invalid",type:"invalid"}:12==a.length?{"class":"invalid",type:"missing_checksum"}:a.length<=12?{"class":"invalid",type:"short"}:a.length>=14?{"class":"invalid",type:"long"}:!checkEan(a)&&{"class":"invalid",type:"checksum"}:{"class":"invalid",type:"invalid"})}function validate_barcode(a,b,c){return""!=a&&($.isNumeric(a)?a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a?{"class":"invalid",type:"invalid"}:a.length<b?{"class":"potentially_valid",type:"short"}:a.length>c&&{"class":"invalid",type:"long"}:{"class":"invalid",type:"invalid"})}function validate_number(a,b,c){if(!$.isNumeric(a))return{"class":"invalid",type:"no_numeric"};var a=parseFloat(a),b=parseFloat(b),c=parseFloat(c);return console.log(b),void 0!=b&&a<b?{"class":"invalid",type:"negative"}:void 0!=c&&a>c&&{"class":"invalid",type:"max_limit"}}function validate_signed_integer(a,b){return $.isNumeric(a)?a>b?{"class":"invalid",type:"too_big"}:a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a&&{"class":"invalid",type:"not_integer"}:{"class":"invalid",type:"not_integer"}}function validate_integer(a,b,c){return $.isNumeric(a)?void 0!=c&&a>c?{"class":"invalid",type:"too_big"}:a<b?{"class":"invalid",type:"too_small"}:Math.floor(a)!=a&&{"class":"invalid",type:"not_integer"}:{"class":"invalid",type:"not_integer"}}function server_validation(a,b,c,d,e,f,g){if(console.log(a),null!=a.parent&&(b=a.parent),null!=a.parent_key&&(c=a.parent_key),null!=a.object&&(d=a.object),null!=a.key&&(e=a.key),null!=a.parent_key_field&&(c=$("#"+a.parent_key_field).val()),$("#"+f+"_editor").addClass("waiting"),null!=a.setup)var h="/ar_setup.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;else{var h="/ar_validation.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;null!=a.actual_field&&(h+="&actual_field="+a.actual_field),console.log(a.metadata),null!=a.metadata&&(h+="&metadata="+JSON.stringify(a.metadata))}$.getJSON(h,function(a){if($("#"+f+"_field").removeClass("waiting invalid valid"),$("#"+f+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud"),$("#"+f+"_formatted_value").hasClass("hide")){if(200==a.state)var b=a.validation,c=a.msg;else var b="invalid",c="Error, can't verify value on server";if(post_validate_field(b,f),$("#"+f+"_msg").html(c),$("#"+f+"_field").addClass(b),$("#fields").hasClass("new_object")){var d=get_form_validation_state();process_form_validation(d)}}})}function new_object_init(){$(".value").each(function(a){var b=$(this).attr("field"),c=$("#"+b).val(),d=$("#"+b+"_container");0==d.length&&("Register_Date_From"==b?d=$("#Register_Date_container"):"Register_Date_To"==b&&(d=$("#Register_Date_container")));var e=d.attr("field_type");if(d.hasClass("address_value"))var f=d.closest("tbody.address_fields").attr("_required");else var f=d.attr("_required");var g=d.attr("server_validation"),h=d.attr("parent"),i=d.attr("parent_key"),j=d.attr("object"),k=d.attr("key"),l=validate_field(b,c,e,f,g,h,i,j,k);"invalid"==l["class"]&&""==c&&(l["class"]="potentially_valid"),"date_interval"!=e&&$("#"+b+"_field").removeClass("invalid potentially_valid valid").addClass(l["class"])});var a=get_form_validation_state();process_form_validation(a)}function toggle_options(a){$("#"+a+"_options").hasClass("hide")?$("#"+a+"_options").removeClass("hide"):$("#"+a+"_options").addClass("hide")}function show_options(a){$("#"+a+"_options").removeClass("hide")}function hide_options(a){$("#"+a+"_options").addClass("hide")}function get_form_validation_state(){return"Mailshot"==$("#fields").attr("object")?get_mailshot_form_validation_state():(form_validation="valid",$(".value").each(function(a){var b=$(this).attr("field");console.log(b),console.log($("#"+b+"_field").hasClass("valid")),"date_interval"==$(this).attr("field_type")?component_validation="valid":$("#"+b+"_field").hasClass("invalid")?component_validation="invalid":$("#"+b+"_field").hasClass("valid")?component_validation="valid":(component_validation="potentially_valid",console.log($(this).attr("field_type")),console.log(b)),"invalid"==component_validation&&(form_validation="invalid"),"invalid"!=form_validation&&"potentially_valid"==component_validation&&(form_validation="potentially_valid")}),console.log("val: "+form_validation),form_validation)}function process_form_validation(a,b){b&&"potentially_valid"==a&&(a="invalid"),$("#fields .controls").removeClass("invalid valid potentially_valid").addClass(a).addClass("changed"),"invalid"==a&&$(".value").each(function(a){var b=$(this).attr("field");!$("#"+b+"_field").hasClass("valid")&&$("#"+b+"_field").length>0&&($("#"+b+"_field").addClass("invalid"),console.log(b))}),reset_controls(),post_process_form_validation()}function post_process_form_validation(){"Customers_List"==$("#fields").attr("Object")&&post_process_new_customer_list_form_validation()}function check_if_form_is_valid(){var a=$("#fields").attr("object"),b=!0;$(".value").each(function(a){var c=$(this).attr("field");$("#"+c+"_validation").hasClass("valid")||(b=!1)}),b?$("#"+a+"_save").addClass("valid").removeClass("invalid"):$("#"+a+"_save").removeClass("valid").addClass("invalid")}function save_new_object(a,b){var c=get_form_validation_state();if(process_form_validation(c,!0),$("tr.controls").hasClass("valid")&&!$("tr.controls").hasClass("waiting")){$("tr.controls").addClass("waiting"),$("#"+a+"_save_icon").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var d={},e=new RegExp("_","g"),f=new FormData;if($(".value").each(function(a){var b=$(this).attr("field"),c=$(this).attr("field_type");if(console.log(c+" "+b),"time"==c)i=clean_time($("#"+b).val());else if("date"==c||"date_interval"==c)i=""!=$("#"+b+"_value").val()?$("#"+b+"_value").val()+" "+$("#"+b+"_time").val():"";else if("password"==c||"password_with_confirmation"==c||"password_with_confirmation_paranoid"==c||"pin"==c||"pin_with_confirmation"==c||"pin_with_confirmation_paranoid"==c)i=sha256_digest($("#"+b).val());else if("attachment"==c)f.append("file",$("#"+b).prop("files")[0]),i="";else if("country_select"==c)i=$("#"+b).countrySelect("getSelectedCountryData").code;else if("telephone"==c)i=$("#"+b).intlTelInput("getNumber");else if("parts_list"==c){var g=[];$("#parts_list_items  tr.part_tr").each(function(a,b){if($(b).hasClass("very_discreet"))var c=0;else var c=$(b).find(".parts_per_product").val();var d={Key:$(b).find(".product_part_key").val(),"Part SKU":$(b).find(".sku").val(),Ratio:c,Note:$(b).find(".note").val()};g.push(d)}),i=JSON.stringify(g)}else if("subscription"==c){var h=$(this).find("i");i=h.hasClass("fa-toggle-on")?"Yes":"No"}else if("elements"==c){var h=$(this).find("i");i=h.hasClass("fa-check-square")?"Yes":"No"}else if("with_field"==c){var h=$(this).find("i");i=h.hasClass("fa-toggle-on")?"Yes":h.hasClass("fa-toggle-off")?"No":""}else if("toggle"==c){console.log("#"+b+"_field"),console.log("#"+b+"_toggle");var i=$("#"+b+"_field").find("."+b+"_toggle").hasClass("fa-toggle-on")}else if("button_radio_options"==c)var i=$("#"+b+"_field").hasClass("selected");else if("input_with_field"==c)var i=$("#"+b+"_field").val();else if("asset"==c)var i=$("#Asset_Key").val();else if("list"==c)var i=$("#List_Key").val();else var i=$("#"+b).val();d[b.replace(e," ")]=i}),console.log(d),"setup"==b)return void save_setup(a,d);if("Attachment"==a)var g="ar_upload.php",h="upload_attachment";else var g="ar_edit.php",h="new_object";var i="/"+g+"?tipo="+(""!=b?b:h)+"&object="+a+"&parent="+$("#fields").attr("parent")+"&parent_key="+$("#fields").attr("parent_key")+"&fields_data="+JSON.stringify(d);f.append("tipo",""!=b?b:h),f.append("object",a),f.append("parent",$("#fields").attr("parent")),f.append("parent_key",$("#fields").attr("parent_key")),f.append("fields_data",JSON.stringify(d));var i=$.ajax({url:"/"+g,data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});i.done(function(b){if(console.log(b),$("#"+a+"_save_icon").addClass("fa-cloud"),$("#"+a+"_save_icon").removeClass("fa-spinner fa-spin"),$("tr.controls").removeClass("waiting").removeClass("valid"),200==b.state){if(""==b.pcard&&""!=b.redirect)return void change_view(b.redirect,b.redirect_metadata);$("#result").html(b.pcard).removeClass("hide"),$("#fields").addClass("hide");for(var c in b.updated_data)$("."+c).html(b.updated_data[c]);post_new_actions(a,b)}else 400==b.state&&($("tr.controls").addClass("error"),$("#"+a+"_msg").html(b.msg).removeClass("hide"),$("#save_msg").html(b.msg).removeClass("hide"))}),i.fail(function(b,c){$("#"+a+"_save_icon").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("tr.controls").removeClass("waiting valid").addClass("error"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function post_new_actions(a,b){switch(a){case"Timesheet_Record":rows.fetch({reset:!0})}}function save_inline_new_object(a){var b=$("#inline_new_object").attr("object"),c=$("#inline_new_object").attr("parent"),d=$("#inline_new_object").attr("parent_key"),e=$("#inline_new_object").attr("field"),f=$("#"+e+"_container").attr("field_type");if($("#inline_new_object").hasClass("valid")){$("#inline_new_object").removeClass("valid "),$("#"+b+"_save").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var g={},h=new RegExp("_","g");if("time"==f)i=clean_time($("#"+e).val()),i=$("#"+e+"_date").val()+" "+i;else var i=$("#"+e).val();g[e.replace(h," ")]=i;var j="/ar_edit.php?tipo=new_object&object="+b+"&parent="+c+"&parent_key="+d+"&fields_data="+JSON.stringify(g),k=new FormData;k.append("tipo","new_object"),k.append("object",b),k.append("parent",c),k.append("parent_key",d),k.append("fields_data",JSON.stringify(g));var j=$.ajax({url:"/ar_edit.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(c){if($("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200==c.state){$("#"+e).val("").attr("has_been_valid",0),$("#inline_new_object").addClass("potentially_valid"),toggle_inline_new_object_form(a),$("#inline_new_object_msg").html(c.msg).addClass("success").removeClass("hide");for(var d in c.updated_data)$("."+d).html(c.updated_data[d]);if(rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),with_elements&&get_elements_numbers(rows.tab,rows.parameters),void 0!=c.metadata&&""!=c.metadata.updated_showcase_fields)for(var f in c.metadata.updated_showcase_fields)$("."+f).html(c.metadata.updated_showcase_fields[f])}else 400==c.state&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(c.msg).addClass("invalid"),$("#inline_new_object").addClass("invalid"))}),j.fail(function(a,c){$("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function toggle_inline_new_object_form(a){var b=$("#inline_new_object").attr("field");$("#"+b+"_container").attr("field_type");if($("#inline_new_object_msg").html("").removeClass("error success"),$("#icon_"+a).hasClass("fa-plus")||$("#icon_"+a).hasClass("fa-link")){if($("#icon_"+a).hasClass("fa-link"))var c="fa-link";else var c="fa-plus";$("#inline_form").removeClass("hide"),$("#inline_new_object").removeClass("hide"),$("#icon_"+a).removeClass("fa-plus").removeClass("fa-link").addClass("fa-times"),$("#icon_"+a).attr("icon",c),$("#inline_form input.inline_input").focus()}else $("#inline_new_object").addClass("hide"),$("#inline_form").addClass("hide"),$("#icon_"+a).addClass($("#icon_"+a).attr("icon")).removeClass("fa-times")}function clone_it(){$("#result").html(""),$("#fields").removeClass("hide"),$("#result").addClass("hide")}function change_to_new_object_view(){var a=$("#fields").attr("object");request=$("#"+a+"_go_new").attr("request"),change_view(request)}function reset_controls(){var a=$("#fields").attr("object");$("#"+a+"_save").removeClass("hide"),$(".new_object_results").addClass("hide"),$("#"+a+"_msg").html("").addClass("hide").removeClass("success"),$("#save_msg").html("").addClass("hide").removeClass("success"),$("#"+a+"_go_new").attr("request","")}function update_new_address_fields(a,b,c,d){var e="/ar_address.php?tipo=fields_data&country_code="+b;$.getJSON(e,function(b){if(200==b.state){for(var d in b.fields){var e=$("#"+a+"_"+d+"_field"),f=$("#"+a+"_"+d+"_container"),g=b.fields[d];e.find(".label").html(g.label),g.required?(f.attr("_required",1),e.find(".fa-asterisk").addClass("required")):(f.attr("_required",0),e.find(".fa-asterisk").removeClass("required")),!g.render||c&&("recipient"==d||"organization"==d)?e.addClass("hide"):e.removeClass("hide"),e.insertBefore("#"+a+"_country_field")}$(".address_value").each(function(a){var b=$(this).attr("field"),c=$("#"+b).val(),d=$("#"+b+"_container"),e=d.attr("field_type"),f=d.attr("server_validation"),g=d.attr("parent"),h=d.attr("parent_key"),i=d.attr("object"),j=d.attr("key");if(d.hasClass("address_value"))var k=d.closest("tbody.address_fields").attr("_required");else var k=d.attr("_required");var l=validate_field(b,c,e,k,f,g,h,i,j);1==d.attr("_required")&&""==c&&"valid"==l["class"]&&(l["class"]="valid attention"),$("#"+b+"_field").removeClass("invalid potentially_valid valid").addClass(l["class"])})}else 400==b.state})}function update_related_fields(a){$("#fields  .telephone_input_field").each(function(b){0==$(this).attr("has_been_changed")&&$(this).intlTelInput("setCountry",a.iso2)}),$("#fields  .address_fields").each(function(b){if(0==$(this).attr("has_been_changed")){var c=$(this).attr("field"),d=$("#"+c+"_country_select");d.countrySelect("selectCountry",a.iso2),update_new_address_fields(c,a.iso2,hide_recipient_fields=!0),$("#"+c+"_country  ").val(a.iso2.toUpperCase())}}),0==$("#Supplier_Products_Origin_Country_Code").attr("has_been_changed")&&$("#Supplier_Products_Origin_Country_Code").countrySelect("selectCountry",a.iso2),0==$("#Supplier_Default_Currency_Code").attr("has_been_changed")&&$("#Supplier_Default_Currency_Code").countrySelect("selectCountryfromCode",a.currency)}function show_field_options(a){$(a).addClass("hide"),$("#"+$(a).attr("field")+"_options_ul").removeClass("hide")}function select_option_for_new_object(a,b,c,d){$("#"+b).val(c).addClass("hide"),$("#"+b+"_formatted").val(d).removeClass("hide"),$("#"+b+"_options li").removeClass("selected"),$(a).addClass("selected"),$("#"+b+"_options_ul").addClass("hide"),on_changed_value(b,c)}function change_view(a,b){void 0==b&&(b={});var c="/ar_setup.php?tipo=views&request="+a+"&metadata="+JSON.stringify(b)+"&old_state="+JSON.stringify(state);$.getJSON(c,function(a){state=a.state,"undefined"!=typeof a.navigation&&null!==a.navigation&&""!=a.navigation&&$("#navigation").html(a.navigation),"undefined"!=typeof a.tabs&&null!==a.tabs&&$("#tabs").html(a.tabs),"undefined"!=typeof a.menu&&null!==a.menu&&$("#menu").html(a.menu),"undefined"!=typeof a.logout_label&&null!==a.logout_label&&$("#logout_label").html(a.logout_label),"undefined"!=typeof a.view_position&&null!==a.view_position&&$("#view_position").html(a.view_position),"undefined"!=typeof a.object_showcase&&null!==a.object_showcase&&""!=a.object_showcase?($("#object_showcase").removeClass("hide"),$("#object_showcase").html(a.object_showcase)):$("#object_showcase").addClass("hide"),"undefined"!=typeof a.tab&&null!==a.tab&&$("#tab").html(a.tab),"undefined"!=typeof a.structure&&null!==a.structure&&(structure=a.structure),change_browser_history_state(a.state.request),help()})}function logout(){window.location.href="/logout.php"}function save_setup(a,b){var c="/ar_setup.php?tipo=setup&step="+$("#fields").attr("step")+"&parent="+$("#fields").attr("parent")+"&parent_key="+$("#fields").attr("parent_key")+"&object="+$("#fields").attr("object")+"&key="+$("#fields").attr("key")+"&fields_data="+JSON.stringify(b);console.log(c);var d=new FormData;d.append("tipo","setup"),d.append("step",$("#fields").attr("step")),d.append("parent",$("#fields").attr("parent")),d.append("parent_key",$("#fields").attr("parent_key")),d.append("object",$("#fields").attr("object")),d.append("key",$("#fields").attr("key")),d.append("fields_data",JSON.stringify(b));var c=$.ajax({url:"/ar_setup.php",data:d,processData:!1,contentType:!1,type:"POST",dataType:"json"});c.done(function(b){if(console.log(b),$("#"+a+"_save_icon").addClass("fa-cloud"),$("#"+a+"_save_icon").removeClass("fa-spinner fa-spin"),$("#save_label").removeClass("hide"),$("#saving_label").addClass("hide"),$("#fields").removeClass("waiting"),200==b.state)if(b.redirect)change_view(b.redirect);else{$("#result").html(b.pcard).removeClass("hide"),$("#fields").addClass("hide");for(var c in b.updated_data)$("."+c).html(b.updated_data[c]);post_new_actions(a,b)}else 400==b.state&&($("#fields").addClass("error"),$("#"+a+"_msg").html(b.msg).removeClass("hide"))}),c.fail(function(b,c){console.log(c),console.log(b.responseText),$("#"+a+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#fields").removeClass("waiting").addClass("valid"),$("#save_label").removeClass("hide"),$("#saving_label").addClass("hide"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}function skip(){var a="/ar_setup.php?tipo=skip&step="+state.section;console.log(a);var b=new FormData;b.append("tipo","skip"),b.append("step",state.section);var a=$.ajax({url:"/ar_setup.php",data:b,processData:!1,contentType:!1,type:"POST",dataType:"json"});a.done(function(a){console.log(a),200==a.state?change_view(a.redirect):400==a.state&&($("#msg").addClass("error"),$("#msg").html(a.msg).removeClass("hide"))}),a.fail(function(a,b){console.log(b),console.log(a.responseText),$("#msg").html("Server error please contact Aurora support").addClass("error")})}function help(){var a="/ar_setup.php?tipo=help&state="+JSON.stringify(state);$.getJSON(a,function(a){"undefined"!=typeof a.title&&null!==a.title&&""!=a.title?$("#help  .help_title").html(a.title).removeClass("hide"):$("#help  .help_title").html("").addClass("hide"),"undefined"!=typeof a.content&&null!==a.content&&""!=a.content?($("#help  .content").html(a.content).removeClass("hide"),1==$("#help  .content .question").length&&show_answer($("#help  .content .question")[0])):$("#help  .content").html("").addClass("hide")})}function change_browser_history_state(a){void 0!=a&&("/"!==a.charAt(0)&&(a="/"+a),window.top.history.pushState({request:a},"",a))}function fixedEncodeURIComponent(a){return encodeURIComponent(a).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$(document).ready(function(){$("body").on("click",".question",function(){show_answer($(this))}),$("#whiteboard .content").on("focusin",function(){$(this).data("empty")&&$(this).html("")}),$("#whiteboard").on("input paste",".content",function(a){delayed_save_whiteboard_content($(this),400)})}),$(document).on("click","#edit_table",function(){change_view(state.request+"&tab="+state.tab+"_edit",{reload_showcase:1})}),$(document).on("click","#exit_edit_table",function(){change_view(state.request+"&tab="+state.tab.replace(/\_edit$/i,""))}),$(document).on("input propertychange","#search",function(){var a=200;window.event&&"propertychange"==event.type&&"value"!=event.propertyName||delayed_search($(this),a)});var HtmlCell=Backgrid.HtmlCell=Backgrid.Cell.extend({className:"html-cell",initialize:function(){Backgrid.Cell.prototype.initialize.apply(this,arguments)},render:function(){this.$el.empty();var a=this.model.get(this.column.get("name")),b=this.formatter.fromRaw(a,this.model);return this.$el.append(b),this.delegateEvents(),this}}),HeaderHtmlCell=Backgrid.HeaderCell.extend({className:"html-cell",render:function(){return this.column.set("label",""),this.constructor.__super__.render.apply(this,arguments),this.column.get("title")&&this.$el.attr("title",this.column.get("title")),this.$el.find("button").html(this.column.get("html_label")+" "+this.$el.find("button").html()),this}}),rightHeaderHtmlCell=Backgrid.HeaderCell.extend({className:"html-cell align-right",render:function(){return this.constructor.__super__.render.apply(this,arguments),this.$el.addClass("align-right"),this.column.get("title")&&this.$el.attr("title",this.column.get("title")),this.column.get("html_label")&&this.$el.find("button").html(this.column.get("html_label")+" "+this.$el.find("button").html()),this}}),integerHeaderCell=Backgrid.HeaderCell.extend({className:"align-right",render:function(){return this.constructor.__super__.render.apply(this,arguments),this.$el.addClass("align-right"),this}}),element_delay=300,element_clicks=0,element_timer=null;$(document).on("click","#elements .element",function(a){element_clicks++;var b=$(this).data("item");1===element_clicks?element_timer=setTimeout(function(){change_table_element("click",b),element_clicks=0},element_delay):(clearTimeout(element_timer),change_table_element("double_click",b),element_clicks=0)}).on("dblclick",function(a){a.preventDefault()}),$(document).ready(function(){console.log("caca"),state={module:"",section:"",parent:"",parent_key:"",object:"",key:""},structure={},change_view($("#_request").val()),$(document).keydown(function(a){key_press(a)})}),window.addEventListener("popstate",function(a){change_view(a.state.request)});
//# sourceMappingURL=aurora_setup.min.js.map