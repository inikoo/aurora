function delayed_save_whiteboard_content(a,b){window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){save_whiteboard_content(a)},b))}function save_whiteboard_content(a){var b=new FormData;b.append("tipo","save_whiteboard"),b.append("state",JSON.stringify(state)),b.append("content",$(a).html()),b.append("block",$(a).data("block")),$.ajax({url:"/ar_edit_help.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state||"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function get_real_time_users(){var a="/ar_real_time.php?tipo=users";$.getJSON(a,function(a){render_real_time_users_table(a.users_data)})}function help(){var a="/ar_help.php?state="+JSON.stringify(state);$.getJSON(a,function(a){"undefined"!=typeof a.help.title&&null!==a.help.title&&""!=a.help.title?$("#help  .help_title").html(a.help.title).removeClass("hide"):$("#help  .help_title").html("").addClass("hide"),"undefined"!=typeof a.help.content&&null!==a.help.content&&""!=a.help.content?($("#help  .content").html(a.help.content).removeClass("hide"),1==$("#help  .content .question").length&&show_answer($("#help  .content .question")[0])):$("#help  .content").html("").addClass("hide"),$("#whiteboard_content").html(a.whiteboard.content).removeClass("hide").data("empty",a.whiteboard.empty),$("#whiteboard_content_tab").html(a.whiteboard.content_tab).removeClass("hide").data("empty",a.whiteboard.empty_tab),$("#whiteboard_content_title").html(a.whiteboard.page_title),$("#whiteboard_content_tab_title").html(a.whiteboard.tab_title),a.whiteboard.has_tab?$("#whiteboard_content_tab").removeClass("hide"):$("#whiteboard_content_tab").addClass("hide")})}function show_answer(a){$(a).next().hasClass("hide")?($("#help .answer").addClass("hide"),$(a).find(".fa-caret-right.bullet").removeClass("fa-caret-right").addClass("fa-caret-down"),$(a).next().removeClass("hide")):($("#help .answer").addClass("hide"),$(a).find(".fa-caret-down.bullet").removeClass("fa-caret-down").addClass("fa-caret-right"))}function show_side_content(a){switch($(".side_content").addClass("hide"),$(".side_content_icon").removeClass("selected"),$("#notifications ."+a+"_button").addClass("selected"),$(".side_content."+a).removeClass("hide"),a){case"help":help();break;case"real_time_users":get_real_time_users()}var b="/ar_edit_help.php?tipo=side_block&value="+a;$.getJSON(b,function(a){})}function key_press(a){switch(a.keyCode){case 37:navigate(a,"left");break;case 38:navigate(a,"up");case 39:navigate(a,"right");break;case 40:navigate(a,"down");break;case 13:enter_hit(a)}}function navigate(a,b){if(key_scope)switch(key_scope.type){case"search":navigate_search(a,b);break;case"option":navigate_option(a,key_scope.field,b);break;case"dropdown_select":navigate_dropdown_select(a,key_scope.field,b)}}function navigate_dropdown_select(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_results .result.selected").prev();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"));break;case"down":a.preventDefault();var d=$("#"+b+"_results .result.selected").next();void 0!=d.attr("id")&&($("#"+b+"_results .result.selected").removeClass("selected"),d.addClass("selected"))}}function navigate_search(a,b){switch(b){case"up":a.preventDefault();var c=$("#results .result.selected").prev();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"));break;case"down":a.preventDefault();var c=$("#results .result.selected").next();void 0!=c.attr("id")&&($("#results .result.selected").removeClass("selected"),c.addClass("selected"))}}function navigate_option(a,b,c){switch(c){case"up":a.preventDefault();var d=$("#"+b+"_options  li.selected").prev();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"));break;case"down":a.preventDefault();var d=$("#"+b+"_options  li.selected").next();void 0!=d.attr("id")&&select_option(b,d.attr("value"),d.attr("label"))}}function enter_hit(a){if(key_scope)switch(key_scope.type){case"search":var b=$("#results .result.selected").attr("view");b&&change_view(b);break;case"dropdown_select":var c=$("#"+key_scope.field+"_results .result.selected").attr("field"),d=$("#"+key_scope.field+"_results .result.selected").attr("value"),e=$("#"+key_scope.field+"_results .result.selected").attr("formatted_value");c&&select_dropdown_option(c,d,e);break;case"option":case"option_multiple_choices":case"string":case"telephone":case"email":case"anything":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"date":case"pin":case"password":save_field(key_scope.object,key_scope.key,key_scope.field);break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+key_scope.field+"_confirm").hasClass("hide")?confirm_field(key_scope.field):save_field(key_scope.object,key_scope.key,key_scope.field)}}function scanned_barcode(a){var b=a.match(/^\!W(\d+)L(\d+)/);return b&&3==parseInt(b.length)?void change_view("/locations/"+b[1]+"/"+b[2]+"&tab=location.parts"):void("delivery_note"==state.object?scanned_barcode_in_delivery_note(a):"supplierdelivery"==state.object?scanned_barcode_in_supplier_delivery_note(a):"warehouse"==state.object?barcode_jump_location(a):""==state.object&&(console.log(state),"inventory"==state.section?barcode_jump_part(a):"locations"==state.section&&barcode_jump_location(a)))}function barcode_jump_part(a){var b="/ar_find.php?tipo=find_object&scope=part&field=barcode&parent=warehouse&parent_key="+state.current_warehouse+"&query="+a+"&state="+JSON.stringify(state);$.getJSON(b,function(a){1==a.results&&(console.log(a),change_view("/part/"+a.data.key))})}function barcode_jump_location(a){var b="/ar_find.php?tipo=find_object&scope=location&field=code&parent=warehouse&parent_key="+state.current_warehouse+"&query="+a+"&state="+JSON.stringify(state);$.getJSON(b,function(a){1==a.results&&(console.log(a),change_view("/locations/"+state.current_warehouse+"/"+a.data.key))})}function process_supplier_delivery_sko_barcode(a){var b=$("#booking_in_barcode_feedback");b.find(".fa-barcode").addClass("valid_save"),window.setTimeout(function(){b.find(".fa-barcode").removeClass("valid_save")},200);var c=!1;checked=!1;var d=!1;if($("#table .part_sko_item").each(function(b,e){if($(e).attr("barcode")==a){console.log($(e).attr("barcode")+" "+a);var f=$(e).closest("span").data("barcode_settings");return console.log(f),d=$(e).closest("tr"),$("#booking_in_barcode_feedback").data("tr",$(e).closest("tr")),console.log($(e).closest("span").attr("_checked")),checked=$(e).closest("span").attr("_checked"),$("#booking_in_barcode_part_reference").html(f.reference),$("#booking_in_barcode_part_description").html(atob(f.description)),f.image_src>0?$("#booking_in_barcode_part_image_src").attr("src",f.image_src):$("#booking_in_barcode_part_image_src").attr("src","/art/nopic.png"),$("#copy_qty_from_barcode_feedback").attr("qty",f.qty).html('<span class="discreet">'+f.cartons+"</span>/"+f.skos+'<span class="discreet">/'+f.units+"</span>"),c=!0,!1}}),$("#table tr").addClass("hide"),$("#booking_in_barcode_qty_input").val(""),booking_in_barcode_qty_input_changed(),$(".booking_in_barcode_feedback_block").addClass("hide"),c)b.find(".barcode_found").removeClass("hide"),console.log(checked),checked?($(".fast_track").addClass("hide"),console.log(d),$(d).removeClass("hide")):$(".fast_track").removeClass("hide");else{b.find(".barcode_not_found").removeClass("hide"),b.find(".barcode_found").addClass("hide"),b.find(".not_found_barcode_number").html(a);var e="/ar_find.php?tipo=find_object&scope=part&field=barcode&parent=warehouse&parent_key="+state.current_warehouse+"&query="+a+"&state="+JSON.stringify(state);console.log(e),$.getJSON(e,function(a){1==a.results?($("#booking_in_barcode_feedback .assign_barcode").addClass("hide"),$("#booking_in_barcode_feedback .find_outside_order").removeClass("hide")):($("#booking_in_barcode_feedback .assign_barcode").removeClass("hide"),$("#booking_in_barcode_feedback .find_outside_order").addClass("hide"))})}}function scanned_barcode_in_supplier_delivery_note(a){if(console.log(state.tab),"supplier.delivery.items"==state.tab&&!$("#booking_in_barcode_feedback").hasClass("hide"))if($(".booking_in_barcode_feedback_block").addClass("hide"),$("#ready_for_scan_label").addClass("hide"),$("#reading_location_barcode").hasClass("invisible"))process_supplier_delivery_sko_barcode(a);else{var b="/ar_find.php?tipo=find_object&scope=location&field=code&parent=warehouse&parent_key="+state.current_warehouse+"&query="+a+"&state="+JSON.stringify(state);console.log(b),$.getJSON(b,function(b){if(1==b.results){$("#booking_in_barcode_feedback").attr("location_key",b.data.key);var c=$("#booking_in_barcode_qty_input").val(),d=$("#booking_in_barcode_feedback").data("tr"),e=(d.find(".checked_quantity i"),d.find(".checked_quantity input")),f=$("#table").data("metadata"),g=d.find(".checked_quantity").data("settings"),h="/ar_edit_orders.php?tipo=edit_item_in_order&parent="+f.parent+"&field="+g.field+"&parent_key="+f.parent_key+"&item_key="+g.item_key+"&qty="+c+"&transaction_key="+g.transaction_key;void 0!=g.item_historic_key&&(h=h+"&item_historic_key="+g.item_historic_key);var i=new FormData;i.append("tipo","edit_item_in_order"),i.append("field",g.field),i.append("parent",f.parent),i.append("parent_key",f.parent_key),i.append("item_key",g.item_key),void 0!=g.item_historic_key&&i.append("item_historic_key",g.item_historic_key),i.append("transaction_key",g.transaction_key),i.append("qty",c);var h=$.ajax({url:"/ar_edit_orders.php",data:i,processData:!1,contentType:!1,type:"POST",dataType:"json"});h.done(function(a){if(200==a.state){console.log(a),console.log(f),e.val(a.transaction_data.qty).removeClass("discreet"),e.attr("ovalue",a.transaction_data.qty),$(c).closest("tr").find(".part_sko_item").attr("_checked",a.transaction_data.qty),$(c).closest("tr").find(".subtotals").html(a.transaction_data.subtotals),$(c).closest("tr").find(".placement").html(a.metadata.placement),$(c).closest(".checked_quantity").find(".checked_qty").attr("ovalue",a.transaction_data.qty),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),a.metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),a.metadata.state_index>=40&&$("#received_node").addClass("complete"),a.metadata.state_index>=50&&$("#checked_node").addClass("complete"),100==a.metadata.state_index?($("#placed_node").addClass("complete"),"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items")):$("#placed_node").removeClass("complete");for(var b in a.metadata.class_html)$("."+b).html(a.metadata.class_html[b]);for(var b in a.metadata.hide)$("#"+a.metadata.hide[b]).addClass("hide");for(var b in a.metadata.show)$("#"+a.metadata.show[b]).removeClass("hide");var c=d.find(".place_item_button"),g=$("#booking_in_barcode_qty_input").val(),h=$("#object_showcase div.order").data("object"),i=h.object,b=h.key,j=$(c).closest(".place_item").attr("part_sku"),k=$(c).closest(".place_item").attr("transaction_key"),l=$("#booking_in_barcode_feedback").attr("location_key"),m=$(c).closest("tr").find(".note").val(),n="/ar_edit_stock.php?tipo=place_part&object="+i+"&key="+b+"&transaction_key="+k+"&part_sku="+j+"&location_key="+l+"&qty="+g+"&note="+m;console.log(n);var o=new FormData;o.append("tipo","place_part"),o.append("object",i),o.append("key",b),o.append("transaction_key",k),o.append("part_sku",j),o.append("location_key",l),o.append("qty",g),o.append("note",m);var n=$.ajax({url:"/ar_edit_stock.php",data:o,processData:!1,contentType:!1,type:"POST",dataType:"json"});n.done(function(a){console.log(a),$(c).addClass("fa-cloud").removeClass("fa-spinner fa-spin");var b=$("#place_item_"+k),d=b.closest("tr");d.find(".placement").html(a.update_metadata.placement),d.find(".part_locations").html(a.part_locations),d.find(".place_qty").val(a.place_qty),d.find(".place_qty").attr("ovalue",a.place_qty),d.find(".place_qty").attr("max",a.place_qty),$(".order_operation").addClass("hide"),$(".items_operation").addClass("hide");for(var e in a.update_metadata.operations)$("#"+a.update_metadata.operations[e]).removeClass("hide");$(".timeline .li").removeClass("complete"),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),a.update_metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),a.update_metadata.state_index>=40&&$("#received_node").addClass("complete"),a.update_metadata.state_index>=50&&$("#checked_node").addClass("complete"),100==a.update_metadata.state_index&&($("#placed_node").addClass("complete"),"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items")),"Yes"==a.placed?b.addClass("hide"):b.removeClass("hide");for(var e in a.update_metadata.class_html)$("."+e).html(a.update_metadata.class_html[e]);for(var e in a.updated_fields)$("."+e).html(a.updated_fields[e]);$(".booking_in_barcode_feedback_block").addClass("hide"),$("#booking_in_barcode_feedback .placement_success").removeClass("hide").find(".placement").html(a.update_metadata.placement),$("#reading_location_barcode").addClass("invisible"),$("#booking_in_barcode_location_input").val("")}),n.fail(function(a,b){})}else 400==a.state&&(sweetAlert(a.msg),e.val(e.attr("ovalue")))})}else $("#booking_in_barcode_location_input").val(a)})}}function scanned_barcode_in_delivery_note(a){if("delivery_note.items"==state.tab){var b=$(".table_views .view.selected");if("view_picking_aid"==b.attr("id")){var c=$("#picking_barcode_feedback");c.find(".fa-barcode").addClass("valid_save"),window.setTimeout(function(){c.find(".fa-barcode").removeClass("valid_save")},200);$("#table .picking").each(function(b,c){if(console.log("bad >"+$(c).attr("barcode")+"< >"+a+"<"),$(c).attr("barcode")==a){console.log($(c).attr("barcode")+" "+a);var d=$(c).closest("span").data("settings");return console.log(d),$("#picking_barcode_part_reference").html(d.reference),$("#picking_barcode_part_description").html(atob(d.description)),$("#picking_barcode_part_image_src").html(d.image_src),!1}})}}}function copy_qty_from_barcode_feedback(a){$("#booking_in_barcode_qty_input").val($(a).attr("qty")),booking_in_barcode_qty_input_changed()}function booking_in_barcode_qty_input_changed(){var a=$("#booking_in_barcode_qty_input");console.log(a.val()),""==a.val()?(a.closest("div").find("i").removeClass("fa-cloud fa-exclamation-circle error").addClass("fa-plus"),$("#reading_location_barcode").addClass("invisible")):validate_signed_integer(a.val(),4294967295)&&""!=a.val()?(a.closest("div").find("i").removeClass("fa-plus fa-cloud invisible").addClass("fa-exclamation-circle error"),$("#reading_location_barcode").addClass("invisible")):(a.closest("div").find("i").removeClass(" fa-exclamation-circle error invisible").addClass("fa-plus"),a.addClass("discreet"),$("#reading_location_barcode").removeClass("invisible"),$("#booking_in_barcode_location_input").focus())}function select_assign_barcode_to_part_option(a){var b=$(a);if(void 0==b.find(".code").attr("barcode")){console.log(b.attr("value"));var c=new FormData;c.append("tipo","edit_field"),c.append("object","Part"),c.append("key",b.attr("value")),c.append("field","Part_SKO_Barcode"),c.append("value",$("#not_found_barcode_number").html());var d=$.ajax({url:"/ar_edit.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(a){200==a.state?(console.log($("#not_found_barcode_number").html()),$("#part_sko_item_"+b.attr("value")).attr("barcode",$("#not_found_barcode_number").html()),process_supplier_delivery_sko_barcode($("#not_found_barcode_number").html())):400==a.state&&sweetAlert(a.msg)})}}function open_edit_this_field(a){var b=$(a).closest("tr").attr("field");$("#"+b+"_lock").hasClass("hide")&&open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),b)}function open_edit_field(a,b,c){var d=$("#"+c+"_container").attr("field_type");switch($("#"+c+"_formatted_value").addClass("hide"),$("#"+c+"_edit_button").addClass("hide"),$("#"+c+"_reset_button").removeClass("hide"),$("#"+c+"_msg").html("").removeClass("success error"),console.log(d),d){case"string":case"handle":case"textarea":case"email":case"new_email":case"numeric":case"amount":case"amount_margin":case"amount_percentage":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"numeric_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"dimensions":case"percentage":$("#"+c).removeClass("hide"),$("#"+c).trigger("focus"),$("#"+c+"_save_button").removeClass("hide");break;case"editor":$("#editor_container_"+c).removeClass("hide");break;case"upload":$("#edit_object_upload_"+c).removeClass("hide");break;case"html_editor":$("#"+c).removeClass("hide"),$("#"+c).trigger("focus"),$("#"+c+"_save_button").removeClass("hide");break;case"barcode":""==$("#"+c+"_value").val()&&$("#"+c+"_assign_available_barcode").removeClass("hide"),$("#"+c).removeClass("hide"),$("#"+c).trigger("focus"),$("#"+c+"_save_button").removeClass("hide");break;case"dropdown_select":$("#"+c+"_dropdown_select_label").removeClass("hide").focus(),$("#"+c+"_save_button").removeClass("hide");break;case"country_select":$("#"+c).removeClass("hide"),$("#"+c).trigger("focus"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"telephone":case"new_telephone":$("#"+c).removeClass("hide"),$("#"+c).trigger("focus"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});case"address":case"country":case"new_delivery_address":$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"other_delivery_address":$("#"+c+"_field").removeClass("hide"),$("#show_new_delivery_address_field").addClass("hide"),$("#other_delivery_addresses_field").addClass("hide"),$("#"+c).removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),$("#"+c+"_field .intl-tel-input .flag-container").css({display:"block"});break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+c).removeClass("hide"),$("#"+c+"_confirm_button").removeClass("hide"),$("#"+c).trigger("focus");break;case"option":$("#"+c+"_add_other_option").removeClass("hide"),$("#"+c+"_options").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"option_multiple_choices":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_options").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"date":$("#"+c+"_formatted").removeClass("hide"),$("#"+c+"_datepicker").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide"),"yes"==$("#"+c+"_eraser").attr("display")&&""!=$("#"+c+"_formatted").val()&&$("#"+c+"_eraser").removeClass("hide");break;case"working_hours":$("#working_hours").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"salary":$("#salary").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"parts_list":$("#parts_list").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"mixed_recipients":$("#"+c+"_container").find(".mixed_recipients_container").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide");break;case"timezone":$(".timezone_edit").removeClass("hide"),$("#"+c+"_save_button").removeClass("hide")}key_scope={type:d,object:a,key:b,field:c}}function show_add_other_option(a){$("#"+a+"_add_other_option").hasClass("fa-plus")?($("#"+a).removeClass("hide"),$("#"+a+"_options").addClass("hide"),$("#"+a+"_add_other_option").removeClass("fa-plus").addClass("fa-list-ul")):($("#"+a).addClass("hide"),$("#"+a+"_options").removeClass("hide"),$("#"+a+"_add_other_option").addClass("fa-plus").removeClass("fa-list-ul"))}function close_edit_this_field(a){close_edit_field($(a).closest("tr").attr("field"))}function close_edit_field(a){console.log(a);var b=$("#"+a+"_container").attr("field_type");switch($("#"+a+"_formatted_value").removeClass("hide"),$("#"+a+"_edit_button").removeClass("hide"),$("#"+a+"_reset_button").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),b){case"string":case"handle":case"email":case"int_unsigned":case"smallint_unsigned":case"mediumint_unsigned":case"int":case"smallint":case"mediumint":case"pin":case"password":case"textarea":case"numeric":case"amount":case"amount_margin":case"amount_percentage":case"dimensions":case"percentage":case"numeric_unsigned":$("#"+a).addClass("hide");break;case"editor":$("#editor_container_"+a).addClass("hide");break;case"upload":$("#edit_object_upload_"+a).addClass("hide");break;case"html_editor":$("#"+a).addClass("hide");break;case"barcode":$("#"+a+"_assign_available_barcode").addClass("hide"),$("#"+a).addClass("hide");break;case"country_select":$("#"+a+"_field div.country-select.inside .flag-dropdown").css({display:"none"}),$("#"+a).addClass("hide");break;case"dropdown_select":$("#"+a+"_dropdown_select_label").addClass("hide"),$("#"+a+"_results_container").addClass("hide").removeClass("show");break;case"new_email":$("#new_email_formatted_value").html(""),$("#new_email_value").val(""),$("#new_email").val(""),on_changed_value("new_email",""),$("#new_email_field").addClass("hide"),$("#show_new_email_field").removeClass("hide");break;case"telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_telephone":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"}),$("#new_telephone_field").addClass("hide"),$("#show_new_telephone_field").removeClass("hide");break;case"address":case"country":$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field div.country-select.inside .flag-dropdown").css({display:"block"});break;case"other_delivery_address":$("#"+a+"_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide"),$("#other_delivery_addresses_field").removeClass("hide"),$("#"+a).addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_field .intl-tel-input .flag-container").css({display:"none"});break;case"new_delivery_address":$("#new_delivery_address_field").addClass("hide"),$("#show_new_delivery_address_field").removeClass("hide");break;case"pin_with_confirmation":case"password_with_confirmation":$("#"+a).addClass("hide"),$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").addClass("hide");break;case"option":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li.selected").removeClass("selected"),$("#"+a+"_option_"+$("#"+a+"_value").val()).addClass("selected"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");break;case"option_multiple_choices":$("#"+a+"_options").addClass("hide"),$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_options li").attr("is_selected",0),$("#"+a+"_options li  .checkbox").removeClass("fa-check-square").addClass("fa-square");for(var c=$("#"+a+"_value").val().split(","),d=0;d<c.length;d++)$("#"+a+"_option_"+c[d]).attr("is_selected",1),$("#"+a+"_option_"+c[d]+" .checkbox").addClass("fa-check-square").removeClass("fa-square");$("#"+a+"_editor").removeClass("changed");break;case"date":$("#"+a+"_formatted").addClass("hide"),$("#"+a+"_datepicker").addClass("hide"),$("#"+a+"_eraser").addClass("hide"),$("#"+a+"_formatted").val($("#"+a+"_formatted_value").html()),$("#"+a+"_editor").removeClass("changed");var e=chrono.parseDate($("#"+a+"_formatted").val());e.toISOString().slice(0,10);$("#"+a+"_datepicker").datepicker("setDate",e);break;case"working_hours":$("#working_hours").addClass("hide");break;case"salary":$("#salary").addClass("hide");break;case"parts_list":$("#parts_list").addClass("hide");break;case"mixed_recipients":$("#"+a+"_container").find(".mixed_recipients_container").addClass("hide");break;case"timezone":$(".timezone_edit").addClass("hide")}$("#"+a+"_editor").removeClass("invalid valid"),$("#"+a+"_msg").hasClass("success")||$("#"+a+"_msg").html("").addClass("hide"),key_scope=!1}function delayed_on_change_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_value(c,e)},b))}function on_changed_confirm_value(a,b){""!=b?$("#"+a+"_editor").addClass("changed"):$("#"+a+"_editor").removeClass("changed"),$("#"+a+"_editor").removeClass("invalid valid");var c=$("#"+a).val();if(c==b?validation="valid":c.substring(0,b.length)==b?validation="potentially_valid":validation="invalid",$("#"+a+"_editor").addClass(validation),"invalid"==validation){if($("#"+a+"_no_match_invalid_msg").length)var d=$("#"+a+"_no_match_invalid_msg").html();else var d=$("#not_match_invalid_msg").html();d+=" "}else var d="";$("#"+a+"_msg").html(d)}function on_changed_value(a,b){var c=$("#fields").attr("object");$("#"+c+"_save").hasClass("hide")&&reset_controls();var d=$("#"+a+"_container"),e=d.attr("field_type");"date"!=e&&"date_interval"!=e||(b=b+" "+$("#"+a+"_time").val()),$("#"+a).closest("tbody.address_fields").attr("has_been_changed",1),$("#"+a).attr("has_been_changed",1),$("#"+a+"_field").removeClass("invalid valid potentially_valid");var f=validate(a,b);process_validation(f,a,!1)}function validate(a,b){var c=$("#"+a+"_container");$("#"+a+"_field").addClass("waiting_validation changed"),$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var d=c.attr("server_validation"),e=c.attr("parent"),f=c.attr("parent_key"),g=c.attr("object"),h=c.attr("key"),i=c.attr("field_type");if(c.hasClass("address_value"))var j=c.closest("tbody.address_fields").attr("_required");else var j=c.attr("_required");return"salary"==i?validate_salary_components():validate_field(a,b,i,j,d,e,f,g,h)}function process_validation(a,b,c){var d=$("#"+b+"_container"),e=d.attr("field_type");if("potentially_valid"==a["class"]&&c&&(a["class"]="invalid","salary"==e&&$("#salary  input.salary_input_field").each(function(a,b){$(b).hasClass("potentially_valid")&&$(b).removeClass("potentially_valid").addClass("invalid")})),"waiting"!=a["class"]){$("#"+b+"_field").removeClass("waiting_validation"),$("#"+b+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud");var f="";if("valid"==a["class"]?($("#"+b).attr("has_been_valid",1),$("#"+b+"_field").removeClass("invalid potentially_valid").addClass("valid")):"invalid"==a["class"]&&($("#"+b+"_field").removeClass("valid").addClass("invalid"),f=$("#"+b+"_"+a.type+"_invalid_msg").length?$("#"+b+"_"+a.type+"_invalid_msg").html():$("#invalid_msg").html()),$("#"+b+"_msg").html(f),$("#fields").hasClass("new_object")){$("#"+$("#"+b+"_container").attr("object")+"_msg").html("");var g=get_form_validation_state();process_form_validation(g)}void 0!=$("#inline_new_object").attr("object")&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(f).addClass(a["class"]).removeClass("hide"),$("#inline_new_object").removeClass("invalid valid potentially_valid"),$("#inline_new_object").addClass(a["class"]))}}function show_invalid_messages(a){var b=validate(a,$("#"+a).val(),$("#"+a+"_container"));process_validation(b,a,!0)}function select_option(a,b,c){$("#"+b).val(c),$("#"+b+"_options li").removeClass("selected"),$(a).addClass("selected"),$("#fields").hasClass("new_object"),on_changed_value(b,c)}function select_option_multiple_choices(a,b,c){var d=$("#"+a+"_option_"+b);1==d.attr("is_selected")?($("#"+a+"_option_"+b+" .checkbox").removeClass("fa-check-square").addClass("fa-square"),d.attr("is_selected",0)):($("#"+a+"_option_"+b+" .checkbox").addClass("fa-check-square").removeClass("fa-square"),d.attr("is_selected",1));var e=0,f=[],g=[];$("#"+a+"_options li").each(function(){1==$(this).attr("is_selected")&&(e++,f.push($(this).attr("value")),g.push($(this).attr("label")))}),$("#"+a+"_container").hasClass("new")&&$("#"+a+"_formatted").val(g.sort().join()),$("#"+a).val(f.sort().join()),on_changed_value(a,f.sort().join())}function set_this_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function set_as_main(a,b,c){var d="/ar_edit.php?tipo=set_as_main&object="+a+"&key="+b+"&field="+c;$.getJSON(d,function(b){if(console.log(b),200==b.state){if("new_field"==b.action&&b.new_fields)for(var c in b.new_fields)create_new_field(b.new_fields[c]);if(""!=b.directory_field&&($("#"+b.directory_field+"_directory").html(b.directory),0==b.items_in_directory?$("#"+b.directory_field+"_field").addClass("hide"):$("#"+b.directory_field+"_field").removeClass("hide")),b.other_fields)for(var c in b.other_fields)update_field(b.other_fields[c]);switch(a){case"Customer Client":"set_main_contact_number_Mobile"==b.action?$("#Customer_Client_Main_Plain_Mobile_display").insertAfter("#display_telephones"):"set_main_contact_number_Telephone"==b.action&&$("#Customer_Client_Main_Plain_Telephone_display").insertAfter("#display_telephones");break;case"Customer":if("set_main_contact_number_Mobile"==b.action)$("#Customer_Main_Plain_Mobile_display").insertAfter("#display_telephones");else if("set_main_contact_number_Telephone"==b.action)$("#Customer_Main_Plain_Telephone_display").insertAfter("#display_telephones");else if("set_main_delivery_address"==b.action){var d=JSON.parse(b.value);$("#Customer_Delivery_Address_recipient  input ").val(decodeEntities(d["Address Recipient"])),$("#Customer_Delivery_Address_organization  input ").val(decodeEntities(d["Address Organization"])),$("#Customer_Delivery_Address_addressLine1  input ").val(decodeEntities(d["Address Line 1"])),$("#Customer_Delivery_Address_addressLine2  input ").val(decodeEntities(d["Address Line 2"])),$("#Customer_Delivery_Address_sortingCode  input ").val(decodeEntities(d["Address Sorting Code"])),$("#Customer_Delivery_Address_postalCode  input ").val(decodeEntities(d["Address Postal Code"])),$("#Customer_Delivery_Address_dependentLocality  input ").val(decodeEntities(d["Address Dependent Locality"])),$("#Customer_Delivery_Address_locality  input ").val(decodeEntities(d["Address Locality"])),$("#Customer_Delivery_Address_administrativeArea  input ").val(decodeEntities(d["Address Administrative Area"])),$("#Customer_Delivery_Address_country_select").intlTelInput("setCountry",d["Address Country 2 Alpha Code"].toLowerCase()),$("#Customer_Delivery_Address_country_select").trigger("country-change","init")}break;case"Supplier":"set_main_contact_number_Mobile"==b.action?$("#Supplier_Main_Plain_Mobile_display").insertAfter("#display_telephones"):"set_main_contact_number_Telephone"==b.action&&$("#Supplier_Main_Plain_Telephone_display").insertAfter("#display_telephones");break;case"Agent":"set_main_contact_number_Mobile"==b.action?$("#Agent_Main_Plain_Mobile_display").insertAfter("#display_telephones"):"set_main_contact_number_Telephone"==b.action&&$("#Agent_Main_Plain_Telephone_display").insertAfter("#display_telephones")}}else 400==b.state})}function save_this_field(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("tr").attr("field"))}function save_this_address(a){save_field($("#fields").attr("object"),$("#fields").attr("key"),$(a).closest("table").attr("field"))}function save_field(a,b,c){var d=$("#"+c+"_container"),e=d.attr("field_type");required=d.attr("_required");var f=$("#"+c),g=f.val();if(!$("#"+c+"_field").hasClass("changed"))return console.log($("#"+c+"_field")),void console.log("no_change :("+c);if(!$("#"+c+"_field").hasClass("valid"))return console.log("field invalid x"),void show_invalid_messages(c);if(!$("#"+c+"_save_button").hasClass("fa-cloud"))return void console.log("waiting for validation");if($("#"+c+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin"),
$("#"+c+"_save_button").hasClass("potentially_valid")){var h=d.attr("server_validation"),i=d.attr("parent"),j=d.attr("parent_key"),k=d.attr("object"),b=d.attr("key"),l=validate_field(c,g,e,required,h,i,j,k,b);if($("#"+c).attr("has_been_valid",1),"password_with_confirmation"!=e&&"in_with_confirmation"!=e||$("#"+c+"_confirm").hasClass("hide"))if($("#"+c+"_"+l.type+"_invalid_msg").length)var m=$("#"+c+"_"+l.type+"_invalid_msg").html();else var m=$("#invalid_msg").html();else{if($("#"+c+"_no_match_invalid_msg").length)var m=$("#"+c+"_no_match_invalid_msg").html();else var m=$("#not_match_invalid_msg").html();m+=$("#"+c+"_cancel_confirm_button").html()}return $("#"+c+"_msg").html(m),$("#"+c+"_field").addClass("invalid"),void $("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}var n={};if("date"==e)g=g+" "+$("#"+c+"_time").val();else if("address"==e||"new_delivery_address"==e||"other_delivery_address"==e)g=get_address_value(c);else if("password"==e||"password_with_confirmation"==e||"password_with_confirmation_paranoid"==e||"pin"==e||"pin_with_confirmation"==e||"pin_with_confirmation_paranoid"==e)g=sha256_digest(g);else if("telephone"==e)g=$("#"+c).intlTelInput("getNumber");else if("country_select"==e)g=$("#"+c).countrySelect("getSelectedCountryData").code;else if("parts_list"==e){var o=[];$("#parts_list_items  tr.part_tr").each(function(a,b){if(!$(b).find(".sku").val())return!0;if($(b).hasClass("very_discreet"))var c=0;else var c=$(b).find(".parts_per_product").val();var d={Key:$(b).find(".product_part_key").val(),"Part SKU":$(b).find(".sku").val(),Ratio:c,Note:$(b).find(".note").val()};o.push(d)}),g=JSON.stringify(o)}else if("mixed_recipients"==e){external_emails=[],user_keys=[];var p=$("#"+c+"_field").find(".mixed_recipients_container");$(".external_email_mixed_recipients_value",p).each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&external_emails.push($(b).val())}),$(".user_key",p).each(function(a,b){$(b).closest("tr").hasClass("very_discreet")||""!=$(b).val()&&user_keys.push($(b).val())});var q={external_emails:external_emails,user_keys:user_keys};g=JSON.stringify(q)}if("setup"==$("#fields").attr("form_type"))var r="/ar_upload.php";else var r="/ar_edit.php";var s=new FormData;s.append("tipo","edit_field"),s.append("object",a),s.append("key",b),s.append("field",c),s.append("value",g),s.append("metadata",JSON.stringify(n)),$.ajax({url:r,type:"POST",data:s,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if(console.log(a),$("#"+c+"_save_button").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),100==a.state&&pre_save_actions(c,a),200==a.state){if($("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),$("#"+c+"_value").val(a.value),$("#"+c+"_field").removeClass("changed"),$("#"+c+"_field").removeClass("valid"),$("."+c).html(a.formatted_value),"option"==e?($("#"+c+"_options li i.current_mark").removeClass("current"),$("#"+c+"_options li.selected  i.current_mark").addClass("current")):"option_multiple_choices"==e?($("#"+c+"_options li .current_mark").removeClass("current"),$("#"+c+"_option_"+g+" .current_mark").addClass("current")):"dropdown_select"==e?$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"):$("#"+c+"_msg").html(a.msg).addClass("success").removeClass("hide"),"deleted"==a.action&&($("#"+c+"_edit_button").parent(".show_buttons").css("visibility","hidden"),$("#"+c+"_label").find(".button").addClass("hide")),""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")),"new_field"==a.action&&a.new_fields)for(var b in a.new_fields)create_new_field(a.new_fields[b]);if(close_edit_field(c),a.other_fields)for(var b in a.other_fields)update_field(a.other_fields[b]);if(a.deleted_fields)for(var b in a.deleted_fields)delete_field(a.deleted_fields[b]);for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide");post_save_actions(c,a)}else 400==a.state&&($("#"+c+"_editor").removeClass("valid potentially_valid").addClass("invalid"),$("#"+c+"_msg").html(a.msg).removeClass("hide"))},error:function(){}})}function pre_save_actions(a,b){}function post_save_actions(a,b){switch(console.log(a),console.log(b),a){case"Prospect_Customer_Key":change_view(state.request,{reload_showcase:1});break;case"User_Preferred_Locale":change_view(state.request,{reload:!0});break;case"Product_Parts":post_save_product_parts(b);break;case"Staff_Type":"contractor"==state.section&&"Contractor"!=b.value&&change_view("/employee/"+state.key),"employee"==state.section&&"Contractor"==b.value&&change_view("/contractor/"+state.key);break;case"Staff_Currently_Working":"employee"==state.section&&change_view("/employee/"+state.key,{reload_showcase:1}),"contractor"==state.section&&change_view("/contractor/"+state.key,{reload_showcase:1});break;case"Supplier_Part_Supplier_Key":change_view(b.update_metadata.request,{reload_showcase:1})}}function create_new_field(a){var b=a.field,c=$("#"+a.clone_from+"_field").clone();if(c.prop("id",b+"_field"),c.removeClass("hide"),c.attr("field",b),$("#"+a.clone_from+"_field").after(c),c.find(".label").prop("id",b+"_label"),c.find("i.reset_button").prop("id",b+"_reset_button"),c.find("i.edit_button").prop("id",b+"_edit_button"),c.find("i.lock").prop("id",b+"_lock"),c.find("td.container").prop("id",b+"_container"),c.find("span.editor").prop("id",b+"_editor"),c.find("span.formatted_value").prop("id",b+"_formatted_value").removeClass(a.clone_from).addClass(b).html(a.formatted_value),c.find("input.unformatted_value").prop("id",b+"_value").val(a.value),"string"==a.edit||"email"==a.edit||"new_email"==a.edit||"int_unsigned"==a.edit||"smallint_unsigned"==a.edit||"mediumint_unsigned"==a.edit||"int"==a.edit||"smallint"==a.edit||"mediumint"==a.edit||"anything"==a.edit||"numeric"==a.edit)c.removeClass("hide"),c.find("input.input_field").prop("id",b).val(a.value),c.find("i.save").prop("id",b+"_save_button").addClass(a.edit),c.find("span.msg").prop("id",b+"_msg");else if("telephone"==a.edit||"new_telephone"==a.edit)c.removeClass("hide"),c.find("input.input_field").prop("id",b).val(a.value),c.find("i.save").prop("id",b+"_save_button").addClass(a.edit),c.find("span.msg").prop("id",b+"_msg"),$("#"+b).intlTelInput({utilsScript:"/js/libs/telephone_utils.js",defaultCountry:"GB",preferredCountries:["GB","US"]}),$("#"+b).intlTelInput("setNumber",a.value);else if("address"==a.edit){c.find("table").prop("id",b).attr("field",b),c.find("tr.recipient ").prop("id",b+"_recipient"),c.find("tr.organization ").prop("id",b+"_organization"),c.find("tr.addressLine1 ").prop("id",b+"_addressLine1"),c.find("tr.addressLine2 ").prop("id",b+"_addressLine2"),c.find("tr.sortingCode ").prop("id",b+"_sortingCode"),c.find("tr.postalCode ").prop("id",b+"_postalCode"),c.find("tr.dependentLocality ").prop("id",b+"_dependentLocality"),c.find("tr.locality ").prop("id",b+"_locality"),c.find("tr.administrativeArea ").prop("id",b+"_administrativeArea"),c.find("tr.country ").prop("id",b+"_country"),c.find("input.country_select ").prop("id",b+"_country_select");var d=JSON.parse(a.value);$("#"+b+"_recipient  input ").val(decodeEntities(d["Address Recipient"])),$("#"+b+"_organization  input ").val(decodeEntities(d["Address Organization"])),$("#"+b+"_addressLine1  input ").val(decodeEntities(d["Address Line 1"])),$("#"+b+"_addressLine2  input ").val(decodeEntities(d["Address Line 2"])),$("#"+b+"_sortingCode  input ").val(decodeEntities(d["Address Sorting Code"])),$("#"+b+"_postalCode  input ").val(decodeEntities(d["Address Postal Code"])),$("#"+b+"_dependentLocality  input ").val(decodeEntities(d["Address Dependent Locality"])),$("#"+b+"_locality  input ").val(decodeEntities(d["Address Locality"])),$("#"+b+"_administrativeArea  input ").val(decodeEntities(d["Address Administrative Area"]));var e=d["Address Country 2 Alpha Code"].toLowerCase();$("#"+b+"_country_select").intlTelInput({initialCountry:e,preferredCountries:$("#preferred_countries").val().split(",")}),$("#"+b+"_country_select").on("country-change",function(a,c){var d=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").name,e=$("#"+b+"_country_select").intlTelInput("getSelectedCountryData").iso2.toUpperCase();d=d.match(/\)\s+\(.+\)$/)?d.replace(/\)\s+\(.+\)$/,")"):d.replace(/\s+\(.+\)$/,""),$("#"+b+"_country  input.address_input_field ").val(e),update_address_fields(b,e,hide_recipient_fields=!1),$("#"+b+"_country_select").val(d),"init"!=c&&on_changed_address_value(b,b+"_country",e)}),$("#"+b+"_country_select").trigger("country-change","init")}void 0!=a.label&&$("#"+b+"_label").html(a.label),post_create_action(a)}function post_create_action(a){}function delete_field(a){var b=a.field;$("#"+b+"_field").addClass("hide")}function update_field(a){var b=a.field,c=$("#"+b+"_container").attr("c");console.log(a),console.log(b),a.render?$("#"+b+"_field").removeClass("hide"):($("#"+b+"_field").addClass("hide"),close_edit_field(b)),void 0!=a.label&&$("#"+b+"_label").html(a.label),void 0!=a.required&&(a.required?$("#"+b+"_validation").addClass("required"):$("#"+b+"_validation").removeClass("required"),$("#"+b+"_container").attr("_required",a.required)),void 0!=a.placeholder&&$("#"+b).attr("placeholder",a.placeholder),void 0!=a.server_validation&&$("#"+b+"_container").attr("server_validation",a.server_validation),void 0!=a.options&&$("#"+b+"_options ul ").html(a.options),void 0!=a.locked&&(1==a.locked?($("#"+b+"_validation").addClass("hide"),$("#"+b+"_locked_tag").removeClass("hide"),$("#"+b).attr("readonly",!0)):($("#"+b+"_validation").removeClass("hide"),$("#"+b+"_locked_tag").addClass("hide"),$("#"+b).attr("readonly",!1))),console.log(c),void 0!=a.value&&("date"==c&&($("."+b).html(a.formatted_value),$("#"+b+"_datepicker").datepicker("setDate",new Date(a.formatted_value)),$("#"+b).val(a.value),$("#"+b+"_formatted").val(a.formatted_value)),"option"==c?($("#"+b+"_formatted_value").html(a.formatted_value),$("#"+b).val(a.value),$("#"+b+"_options li").removeClass("selected").removeClass("current"),$("#"+b+"_option_"+a.value.replace(".",".")).addClass("selected").addClass("current")):($("."+b).html(a.formatted_value),$("#"+b).val(a.value))),post_update_field(a)}function post_update_field(a){}function hide_edit_field_msg(a){$("#"+a+"_msg").html("").addClass("hide")}function confirm_field(a){$("#"+a).addClass("hide"),$("#"+a+"_confirm_button").addClass("hide"),$("#"+a+"_confirm").removeClass("hide"),$("#"+a+"_save_button").removeClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_confirm").focus()}function cancel_confirm_field(a){$("#"+a).removeClass("hide"),$("#"+a+"_confirm_button").removeClass("hide"),$("#"+a+"_confirm").addClass("hide"),$("#"+a+"_save_button").addClass("hide"),$("#"+a+"_editor").removeClass("invalid valid changed"),$("#"+a+"_msg").html(""),$("#"+a).val(""),$("#"+a).attr("has_been_valid",0),$("#"+a).trigger("focus")}function addZero2dateComponent(a){return a<10&&(a="0"+a),a}function clean_time(a){var b=/^[0-9]{4}$/;if(b.test(a))c=[a.substring(0,2),a.substring(2,4)];else var c=a.split(":");var d=addZero2dateComponent(parseInt(c[0])),e=addZero2dateComponent(parseInt(c[1])),f="00";return d+":"+e+":"+f}function add_minutes_to_time(a,b){var c=a.split(":"),d=new Date(2e3,0,1,c[0],parseInt(c[1])+parseInt(b),c[2]);return a=addZero2dateComponent(d.getHours())+":"+addZero2dateComponent(d.getMinutes())+":00"}function update_address_fields(a,b,c){var d="/ar_address.php?tipo=fields_data&country_code="+b;$.getJSON(d,function(b){if(200==b.state)for(var d in b.fields){var e=$("#"+a+"_"+d),f=b.fields[d];e.find(".label").html(f.label),f.required?e.find(".fa-asterisk").removeClass("hide"):e.find(".fa-asterisk").addClass("hide"),!f.render||c&&("recipient"==d||"organization"==d)?e.addClass("hide"):e.removeClass("hide"),e.insertBefore("#"+a+"_country")}else 400==b.state})}function delayed_on_change_address_field(a,b){var c=a.closest("table").attr("field"),d=a.closest("tr").attr("id"),e=a.val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_changed_address_value(c,d,e)},b))}function get_address_value(a){var b={"Address Recipient":null,"Address Organization":null,"Address Line 1":null,"Address Line 2":null,"Address Sorting Code":null,"Address Postal Code":null,"Address Dependent Locality":null,"Address Locality":null,"Address Administrative Area":null,"Address Country 2 Alpha Code":null};return $("#"+a+" input.address_input_field").each(function(a,c){var d=$(c);""!=d.val()&&(b[d.attr("field_name")]=d.val())}),JSON.stringify(b)}function on_changed_address_value(a,b,c){var d=get_address_value(a);if(d!=$("#"+a+"_value").val()){$("#"+a+"_editor").addClass("changed");var e=!0;$("#"+a+"_address_fields").attr("has_been_changed",1)}else{$("#"+a+"_editor").removeClass("changed");var e=!1;$("#"+a+"_address_fields").attr("has_been_changed",0)}if($("#"+a+"_save_button").removeClass("invalid valid potentially_valid"),$("#"+a+"_msg").removeClass("invalid valid potentially_valid"),$("#"+a+"_validation").removeClass("invalid valid potentially_valid"),e){$("#"+a+"_field").addClass("waiting_validation changed"),$("#"+a+"_save_button").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var f=validate_address(a);process_validation(f,a,!0)}else $("#"+a+"_msg").html("")}function set_directory_item_as_main(a){set_as_main($("#fields").attr("object"),$("#fields").attr("key"),a)}function show_directory_item_edit(a){open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),a)}function delete_directory_item(a,b){var c="/ar_edit.php?tipo=delete_object_component&object="+$("#fields").attr("object")+"&key="+$("#fields").attr("key")+"&field="+b;$.getJSON(c,function(a){200==a.state?""!=a.directory_field&&($("#"+a.directory_field+"_directory").html(a.directory),0==a.items_in_directory?$("#"+a.directory_field+"_field").addClass("hide"):$("#"+a.directory_field+"_field").removeClass("hide")):400==a.state})}function delayed_on_change_dropdown_select_field(a,b){var c=a.attr("id"),d=$("#"+c),e=d.val();key_scope={type:"dropdown_select",field:d.attr("field")},window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_dropdown_select(c,e)},b))}function get_dropdown_select(a,b){var c=$("#"+a).attr("parent_key"),d=$("#"+a).attr("parent"),e=$("#"+a).attr("scope"),f=$("#"+a).attr("field"),g=$("#"+a).data("metadata");console.log(g),void 0==g&&(g={});var h="/ar_find.php?tipo=find_objects&query="+fixedEncodeURIComponent(b)+"&scope="+e+"&parent="+d+"&parent_key="+c+"&metadata="+JSON.stringify(g)+"&state="+JSON.stringify(state);void 0!=$("#"+a).attr("action")&&(h+="&action="+$("#"+a).attr("action")),console.log(h),$.getJSON(h,function(c){c.number_results>0?($("#"+f+"_results_container").removeClass("hide").addClass("show"),$("#"+f+"_msg").html("").addClass("hide"),$("#"+f).val(""),on_changed_value(f,b)):b.length>0?(console.log("caca"),1==$("#"+a).attr("create_new")?$("#"+f+"_new_object_invalid_msg").length&&(msg=$("#"+f+"_new_object_invalid_msg").html(),$("#"+f+"_msg").html(msg).removeClass("hide")):($("#"+f+"_results_container").addClass("hide").removeClass("show"),$("#"+f).val(""),on_changed_value(f,"__error__"))):($("#"+f+"_results_container").addClass("hide").removeClass("show"),$("#"+f).val(""),on_changed_value(f,"")),$("#"+f+"_results .result").remove();var d=!0;for(var e in c.results){var g=$("#"+f+"_search_result_template").clone();g.prop("id",f+"_result_"+e),g.addClass("result").removeClass("hide"),g.attr("value",c.results[e].value),g.attr("formatted_value",c.results[e].formatted_value),g.data("metadata",c.results[e].metadata),g.attr("field",f),d&&(g.addClass("selected"),d=!1),g.children(".code").html(c.results[e].code),g.children(".label").html(c.results[e].description),$("#"+f+"_results").append(g)}})}function select_dropdown_option(a){if(field=$(a).attr("field"),value=$(a).attr("value"),formatted_value=$(a).attr("formatted_value"),metadata=$(a).data("metadata"),$("#"+field+"_dropdown_select_label").val(formatted_value),$("#"+field).val(value),on_changed_value(field,value),$("#"+field+"_results_container").addClass("hide").removeClass("show"),console.log(metadata),void 0!=metadata&&metadata.other_fields)for(var b in metadata.other_fields)update_field(metadata.other_fields[b])}function assign_available_barcode(a){var b="/ar_edit.php?tipo=get_available_barcode";$.getJSON(b,function(b){200==b.state?""==b.barcode_number||($("#"+a).val(b.barcode_number),$("#"+a+"_field").addClass("changed").addClass("valid"),save_field($("#fields").attr("object"),$("#fields").attr("key"),a)):400==b.state})}function not_authorised_toggle_unlock_delete_object(a,b){var c=$(a).data("labels");console.log(c),console.log(a);var d="/ar_find.php?tipo=users_with_right&right="+b;$.getJSON(d,function(a){var b=[];$.each(a.users_data,function(a,c){"No"==c.UIR&&b.push(c["User Alias"])});var d=b.join(", ");footer_text=c.footer+d,Swal.fire({type:"error",title:c.title,text:c.text,footer:footer_text})})}function toggle_unlock_delete_object(a){$(a).hasClass("fa-lock")?($(a).removeClass("fa-lock").addClass("fa-unlock"),$(a).nextAll("span:first").removeClass("disabled").addClass("button")):($(a).addClass("fa-lock").removeClass("fa-unlock"),$(a).nextAll("span:first").addClass("disabled").removeClass("button"))}function toggle_prospect_link_to_customer(a){var b="Prospect_Customer_Key";$(a).hasClass("fa-lock")?($(a).removeClass("fa-lock").addClass("fa-unlock"),$(a).nextAll("span:first").removeClass("disabled").addClass("button"),open_edit_field($("#fields").attr("object"),$("#fields").attr("key"),b)):($(a).addClass("fa-lock").removeClass("fa-unlock"),$(a).nextAll("span:first").addClass("disabled").removeClass("button"),close_edit_field(b))}function delete_object(a){save_object_operation("delete",a)}function clean_cache(a){save_object_operation("clean_cache",a)}function approve_object(a){save_object_operation("approve",a)}function reject_object(a){save_object_operation("reject",a)}function suspend_object(a){save_object_operation("suspend",a)}function activate_object(a){save_object_operation("activate",a)}function finish_object(a){save_object_operation("finish",a)}function suspend_parent_object(a){save_object_operation("suspend_parent",a)}function activate_parent_object(a){save_object_operation("activate_parent",a)}function reset_object(a){save_object_operation("reset",a)}function reindex_object(a){save_object_operation("reindex",a)}function archive_object(a){save_object_operation("archive",a)}function unarchive_object(a){save_object_operation("unarchive",a)}function unlink_customer_object(a){save_object_operation("unlink_customer",a)}function save_object_operation(a,b,c){if(!$(b).hasClass("disabled")){if("delete"==a)var d="fa-trash-alt";else if("archive"==a)var d="fa-archive";else if("unarchive"==a)var d="fa-folder-open";$(b).find("i").removeClass(d).addClass("fa-spinner fa-spin");var e="/ar_edit.php?tipo=object_operation&operation="+a+"&object="+$(b).data("data").object+"&key="+$(b).data("data").key+"&state="+JSON.stringify(state);void 0!=c&&(e=e+"&metadata="+JSON.stringify(c)),$.getJSON(e,function(a){200==a.state?(console.log(a),void 0!=a.request?change_view(a.request):change_view(state.request,{reload_showcase:1})):400==a.state&&($(b).find("i").addClass(d).removeClass("fa-spinner fa-spin"),Swal.fire({type:"error",title:a.resp}))})}}function delete_attachment(a){if(!$(a).hasClass("disabled")&&$(a).find("i.fa").removeClass("fa-trash")){$(a).find("i.fa").removeClass("fa-trash").addClass("fa-spinner fa-spin");var b="/ar_edit.php?tipo=delete_attachment&attachment_bridge_key="+$(a).data("data").attachment_bridge_key;$.getJSON(b,function(b){200==b.state?(console.log(b),change_view(void 0!=b.request?b.request:state.request)):400==b.state&&$(a).find("i.fa").addClass("fa-trash").removeClass("fa-spinner fa-spin")})}}function publish(a,b){var c=$(a).find("i");if(!c.hasClass("fa-spin")){c.addClass("fa-spinner fa-spin");var d="/ar_edit_website.php?tipo="+b+"&parent_key="+$(a).attr("webpage_key");console.log(d),$.getJSON(d,function(a){if("publish_webpage"==b?(c.addClass("fa-rocket").removeClass("fa-spinner fa-spin"),$("#publish").removeClass("changed valid")):"set_webpage_as_ready"==b?c.addClass("fa-check-circle").removeClass("fa-spinner fa-spin"):"set_webpage_as_not_ready"==b?c.addClass("fa-child").removeClass("fa-spinner fa-spin"):"unpublish_webpage"==b&&(c.addClass("fa-rocket").removeClass("fa-spinner fa-spin"),$("#publish").addClass("changed valid")),console.log(a),a.other_fields)for(var d in a.other_fields)update_field(a.other_fields[d]);if(a.deleted_fields)for(var d in a.deleted_fields)delete_field(a.deleted_fields[d]);for(var d in a.update_metadata.class_html)console.log("."+d),console.log(a.update_metadata.class_html[d]),$("."+d).html(a.update_metadata.class_html[d]);for(var d in a.update_metadata.hide_by_id)$("#"+a.update_metadata.hide_by_id[d]).addClass("hide");for(var d in a.update_metadata.show_by_id)$("#"+a.update_metadata.show_by_id[d]).removeClass("hide");for(var d in a.update_metadata.visible_by_id)$("#"+a.update_metadata.visible_by_id[d]).removeClass("invisible");for(var d in a.update_metadata.invisible_by_id)$("#"+a.update_metadata.invisible_by_id[d]).addClass("invisible")})}}function erase_date_field(a){console.log(a),$("#"+a).val(""),$("#"+a+"_formatted").val(""),on_changed_value(a,$("#".field).val())}function toggle_field_value(a){var b=$(a).find("i");b.hasClass("fa-toggle-on")?b.removeClass("fa-toggle-on").addClass("fa-toggle-off").next("span").addClass("discreet"):b.hasClass("fa-toggle-off")&&b.removeClass("fa-toggle-off").addClass("fa-toggle-on").next("span").removeClass("discreet")}function check_field_value(a){var b=$(a).find("i");b.hasClass("fa-check-square")?b.removeClass("fa-check-square").addClass("fa-square").next("span").addClass("discreet"):b.hasClass("fa-square")&&b.removeClass("fa-square").addClass("fa-check-square").next("span").removeClass("discreet")}function save_permissions(){var a=$(".permissions .save");if(a.hasClass("valid")&&!a.hasClass("wait")){a.addClass("wait").find("i.save_icon").addClass("fa-spin fa-spinner");var b=[],c=[];$(".permissions  .permission_type i").each(function(a,c){($(c).hasClass("fa-check-square")||$(c).hasClass("fa-dot-circle"))&&b.push($(c).closest(".permission_type").data("group_id"))}),$(".permissions  .permission_store i").each(function(a,b){($(b).hasClass("fa-check-square")||$(b).hasClass("fa-dot-circle"))&&c.push($(b).closest(".permission_store").data("store_key"))}),value=JSON.stringify({user_groups:b,stores:c});var d=new FormData;d.append("tipo","edit_field"),d.append("object","user"),d.append("key",a.data("user_key")),d.append("value",value),d.append("field","Permissions"),$.ajax({url:"/ar_edit.php",type:"POST",data:d,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(b){console.log(b),a.removeClass("wait").find("i.save_icon").removeClass("fa-spin fa-spinner"),"200"==b.state?(a.removeClass("valid changed"),$(".permissions .updated_msg").removeClass("hide")):"400"==b.state&&swal(b.msg)},error:function(){}})}}function remove_recipient(a){var b=$(a).closest(".mixed_recipients_container");$(a).closest("tr").hasClass("new")?($(a).closest("tr").remove(),b.data("added",b.data("added")-1)):$(a).closest("tr").hasClass("very_discreet")?(b.data("removed",b.data("removed")-1),$(a).closest("tr").removeClass("very_discreet"),$(a).closest("tr").find(".recipient").removeClass("strikethrough")):($(a).closest("tr").addClass("very_discreet"),$(a).closest("tr").find(".recipient").addClass("strikethrough"),b.data("removed",b.data("removed")+1)),validate_mixed_recipients_list(b)}function delayed_on_change_user_recipient_dropdown_select_field(a,b){var c=$(a).val();window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_user_recipient_dropdown_select(a,c)},b))}function get_user_recipient_dropdown_select(a,b){var c=$(a).attr("parent_key"),d=$(a).attr("parent"),e=$(a).attr("scope"),f="/ar_find.php?tipo=find_objects&query="+fixedEncodeURIComponent(b)+"&scope="+e+"&parent="+d+"&parent_key="+c+"&state="+JSON.stringify(state);console.log(f),$.getJSON(f,function(b){var c=$(a).closest("td.mixed_recipients").find(".search_results_container");b.number_results>0?c.removeClass("hide").addClass("show"):c.addClass("hide").removeClass("show"),c.find(".result").remove();var d=!0;for(var e in b.results){var f=c.find(".search_result_template").clone();f.addClass("result").removeClass("hide search_result_template"),f.attr("value",b.results[e].value),f.attr("formatted_value",b.results[e].formatted_value),f.data("metadata",b.results[e].metadata),d&&(f.addClass("selected"),d=!1),f.children(".code").html(b.results[e].code),f.children(".label").html(b.results[e].description),c.find(".results").append(f)}})}function select_dropdown_user_recipient(a){var b=$(a).closest(".mixed_recipients_container");$(a).closest(".user_tr").removeClass("in_process"),$(a).closest("td.mixed_recipients").find(".User_Handle").html($(a).attr("formatted_value")).removeClass("hide"),$(a).closest("td.mixed_recipients").find(".User_Handle_value").remove(),$(a).closest("td.mixed_recipients").find(".user_key").val($(a).attr("value")),$(a).closest("td.mixed_recipients").find(".search_results_container").remove(),b.data("added",b.data("added")+1),validate_mixed_recipients_list(b)}function add_user_to_mixed_recipients(a){var b=$(a).closest(".mixed_recipients_container"),c=b.find(".new_user_recipient").clone();c.prop("id",""),c.removeClass("hide new_user_recipient"),b.find(".users_recipients_items").append(c),c.find(".User_Handle_value").focus()}function add_external_email_to_mixed_recipients(a){var b=$(a).closest(".mixed_recipients_container"),c=b.find(".new_external_email_recipient").clone();c.prop("id",""),c.removeClass("hide new_external_email_recipient").find("input").addClass("external_email_mixed_recipients_value"),b.find(".external_emails_recipients_items").append(c),c.find(".external_email_mixed_recipients_value").focus(),b.data("added",b.data("added")+1),validate_mixed_recipients_list(b)}function save_mixed_recipients(a){var b=$(a).closest(".mixed_recipients_container");save_field($("#fields").attr("object"),$("#fields").attr("key"),b.data("field"))}function validate_mixed_recipients_list(a){var b="valid";$(".external_email_mixed_recipients_value",a).each(function(a,c){return $(c).hasClass("invalid")?(b="invalid",!1):$(c).hasClass("potentially_valid")?(b="potentially_valid",!1):void 0}),console.log(b);var c=a.find(".save"),d=$("#"+a.data("field")+"_field");c.removeClass("invalid valid potentially_valid").addClass(b),d.removeClass("invalid valid potentially_valid").addClass(b),a.data("added")>0||a.data("removed")>0?(c.addClass("changed"),d.addClass("changed")):(c.removeClass("changed valid"),d.removeClass("changed valid"))}function delayed_search(a,b){var c=a.val();key_scope={type:"search"},c.length>0?$("#clear_search").removeClass("hide"):$("#clear_search").addClass("hide"),window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){search(c)},b))}function search(a){var b="/ar_search.php?tipo=search&query="+fixedEncodeURIComponent(a)+"&state="+JSON.stringify(state);$.getJSON(b,function(a){console.log(a),a.number_results>0?$("#results_container_shifted").removeClass("hide"):$("#results_container_shifted").addClass("hide"),$("#results .result").remove();var b=!0;for(var c in a.results){var d=$("#search_result_template").clone();d.prop("id","result_"+c),d.addClass("result").removeClass("hide"),d.attr("view",a.results[c].view),b&&(d.addClass("selected"),b=!1),void 0!=a.show_stores&&a.show_stores&&""!=a.results[c].store&&d.children(".store").html(a.results[c].store).removeClass("hide"),d.children(".label").html(a.results[c].label),d.children(".details").html(a.results[c].details),$("#results").append(d)}})}function clear_search(){$("#search").val(""),$("#clear_search").addClass("hide"),$("#results_container_shifted").removeClass("show"),$("#results .result").remove()}function show_filter(){$("#show_filter").addClass("hide"),$(".filter").removeClass("hide"),$("#filter input").focus()}function show_results_per_page(){var a=$("#results_per_page");a.hasClass("showing_options")?(a.removeClass("showing_options"),$(".results_per_page").addClass("hide")):(a.addClass("showing_options"),$(".results_per_page").removeClass("hide"))}function change_results_per_page(a){$(".results_per_page").removeClass("selected"),$("#results_per_page_"+a).addClass("selected"),rows.setPageSize(a),$("#results_per_page").attr("title",$("#results_per_page").attr("title").replace(/\(.*\)/g,"("+a+")"))}function change_period(a){var b=JSON.parse(rows.parameters);if("date"==a)b.from=$("#select_date").val(),b.to=$("#select_date").val();else if("interval"==a){var c=$("#select_interval_from").val().split(/\//);b.from=c[2]+"-"+c[0]+"-"+c[1],c=$("#select_interval_to").val().split(/\//),b.to=c[2]+"-"+c[0]+"-"+c[1]}$("#date_chooser div").removeClass("selected"),$("#"+a).addClass("selected"),$("#select_date_control_panel").addClass("hide"),$("#select_interval_control_panel").addClass("hide"),b.period=a,rows.parameters=JSON.stringify(b),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),with_elements&&get_elements_numbers(rows.tab,rows.parameters)}function get_elements_numbers(a,b){var c="/ar_elements.php?tab="+a+"&parameters="+b;$.getJSON(c,function(a){if(200==a.state){for(element in a.elements_numbers)for(item in a.elements_numbers[element])$("#element_qty_"+item).html("("+a.elements_numbers[element][item]+")");if(void 0!=a.class_html)for(var b in a.class_html)$("."+b).html(a.class_html[b])}})}function close_columns_period_options(){var a=$("#columns_period .fa");a.addClass("fa-bars"),a.removeClass("fa-chevron-up"),$("#columns_period_chooser").addClass("hide")}function close_columns_frequency_options(){var a=$("#columns_frequency .fa");a.addClass("fa-bars"),a.removeClass("fa-chevron-up"),$("#columns_frequency_chooser").addClass("hide")}function show_columns_period_options(){var a=$("#columns_period"),b=$("#columns_period .fa");if(b.hasClass("fa-bars")){b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=$("#columns_period .fa").position(),d=a.height();$("#columns_period_chooser").removeClass("hide").offset({top:$("#columns_period").position().top+d,left:c.left-$("#columns_period_chooser").width()+b.width()+20})}else close_columns_period_options()}function show_columns_frequency_options(){var a=$("#columns_frequency"),b=$("#columns_frequency .fa");if(b.hasClass("fa-bars")){b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=$("#columns_frequency .fa").position(),d=a.height();console.log($("#columns_frequency").position().top+d),console.log(c.left-$("#columns_frequency_chooser").width()+b.width()+20),$("#columns_frequency_chooser").removeClass("hide").offset({top:$("#columns_frequency").position().top+d,left:c.left-$("#columns_frequency_chooser").width()+b.width()+20})}else close_columns_frequency_options()}function show_f_options(a){if($("#filter_field").hasClass("button"))if($("#f_options_chooser").hasClass("hide")){var b=$("#filter_field").position(),c=$("#filter_field").height();$("#f_options_chooser").removeClass("hide").offset({top:b.top+c,left:b.left-27.2})}else $("#f_options_chooser").addClass("hide")}function change_f_option(a){$(a).hasClass("selected")||($("#f_options_chooser div").removeClass("selected"),$("#f_options_chooser div i").removeClass("fa-circle").addClass("fa-circle"),$(a).addClass("selected"),$(a).find("i").addClass("fa-circle"),$("#filter").attr("f_field",$(a).attr("f_field")).find("input").val(""),$("#filter_field .label").html($(a).find(".label").html()),
rows.fetch({reset:!0}),show_f_options())}function show_elements_types(){var a=$("#element_type"),b=$("#element_type .fa");if(b.hasClass("fa-bars")){$("#f_options_chooser").addClass("hide"),b.removeClass("fa-bars"),b.addClass("fa-chevron-up");var c=a.position(),d=a.height();$("#elements_chooser").removeClass("hide").offset({top:c.top+d,left:c.left})}else b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide")}function change_columns_frequency(a,b){$("#columns_frequency span.label").html(b);var c=JSON.parse(rows.parameters);c.frequency=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),close_columns_frequency_options(),$("#columns_frequency_chooser div").removeClass("selected"),$("#columns_frequency_chooser .fa").removeClass("fa-circle").addClass("fa-circle"),$("#element_group_option_"+a).addClass("selected"),$("#element_group_option_"+a+" .fa").removeClass("fa-circle").addClass("fa-circle")}function change_columns_period(a,b){$("#columns_period span.label").html(b);var c=JSON.parse(rows.parameters);c.f_period=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),close_columns_period_options(),$("#columns_period_chooser div").removeClass("selected"),$("#columns_period_chooser .fa").removeClass("fa-circle").addClass("fa-circle"),$("#element_group_option_"+a).addClass("selected"),$("#element_group_option_"+a+" .fa").removeClass("fa-circle").addClass("fa-circle")}function change_elements_type(a){$("#elements .elements_group").addClass("hide"),$("#elements_group_"+a).removeClass("hide"),$("#elements_chooser  div").removeClass("selected"),$("#element_group_option_"+a).addClass("selected"),$("#elements_chooser  i").removeClass("fa").addClass("far"),$("#element_group_option_"+a+" i").addClass("fa"),$("#element_group_option_"+a+" i").removeClass("far");var b=$("#element_type .fa");b.addClass("fa-bars"),b.removeClass("fa-chevron-up"),$("#elements_chooser").addClass("hide");var c=JSON.parse(rows.parameters);c.elements_type=a,rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0})}function change_table_element(a,b){"double_click"==a?($("#elements i.element_checkbox").removeClass("fa-check-square").addClass("fa-square"),$("#elements .element").removeClass("selected"),$("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square"),$("#element_checkbox_"+b).addClass("fa-check-square")):$("#element_"+b).hasClass("selected")?($("#element_"+b).removeClass("selected"),$("#element_checkbox_"+b).removeClass("fa-check-square"),$("#element_checkbox_"+b).addClass("fa-square")):($("#element_"+b).addClass("selected"),$("#element_checkbox_"+b).removeClass("fa-square"),$("#element_checkbox_"+b).addClass("fa-check-square"));var c=JSON.parse(rows.parameters);$("#elements_group_"+c.elements_type+" .element").each(function(a){c.elements[c.elements_type].items[$(this).attr("item_key")].selected=$(this).hasClass("selected")}),rows.parameters=JSON.stringify(c),rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),post_table_rendered()}function show_export_dialog_left_button(a){var b=$(a).closest("div").next(".export_dialog_container").find(".export_dialog");b.hasClass("hide")?(b.removeClass("hide"),b.css("top",$(a).closest(".square_button").height())):hide_export_dialog(b)}function show_download_edit_items_dialog(a){var b=$(a).closest("div.edit_table_dialog").next(".export_dialog_container").find(".export_dialog"),c=$(a).closest("div.edit_table_dialog").next(".export_dialog_container").find(".export_dialog_config");b.hasClass("hide")?(b.removeClass("hide"),c.removeClass("hide"),b.css("top",$(a).closest(".square_button").height()),b.offset({top:$("#edit_table_dialog").offset().top,left:$("#edit_table_dialog").offset().left+$("#edit_table_dialog").width()-b.width()}),c.offset({top:$("#edit_table_dialog").offset().top,left:b.offset().left-c.width()-30})):hide_export_dialog(b)}function hide_export_dialog(a){$(a).addClass("hide"),hide_export_config_dialog($(a).closest(".export_dialog_container").find(".export_dialog_config")),$(a).find(".export_download").addClass("hide").attr("title","").on("click",function(){}),$(a).find(".export_progress_bar_bg").addClass("hide").html(""),$(a).find(".export_progress_bar").css("width","0px").removeClass("hide").attr("title","").html("")}function show_edit_table_dialog(){if($("#edit_table_dialog").hasClass("hide")){$("#edit_table_dialog").removeClass("hide");var a=$("#show_edit_table_dialog_button").closest("div");$("#edit_table_dialog").offset({top:a.offset().top+a.height(),left:$("#show_edit_table_dialog_button").offset().left-$("#edit_table_dialog").width()+20})}else $("#edit_table_dialog").addClass("hide")}function table_edit_view(){$("#table .table_item_editable").attr("contenteditable",!0).addClass("editing"),$("#inline_edit_table_items_buttons").removeClass("hide"),$("#show_edit_table_dialog_button").addClass("hide"),$(".table_item_editable.editing").each(function(a,b){$(b).attr("ovalue",$(b).html())}),show_edit_table_dialog()}function open_export_config(){$("#export_dialog_config").hasClass("hide")?($("#export_dialog_config").removeClass("hide"),$("#export_dialog_config").css("left",-1*($("#export_dialog_config").width()+40+$("#export_dialog").width())),$("#export_dialog_config").css("top",$("#show_export_dialog").height())):hide_export_config_dialog()}function open_export_config_left_button(a){var b=$(a).closest(".export_dialog_container").find(".export_dialog");$(a).hasClass("hide")?($(a).removeClass("hide"),$(a).css("left",b.offset().left+b.width()),$(a).css("top",b.position().top)):hide_export_config_dialog(a)}function hide_export_config_dialog(a){$(a).addClass("hide")}function toggle_all_export_fields(a){var b=$(a).closest("table");$(a).hasClass("fa-check-square")?($(a).removeClass("fa-check-square"),$(a).addClass("fa-square"),b.find(".export_fields i").removeClass("fa-check-square"),b.find(".export_fields i").addClass("fa-square")):($(a).addClass("fa-check-square"),$(a).removeClass("fa-square"),b.find(".export_fields i").addClass("fa-check-square"),b.find(".export_fields i").removeClass("fa-square"))}function toggle_export_field(a){field_element=$(a),field_element.hasClass("fa-check-square")?(field_element.removeClass("fa-check-square"),field_element.addClass("fa-square")):(console.log("unckeced"),field_element.addClass("fa-check-square"),field_element.removeClass("fa-square"))}function export_table(a){var b=$(a).data("type"),c=$(a).closest(".export_dialog_container");$(a).removeClass("link").addClass("disabled"),c.find(".field_export").removeClass("button").addClass("disabled"),c.find(".stop_export").removeClass("hide").data("stop",0);var d=[];c.find(".field_export i").each(function(a,b){$(b).hasClass("fa-check-square")&&d.push($(b).attr("key"))});var e="/ar_export.php?ar_file="+rows.ar_file+"&tipo="+rows.tipo+"&parameters="+rows.parameters+"&type="+b+"&state="+JSON.stringify(state)+"&fields="+JSON.stringify(d);$.getJSON(e,function(a){200==a.state&&(c.find(".export_progress_bar_bg").removeClass("hide").html("&nbsp;"+a.txt),c.closest(".export_dialog_container").attr("id","download_"+a.download_key))})}function get_editable_data(a){var b=$(a).data("type");_data=$(a).data("data");var c=$(a).closest(".export_dialog_container");$(a).removeClass("link").addClass("disabled"),c.find(".field_export").removeClass("button").addClass("disabled"),c.find(".stop_export").removeClass("hide").data("stop",0);var d=[];c.find(".export_fields .field_export i").each(function(a,b){$(b).hasClass("fa-check-square")&&d.push($(b).attr("key"))});var e=$("#edit_table_dialog").data("metadata"),f="/ar_export_edit_template.php?parent="+_data.parent+"&parent_key="+_data.parent_key+"&parent_code="+_data.parent_code+"&objects="+_data.object+"&fields="+JSON.stringify(d)+"&type="+b+"&metadata="+JSON.stringify(e);$.getJSON(f,function(a){200==a.state&&(c.find(".export_progress_bar_bg").removeClass("hide").html("&nbsp;"+a.txt),c.closest(".export_dialog_container").attr("id","download_"+a.download_key))})}function change_export_as(a,b){$(a).closest(".export_type_options").find("span").addClass("very_discreet"),$(a).removeClass("very_discreet");var c=$(a).closest(".export_dialog_container").find(".export_button");c.data("type",b),console.log(b),"Excel"==b?(c.find("i").addClass("fa-file-excel").removeClass("fa-table"),c.find("span.excel").removeClass("hide"),c.find("span.csv").addClass("hide")):(c.find("i").removeClass("fa-file-excel").addClass("fa-table"),c.find("span.excel").addClass("hide"),c.find("span.csv").removeClass("hide"))}function stop_export(a){$("#stop_export_table_"+a+"_export").attr("stop",1)}function get_export_process_bar(a,b,c,d){request="/ar_fork.php?tipo=get_process_bar&fork_key="+a+"&tag="+b,$.getJSON(request,function(a){200==a.state&&("In Progress"==a.state?setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c,d)},100):"In Process"==a.fork_state?($("#export_download_"+c+d).addClass("hide"),$("#export_progress_bar_bg_"+c+d).removeClass("hide").html("&nbsp;"+a.progress_info),$("#export_progress_bar_"+c+d).css("width",a.percentage).removeClass("hide").attr("title",a.progress).html("&nbsp;"+a.forks_info),setTimeout(function(){get_export_process_bar(a.fork_key,a.tag,c,d)},250)):"Finished"==a.fork_state&&($("#download_"+c+d).attr("href","/download.php?file="+a.result),$("#export_download_"+c+d).removeClass("hide").attr("title",a.result_info).on("click",function(){download_exported_file(c,d)}),$("#export_progress_bar_bg_"+c+d).addClass("hide").html(""),$("#export_progress_bar_"+c+d).css("width","0px").removeClass("hide").attr("title","").html(""),$("#export_table_excel").addClass("link").removeClass("disabled"),$("#export_table_csv").addClass("link").removeClass("disabled"),$(".field_export").addClass("button").removeClass("disabled"),$("#stop_export_table_"+c+d).addClass("hide")))})}function download_exported_file(a){var b=$(a).closest(".export_dialog_container");b.find(".download_export")[0].click()}function edit_category_subject(a){if(!$(a).hasClass("wait")){$(a).hasClass("fa-unlink")?($(a).removeClass("fa-unlink very_discreet").addClass("fa-link wait"),operation="link"):($(a).addClass("fa-unlink very_discreet wait").removeClass("fa-link"),operation="unlink");var b="/ar_edit.php?tipo=edit_category_subject&category_key="+state.key+"&subject_key="+$(a).attr("key")+"&operation="+operation;$.getJSON(b,function(b){$(a).removeClass("wait"),200==b.state||400==b.state&&("link"==operation?$(a).addClass("fa-unlink very_discreet wait").removeClass("fa-link"):$(a).removeClass("fa-unlink very_discreet").addClass("fa-link wait"))})}}function post_table_rendered(a){switch(console.log("hello"),console.log(state.tab),state.tab){case"order.input_picking_sheet":validate_data_entry_picking_aid();break;case"location.parts":$(".table_edit_cell").awesomeCursor("pencil",{color:"rgba(0, 0, 0, 0.5)",hotspot:"bottom left"});break;case"intrastat":get_intrastat_totals();break;case"intrastat_orders":get_intrastat_orders_totals();break;case"intrastat_products":get_intrastat_products_totals();break;case"intrastat_imports":get_intrastat_imports_totals();break;case"intrastat_deliveries":get_intrastat_deliveries_totals();break;case"intrastat_parts":get_intrastat_parts_totals();break;case"ec_sales_list":get_ec_sales_list_totals();break;case"store.payment_accounts":console.log(a);break;case"refund.new.items":$(".new_refund_item").each(function(a,b){if(""!=$(b).val()){var c;""!=$(b).val()&&validate_number($(b).val(),0,$(b).attr("max"))?($(b).addClass("error"),c=!0):($(this).removeClass("error"),c=!1);var d=$(b).closest("tr").find(".set_otf_feedback_button").removeClass("hide");$(b).val()>0&&!c?d.removeClass("hide"):d.addClass("hide"),update_new_refund_totals()}})}}function export_omega_invoices(){window.open("/invoices.omega.txt.php","_blank")}function validate_field(a,b,c,d,e,f,g,h,i){var j=client_validation(c,d,b,a);if("valid"==j["class"]&&void 0!=e&&""!=e){var k=JSON.parse(e);if("check_for_duplicates"==k.tipo&&""==b)return post_validate_field(j,a),j;var j={"class":"waiting",type:""};server_validation(k,f,g,h,i,a,b)}return post_validate_field(j,a),j}function post_validate_field(a,b){}function validate_address(a){var b={"class":"valid",type:""},c=0;return $("#"+a+" input.address_input_field").each(function(a,d){var e=$(d).closest("tr"),f=e.find(".fa-asterisk");f.hasClass("hide")||(""==$(d).val()?(c++,e.find(".show_buttons").removeClass("super_discreet success").addClass("error"),"Address Recipient"==$(d).attr("field_name")?valid_state_type="missing_recipient":"Address Line 1"==$(d).attr("field_name")?valid_state_type="missing_addressLine1":"Address Postal Code"==$(d).attr("field_name")?valid_state_type="missing_postalCode":valid_state_type="missing_field",b={"class":"invalid",type:valid_state_type}):e.find(".show_buttons").addClass(" success").removeClass("super_discreet error"))}),c>1&&(b={"class":"invalid",type:"missing_fields"}),b}function client_validation(a,b,c,d){var e={"class":"valid",type:""};if(""==c)return b?"dropdown_select"==a?""==$("#"+d+"_dropdown_select_label").val()?{"class":"invalid",type:"empty"}:{"class":"invalid",type:"not_found"}:{"class":"invalid",type:"empty"}:{"class":"valid",type:""};switch(a){case"dropdown_select":if("__error__"==c&&""==$("#"+d).val())return{"class":"invalid",type:"not_found"};if(""==$("#"+d).val())return{"class":"potentially_valid",type:"not_selected"};break;case"string":break;case"handle":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"pin":if(c.length<4)return{"class":"potentially_valid",type:"short"};break;case"password":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"password_with_confirmation":if(c.length<6)return{"class":"potentially_valid",type:"short"};break;case"date":case"date_interval":break;case"barcode":var f=validate_ean_barcode(c);if(f)return f;break;case"barcode_range":if(c.match(/\-/g)){if(barcodes=c.split("-"),barcodes.length>2)return{"class":"invalid",type:"invalid"};var f=validate_barcode(barcodes[0],12,12);if(f)return{"class":"invalid",type:f.type};if(""==barcodes[1])return{"class":"potentially_valid",type:"short"};if(f=validate_barcode(barcodes[1],12,12))return f;if(barcodes[1]<barcodes[0])return{"class":"invalid",type:"range_minmax"}}else{var f=validate_barcode(c,12,13);if(f)return f}break;case"telephone":if(c=c.replace(/(\s|\-|\(|\))/g,""),c.length<4)return c=c.replace(/^\+/g,""),""==c||$.isNumeric(c)?{"class":"potentially_valid",type:"short"}:{"class":"invalid",type:"invalid"};if(!$("#"+d).intlTelInput("isValidNumber")){var g=$("#"+d).intlTelInput("getValidationError");if(g==intlTelInputUtils.validationError.TOO_SHORT)return{"class":"potentially_valid",type:"short"};if(g==intlTelInputUtils.validationError.TOO_LONG)return{"class":"invalid",type:"long"};if(g==intlTelInputUtils.validationError.NOT_A_NUMBER)return{"class":"invalid",type:"invalid"};if(g==intlTelInputUtils.validationError.INVALID_COUNTRY_CODE)return{"class":"invalid",type:"invalid_code"}}break;case"email":case"new_email":var h=c.replace(/"[^"]*"/g,"");if(h.match(/"/g));else{if(h.match(/\s/g))return{"class":"invalid",type:"spaces"};if(h.match(/\(|\)|\,|:|;|<|>|\[|\]/g))return h.match(/,/g)?{"class":"invalid",type:"comma"}:{"class":"invalid",type:"invalid_character"};if(h.match(/^([^@]*@){2,}[^@]*$/g))return{"class":"invalid",type:"double_at"}}var i=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,63})?$/;if(!i.test(c))return{"class":"potentially_valid",type:"invalid"};break;case"time":var j=/^[0-9\:]+$/;if(!j.test(c))return{"class":"invalid",type:"invalid"};if(c.length>5)return{"class":"invalid",type:"invalid"};if(1==c.length){var k=/^[0-9]$/;if(!k.test(c))return{"class":"invalid",type:"invalid"}}else if(2==c.length){var k=/^(1?[0-9]|2[0-3])|[0-9]:$/;if(!k.test(c))return{"class":"invalid",type:"invalid"}}else if(4==c.length){var j=/^(1?[0-9]|2[0-3]|0[0-9])[0-5][0-9]$/;if(j.test(c))return{"class":"valid",type:"valid"};var j=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5]$/;if(j.test(c))return{"class":"potentially_valid",type:"invalid"}}var j=/^(1?[0-9]|2[0-3]|0[0-9]):[0-5][0-9]$/;return j.test(c)?{"class":"valid",type:""}:5==c.length||4==c.length?{"class":"invalid",type:"invalid"}:{"class":"potentially_valid",type:"invalid"};case"positive_integer_more_than_zero":var f=validate_integer(c,1,65535);if(f)return f;break;case"smallint_unsigned":var f=validate_signed_integer(c,65535);if(f)return f;break;case"int_unsigned":var f=validate_signed_integer(c,4294967295);if(f)return f;break;case"minutes_in_day":var f=validate_signed_integer(c,1440);if(f)return f;break;case"numeric_unsigned":var f=validate_number(c,0,4294967295);if(f)return f;break;case"minutes_in_break":if(0==c)return{"class":"invalid",type:"invalid_break_duration"};var f=validate_signed_integer(c,1440);if(f)return f;break;case"seconds_in_day":var f=validate_signed_integer(c,86400);if(f)return f;break;case"seconds_in_hour":var f=validate_signed_integer(c,3600);if(f)return f;break;case"day_of_month":if(0==c)return{"class":"invalid",type:"invalid_day_of_month"};var f=validate_signed_integer(c,31);if(f)return f;break;case"amount":var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}$/;if(!o.test(c))return{"class":"invalid",type:"invalid_amount"};break;case"percentage":var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}\%$/;if(o.test(c))return{"class":"valid",type:"valid"};var o=/^\d*\.?\d{0,6}$/;return o.test(c)?{"class":"potentially_valid",type:"invalid"}:{"class":"invalid",type:"invalid_amount"};case"amount_margin":c=c.replace(/\%$/g,"");var l=",",m=".",n=new RegExp(l,"g");if(c=c.replace(n,""),c==m)return{"class":"potentially_valid",type:"invalid"};var o=/^\d*\.?\d{0,6}$/;if(!o.test(c))return{"class":"invalid",type:"invalid_amount"}}return e}function checkEan(a){var b="0123456789";for(i=0;i<a.length;i++)if(digit=a.charAt(i),b.indexOf(digit)==-1)return!1;if(8==a.length)a="00000"+a;else if(13!=a.length)return!1;return originalCheck=a.substring(a.length-1),a=a.substring(0,a.length-1),even=Number(a.charAt(1))+Number(a.charAt(3))+Number(a.charAt(5))+Number(a.charAt(7))+Number(a.charAt(9))+Number(a.charAt(11)),even*=3,odd=Number(a.charAt(0))+Number(a.charAt(2))+Number(a.charAt(4))+Number(a.charAt(6))+Number(a.charAt(8))+Number(a.charAt(10)),total=even+odd,checksum=total%10,0!=checksum&&(checksum=10-checksum),checksum==originalCheck}function validate_ean_barcode(a){return""!=a&&($.isNumeric(a)?a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a?{"class":"invalid",type:"invalid"}:12==a.length?{"class":"invalid",type:"missing_checksum"}:a.length<=12?{"class":"invalid",type:"short"}:a.length>=14?{"class":"invalid",type:"long"}:!checkEan(a)&&{"class":"invalid",type:"checksum"}:{"class":"invalid",type:"invalid"})}function validate_barcode(a,b,c){return""!=a&&($.isNumeric(a)?a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a?{"class":"invalid",type:"invalid"}:a.length<b?{"class":"potentially_valid",type:"short"}:a.length>c&&{"class":"invalid",type:"long"}:{"class":"invalid",type:"invalid"})}function validate_number(a,b,c){if(!$.isNumeric(a))return{"class":"invalid",type:"no_numeric"};var a=parseFloat(a),b=parseFloat(b),c=parseFloat(c);return void 0!=b&&a<b?{"class":"invalid",type:"negative"}:void 0!=c&&a>c&&{"class":"invalid",type:"max_limit"}}function validate_signed_integer(a,b){return $.isNumeric(a)?a>b?{"class":"invalid",type:"too_big"}:a<0?{"class":"invalid",type:"negative"}:Math.floor(a)!=a&&{"class":"invalid",type:"not_integer"}:{"class":"invalid",type:"not_integer"}}function validate_integer(a,b,c){return $.isNumeric(a)?void 0!=c&&a>c?{"class":"invalid",type:"too_big"}:a<b?{"class":"invalid",type:"too_small"}:Math.floor(a)!=a&&{"class":"invalid",type:"not_integer"}:{"class":"invalid",type:"not_integer"}}function server_validation(a,b,c,d,e,f,g){if(null!=a.parent&&(b=a.parent),null!=a.parent_key&&(c=a.parent_key),null!=a.object&&(d=a.object),null!=a.key&&(e=a.key),null!=a.parent_key_field&&(c=$("#"+a.parent_key_field).val()),$("#"+f+"_editor").addClass("waiting"),null!=a.setup)var h="/ar_setup.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;else{var h="/ar_validation.php?tipo="+a.tipo+"&parent="+b+"&parent_key="+c+"&object="+d+"&key="+e+"&field="+f+"&value="+g;null!=a.actual_field&&(h+="&actual_field="+a.actual_field),null!=a.metadata&&(h+="&metadata="+JSON.stringify(a.metadata))}$.getJSON(h,function(a){if($("#"+f+"_field").removeClass("waiting invalid valid"),$("#"+f+"_save_button").removeClass("fa-spinner fa-spin").addClass("fa-cloud"),$("#"+f+"_formatted_value").hasClass("hide")){if(200==a.state)var b=a.validation,c=a.msg;else var b="invalid",c="Error, can't verify value on server";if(post_validate_field(b,f),$("#"+f+"_msg").html(c),$("#"+f+"_field").addClass(b),$("#fields").hasClass("new_object")){var d=get_form_validation_state();process_form_validation(d)}}})}function show_pdf_invoice_dialog(a,b){var c=$(a).prev(".pdf_link"),d=$(a).closest(".node");$(".pdf_invoice_dialog").removeClass("hide").offset({top:$(d).offset().top-1,left:$(c).offset().left}).data("invoice_key",b)}function download_pdf_from_list(a,b){$(b).closest(".options_dialog").data("invoice_key",a),download_pdf(b)}function download_pdf(a){var b=$(a).closest(".options_dialog"),c=b.data("data"),d="";switch($(".pdf_option",b).each(function(a,b){switch(console.log($(b).data("field")),$(b).data("field")){case"locale":var c=$(b).find("i");c.hasClass("fa-check-square")&&(d+="&locale="+c.data("value"));break;default:var c=$(b).find("i");c.hasClass("fa-check-square")&&(d+="&"+$(b).data("field")+"=1")}}),c.type){case"proforma":window.open("/pdf/proforma.pdf.php?id="+c.order_key+d,"_blank");break;case"invoice":window.open("/pdf/invoice.pdf.php?id="+c.invoice_key+d,"_blank");break;case"invoice_from_list":window.open("/pdf/invoice.pdf.php?id="+b.data("invoice_key")+d,"_blank")}}function edit_next_webpage_blocks_column(a){var b=parseFloat($("#exit_edit_column").attr("key"))+1;exit_edit_webpage_block_column();var c=$("#edit_mode_"+b);console.log(b),edit_webpage_block_column(c.length?b:0)}function edit_prev_webpage_blocks_column(a){var b=parseFloat($("#exit_edit_column").attr("key"))-1;exit_edit_webpage_block_column(),edit_webpage_block_column(b>=0?b:$("#edit_columns .edit_mode:last").attr("key"))}function edit_webpage_block_column(a){$("#preview").removeClass("hide"),$(".edit_block").addClass("hide"),$("#columns").addClass("hide"),$("#edit_columns").removeClass("hide").attr("current_key",a),$(".edit_mode").addClass("hide"),$("#edit_mode_"+a).removeClass("hide"),$("#exit_edit_column").attr("key",a),$(".options_dialog").addClass("hide")}function exit_edit_webpage_block_column(){$("#columns").removeClass("hide"),$("#edit_columns").addClass("hide").attr("current_key",""),$(".options_dialog").addClass("hide"),$("#save_button").removeClass("hide")}function change_text_template(a){$("#text_layout_ideas").removeClass("hide").data("block_key",$(a).closest(".edit_mode").attr("key"))}function change_images_template(a){$("#images_layout_ideas").removeClass("hide").data("block_key",$(a).closest(".edit_mode").attr("key"))}function open_blackboard_text_edit_view(a,b){console.log(a),edit_webpage_block_column(a),$("#edit_mode_main_"+a).addClass("hide"),$("#edit_mode_text_block_"+a).removeClass("hide").data("blackboard_text_id",b)}function close_blackboard_text_edit_view(a){$("#edit_mode_main_"+a).removeClass("hide"),$("#edit_mode_text_block_"+a).addClass("hide"),$("#preview")[0].contentWindow.exit_blackboard_text_edit($("#edit_mode_text_block_"+a).data("blackboard_text_id"))}function delete_blackboard_text_edit_view(a){$("#edit_mode_main_"+a).removeClass("hide"),$("#edit_mode_text_block_"+a).addClass("hide"),$("#preview")[0].contentWindow.delete_blackboard_text_edit($("#edit_mode_text_block_"+a).data("blackboard_text_id"))}function show_webpage_editor(){$(".webpage_showcase").addClass("hide"),$(".hide_webpage_editor").removeClass("hide"),$(".show_webpage_editor").addClass("hide"),change_tab("webpage.preview",{reload:!0}),$("#tabs").addClass("hide")}function hide_webpage_editor(){$(".webpage_showcase").removeClass("hide"),$(".hide_webpage_editor").addClass("hide"),$(".show_webpage_editor").removeClass("hide"),change_tab("webpage.assets",{reload:!0}),$("#tabs").removeClass("hide")}function new_object_init(){$(".value").each(function(a){var b=$(this).attr("field"),c=$("#"+b).val(),d=$("#"+b+"_container");0==d.length&&("Register_Date_From"==b?d=$("#Register_Date_container"):"Register_Date_To"==b&&(d=$("#Register_Date_container")));var e=d.attr("field_type");if(d.hasClass("address_value"))var f=d.closest("tbody.address_fields").attr("_required");else var f=d.attr("_required");var g=d.attr("server_validation"),h=d.attr("parent"),i=d.attr("parent_key"),j=d.attr("object"),k=d.attr("key"),l=validate_field(b,c,e,f,g,h,i,j,k);"invalid"==l["class"]&&""==c&&(l["class"]="potentially_valid"),"date_interval"!=e&&$("#"+b+"_field").removeClass("invalid potentially_valid valid").addClass(l["class"])});var a=get_form_validation_state();process_form_validation(a)}function toggle_options(a){$("#"+a+"_options").hasClass("hide")?$("#"+a+"_options").removeClass("hide"):$("#"+a+"_options").addClass("hide")}function show_options(a){$("#"+a+"_options").removeClass("hide")}function hide_options(a){$("#"+a+"_options").addClass("hide")}function get_form_validation_state(){return"Mailshot"==$("#fields").attr("object")?get_mailshot_form_validation_state():(form_validation="valid",$(".value").each(function(a){var b=$(this).attr("field");console.log(b),console.log($("#"+b+"_field").hasClass("valid")),"date_interval"==$(this).attr("field_type")?component_validation="valid":$("#"+b+"_field").hasClass("invalid")?component_validation="invalid":$("#"+b+"_field").hasClass("valid")?component_validation="valid":(component_validation="potentially_valid",console.log($(this).attr("field_type")),console.log(b)),"invalid"==component_validation&&(form_validation="invalid"),"invalid"!=form_validation&&"potentially_valid"==component_validation&&(form_validation="potentially_valid")}),console.log("val: "+form_validation),form_validation)}function process_form_validation(a,b){b&&"potentially_valid"==a&&(a="invalid"),$("#fields .controls").removeClass("invalid valid potentially_valid").addClass(a).addClass("changed"),"invalid"==a&&$(".value").each(function(a){var b=$(this).attr("field");!$("#"+b+"_field").hasClass("valid")&&$("#"+b+"_field").length>0&&($("#"+b+"_field").addClass("invalid"),console.log(b))}),reset_controls(),post_process_form_validation()}function post_process_form_validation(){"Customers_List"==$("#fields").attr("Object")&&post_process_new_customer_list_form_validation()}function check_if_form_is_valid(){var a=$("#fields").attr("object"),b=!0;$(".value").each(function(a){var c=$(this).attr("field");$("#"+c+"_validation").hasClass("valid")||(b=!1)}),b?$("#"+a+"_save").addClass("valid").removeClass("invalid"):$("#"+a+"_save").removeClass("valid").addClass("invalid")}function save_new_object(a,b){var c=get_form_validation_state();if(process_form_validation(c,!0),$("tr.controls").hasClass("valid")&&!$("tr.controls").hasClass("waiting")){$("tr.controls").addClass("waiting");const d=a.replace(" ","_");$("#"+d+"_save_icon").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var e={},f=new RegExp("_","g"),g=new FormData;if($(".value").each(function(a){var b=$(this).attr("field"),c=$(this).attr("field_type");if(console.log(c+" "+b),"time"==c)k=clean_time($("#"+b).val());else if("date"==c||"date_interval"==c)k=""!=$("#"+b+"_value").val()?$("#"+b+"_value").val()+" "+$("#"+b+"_time").val():"";else if("password"==c||"password_with_confirmation"==c||"password_with_confirmation_paranoid"==c||"pin"==c||"pin_with_confirmation"==c||"pin_with_confirmation_paranoid"==c)k=sha256_digest($("#"+b).val());else if("attachment"==c)g.append("file",$("#"+b).prop("files")[0]),k="";else if("country_select"==c)k=$("#"+b).countrySelect("getSelectedCountryData").code;else if("telephone"==c)k=$("#"+b).intlTelInput("getNumber");else if("parts_list"==c){var d=[];$("#parts_list_items  tr.part_tr").each(function(a,b){if($(b).hasClass("very_discreet"))var c=0;else var c=$(b).find(".parts_per_product").val();var e={Key:$(b).find(".product_part_key").val(),"Part SKU":$(b).find(".sku").val(),Ratio:c,Note:$(b).find(".note").val()};d.push(e)}),k=JSON.stringify(d)}else if("user_permissions"==c){var h=[],i=[];$(".permissions  .permission_type i").each(function(a,b){($(b).hasClass("fa-check-square")||$(b).hasClass("fa-dot-circle"))&&h.push($(b).closest(".permission_type").data("group_id"))}),$(".permissions  .permission_store i").each(function(a,b){($(b).hasClass("fa-check-square")||$(b).hasClass("fa-dot-circle"))&&i.push($(b).closest(".permission_store").data("store_key"))}),k=JSON.stringify({user_groups:h,stores:i})}else if("subscription"==c){var j=$(this).find("i");k=j.hasClass("fa-toggle-on")?"Yes":"No"}else if("elements"==c){var j=$(this).find("i");k=j.hasClass("fa-check-square")?"Yes":"No"}else if("with_field"==c){var j=$(this).find("i");k=j.hasClass("fa-toggle-on")?"Yes":j.hasClass("fa-toggle-off")?"No":""}else if("toggle"==c)var k=$("#"+b+"_field").find("."+b+"_toggle").hasClass("fa-toggle-on");else if("button_radio_options"==c)var k=$("#"+b+"_field").hasClass("selected");else if("input_with_field"==c)var k=$("#"+b+"_field").val();else if("asset"==c)var k=$("#Asset_Key").val();else if("list"==c)var k=$("#List_Key").val();else var k=$("#"+b).val();e[b.replace(f," ")]=k}),console.log(e),"setup"==b)return void save_setup(a,e);if("Attachment"==a)var h="ar_upload.php",i="upload_attachment";else var h="ar_edit.php",i="new_object";var j="/"+h+"?tipo="+(""!=b?b:i)+"&object="+a+"&parent="+$("#fields").attr("parent")+"&parent_key="+$("#fields").attr("parent_key")+"&fields_data="+JSON.stringify(e);console.log(j),g.append("tipo",""!=b?b:i),g.append("object",a),g.append("parent",$("#fields").attr("parent")),g.append("parent_key",$("#fields").attr("parent_key")),g.append("fields_data",JSON.stringify(e));var j=$.ajax({url:"/"+h,data:g,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(b){if($("tr.controls").removeClass("waiting").removeClass("valid"),200==b.state){if(""==b.pcard&&""!=b.redirect)return console.log(b.redirect),void change_view(b.redirect,b.redirect_metadata);$("#result").html(b.pcard).removeClass("hide"),$("#fields").addClass("hide");for(var c in b.updated_data)$("."+c).html(b.updated_data[c]);post_new_actions(a,b),$("#"+d+"_save_icon").addClass("fa-cloud"),$("#"+d+"_save_icon").removeClass("fa-spinner fa-spin")}else 400==b.state&&($("#"+d+"_save_icon").addClass("fa-cloud"),$("#"+d+"_save_icon").removeClass("fa-spinner fa-spin"),$("tr.controls").addClass("error"),$("#"+d+"_msg").html(b.msg).removeClass("hide"),$("#save_msg").html(b.msg).removeClass("hide"))}),j.fail(function(a,b){$("#"+d+"_save_icon").addClass("fa-cloud"),$("#"+d+"_save_icon").removeClass("fa-spinner fa-spin"),$("#"+d+"_save_icon").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("tr.controls").removeClass("waiting valid").addClass("error"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function post_new_actions(a,b){switch(a){case"Timesheet_Record":rows.fetch({reset:!0})}}function save_inline_new_object(a){var b=$("#inline_new_object").attr("object"),c=$("#inline_new_object").attr("parent"),d=$("#inline_new_object").attr("parent_key"),e=$("#inline_new_object").attr("field"),f=$("#"+e+"_container").attr("field_type");if($("#inline_new_object").hasClass("valid")){
$("#inline_new_object").removeClass("valid "),$("#"+b+"_save").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var g={},h=new RegExp("_","g");if("time"==f)i=clean_time($("#"+e).val()),i=$("#"+e+"_date").val()+" "+i;else var i=$("#"+e).val();g[e.replace(h," ")]=i;var j="/ar_edit.php?tipo=new_object&object="+b+"&parent="+c+"&parent_key="+d+"&fields_data="+JSON.stringify(g),k=new FormData;k.append("tipo","new_object"),k.append("object",b),k.append("parent",c),k.append("parent_key",d),k.append("fields_data",JSON.stringify(g));var j=$.ajax({url:"/ar_edit.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(c){if($("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200==c.state){$("#"+e).val("").attr("has_been_valid",0),$("#inline_new_object").addClass("potentially_valid"),toggle_inline_new_object_form(a),$("#inline_new_object_msg").html(c.msg).addClass("success").removeClass("hide");for(var d in c.updated_data)$("."+d).html(c.updated_data[d]);if(rows.url="/"+rows.ar_file+"?tipo="+rows.tipo+"&parameters="+rows.parameters,rows.fetch({reset:!0}),with_elements&&get_elements_numbers(rows.tab,rows.parameters),void 0!=c.metadata&&""!=c.metadata.updated_showcase_fields)for(var f in c.metadata.updated_showcase_fields)$("."+f).html(c.metadata.updated_showcase_fields[f])}else 400==c.state&&($("#inline_new_object_msg").removeClass("invalid valid potentially_valid"),$("#inline_new_object_msg").html(c.msg).addClass("invalid"),$("#inline_new_object").addClass("invalid"))}),j.fail(function(a,c){$("#"+b+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}}function toggle_inline_new_object_form(a){var b=$("#inline_new_object").attr("field");$("#"+b+"_container").attr("field_type");if($("#inline_new_object_msg").html("").removeClass("error success"),$("#icon_"+a).hasClass("fa-plus")||$("#icon_"+a).hasClass("fa-link")){if($("#icon_"+a).hasClass("fa-link"))var c="fa-link";else var c="fa-plus";$("#inline_form").removeClass("hide"),$("#inline_new_object").removeClass("hide"),$("#icon_"+a).removeClass("fa-plus").removeClass("fa-link").addClass("fa-times"),$("#icon_"+a).attr("icon",c),$("#inline_form input.inline_input").focus()}else $("#inline_new_object").addClass("hide"),$("#inline_form").addClass("hide"),$("#icon_"+a).addClass($("#icon_"+a).attr("icon")).removeClass("fa-times")}function clone_it(){$("#result").html(""),$("#fields").removeClass("hide"),$("#result").addClass("hide")}function change_to_new_object_view(){var a=$("#fields").attr("object");request=$("#"+a+"_go_new").attr("request"),change_view(request)}function reset_controls(){var a=$("#fields").attr("object");$("#"+a+"_save").removeClass("hide"),$(".new_object_results").addClass("hide"),$("#"+a+"_msg").html("").addClass("hide").removeClass("success"),$("#save_msg").html("").addClass("hide").removeClass("success"),$("#"+a+"_go_new").attr("request","")}function update_new_address_fields(a,b,c,d){var e="/ar_address.php?tipo=fields_data&country_code="+b;$.getJSON(e,function(b){if(200==b.state){for(var d in b.fields){var e=$("#"+a+"_"+d+"_field"),f=$("#"+a+"_"+d+"_container"),g=b.fields[d];e.find(".label").html(g.label),g.required?(f.attr("_required",1),e.find(".fa-asterisk").addClass("required")):(f.attr("_required",0),e.find(".fa-asterisk").removeClass("required")),!g.render||c&&("recipient"==d||"organization"==d)?e.addClass("hide"):e.removeClass("hide"),e.insertBefore("#"+a+"_country_field")}$(".address_value").each(function(a){var b=$(this).attr("field"),c=$("#"+b).val(),d=$("#"+b+"_container"),e=d.attr("field_type"),f=d.attr("server_validation"),g=d.attr("parent"),h=d.attr("parent_key"),i=d.attr("object"),j=d.attr("key");if(d.hasClass("address_value"))var k=d.closest("tbody.address_fields").attr("_required");else var k=d.attr("_required");var l=validate_field(b,c,e,k,f,g,h,i,j);1==d.attr("_required")&&""==c&&"valid"==l["class"]&&(l["class"]="valid attention"),$("#"+b+"_field").removeClass("invalid potentially_valid valid").addClass(l["class"])})}else 400==b.state})}function update_related_fields(a){$("#fields  .telephone_input_field").each(function(b){0==$(this).attr("has_been_changed")&&$(this).intlTelInput("setCountry",a.iso2)}),$("#fields  .address_fields").each(function(b){if(0==$(this).attr("has_been_changed")){var c=$(this).attr("field"),d=$("#"+c+"_country_select");d.countrySelect("selectCountry",a.iso2),update_new_address_fields(c,a.iso2,hide_recipient_fields=!0),$("#"+c+"_country  ").val(a.iso2.toUpperCase())}}),0==$("#Supplier_Products_Origin_Country_Code").attr("has_been_changed")&&$("#Supplier_Products_Origin_Country_Code").countrySelect("selectCountry",a.iso2),0==$("#Supplier_Default_Currency_Code").attr("has_been_changed")&&$("#Supplier_Default_Currency_Code").countrySelect("selectCountryfromCode",a.currency)}function show_field_options(a){$(a).addClass("hide"),$("#"+$(a).attr("field")+"_options_ul").removeClass("hide")}function select_option_for_new_object(a,b,c,d){$("#"+b).val(c).addClass("hide"),$("#"+b+"_formatted").val(d).removeClass("hide"),$("#"+b+"_options li").removeClass("selected"),$(a).addClass("selected"),$("#"+b+"_options_ul").addClass("hide"),on_changed_value(b,c)}function toggle_order_operation_dialog(a){if($("#"+a+"_dialog").hasClass("hide"))if($(".order_operation_dialog").addClass("hide"),console.log($("#"+a+"_operations").parents("#back_operations").length),$("#"+a+"_operations").parent("div#back_operations").length){var b=$("#"+a+"_dialog").closest(".block").position();$("#"+a+"_dialog").removeClass("hide").offset({left:b.left})}else{var b=$("#"+a+"_dialog").closest(".block").position();$("#"+a+"_dialog").removeClass("hide").offset({left:b.left+30})}else close_dialog(a)}function close_dialog(a){$("#"+a+"_dialog").addClass("hide")}function set_order_for_collection(a){var b=$(".delivery_options"),c=$(a).find(".radio_icon");if(!c.hasClass("fa-scrubber")&&!b.hasClass("wait")){b.addClass("wait"),c.addClass("fa-spinner fa-spin").removeClass("fa-circle");var d=$("#object_showcase div.order").data("object"),e=d.key,f=new FormData;f.append("tipo","set_order_for_collection"),f.append("order_key",e);var g=$.ajax({url:"/ar_edit_orders.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(a){if(b.removeClass("wait"),200==a.state){if(console.log(a),b.find(".radio_icon").removeClass("fa-scrubber").addClass("fa-circle"),c.addClass("fa-scrubber").removeClass("fa-spinner fa-spin"),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Shipping_Net_Amount_input").val(a.metadata.shipping).attr("ovalue",a.metadata.shipping),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),a.other_fields)for(var d in a.other_fields)update_field(a.other_fields[d]);0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var d in a.metadata.class_html)$("."+d).html(a.metadata.class_html[d]);for(var d in a.metadata.hide)$("."+a.metadata.hide[d]).addClass("hide");for(var d in a.metadata.show)$("."+a.metadata.show[d]).removeClass("hide");for(var d in a.metadata.add_class)$("."+d).addClass(a.metadata.add_class[d]);for(var d in a.metadata.remove_class)$("."+d).removeClass(a.metadata.remove_class[d])}else 400==a.state&&(c.addClass("fa-circle").removeClass("fa-spinner fa-spin"),swal($("#_labels").data("labels").error,a.msg,"error"))}),g.fail(function(a,d){b.removeClass("wait"),c.addClass("fa-circle").removeClass("fa-spinner fa-spin"),console.log(d),console.log(a.responseText)})}}function use_delivery_address_form_directory(a){var b=$(".delivery_options"),c=$(a).find(".radio_icon");if(!c.hasClass("fa-scrubber")&&!b.hasClass("wait")){b.addClass("wait"),c.addClass("fa-spinner fa-spin").removeClass("fa-circle");var d=$("#object_showcase div.order").data("object"),e=d.key,f=new FormData;f.append("tipo","use_delivery_address_form_directory"),f.append("order_key",e),f.append("other_delivery_address_key",$(a).data("other_delivery_address_key")),f.append("type",$(a).data("type"));var g=$.ajax({url:"/ar_edit_orders.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(a){if(b.removeClass("wait"),200==a.state){if(b.find(".radio_icon").removeClass("fa-scrubber").addClass("fa-circle"),c.addClass("fa-scrubber").removeClass("fa-spinner fa-spin"),a.other_fields)for(var d in a.other_fields)update_field(a.other_fields[d]);$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Shipping_Net_Amount_input").val(a.metadata.shipping).attr("ovalue",a.metadata.shipping),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var d in a.metadata.class_html)$("."+d).html(a.metadata.class_html[d]);for(var d in a.metadata.hide)$("."+a.metadata.hide[d]).addClass("hide");for(var d in a.metadata.show)$("."+a.metadata.show[d]).removeClass("hide");for(var d in a.metadata.add_class)$("."+d).addClass(a.metadata.add_class[d]);for(var d in a.metadata.remove_class)$("."+d).removeClass(a.metadata.remove_class[d]);$("#Order_Delivery_Address_recipient").find("input.address_input_field").val(a.Order_Delivery_Address_recipient),$("#Order_Delivery_Address_organization").find("input.address_input_field").val(a.Order_Delivery_Address_organization),$("#Order_Delivery_Address_addressLine1").find("input.address_input_field").val(a.Order_Delivery_Address_addressLine1),$("#Order_Delivery_Address_addressLine2").find("input.address_input_field").val(a.Order_Delivery_Address_addressLine2),$("#Order_Delivery_Address_postalCode").find("input.address_input_field").val(a.Order_Delivery_Address_postalCode),$("#Order_Delivery_Address_sortingCode").find("input.address_input_field").val(a.Order_Delivery_Address_sortingCode),$("#Order_Delivery_Address_dependentLocality").find("input.address_input_field").val(a.Order_Delivery_Address_dependentLocality),$("#Order_Delivery_Address_locality").find("input.address_input_field").val(a.Order_Delivery_Address_locality),$("#Order_Delivery_Address_administrativeArea").find("input.address_input_field").val(a.Order_Delivery_Address_administrativeArea),$("#Order_Delivery_Address_administrativeArea").find("input.address_input_field").val(a.Order_Delivery_Address_country),on_changed_address_value("Order_Delivery_Address","Order_Delivery_Address_country",a.Order_Delivery_Address_country.toLowerCase())}else 400==a.state&&(c.addClass("fa-circle").removeClass("fa-spinner fa-spin"),swal($("#_labels").data("labels").error,a.msg,"error"))}),g.fail(function(a,d){b.removeClass("wait"),c.addClass("fa-circle").removeClass("fa-spinner fa-spin"),console.log(d),console.log(a.responseText)})}}function save_order_operation(a){console.log($("#table").data("metadata")),console.log($(a).data("data"));var b=$(a).data("data"),c=$("#table").data("metadata"),d=$("#object_showcase div.order").data("object");console.log(d);var e=b.dialog_name,f=b.field,g=b.value,h=d.object,i=d.key;if(!$("#"+e+"_save_buttons").hasClass("button"))return void console.log("#"+e+"_save_buttons");$("#"+e+"_save_buttons").removeClass("button"),$("#"+e+"_save_buttons i").addClass("fa-spinner fa-spin"),$("#"+e+"_save_buttons .label").addClass("hide");var j={};$("#"+e+"_dialog  .option_input_field").each(function(){var a=$(this).data("settings");"datetime"==a.type&&(j[a.field]=$("#"+a.id).val()+" "+$("#"+a.id+"_time").val())}),"Replacement State"==f&&(j["Delivery Note Key"]=b.replacement_key);var k=new FormData;k.append("tipo","edit_field"),k.append("object",h),k.append("key",i),k.append("field",f),k.append("value",g),k.append("metadata",JSON.stringify(j));var l=$.ajax({url:"/ar_edit.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});l.done(function(a){if(console.log(a),$("#"+e+"_save_buttons").addClass("button"),$("#"+e+"_save_buttons i").removeClass("fa-spinner fa-spin"),$("#"+e+"_save_buttons .label").removeClass("hide"),200==a.state){close_dialog(e),"Cancelled"==a.value&&change_view(state.request,{reload_showcase:!0});for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide");$(".order_operation").addClass("hide");for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide");$(".timeline .li").removeClass("complete"),"order"==h?(10==a.update_metadata.state_index?($("#tab_order\\.details").addClass("hide"),$("#tab_order\\.delivery_notes").addClass("hide"),$("#tab_order\\.invoices").addClass("hide"),$("#tab_order\\.sent_emails").addClass("hide"),"order.details"!=state.tab&&"order.delivery_notes"!=state.tab&&"order.invoices"!=state.tab&&"order.sent_emails"!=state.tab||change_tab("order.items")):($("#tab_order\\.details").removeClass("hide").addClass("icon_only right"),$("#tab_order\\.delivery_notes").removeClass("hide").addClass("icon_only right"),$("#tab_order\\.invoices").removeClass("hide").addClass("icon_only right"),$("#tab_order\\.sent_emails").removeClass("hide").addClass("icon_only right")),a.update_metadata.state_index>=30&&$("#submitted_node").addClass("complete"),a.update_metadata.state_index>=40&&$("#in_warehouse_node").addClass("complete"),a.update_metadata.state_index>=80&&$("#packed_done_node").addClass("complete"),a.update_metadata.state_index>=90&&$("#approved_node").addClass("complete"),a.update_metadata.state_index>=100&&$("#dispatched_node").addClass("complete"),$("#delivery_notes").html(a.update_metadata.deliveries_xhtml),0==a.update_metadata.number_deliveries?$("#delivery_notes").addClass("hide"):$("#delivery_notes").removeClass("hide"),$("#invoices").html(a.update_metadata.invoices_xhtml),0==a.update_metadata.number_invoices?$("#invoices").addClass("hide"):$("#invoices").removeClass("hide")):"delivery_note"==h?($("#order_node").addClass("complete"),a.update_metadata.state_index>=20&&$("#start_picking_node").addClass("complete"),a.update_metadata.state_index>=30&&$("#picked_node").addClass("complete"),a.update_metadata.state_index>=70&&$("#packed_node").addClass("complete"),a.update_metadata.state_index>=80&&$("#packed_done_node").addClass("complete"),a.update_metadata.state_index>=90&&$("#dispatch_approved_node").addClass("complete"),a.update_metadata.state_index>=100&&$("#dispatched_node").addClass("complete"),a.update_metadata.state_index>10?$(".delivery_note_handling_fields").removeClass("hide"):$(".delivery_note_handling_fields").addClass("hide"),$("#Delivery_Note_State_Index").val(a.update_metadata.state_index)):"supplierdelivery"==h?($("#order_dispatched_node").addClass("complete"),$("#order_node").addClass("complete"),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),a.update_metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),a.update_metadata.state_index>=40&&$("#received_node").addClass("complete"),a.update_metadata.state_index>=50&&$("#checked_node").addClass("complete"),"return"==c.type?"received"==e&&(change_tab("return.items"),$("#received_operations")):(a.update_metadata.state_index>=100&&($("#placed_node").addClass("complete"),"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items")),"undo_costing"==e?change_tab("supplier.delivery.costing"):"undo_received"!=e&&"received"!=e||"supplier.delivery.items"!=state.tab||change_tab("supplier.delivery.items"))):"purchase_order"==h&&(a.update_metadata.state_index>=30&&$("#submitted_node").addClass("complete"),"Purchase Order State"==f&&(console.log(state.tab),"InProcess"==a.value?($("#create_delivery").addClass("hide"),$("#all_available_items,#new_item").removeClass("hide"),change_tab("supplier.order.items_in_process")):"Submitted"==a.value&&($("#all_available_items,#new_item").addClass("hide"),change_tab("supplier.order.items"),a.update_metadata.pending_items_in_delivery>0?"No"==d.skip_inputting?$("#create_delivery").removeClass("hide"):$("#quick_create_delivery_operations").removeClass("hide"):($("#create_delivery").addClass("hide"),$("#quick_create_delivery_operations").addClass("hide")))),"supplier.order.history"!=state.tab&&"supplier.delivery.history"!=state.tab||rows.fetch({reset:!0}))}else 400==a.state&&swal($("#_labels").data("labels").error,a.msg,"error")}),l.fail(function(a,b){console.log(b),console.log(a.responseText)})}function save_item_qty_change(a){if(!$(a).hasClass("fa-exclamation-circle")){$(a).addClass("fa-spinner fa-spin");var b=$(a).closest("span").find("input"),c=$(a).closest("span").data("settings");if($(a).hasClass("fa-plus")){var d="fa-plus";if(isNaN(b.val())||""==b.val())var e=1;else e=parseFloat(b.val())+1;b.val(e).addClass("discreet")}else if($(a).hasClass("fa-minus")){if(isNaN(b.val())||""==b.val()||0==b.val())var e=0;else e=parseFloat(b.val())-1;b.val(e).addClass("discreet");var d="fa-minus"}else if($(a).hasClass("fa-undo")){e=b.attr("ovalue");var d="fa-minus"}else{if(isNaN(parseFloat(b.val()))||""==b.val()||0==b.val())var e=0;else e=parseFloat(b.val());var d="fa-cloud"}$(a).addClass(d),""==e&&(e=0);var f=$("#table").data("metadata");if("Picked"==c.field&&""==$("#dn_data").attr("picker_key"))return $(a).removeClass("fa-spinner fa-spin"),void sweetAlert($("#dn_data").attr("no_picker_msg"));if("Packed"==c.field&&""==$("#dn_data").attr("packer_key"))return $(a).removeClass("fa-spinner fa-spin"),void sweetAlert($("#dn_data").attr("no_packer_msg"));"Supplier Delivery Checked Units"==c.field&&(e*=c.sko_factor);var g="/ar_edit_orders.php?tipo=edit_item_in_order&parent="+f.parent+"&field="+c.field+"&parent_key="+f.parent_key+"&item_key="+c.item_key+"&qty="+e+"&transaction_key="+c.transaction_key;void 0!=c.item_historic_key&&(g+="&item_historic_key="+c.item_historic_key),void 0!=c.item_historic_key&&(g=g+"&item_historic_key="+c.item_historic_key),"Picked"==c.field&&(g=g+"&picker_key="+$("#dn_data").attr("picker_key")),"Packed"==c.field&&(g=g+"&packer_key="+$("#dn_data").attr("packer_key")),console.log(g);var h=new FormData;h.append("tipo","edit_item_in_order"),h.append("field",c.field),h.append("parent",f.parent),h.append("parent_key",f.parent_key),void 0!=c.item_key&&h.append("item_key",c.item_key),void 0!=c.item_historic_key&&h.append("item_historic_key",c.item_historic_key),"Picked"==c.field&&h.append("picker_key",$("#dn_data").attr("picker_key")),"Packed"==c.field&&h.append("packer_key",$("#dn_data").attr("packer_key")),h.append("transaction_key",c.transaction_key),h.append("tab",state.tab),h.append("qty",e);var g=$.ajax({url:"/ar_edit_orders.php",data:h,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(c){var d=$("body").data("labels");if($(a).closest("span").find("i.plus").removeClass("fa-spinner fa-spin fa-cloud error fa-exclamation-circle").addClass("fa-plus").prop("title",d.add),$(a).closest("span").find("i.minus").removeClass("fa-spinner fa-spin invisible fa-undo very_discreet").addClass("fa-minus").prop("title",d.remove),200==c.state){if(console.log(c),b.val(c.transaction_data.qty).removeClass("discreet"),b.attr("ovalue",c.transaction_data.qty),"order"==f.parent){$(".order_operation").addClass("hide");for(var e in c.metadata.operations)$("#"+c.metadata.operations[e]).removeClass("hide");$(a).closest("tr").find("._order_item_net").html(c.transaction_data.to_charge),$(".Total_Amount").attr("amount",c.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",c.metadata.to_pay),$("#Shipping_Net_Amount_input").val(c.metadata.shipping).attr("ovalue",c.metadata.shipping),$("#Charges_Net_Amount_input").val(c.metadata.charges).attr("ovalue",c.metadata.charges),0==c.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=c.metadata.to_pay||0==c.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),c.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==c.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",c.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",c.metadata.to_pay),$("#payment_nodes").html(c.metadata.payments_xhtml);for(var e in c.metadata.class_html)$("."+e).html(c.metadata.class_html[e]);for(var e in c.metadata.hide)$("."+c.metadata.hide[e]).addClass("hide");for(var e in c.metadata.show)$("."+c.metadata.show[e]).removeClass("hide");for(var e in c.metadata.add_class)$("."+e).addClass(c.metadata.add_class[e]);for(var e in c.metadata.remove_class)$("."+e).removeClass(c.metadata.remove_class[e]);for(var e in c.metadata.deleted_otfs)$("#transaction_item_net_"+c.metadata.deleted_otfs[e]).closest("tr").remove();c.metadata.new_otfs.length>0&&rows.fetch({reset:!0});for(var e in c.discounts_data)console.log(e+": "+c.discounts_data[e]),$("#transaction_deal_info_"+e).html(c.discounts_data[e].deal_info),$("#transaction_discounts_"+e).html(c.discounts_data[e].discounts),$("#transaction_item_net_"+e).html(c.discounts_data[e].item_net)}else if("delivery_note"==f.parent)$(a).closest("tr").find(".location_components").html(c.metadata.location_components),$(a).closest("tr").find(".picked_quantity_components").html(c.metadata.picked_quantity_components),c.metadata.state_index>=30&&$("#picked_node").addClass("complete");else if("purchase_order"==f.parent){b.closest("tr").find(".order_units_qty").val(c.transaction_data.qty_units),b.closest("tr").find(".order_skos_qty").val(c.transaction_data.qty_skos),b.closest("tr").find(".order_cartons_qty").val(c.transaction_data.qty_cartons),b.closest("tr").find("input.order_qty").removeClass("error").addClass(c.transaction_data.input_class),$(".order_operation").addClass("hide");for(var e in c.metadata.operations)$("#"+c.metadata.operations[e]).removeClass("hide");$(a).closest("tr").find(".part_sko_item").attr("_checked",c.transaction_data.qty),$(a).closest("tr").find(".subtotals").html(c.transaction_data.subtotals),$(a).closest("tr").find(".placement").html(c.metadata.placement),$(a).closest(".checked_quantity").find(".checked_qty").attr("ovalue",c.transaction_data.qty),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),c.metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),c.metadata.state_index>=40&&$("#received_node").addClass("complete"),c.metadata.state_index>=50&&$("#checked_node").addClass("complete"),100==c.metadata.state_index?($("#placed_node").addClass("complete"),"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items")):$("#placed_node").removeClass("complete")}else if("supplierdelivery"==f.parent||"supplier_delivery"==f.parent){$(".order_operation").addClass("hide");for(var e in c.metadata.operations)$("#"+c.metadata.operations[e]).removeClass("hide");$(a).closest("tr").find(".part_sko_item").attr("_checked",c.transaction_data.qty),$(a).closest("tr").find(".subtotals").html(c.transaction_data.subtotals),$(a).closest("tr").find(".placement").html(c.metadata.placement),$(a).closest(".checked_quantity").find(".checked_qty").attr("ovalue",c.transaction_data.qty),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),c.metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),c.metadata.state_index>=40&&$("#received_node").addClass("complete"),c.metadata.state_index>=50&&$("#checked_node").addClass("complete"),100==c.metadata.state_index?($("#placed_node").addClass("complete"),"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items")):$("#placed_node").removeClass("complete"),console.log("caca"),"agent_delivery"==f.type||"delivery"==f.type?void 0!=c.metadata.checked_items&&c.metadata.checked_items>0?($(".Mismatched_Items").removeClass("hide"),$("div[id='tab_supplier.delivery.items_mismatch']").removeClass("hide")):($("div[id='tab_supplier.delivery.items_mismatch']").addClass("hide"),$(".Mismatched_Items").addClass("hide")):"return"==f.type}for(var e in c.metadata.class_html)$("."+e).html(c.metadata.class_html[e]);for(var e in c.metadata.hide)$("#"+c.metadata.hide[e]).addClass("hide");for(var e in c.metadata.show)$("#"+c.metadata.show[e]).removeClass("hide")}else 400==c.state&&(sweetAlert(c.msg),b.val(b.attr("ovalue")))}),g.fail(function(a,b){console.log(b),console.log(a.responseText)})}}function save_item_out_of_stock_qty_change(a){$(a).addClass("fa-spinner fa-spin");var b=$("#set_out_of_stock_items_dialog").find("input");if($(a).hasClass("fa-plus")){if(isNaN(b.val())||""==b.val())var c=1;else c=parseFloat(b.val())+1;b.val(c).addClass("discreet")}else if($(a).hasClass("fa-minus")){if(isNaN(b.val())||""==b.val()||0==b.val())var c=0;else c=parseFloat(b.val())-1;b.val(c).addClass("discreet")}else c=parseFloat(b.val());""==c&&(c=0);var d=$("#table").data("metadata");"/ar_edit_orders.php?tipo=edit_item_in_order&parent="+d.parent+"&field=Out_of_stock&parent_key="+d.parent_key+"&item_key="+$("#set_out_of_stock_items_dialog").attr("item_key")+"&qty="+c+"&transaction_key="+$("#set_out_of_stock_items_dialog").attr("transaction_key");return}function get_orders_table(a,b,c){switch($(".order_flow").removeClass("selected"),$(".blue").removeClass("blue"),a){case"website":$("#order_flow_website").addClass("selected"),widget="orders.website.wget",$(".Orders_In_Basket_Number").addClass("blue"),$(".Orders_In_Basket_Amount").addClass("blue");break;case"website_purges":$("#order_flow_website").addClass("selected"),widget="orders.website.purges.wget",$(".Orders_In_Basket_Number").addClass("blue"),$(".Orders_In_Basket_Amount").addClass("blue");break;case"website_mailshots":$("#order_flow_website").addClass("selected"),widget="orders.website.mailshots.wget",$(".Orders_In_Basket_Number").addClass("blue"),$(".Orders_In_Basket_Amount").addClass("blue");break;case"submitted_not_paid":$("#order_flow_submitted").addClass("selected").find(""),widget="orders.in_process.not_paid.wget",$(".Orders_In_Process_Not_Paid_Number").addClass("blue"),$(".Orders_In_Process_Not_Paid_Amount").addClass("blue");break;case"submitted":$("#order_flow_submitted").addClass("selected"),widget="orders.in_process.paid.wget",$(".Orders_In_Process_Paid_Number").addClass("blue"),$(".Orders_In_Process_Paid_Amount").addClass("blue");break;case"in_warehouse":$("#order_flow_in_warehouse").addClass("selected"),widget="orders.in_warehouse_no_alerts.wget",$(".Orders_In_Warehouse_No_Alerts_Number").addClass("blue"),$(".Orders_In_Warehouse_No_Alerts_Amount").addClass("blue");break;case"in_warehouse_with_alerts":$("#order_flow_in_warehouse").addClass("selected"),widget="orders.in_warehouse_with_alerts.wget",$(".Orders_In_Warehouse_With_Alerts_Number").addClass("blue"),$(".Orders_In_Warehouse_With_Alerts_Amount").addClass("blue");break;case"packed_done":$("#order_flow_packed").addClass("selected"),widget="orders.packed_done.wget",$(".Orders_Packed_Number").addClass("blue"),$(".Orders_Packed_Amount").addClass("blue");break;case"approved":$("#order_flow_packed").addClass("selected"),widget="orders.approved.wget",$(".Orders_Dispatch_Approved_Number").addClass("blue"),$(".Orders_Dispatch_Approved_Amount").addClass("blue");break;case"dispatched_today":$("#order_flow_dispatched").addClass("selected"),widget="orders.dispatched_today.wget",$(".Orders_Dispatched_Today_Number").addClass("blue"),$(".Orders_Dispatched_Today_Amount").addClass("blue");break;default:a="submitted",$("#order_flow_submitted").addClass("selected"),widget="orders.in_process.paid.wget",$(".Orders_In_Process_Paid_Number").addClass("blue"),$(".Orders_In_Process_Paid_Amount").addClass("blue")}if($("#order_flow_website").data("current_order_flow")!=a||"Yes"==c){$("#order_flow_website").data("current_order_flow",a);var d=window.location.pathname.replace(/dashboard.*$/,"")+"dashboard/"+a;window.top.history.pushState({request:d},null,d);var e="/ar_views.php?tipo=widget_details&widget="+widget+"&metadata="+JSON.stringify(b);$.getJSON(e,function(a){$("#widget_details").html(a.widget_details).removeClass("hide")})}}function select_payment_account(a){var b=$(a).data("settings");$(".payment_button").removeClass("selected"),$(a).addClass("selected"),$("#new_payment_payment_account_key").val(b.payment_account_key).data("settings",b),$("#new_payment_payment_method").val(b.payment_method),$("#add_payment :input").attr("disabled",!1),$("#add_payment .payment_fields").removeClass("just_hinted"),"Accounts"==b.block?$("#new_payment_reference").closest("tr").addClass("hide"):$("#new_payment_reference").closest("tr").removeClass("hide"),$(".new_payment_payment_account_button").addClass("super_discreet"),$(a).removeClass("super_discreet"),""==$("#new_payment_amount").val()?$("#new_payment_amount").focus():$("#new_payment_reference").focus()}function try_to_pay(a){var b=$("#object_showcase div.order").data("object");if(console.log($(a).attr("amount")),console.log(b.order_type),$(a).attr("amount")>0||"Refund"==b.order_type)$("#add_payment").hasClass("hide")&&show_add_payment_to_order(),$("#new_payment_amount").is(":disabled")||($("#new_payment_amount").val($(a).attr("amount")),validate_new_payment());else{if($(a).attr("amount")<0&&"Order"==b.order_type)return;if($(a).attr("amount")<0&&$("#payment_refund_amount").is(":visible")){var c=Math.abs($(a).attr("amount")),d=$("#payment_refund_dialog").data("settings").amount;d<c&&(c=d),$("#payment_refund_amount").val(c),validate_refund_form()}}}function show_create_credit(a){if($("#add_credit").hasClass("hide")){var b=$("#object_showcase div.order").data("object");"invoice"==b.object?change_tab("invoice.payments",{add_payment:1}):change_tab("order.payments",{add_payment:1}),$("#tabs").addClass("hide"),$("#new_credit_amount").val($(a).attr("absolute_amount")),$("#add_credit").removeClass("hide")}}function open_add_payment_to_order(a){if($(a).hasClass("fa-lock")){var b=$(a).data("labels");swal({title:b.title,text:b.text,type:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:b.no_text_no_stock,confirmButtonText:b.yes_text_no_stock}).then(function(b){console.log(b),b.value&&$(a).removeClass("fa-lock super_discreet").addClass("fa-plus")})}else show_add_payment_to_order()}function show_add_payment_to_order(){if($("#add_payment").hasClass("hide")){
var a=$("#object_showcase div.order").data("object");"invoice"==a.object?change_tab("invoice.payments",{add_payment:1}):change_tab("order.payments",{add_payment:1}),$("#tabs").addClass("hide"),$("#add_payment :input").attr("disabled",!0),$(".payment_fields").addClass("just_hinted"),$("#new_payment_reference").closest("tr").removeClass("hide"),$("#add_payment").removeClass("hide"),$("#new_payment_payment_account_key").val(""),$("#new_payment_payment_method").val(""),$(".new_payment_payment_account_button").removeClass("super_discreet")}}function close_add_payment_to_order(){$("#add_payment").addClass("hide"),$("#tabs").removeClass("hide")}function validate_new_payment(){var a=$("#new_payment_payment_account_key").data("settings");if("Accounts"==a.block)var b=!0;else var b=""!=$("#new_payment_reference").val();if(""!=a.max_amount)var c=!(parseFloat(a.max_amount)<parseFloat($("#new_payment_amount").val()));else var c=!0;if(!validate_number($("#new_payment_amount").val(),0,999999999)&&$("#new_payment_payment_account_key").val()>0)var d=!0;else var d=!1;b&&c&&d?$("#save_new_payment").addClass("valid changed"):$("#save_new_payment").removeClass("valid changed")}function save_new_payment(){var a=$("#object_showcase div.order").data("object");if(!$("#save_new_payment").hasClass("wait")){$("#save_new_payment").addClass("wait"),$("#save_new_payment i").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var b=new FormData;b.append("tipo","new_payment"),b.append("parent",a.object),b.append("parent_key",a.key),b.append("payment_account_key",$("#new_payment_payment_account_key").val()),b.append("amount",$("#new_payment_amount").val()),b.append("payment_method",$("#new_payment_payment_method").val()),b.append("reference",$("#new_payment_reference").val()),console.log("/ar_edit_orders.php?tipo=new_payment&parent="+a.object+"&parent_key="+a.key+"&payment_account_key="+$("#new_payment_payment_account_key").val()+"&amount="+$("#new_payment_amount").val()+"&payment_method="+$("#new_payment_payment_method").val()+"&reference="+$("#new_payment_reference").val()),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(b){if($("#save_new_payment").removeClass("wait"),$("#save_new_payment i").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),"200"==b.state)if("invoice"==a.object)$("#tabs").removeClass("hide"),change_view(state.request,{reload_showcase:1});else{$("#new_payment_amount").val(""),$("#new_payment_reference").val(""),validate_new_payment(),$(".Total_Amount").attr("amount",b.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",b.metadata.to_pay),$("#Shipping_Net_Amount_input").val(b.metadata.shipping).attr("ovalue",b.metadata.shipping),$("#Charges_Net_Amount_input").val(b.metadata.charges).attr("ovalue",b.metadata.charges),0==b.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=b.metadata.to_pay||0==b.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),b.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==b.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",b.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",b.metadata.to_pay),$("#payment_nodes").html(b.metadata.payments_xhtml);for(var c in b.metadata.class_html)$("."+c).html(b.metadata.class_html[c]);for(var c in b.metadata.hide)$("#"+b.metadata.hide[c]).addClass("hide");for(var c in b.metadata.show)$("#"+b.metadata.show[c]).removeClass("hide");"order.payments"==state.tab&&rows.fetch({reset:!0}),close_add_payment_to_order()}else"400"==b.state&&($("#tabs").removeClass("hide"),swal("Error!",b.msg,"error"))},error:function(){$("#save_new_payment").removeClass("wait"),$("#save_new_payment i").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}})}}function show_add_offer_to_order(){}function toggle_selected_by_customer_charge(a){if(!$(a).hasClass("wait")){if($(a).hasClass("fa-toggle-on"))var b="remove_charge";else var b="add_charge";$(a).addClass("wait fa-spin fa-spinner").removeClass("fa-toggle-on fa-toggle-off");var c=$("#object_showcase div.order").data("object"),d=new FormData;d.append("tipo","toggle_charge"),d.append("operation",b),d.append("parent",c.object),d.append("parent_key",c.key),d.append("charge_key",$(a).data("charge_key")),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:d,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(c){if($(a).removeClass("wait"),console.log(c),"200"==c.state){"add_charge"==c.operation?($(a).addClass("fa-toggle-on").removeClass("fa-spinner fa-spin"),$(a).closest("tr").find(".selected_by_customer_charge").html(c.transaction_data.amount),$(".Order_Priority_Icon").removeClass("hide"),$(".priority_label").removeClass("hide")):($(a).addClass("fa-toggle-off").removeClass("fa-spinner fa-spin"),$(a).closest("tr").find(".selected_by_customer_charge").html(""),$(".Order_Priority_Icon").addClass("hide"),$(".priority_label").addClass("hide")),$(".Total_Amount").attr("amount",c.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",c.metadata.to_pay),$("#Shipping_Net_Amount_input").val(c.metadata.shipping).attr("ovalue",c.metadata.shipping),$("#Charges_Net_Amount_input").val(c.metadata.charges).attr("ovalue",c.metadata.charges),0==c.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=c.metadata.to_pay||0==c.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),c.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==c.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",c.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",c.metadata.to_pay);for(var d in c.metadata.class_html)$("."+d).html(c.metadata.class_html[d]);for(var d in c.metadata.hide)$("#"+c.metadata.hide[d]).addClass("hide");for(var d in c.metadata.show)$("#"+c.metadata.show[d]).removeClass("hide")}else swal("Error!",c.msg,"error"),console.log(a),$(a).removeClass("fa-spinner fa-spin"),"remove_charge"==b?$(a).addClass("fa-toggle-on"):$(a).addClass("fa-toggle-off")},error:function(){$(a).removeClass("fa-spinner fa-spin"),"remove_charge"==b?$(a).addClass("fa-toggle-on"):$(a).addClass("fa-toggle-off")}})}}function select_deal_component_choose_by_customer(a){var b=$(a).closest(".deal_component_choose_by_customer");if($(a).data("product_id")!=b.data("selected")&&!b.hasClass("wait")){b.addClass("wait"),b.find("i").removeClass("fa-dot-circle").addClass("fa-circle"),$(a).find("i").addClass("fa-spin fa-spinner").removeClass("fa-circle");var c=$("#object_showcase div.order").data("object"),d=new FormData;d.append("tipo","toggle_deal_component_choose_by_customer"),d.append("order_key",c.key),d.append("deal_component_key",b.data("deal_component_key")),d.append("otdb_key",b.data("otdb_key")),d.append("product_id",$(a).data("product_id")),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:d,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(c){if(console.log(c),"200"==c.state){$(a).find("i").addClass("fa-spin fa-spinner").removeClass("fa-circle");var d=$("#transaction_item_net_"+c.transaction_deal_data.otf_key).closest("tr");d.find(".item_code").html(c.transaction_deal_data.Code),d.find(".item_description").html(c.transaction_deal_data.Description),b.removeClass("wait").data("selected",c.transaction_deal_data.product_id),$(a).find("i").removeClass("fa-spin fa-spinner").addClass("fa-dot-circle"),$(".Total_Amount").attr("amount",c.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",c.metadata.to_pay),$("#Shipping_Net_Amount_input").val(c.metadata.shipping).attr("ovalue",c.metadata.shipping),$("#Charges_Net_Amount_input").val(c.metadata.charges).attr("ovalue",c.metadata.charges),0==c.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=c.metadata.to_pay||0==c.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),c.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==c.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",c.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",c.metadata.to_pay);for(var e in c.metadata.class_html)$("."+e).html(c.metadata.class_html[e]);for(var e in c.metadata.hide)$("#"+c.metadata.hide[e]).addClass("hide");for(var e in c.metadata.show)$("#"+c.metadata.show[e]).removeClass("hide")}else swal("Error!",c.msg,"error"),console.log(a),$(a).removeClass("fa-spinner fa-spin"),"remove_charge"==operation?$(a).addClass("fa-toggle-on"):$(a).addClass("fa-toggle-off")},error:function(){$(a).removeClass("fa-spinner fa-spin")}})}}function save_shipping_value(){if(!($("#order").data("state_index")>=90||$("#order").data("state_index")<=0||$("#Shipping_Net_Amount_save").hasClass("wait"))){$("#Shipping_Net_Amount_save").addClass("wait"),$("#Shipping_Net_Amount_save").removeClass("fa-cloud").addClass("fa-spinner fa-spin"),""==$("#Shipping_Net_Amount_input").val()&&$("#Shipping_Net_Amount_input").val(0);var a=parseFloat($("#Shipping_Net_Amount_input").val()),b=new FormData;b.append("tipo","set_shipping_value"),b.append("order_key",$("#object_showcase div.order").data("object").key),b.append("amount",a),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if($("#Shipping_Net_Amount_save").removeClass("wait"),$("#Shipping_Net_Amount_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),console.log(a),"200"==a.state){$("#Shipping_Net_Amount").removeClass("hide"),$("#Shipping_Net_Amount_form").addClass("hide"),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Shipping_Net_Amount_input").val(a.metadata.shipping).attr("ovalue",a.metadata.shipping),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock-alt super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock-alt super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var b in a.metadata.class_html)$("."+b).html(a.metadata.class_html[b]);for(var b in a.metadata.hide)$("#"+a.metadata.hide[b]).addClass("hide");for(var b in a.metadata.show)$("#"+a.metadata.show[b]).removeClass("hide")}else"400"==a.state&&swal($("body").data("labels").error,a.msg,"error")},error:function(){$("#Shipping_Net_Amount_save").removeClass("wait"),$("#Shipping_Net_Amount_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}})}}function set_shipping_as_auto(){if(!($("#order").data("state_index")>=90||$("#order").data("state_index")<=0||$("#set_shipping_as_auto").hasClass("wait"))){$("#set_shipping_as_auto").addClass("wait"),$("#set_shipping_as_auto").removeClass("fa-magic").addClass("fa-spinner fa-spin");var a=new FormData;a.append("tipo","set_shipping_as_auto"),a.append("order_key",$("#object_showcase div.order").data("object").key),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:a,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if($("#set_shipping_as_auto").removeClass("wait"),$("#set_shipping_as_auto").addClass("fa-magic").removeClass("fa-spinner fa-spin"),console.log(a),"200"==a.state){$("#Shipping_Net_Amount").removeClass("hide"),$("#Shipping_Net_Amount_form").addClass("hide"),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Shipping_Net_Amount_input").val(a.metadata.shipping).attr("ovalue",a.metadata.shipping),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock-alt super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock-alt super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var b in a.metadata.class_html)$("."+b).html(a.metadata.class_html[b]);for(var b in a.metadata.hide)$("#"+a.metadata.hide[b]).addClass("hide");for(var b in a.metadata.show)$("#"+a.metadata.show[b]).removeClass("hide")}else"400"==a.state&&swal($("body").data("labels").error,a.msg,"error")},error:function(){$("#set_shipping_as_auto").removeClass("wait"),$("#set_shipping_as_auto").addClass("fa-magic").removeClass("fa-spinner fa-spin")}})}}function save_charges_value(){if(!($("#order").data("state_index")>=90||$("#order").data("state_index")<=0||$("#Charges_Net_Amount_save").hasClass("wait"))){$("#Charges_Net_Amount_save").addClass("wait"),$("#Charges_Net_Amount_save").removeClass("fa-cloud").addClass("fa-spinner fa-spin"),""==$("#Charges_Net_Amount_input").val()&&$("#Charges_Net_Amount_input").val(0);var a=parseFloat($("#Charges_Net_Amount_input").val()),b=new FormData;b.append("tipo","set_hanging_charges_value"),b.append("order_key",$("#object_showcase div.order").data("object").key),b.append("amount",a),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if($("#Charges_Net_Amount_save").removeClass("wait"),$("#Charges_Net_Amount_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),console.log(a),"200"==a.state){$("#Charges_Net_Amount").removeClass("hide"),$("#Charges_Net_Amount_form").addClass("hide"),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock-alt super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock-alt super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var b in a.metadata.class_html)$("."+b).html(a.metadata.class_html[b]);for(var b in a.metadata.hide)$("#"+a.metadata.hide[b]).addClass("hide");for(var b in a.metadata.show)$("#"+a.metadata.show[b]).removeClass("hide")}else"400"==a.state&&swal($("body").data("labels").error,a.msg,"error")},error:function(){$("#Charges_Net_Amount_save").removeClass("wait"),$("#Charges_Net_Amount_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}})}}function set_charges_as_auto(){if(!($("#order").data("state_index")>=90||$("#order").data("state_index")<=0||$("#set_charges_as_auto").hasClass("wait"))){$("#set_charges_as_auto").addClass("wait"),$("#set_charges_as_auto").removeClass("fa-magic").addClass("fa-spinner fa-spin");var a=new FormData;a.append("tipo","set_charges_as_auto"),a.append("order_key",$("#object_showcase div.order").data("object").key),$.ajax({url:"/ar_edit_orders.php",type:"POST",data:a,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if($("#set_charges_as_auto").removeClass("wait"),$("#set_charges_as_auto").addClass("fa-magic").removeClass("fa-spinner fa-spin"),console.log(a),"200"==a.state){$("#Charges_Net_Amount").removeClass("hide"),$("#Charges_Net_Amount_form").addClass("hide"),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock-alt super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock-alt super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var b in a.metadata.class_html)$("."+b).html(a.metadata.class_html[b]);for(var b in a.metadata.hide)$("#"+a.metadata.hide[b]).addClass("hide");for(var b in a.metadata.show)$("#"+a.metadata.show[b]).removeClass("hide")}else"400"==a.state&&swal($("body").data("labels").error,a.msg,"error")},error:function(){$("#set_charges_as_auto").removeClass("wait"),$("#set_charges_as_auto").addClass("fa-magic").removeClass("fa-spinner fa-spin")}})}}function edit_order_in_warehouse(){$("#forward_operations .edit_order_in_warehouse i").hasClass("far")?Swal.fire({title:$(".edit_order_in_warehouse").data("title"),html:$(".edit_order_in_warehouse").data("html")+' <div style="margin-top:10px" class="small error">This is a <em>beta</em> (untested) feature</div>',type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:$(".edit_order_in_warehouse").data("confirmButtonText")}).then(function(a){a.value&&(grid.columns.findWhere({name:"quantity"}).set("renderable",!1),grid.columns.findWhere({name:"quantity_edit"}).set("renderable",!0),$("#forward_operations .edit_order_in_warehouse i").removeClass("far").addClass("fas"))}):(grid.columns.findWhere({name:"quantity"}).set("renderable",!0),grid.columns.findWhere({name:"quantity_edit"}).set("renderable",!1),$("#forward_operations .edit_order_in_warehouse i").addClass("far").removeClass("fas"))}function show_add_deal_to_order(){$(".open_add_discounts").addClass("hide"),$(".discounts_label").addClass("hide"),$(".save_add_discounts").removeClass("hide"),$(".close_add_discounts").removeClass("hide"),$("#add_discount").removeClass("hide").focus(),$("#add_item_results_container").removeClass("hide")}function hide_add_deal_to_order(){$(".open_add_discounts").removeClass("hide"),$(".discounts_label").removeClass("hide"),$(".save_add_discounts").addClass("hide"),$(".close_add_discounts").addClass("hide"),$("#add_discount").addClass("hide").focus(),$("#add_item_results_container").addClass("hide")}function save_add_deal_to_order(){console.log("to do")}function close_clone_order(){$("#clone_order_dialog").addClass("hide")}function open_clone_order(){if($(".clone_order_open_button i").hasClass("fa-clone")){$(".clone_order_open_button i").removeClass("fa-clone").addClass("fa-spinner fa-spin");var a="/ar_find.php?tipo=orders_in_process&customer_key="+$("#order").data("customer_key");$.getJSON(a,function(a){$(".clone_order_open_button i").addClass("fa-clone").removeClass("fa-spinner fa-spin"),$("#clone_order_dialog").find(".clone_order_msg").html(a.clone_msg),a.orders_in_process>1&&$("#clone_order_dialog").find(".save").removeClass("valid").addClass("invalid"),$("#clone_order_dialog").removeClass("hide").offset({top:$(".clone_order_open_button").offset().top+$(".clone_order_open_button").height(),left:$(".clone_order_open_button").offset().left-$("#clone_order_dialog").width()})})}}function clone_order(a){if(!$(a).hasClass("invalid")){var b=$(a).find("i");if(!b.hasClass("wait")){b.addClass("wait fa-spinner fa-spin").removeClass("fa-clone");var c="/ar_edit_orders.php?tipo=clone_order&order_key="+$("#order").attr("order_key");console.log(c);var d=new FormData;d.append("tipo","clone_order"),d.append("order_key",$("#order").attr("order_key"));var c=$.ajax({url:"/ar_edit_orders.php",data:d,processData:!1,contentType:!1,type:"POST",dataType:"json"});c.done(function(a){200==a.state?change_view(a.redirect):400==a.state&&alert(a.msg)}),c.fail(function(a,b){console.log(b),console.log(a.responseText)})}}}function send_email(a,b){$("#save_email_template_dialog").addClass("hide");var c=new FormData;c.append("tipo","send_email"),c.append("recipient",a),c.append("recipient_key",b),c.append("html",$("#template_name2").data("htmlFile")),c.append("json",$("#template_name2").data("jsonFile")),c.append("text",$("#email_template_text").val()),c.append("subject",$("#email_template_subject").val()),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:c,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?change_view(a.redirect):"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function send_mailshot_now(a){$(a).find("i").removeClass("fa-paper-plane").addClass("fa-spinner fa-spin");var b=new FormData;b.append("tipo","send_mailshot"),b.append("key",$("#email_campaign").data("email_campaign_key")),$.ajax({url:"/ar_mailshot.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){console.log(a),$("#mailshot\\.published_email").removeClass("hide"),change_tab("mailshot.published_email");for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);$(".email_campaign_operation").addClass("hide"),$(".estimated_recipients_pre_sent").addClass("hide"),$(".estimated_recipients_post_sent").removeClass("hide");for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide");$(".timeline .li").removeClass("complete"),$("#setup_mail_list_node").addClass("complete"),$("#composed_email_node").addClass("complete"),$("#scheduled_node").addClass("complete"),$("#sending_node").addClass("complete")}else"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function resume_mailshot(a){$(a).find("i").removeClass("fa-play").addClass("fa-spinner fa-spin");var b=new FormData;b.append("tipo","resume_mailshot"),b.append("key",$("#email_campaign").data("email_campaign_key")),$.ajax({url:"/ar_mailshot.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){$("#mailshot\\.published_email").removeClass("hide"),change_tab("mailshot.published_email");for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);$(".email_campaign_operation").addClass("hide"),console.log(a.update_metadata.operations);for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide");$("#stopped_node").addClass("hide"),$(".timeline .li").removeClass("complete"),$("#setup_mail_list_node").addClass("complete"),$("#composed_email_node").addClass("complete"),$("#scheduled_node").addClass("complete"),$("#sending_node").addClass("complete")}else"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function stop_mailshot(a){$(a).find("i").removeClass("fa-play").addClass("fa-spinner fa-spin");var b=new FormData;b.append("tipo","stop_mailshot"),b.append("key",$("#email_campaign").data("email_campaign_key")),$.ajax({url:"/ar_mailshot.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){$("#mailshot\\.workshop").removeClass("hide"),change_tab("mailshot.workshop");for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);$(".email_campaign_operation").addClass("hide"),console.log(a.update_metadata.operations);for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide");$("#stopped_node").removeClass("hide"),$(".timeline .li").removeClass("complete"),$("#setup_mail_list_node").addClass("complete"),$("#composed_email_node").addClass("complete"),$("#scheduled_node").addClass("complete"),$("#sending_node").addClass("complete")}else"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function save_email_campaign_operation(a){var b=$(a).data("data"),c=$("#email_campaign").data("object"),d=b.dialog_name,e=b.field,f=b.value,g=c.object,h=c.key;if(!$("#"+d+"_save_buttons").hasClass("button"))return void console.log("#"+d+"_save_buttons");$("#"+d+"_save_buttons").removeClass("button"),$("#"+d+"_save_buttons i").addClass("fa-spinner fa-spin"),$("#"+d+"_save_buttons .label").addClass("hide");var i={};$("#"+d+"_dialog  .option_input_field").each(function(){var a=$(this).data("settings");"datetime"==a.type&&(i[a.field]=$("#"+a.id).val()+" "+$("#"+a.id+"_time").val())});var j="/ar_edit.php?tipo=edit_field&object="+g+"&key="+h+"&field="+e+"&value="+f+"&metadata="+JSON.stringify(i);console.log(j);var k=new FormData;k.append("tipo","edit_field"),k.append("object",g),k.append("key",h),k.append("field",e),k.append("value",f),k.append("metadata",JSON.stringify(i));var j=$.ajax({url:"/ar_edit.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(a){if($("#"+d+"_save_buttons").addClass("button"),$("#"+d+"_save_buttons i").removeClass("fa-spinner fa-spin"),$("#"+d+"_save_buttons .label").removeClass("hide"),200==a.state){close_dialog(d),"Cancelled"==a.value&&change_view(state.request,{reload_showcase:!0}),void 0!=a.update_metadata.tab&&($("#mailshot\\."+a.update_metadata.tab).removeClass("hide"),change_tab("mailshot."+a.update_metadata.tab));for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);$(".email_campaign_operation").addClass("hide");for(var b in a.update_metadata.operations)console.log("#"+a.update_metadata.operations[b]),$("#"+a.update_metadata.operations[b]).removeClass("hide");$(".timeline .li").removeClass("complete"),a.update_metadata.state_index>=20&&$("#setup_mail_list_node").addClass("complete"),a.update_metadata.state_index>=30&&$("#composed_email_node").addClass("complete"),a.update_metadata.state_index>=80&&$("#packed_done_node").addClass("complete"),a.update_metadata.state_index>=90&&$("#approved_node").addClass("complete"),a.update_metadata.state_index>=100&&$("#dispatched_node").addClass("complete")}else 400==a.state&&swal($("#_labels").data("labels").error,a.msg,"error")}),j.fail(function(a,b){console.log(b),console.log(a.responseText)})}function open_send_test_email_dialog(a){$("#email_template_text_controls").hasClass("hide")?$("#send_email_dialog").removeClass("hide").css({top:"170px",left:"210px"}):$("#send_email_dialog").removeClass("hide").css({top:"64px",left:"160px"}),$("#send_test_email_to").data("html",a),$("#send_test_email_to").val($("#email_template_data").data("send_email_to")),$("#send_email_ok").addClass("hide")}function validate_send_test_email_to(){var a=$("#send_test_email_to"),b=a.next("i"),c=client_validation("email",!1,a.val());console.log(c),a.removeClass("error"),b.removeClass("valid invalid"),"invalid"==c["class"]?(a.addClass("error"),b.addClass("invalid")):"valid"==c["class"]&&b.addClass("valid"),""!=a.val()?b.addClass("changed"):b.removeClass("changed valid")}function open_save_as_blueprint_dialog(a){$("#save_as_blueprint_dialog").removeClass("hide"),$("#save_as_blueprint_dialog").find("input").val("").focus().data("jsonFile",a).data("htmlFile","")}function send_test_email(){$("#send_email").addClass("fa-spinner fa-spin").removeClass("valid changed fa-paper-plane");var a=new FormData;a.append("tipo","send_test_email"),a.append("email_template_key",$("#email_template_data").data("email_template_key")),a.append("html",$("#send_test_email_to").data("html")),a.append("email",$("#send_test_email_to").val()),$(".toggle_send_test_email_with_tracking_code").hasClass("hide")||$(".toggle_send_test_email_with_tracking_code").find("i").hasClass("fa-toggle-on")&&a.append("options","with_tracking_code"),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:a,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){$("#send_email").removeClass("fa-spinner fa-spin").addClass("valid changed fa-paper-plane"),$("#send_email_dialog").addClass("hide"),$("#email_template_text_controls").hasClass("hide")?$("#send_email_ok").removeClass("hide").css({top:"170px",left:"210px"}):$("#send_email_ok").removeClass("hide").css({top:"64px",left:"160px"});for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide")}else"400"==a.state&&swal("{t}Error{/t}",a.msg,"error")},error:function(){}})}function auto_save_email_template(a,b){var c=new FormData;c.append("tipo","auto_save_email_template"),c.append("email_template_key",$("#email_template_data").data("email_template_key")),c.append("json",a),c.append("html",b),c.append("subject",$("#email_template_subject").val()),c.append("text",$("#email_template_text").val()),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:c,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?(console.log(a),$("#email_template_info").html(a.email_template_info),a.published?$("#publish_email_template_from_text_controls").addClass("super_discreet").removeClass("button"):$("#publish_email_template_from_text_controls").removeClass("super_discreet").addClass("button")):"400"==a.state},error:function(){}})}function save_email_template(a,b){var c=new FormData;c.append("tipo","publish_email_template"),c.append("email_template_key",$("#email_template_data").data("email_template_key")),c.append("json",a),c.append("html",b),c.append("subject",$("#email_template_subject").val()),
c.append("text",$("#email_template_text").val()),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:c,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){console.log(a),$("#email_template_info").html(a.email_template_info),a.published?$("#publish_email_template_from_text_controls").addClass("super_discreet").removeClass("button"):$("#publish_email_template_from_text_controls").removeClass("super_discreet").addClass("button");for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide");$(".email_campaign_operation").addClass("hide");for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide");30==a.update_metadata.state_index&&($("#mailshot\\.workshop").addClass("hide"),$("#mailshot\\.published_email").removeClass("hide"),change_tab("mailshot.published_email"),$("#composed_email_node").addClass("complete"))}else"400"==a.state},error:function(){}})}function save_as_blueprint(a){var b=$(a).closest("div").find("input"),c=new FormData;c.append("tipo","save_blueprint"),c.append("email_template_key",$("#email_template_data").data("email_template_key")),c.append("json",b.data("jsonFile")),c.append("html",b.data("htmlFile")),c.append("name",b.val()),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:c,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?$(".save_as_blueprint_dialog").addClass("hide"):"400"==a.state&&swal({title:a.title,text:a.msg,confirmButtonText:"OK"})},error:function(){}})}function save_email_template_text(){if(!$("#email_template_text_save").hasClass("waiting")){$("#email_template_text_save").addClass("waiting").find("i").addClass("fa-spin fa-spinner");var a=new FormData;a.append("tipo","save_email_template_text_part"),a.append("email_template_key",$("#email_template_data").data("email_template_key")),a.append("subject",$("#email_template_subject").val()),a.append("text",$("#email_template_text").val()),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:a,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state){for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.hide)$("."+a.update_metadata.hide[b]).addClass("hide");for(var b in a.update_metadata.show)$("."+a.update_metadata.show[b]).removeClass("hide");$(".email_campaign_operation").addClass("hide");for(var b in a.update_metadata.operations)$("#"+a.update_metadata.operations[b]).removeClass("hide")}else"400"==a.state&&swal(a.msg);$("#email_template_text_save").removeClass("valid changed waiting").find("i").addClass("fa-cloud").removeClass("fa-spin fa-spinner")},error:function(){}})}}function delete_blueprint(a,b){if(!$(a).hasClass("super_discreet")){var c=$("#delete_blueprint_button_"+b).closest("tr");if(!c.hasClass("deleting_tr")&&!c.hasClass("deleted_tr")){c.addClass("deleting_tr");var d=new FormData;d.append("tipo","object_operation"),d.append("operation","delete"),d.append("object","Email_Blueprint"),d.append("key",b),$.ajax({url:"/ar_edit.php",type:"POST",data:d,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?(c.removeClass("deleting_tr").addClass("deleted_tr"),$("#delete_blueprint_button_"+b).html(a.msg).closest("td").addClass("hide").html("")):"400"==a.state&&(c.removeClass("deleting_tr"),swal(a.msg))},error:function(){}})}}}function select_blueprint_from_table(a,b,c,d,e){if(icon=$(a).find("i"),!icon.hasClass("fa-spin")){icon.removeClass("fa-trophy"),icon.addClass("fa-spinner fa-spin");var f=new FormData;f.append("tipo","use_template"),f.append("scope",b),f.append("scope_key",c),f.append("blueprint_key",d),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:f,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?change_tab(e,{reload_showcase:1}):"400"==a.state&&(icon.removeClass("fa-spinner fa-spin"),swal(a.msg))},error:function(){}})}}function unlock_delete_blueprint(a){$(a).hasClass("fa-lock")?$(a).removeClass("fa-lock").addClass("fa-unlock").next("span").removeClass("super_discreet").addClass("button"):$(a).addClass("fa-lock").removeClass("fa-unlock").next("span").addClass("super_discreet").removeClass("button")}function clone_sent_mailshot_from_table(a,b,c,d,e){if(icon=$(a).find("i"),!icon.hasClass("fa-spin")){icon.removeClass("fa-clone"),icon.addClass("fa-spinner fa-spin");var f=new FormData;f.append("tipo","clone_sent_mailshot"),f.append("object",b),f.append("key",c),f.append("mailshot_clone_key",d),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:f,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?change_tab(e):"400"==a.state&&(icon.removeClass("fa-spinner fa-spin"),swal(a.msg))},error:function(){}})}}function set_email_template_as_selecting_blueprints(a){var b=new FormData;b.append("tipo","set_email_template_as_selecting_blueprints"),b.append("email_template_key",a),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?change_view(state.request,{reload_showcase:1}):"400"==a.state&&swal(a.msg)},error:function(){}})}function undo_email_template_as_selecting_blueprints(a){var b=new FormData;b.append("tipo","undo_email_template_as_selecting_blueprints"),b.append("email_template_key",a),$.ajax({url:"/ar_edit_email_template.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){"200"==a.state?change_view(state.request,{reload_showcase:1}):"400"==a.state&&swal(a.msg)},error:function(){}})}function show_create_delivery(){$("#new_delivery").hasClass("hide")?("supplier.order.items"==state.tab?(grid.columns.findWhere({name:"operations"}).set("renderable",!0),grid.columns.findWhere({name:"state"}).set("renderable",!1),grid.columns.findWhere({name:"quantity_units"}).set("renderable",!0),grid.columns.findWhere({name:"quantity_skos"}).set("renderable",!0),grid.columns.findWhere({name:"quantity_cartons"}).set("renderable",!0)):change_tab("supplier.order.items",{create_delivery:1}),$(".submitted_items_qty").addClass("button"),$("#new_delivery").removeClass("hide"),$("#delivery_number").val("").focus(),validate_new_supplier_delivery()):close_create_delivery()}function close_create_delivery(){$("#tabs").removeClass("hide"),$("#new_delivery").addClass("hide"),$(".submitted_items_qty").removeClass("button"),grid.columns.findWhere({name:"checkbox"}).set("renderable",!1),grid.columns.findWhere({name:"operations"}).set("renderable",!1),grid.columns.findWhere({name:"delivery_quantity"}).set("renderable",!1)}function save_delivery_qty_change(a){}function change_on_delivery(a){$(a).hasClass("fa-square")?($(a).removeClass("fa-square").addClass("fa-check-square"),$(".delivery_quantity_"+$(a).attr("key")).css({visibility:"visible"}).addClass("on")):($(a).addClass("fa-square").removeClass("fa-check-square"),console.log($(a).attr("key")),$(".delivery_quantity_"+$(a).attr("key")).css({visibility:"hidden"}).removeClass("on"),$(a).closest("tr").find(".submitted_items_qty").trigger("click")),validate_new_supplier_delivery()}function quick_create_delivery(){var a=$("#object_showcase div.order").data("object");$("#delivery_number").val(a.purchase_order_number),$("#quick_create_delivery_operation").addClass("valid"),save_create_delivery("#quick_create_delivery_operation")}function save_create_delivery(a){if($(a).hasClass("valid")&&!$(a).hasClass("wait")){$(a).addClass("wait"),$(a).find("i").addClass("fa-spinner fa-spin fa-cloud").removeClass("fa-plus");var b=$("#object_showcase div.order").data("object"),c={};c["Supplier Delivery Public ID"]=$("#delivery_number").val(),c.items={},c.pending_items={},$(".order_units_qty").each(function(){1==$(this).closest("span").hasClass("on")?c.items[$(this).closest("span").data("settings").key]=$(this).val():c.pending_items[$(this).closest("span").data("settings").key]=$(this).val()});var d="/ar_edit.php?tipo=new_object&object=SupplierDelivery&parent="+b.object+"&parent_key="+b.key+"&fields_data="+JSON.stringify(c);console.log(d);var e=new FormData;e.append("tipo","new_object"),e.append("parent",b.object),e.append("parent_key",b.key),e.append("object","SupplierDelivery"),e.append("fields_data",JSON.stringify(c));var d=$.ajax({url:"/ar_edit.php",data:e,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(c){200==c.state?change_view(b.order_parent.toLowerCase()+"/"+b.order_parent_key+"/delivery/"+c.new_id,{tab:"supplier.delivery.items"}):400==c.state&&($(a).removeClass("wait"),$(a).find("i").removeClass("fa-spinner fa-spin fa-cloud").addClass("fa-plus"),console.log(c))}),d.fail(function(a,b){console.log(b),console.log(a.responseText)})}}function validate_new_supplier_delivery(){var a=!1,b="";if(""==$("#delivery_number").val())var c=!1;else var c=!0;$("#delivery_number").hasClass("error")&&(a=!0,b="invalid delivery number"),$(".order_units_qty").each(function(c,d){if($(d).hasClass("error"))return a=!0,b="Items with error",!1}),with_items=!1,$(".delivery_quantity_item_container").each(function(a,b){if($(b).hasClass("on"))return with_items=!0,!1}),console.log(a);var d=$("#new_delivery").find("td.buttons");a?(d.addClass("invalid changed").removeClass("valid"),d.find(".error_msg").html(b)):(d.find(".error_msg").html(""),d.removeClass("invalid"),c&&with_items?d.addClass("changed valid"):d.removeClass("changed valid"))}function create_delivery_item_icon_clicked(a){if(!$(a).hasClass("fa-exclamation-circle")){$(a).addClass("fa-spinner fa-spin");var b=$(a).closest("span").find("input");if($(a).hasClass("fa-plus")){var c="fa-plus";if(isNaN(b.val())||""==b.val())var d=1;else d=parseFloat(b.val())+1;b.val(d).addClass("discreet")}else if($(a).hasClass("fa-minus")){if(isNaN(b.val())||""==b.val()||0==b.val())var d=0;else d=parseFloat(b.val())-1;b.val(d).addClass("discreet");var c="fa-minus"}else{d=parseFloat(b.val());var c="fa-check-circle"}$(a).addClass(c),""==d&&(d=0),create_delivery_change_quantity(d,b)}}function use_submitted_qty_in_delivery(a,b){validate_signed_integer(b,4294967295)||($(a).closest("tr").find("i.plus").removeClass("fa-check-circle fa-exclamation-circle error").addClass("fa-plus"),$(a).closest("tr").find("i.minus").removeClass("invisible"),$(a).closest("tr").find("input.create_delivery_item_qty").removeClass("error"),$(a).closest("tr").find("input.order_units_qty").val(b),create_delivery_change_quantity(b,$(a).closest("tr").find("input.order_units_qty")))}function create_delivery_change_quantity(a,b){var c=$(b).closest("span").data("settings"),d=$(b).closest("tr");switch(console.log(c.type),c.type){case"Cartons":units_qty=c.unit_factor*a,skos_qty=c.sko_factor*a,cartons_qty=a,d.find("input.order_units_qty").val(units_qty),d.find("input.order_skos_qty").val(skos_qty);break;case"SKOs":units_qty=c.unit_factor*a,skos_qty=a,cartons_qty=a/c.carton_factor,d.find("input.order_units_qty").val(units_qty),d.find("input.order_cartons_qty").val(cartons_qty);break;case"Units":console.log(c.carton_factor),units_qty=a,skos_qty=a/c.sko_factor,cartons_qty=a/c.carton_factor,d.find("input.order_skos_qty").val(skos_qty),d.find("input.order_cartons_qty").val(cartons_qty)}console.log("----"),console.log(units_qty),console.log(skos_qty),console.log(cartons_qty),console.log("----"),console.log(units_qty%skos_qty),console.log(units_qty%cartons_qty),Number.isInteger(units_qty)&&Number.isInteger(skos_qty)?d.find(".create_delivery_item_qty").removeClass("error"):d.find(".create_delivery_item_qty").addClass("error"),$(b).removeClass("discreet"),$(b).closest("span").find("i.plus").removeClass("fa-check-circle fa-exclamation-circle error").addClass("fa-plus").removeClass("fa-spinner fa-spin"),$(b).closest("span").find("i.minus").removeClass("invisible").removeClass("fa-spinner fa-spin"),validate_new_supplier_delivery()}function set_po_transaction_amount_to_current_cost(a,b,c){$(a).addClass("fa-spin fa-spinner");var d=new FormData;d.append("tipo","set_po_transaction_amount_to_current_cost"),d.append("transaction_key",c),d.append("type",b);var e=$.ajax({url:"/ar_edit_orders.php",data:d,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(a){if(200==a.state){$(".po_amount_"+c).html(a.amount);for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b])}else 400==a.state&&console.log(a)}),e.fail(function(a,b){console.log(b),console.log(a.responseText)})}function show_item_po_note(a){$(a).addClass("hide");var b=$(a).closest("tr").find(".item_po_note");b.removeClass("hide"),b.find("textarea").removeClass("hide").focus(),b.find("i").removeClass("hide")}function save_po_note(a){var b=$(a).closest("tr").find(".item_po_note"),c=new FormData;c.append("tipo","update_po_item_note"),c.append("potf_key",b.data("potfk")),c.append("note",b.val());var d=$.ajax({url:"/ar_edit_orders.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(b){if(200==b.state){var c=$(a).closest("tr");c.find(".item_po_note_save").addClass("hide"),c.find(".item_po_note").addClass("hide"),""==b.note?(c.find(".item_po_note_new").removeClass("hide"),c.find(".item_po_note_display").addClass("hide").html("")):(c.find(".item_po_note_new").addClass("hide"),c.find(".item_po_note_display").removeClass("hide").html(b.note))}else 400==b.state&&console.log(b)}),d.fail(function(a,b){console.log(b),console.log(a.responseText)})}function cancel_purchase_order_submitted_item(a){$(element).addClass("fa-spin fa-spinner");var b=new FormData;b.append("tipo","cancel_purchase_order_submitted_item"),b.append("transaction_key",a);var c=$.ajax({url:"/ar_edit_orders.php",data:b,processData:!1,contentType:!1,type:"POST",dataType:"json"});c.done(function(a){if(200==a.state)for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);else 400==a.state&&console.log(a)}),c.fail(function(a,b){console.log(b),console.log(a.responseText)})}function set_placement_location(a){$(a).closest("tr").find(".location_code").val($(a).find(".code").html()),$(a).closest("tr").find("i.save").attr("location_key",$(a).attr("location_key")),validate_place_item($(a).closest("tr").find(".place_item"))}function delayed_on_change_place_qty_field(a,b){window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){on_change_place_qty_field(a)},b))}function on_change_place_qty_field(a){var b=a.attr("max");error=validate_number(a.val(),0,b),error||""!=a.val()&&0!=a.val()||(error={"class":"invalid",type:"empty"}),console.log(error),error?a.addClass(error["class"]):a.removeClass("invalid"),validate_place_item(a.closest(".place_item"))}function delayed_on_change_location_code_field(a,b){window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_placement_locations_select(a)},b))}function get_placement_locations_select(a){a.removeClass("invalid");var b="/ar_find.php?tipo=find_objects&query="+fixedEncodeURIComponent(a.val())+"&scope=locations&state="+JSON.stringify(state);console.log(b),$.getJSON(b,function(b){var c=a.offset();b.number_results>0?($("#location_results_container").removeClass("hide").addClass("show"),$("#location_results_container").offset({top:c.top+a.outerHeight()-1,left:c.left})):($("#location_results_container").addClass("hide").removeClass("show"),""!=a.val()&&a.addClass("invalid")),$("#location_results .result").remove();var d=!0;for(var e in b.results){var f=$("#location_search_result_template").clone();f.prop("id","location_result_"+e),f.addClass("result").removeClass("hide"),f.attr("value",b.results[e].value),f.attr("transaction_key",a.closest(".place_item").attr("transaction_key")),f.attr("formatted_value",b.results[e].formatted_value),d&&(f.addClass("selected"),d=!1),f.children(".label").html(b.results[e].description),$("#location_results").append(f)}})}function select_location_option(a){var b=$("#place_item_"+$(a).attr("transaction_key"));b.find(".location_code").val($(a).attr("formatted_value")),b.find("i.save").attr("location_key",$(a).attr("value")),$("#location_results_container").addClass("hide").removeClass("show"),validate_place_item(b)}function validate_place_item(a){$(a).find(".place_qty").hasClass("invalid")||$(a).find(".location_code").hasClass("invalid")?$(a).addClass("invalid changed"):($(a).removeClass("invalid changed"),$(a).find("i.save").attr("location_key")>0&&$(a).addClass("changed valid"))}function place_item(a){$(a).removeClass("fa-cloud").addClass("fa-spinner fa-spin");var b=$("#object_showcase div.order").data("object"),c=b.object,d=b.key,e=$(a).closest(".place_item").attr("part_sku"),f=$(a).closest(".place_item").attr("transaction_key"),g=$(a).attr("location_key"),h=$(a).closest(".place_item").find(".place_qty").val(),i=$(a).closest("tr").find(".note").val(),j="/ar_edit_stock.php?tipo=place_part&object="+c+"&key="+d+"&transaction_key="+f+"&part_sku="+e+"&location_key="+g+"&qty="+h+"&note="+i;console.log(j);var k=new FormData;k.append("tipo","place_part"),k.append("object",c),k.append("key",d),k.append("transaction_key",f),k.append("part_sku",e),k.append("location_key",g),k.append("qty",h),k.append("note",i);var j=$.ajax({url:"/ar_edit_stock.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(b){var c=$("#table").data("metadata");console.log(b),$(a).addClass("fa-cloud").removeClass("fa-spinner fa-spin");var d=$("#place_item_"+f),e=d.closest("tr");e.find(".placement").html(b.update_metadata.placement),e.find(".part_locations").html(b.part_locations),e.find(".place_qty").val(b.place_qty),e.find(".place_qty").attr("ovalue",b.place_qty),e.find(".place_qty").attr("max",b.place_qty),$(".order_operation").addClass("hide"),$(".items_operation").addClass("hide");for(var g in b.update_metadata.operations)console.log(b.update_metadata.operations[g]),$("#"+b.update_metadata.operations[g]).removeClass("hide");$(".timeline .li").removeClass("complete"),$("#order_node").addClass("complete"),$("#order_dispatched_node").addClass("complete"),$("#inputted_node").addClass("complete"),$("#purchase_order_node").addClass("complete"),b.update_metadata.state_index>=30&&$("#dispatched_node").addClass("complete"),b.update_metadata.state_index>=40&&$("#received_node").addClass("complete"),b.update_metadata.state_index>=50&&$("#checked_node").addClass("complete"),b.update_metadata.state_index>=100&&$("#placed_node").addClass("complete"),console.log(c.type),console.log(b.update_metadata.state_index),"return"==c.type?b.update_metadata.state_index>=100&&($("div[id='tab_return']").addClass("hide"),$("div[id='tab_return.items_done']").removeClass("hide"),change_tab("return.items_done")):100==b.update_metadata.state_index&&"supplier.delivery.items"==state.tab&&change_tab("supplier.delivery.items"),"Yes"==b.placed?d.addClass("hide"):d.removeClass("hide");for(var g in b.update_metadata.class_html)$("."+g).html(b.update_metadata.class_html[g]);for(var g in b.updated_fields)$("."+g).html(b.updated_fields[g])}),j.fail(function(a,b){})}function show_part_locations(a){var b=$(a).closest("tr").find(".part_locations");b.hasClass("hide")?(b.removeClass("hide"),$(a).prop("title",b.attr("hide_title")).removeClass("discreet")):(b.addClass("hide"),$(a).prop("title",b.attr("show_title")).addClass("discreet"))}function open_edit_stock(){$(".part_stock_value_info").addClass("hide"),process_edit_stock(),$(".unlink_operations").removeClass("hide"),$("#stock_table").addClass("super_discreet"),$("#close_edit_stock").removeClass("hide"),$("#edit_stock_saving_buttons").removeClass("hide"),$("#open_edit_stock").addClass("hide"),$("#locations_table .formatted_stock").addClass("hide"),$("#locations_table .stock_input").removeClass("hide"),$("#add_location_tr").removeClass("hide")}function close_edit_stock(){$(".part_stock_value_info").removeClass("hide"),$("#move_stock_tr").hasClass("hide")||close_move(),$(".unlink_operations").addClass("hide"),$("#stock_table").removeClass("super_discreet"),$("#close_edit_stock").addClass("hide"),$("#edit_stock_saving_buttons").addClass("hide"),$("#open_edit_stock").removeClass("hide"),$("#locations_table .formatted_stock").removeClass("hide"),$("#locations_table .stock_input").addClass("hide"),$("#add_location_tr").addClass("hide"),$("#locations_table  input.stock ").each(function(a,b){$(b).val($(b).attr("ovalue")),stock_changed($(b))})}function process_edit_stock(){var a=0,b=0,c=0,d=!1,e=0,f=0,g=0,h=0;$("#locations_table  input.stock ").each(function(i,j){var k=!0,l=!0;$(j).closest("tr").find(".set_as_audit").hasClass("super_discreet")||(e++,k=!1,l=!1),$(j).closest("tr").find(".unlink_operations i").hasClass("fa-unlink")||(f++,k=!1,l=!1),$(j).closest("tr").hasClass("invalid")&&(d=!0,k=!1,l=!1),0!=$(j).val()&&""!=$(j).val()||(k=!1);var m=$(j).val(),n=$(j).attr("ovalue");""==m&&(m=0),""==n&&(n=0),m=parseFloat(m),n=parseFloat(n);var o=m-n;o>0?b+=o:c+=o,a+=m,k&&g++,l?(h++,$("#move_stock_tr").hasClass("hide")&&($(j).closest("tr").find("input.stock").val()<=0?$(j).closest("tr").find(".move_trigger").addClass("invisible"):$(j).closest("tr").find(".move_trigger").removeClass("invisible"))):$(j).closest("tr").find(".move_trigger").addClass("invisible")});var i="";h<2&&$(".move_trigger").addClass("invisible"),1==f?i='<i class="fa fa-unlink" aria-hidden="true"></i> ':f>1&&(i=f+'<i class="fa fa-unlink" aria-hidden="true"></i>'),1==e?i+=' <i class="far fa-dot-circle" aria-hidden="true"></i> ':e>1&&(i+=e+' <i class="far fa-dot-circle" aria-hidden="true"></i>'),0!=c&&(i+=" ("+c.toFixed(2).replace(/[.,]00$/,"")+") "),0!=b&&(i+=" (+"+b.toFixed(2).replace(/[.,]00$/,"")+") "),$("#new_stock").html(a),$("#stock_diff").html(i),d?$("#edit_stock_saving_buttons").removeClass("valid changed").addClass("invalid"):($("#edit_stock_saving_buttons").removeClass("invalid"),0!=c||0!=b||e>0||f>0?$("#edit_stock_saving_buttons").addClass("valid changed"):$("#edit_stock_saving_buttons").removeClass("valid changed"))}function open_add_location(){$("#add_location_label").hasClass("hide")?close_add_location():($("#add_location_label").addClass("hide"),$("#add_location").removeClass("hide").focus(),$("#save_add_location").removeClass("hide"))}function close_add_location(){$("#add_location_label").removeClass("hide"),$("#add_location").addClass("hide").val(""),$("#save_add_location").addClass("hide")}function save_stock(a){if($("#edit_stock_saving_buttons").hasClass("valid")){$("#inventory_transaction_note").addClass("hide"),$(a).removeClass("fa-cloud").addClass("fa-spinner fa-spin ");var b=$(a),c=[];if($("#locations_table tr.locations input.stock ").each(function(a,b){c.push({qty:$(b).val(),location_key:$(b).attr("location_key"),part_sku:$("#locations_table").attr("part_sku"),audit:!$(b).closest("tr").find(".set_as_audit").hasClass("super_discreet"),disassociate:!$(b).closest("tr").find(".unlink_operations i").hasClass("fa-unlink"),note:$(b).closest("tr").find(".note").val()})}),movements)var d=movements;else var d={};var e="/ar_edit_stock.php?tipo=edit_stock&object=part&key="+$("#locations_table").attr("part_sku")+"&parts_locations_data="+JSON.stringify(c)+"&movements="+JSON.stringify(d),f=new FormData;f.append("tipo","edit_stock"),f.append("object","part"),f.append("key",$("#locations_table").attr("part_sku")),f.append("parts_locations_data",JSON.stringify(c)),f.append("movements",JSON.stringify(d));var e=$.ajax({url:"/ar_edit_stock.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(a){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab||rows.fetch({reset:!0}),b.addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#edit_stock_saving_buttons").removeClass("valid"),close_edit_stock();for(var c in a.updated_fields)$("."+c).html(a.updated_fields[c]);0!=a.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),$("#Part_Unknown_Location_Stock").attr("qty",a.Part_Unknown_Location_Stock),"part.locations"==state.tab&&rows.fetch({reset:!0})}),e.fail(function(a,b){})}}function show_dialog_consolidate_unknown_location(a){part_sku=$(a).attr("part_sku"),qty=$(a).attr("qty"),console.log($(a).offset().top),$("#edit_stock_dialog_consolidate_unknown_location").removeClass("hide").offset({top:$(a).offset().top-3,left:$(a).offset().left+$(a).width()-$("#edit_stock_dialog_consolidate_unknown_location").width()-20}).attr("part_sku",part_sku).attr("max_qty",qty),$("#edit_stock_dialog_consolidate_unknown_location").attr("factor",qty>0?1:-1),$("#part_leakage_qty_input").val(Math.abs(qty)),$("#part_leakage_note_input").val(""),$("#unknown_location_save_buttons td").addClass("super_discreet").removeClass("button"),qty>0?($("#unknown_location_save_buttons .label").removeClass("hide"),$("#unknown_location_save_buttons .lost_error").removeClass("hide"),$("#unknown_location_save_buttons .found_error").addClass("hide")):($("#unknown_location_save_buttons .label").addClass("hide"),$("#unknown_location_save_buttons .label._error").removeClass("hide"),$("#unknown_location_save_buttons .lost_error").addClass("hide"),$("#unknown_location_save_buttons .found_error").removeClass("hide"))}function open_sent_part_to_production(a){$("#edit_stock_dialog_to_production").removeClass("hide").offset({top:$(a).offset().top-3,left:$(a).offset().left-$("#edit_stock_dialog_to_production").width()}).attr("max",$(a).attr("max")).find(".max").html($(a).attr("max")),$("#edit_stock_dialog_to_production").attr("location_key",$(a).attr("location_key"))}function validate_part_to_production(){var a=!1;max=$("#edit_stock_dialog_to_production").attr("max");var b=validate_number($("#part_to_production_qty_input").val(),0,Math.abs(max));b?(a=!0,$("#part_to_production_qty_input").addClass("error")):$("#part_to_production_qty_input").removeClass("error"),""==$("#part_to_production_note_input").val()?(a=!0,$("#part_to_production_note_input").addClass("error")):$("#part_to_production_note_input").removeClass("error"),$("#edit_stock_dialog_to_production .save").addClass("changed"),a?$("#edit_stock_dialog_to_production .save").addClass("invalid").removeClass("valid"):$("#edit_stock_dialog_to_production .save").removeClass("invalid").addClass("valid")}function validate_part_leakage(){var a=!1;max=$("#edit_stock_dialog_consolidate_unknown_location").attr("max_qty");var b=validate_number($("#part_leakage_qty_input").val(),0,Math.abs(max));console.log(b),b?(a=!0,$("#part_leakage_qty_input").addClass("error")):$("#part_leakage_qty_input").removeClass("error"),""==$("#part_leakage_note_input").val()?(a=!0,$("#part_leakage_note_input").addClass("error")):$("#part_leakage_note_input").removeClass("error"),a?$("#unknown_location_save_buttons td").addClass("super_discreet").removeClass("button"):$("#unknown_location_save_buttons td").removeClass("super_discreet").addClass("button")}function save_stock_dialog_to_production(a){if($(a).hasClass("valid")&&!$(a).hasClass("wait")){$(a).addClass("wait"),$(a).find("i").addClass("fa-spinner fa-spin");var b="/ar_edit_stock.php?tipo=send_to_production&part_sku="+$("#locations_table").attr("part_sku")+"&qty="+$("#part_to_production_qty_input").val()+"&note="+$("#part_to_production_note_input").val()+"&location_key="+$("#edit_stock_dialog_to_production").attr("location_key");console.log(b);var c=new FormData;c.append("tipo","send_to_production"),c.append("part_sku",$("#locations_table").attr("part_sku")),c.append("qty",$("#part_to_production_qty_input").val()),c.append("note",$("#part_to_production_note_input").val()),c.append("location_key",$("#edit_stock_dialog_to_production").attr("location_key"));var b=$.ajax({url:"/ar_edit_stock.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});b.done(function(b){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab||rows.fetch({reset:!0}),$("#edit_stock_dialog_to_production").addClass("hide"),$(a).removeClass("wait"),$(a).find("i").removeClass("fa-spinner fa-spin");for(var c in b.updated_fields)$("."+c).html(b.updated_fields[c]);0!=b.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),"part.locations"==state.tab&&rows.fetch({reset:!0})}),b.fail(function(a,b){})}}function save_leakage(a){if(!$(a).hasClass("super_discreet")&&!$(a).hasClass("wait")){$("#unknown_location_save_buttons td").addClass("super_discreet"),$(a).addClass("wait").removeClass("super_discreet").find("span.label").addClass("hide"),$(a).find("i").removeClass("hide");var b="/ar_edit_stock.php?tipo=edit_leakages&part_sku="+$("#locations_table").attr("part_sku")+"&qty="+$("#part_leakage_qty_input").val()*$("#edit_stock_dialog_consolidate_unknown_location").attr("factor")+"&note="+$("#part_leakage_note_input").val()+"&type="+$(a).attr("type");console.log(b);var c=new FormData;c.append("tipo","edit_leakages"),c.append("part_sku",$("#locations_table").attr("part_sku")),c.append("warehouse_key",$("#locations_table").attr("part_sku")),c.append("qty",$("#part_leakage_qty_input").val()*$("#edit_stock_dialog_consolidate_unknown_location").attr("factor")),c.append("note",$("#part_leakage_note_input").val()),c.append("type",$(a).attr("type"));var b=$.ajax({url:"/ar_edit_stock.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});b.done(function(a){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab||rows.fetch({reset:!0}),$("#edit_stock_dialog_consolidate_unknown_location").addClass("hide"),$("#unknown_location_save_buttons i").addClass("hide"),$("#unknown_location_save_buttons span.label").removeClass("hide"),$("#edit_stock_saving_buttons").removeClass("valid"),close_edit_stock();for(var b in a.updated_fields)$("."+b).html(a.updated_fields[b]);0!=a.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),"part.locations"==state.tab&&rows.fetch({reset:!0})}),b.fail(function(a,b){})}}function open_edit_min_max(a){console.log($(a).offset()),location_key=$(a).attr("location_key"),min=$(a).attr("min"),max=$(a).attr("max"),$("#edit_stock_min_max").removeClass("hide").offset({top:$(a).offset().top-3,left:$(a).offset().left}).attr("location_key",location_key),$("#edit_stock_min_max").find(".recommended_min").val(min).attr("ovalue",min),$("#edit_stock_min_max").find(".recommended_max").val(max).attr("ovalue",max)}function open_edit_recommended_move(a){location_key=$(a).attr("location_key"),recommended_move=$(a).attr("recommended_move"),console.log("caca"),$("#edit_recommended_move").removeClass("hide").offset({top:$(a).offset().top-3,left:$(a).offset().left}).attr("location_key",location_key),$("#edit_recommended_move").find(".recommended_move").val(recommended_move).attr("ovalue",recommended_move)}function close_edit_recommended_move(a){var b=$("#edit_recommended_move").find(".recommended_move").removeClass("valid invalid");b.val(b.attr("ovalue")),$("#edit_recommended_move").removeClass("valid invalid").addClass("hide")}function close_edit_min_max(a){var b=$("#edit_stock_min_max").find(".recommended_min").removeClass("valid invalid");b.val(b.attr("ovalue"));var c=$("#edit_stock_min_max").find(".recommended_max").removeClass("valid invalid");c.val(c.attr("ovalue")),$("#edit_stock_min_max").removeClass("valid invalid").addClass("hide")}function min_max_changed(a){var b=$("#edit_stock_min_max").find(".recommended_min"),c=$("#edit_stock_min_max").find(".recommended_max"),d=client_validation("smallint_unsigned",!1,b.val(),""),e=client_validation("smallint_unsigned",!1,c.val(),"");""!=b.val()&&""!=c.val()&&"valid"==d["class"]&&"valid"==e["class"]&&parseFloat(b.val())>parseFloat(c.val())&&(d["class"]="invalid",e["class"]="invalid"),"invalid"==d["class"]||"invalid"==e["class"]?validation="invalid":validation="valid",
b.removeClass("valid invalid").addClass(d["class"]),c.removeClass("valid invalid").addClass(e["class"]),$("#edit_stock_min_max").removeClass("valid invalid").addClass(validation).addClass("changed")}function recommended_move_changed(a){var b=$("#edit_recommended_move").find(".recommended_move"),c=client_validation("smallint_unsigned",!1,b.val(),"");b.removeClass("valid invalid").addClass(c["class"]),$("#edit_recommended_move").removeClass("valid invalid").addClass(c["class"]).addClass("changed")}function save_recommendations(a,b){if("min_max"==a){if(!$("#edit_stock_min_max").hasClass("valid"))return;$("#edit_stock_min_max").find(".save").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var c=$("#edit_stock_min_max").find(".recommended_min").val(),d=$("#edit_stock_min_max").find(".recommended_max").val(),e=$("#edit_stock_min_max").attr("location_key"),f=JSON.stringify({min:c,max:d}),g="Part_Location_min_max"}else{if(!$("#edit_recommended_move").hasClass("valid"))return;$("#edit_recommended_move").find(".save").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var f=$("#edit_recommended_move").find(".recommended_move").val(),e=$("#edit_recommended_move").attr("location_key"),g="Part_Location_Moving_Quantity"}var h="/ar_edit.php?tipo=edit_field&object=part_location&key="+$("#locations_table").attr("part_sku")+"_"+e+"&field="+g+"&value="+fixedEncodeURIComponent(f);console.log(h);var i=new FormData;i.append("tipo","edit_field"),i.append("object","part_location"),i.append("key",$("#locations_table").attr("part_sku")+"_"+e),i.append("field",g),i.append("value",f);var h=$.ajax({url:"/ar_edit.php",data:i,processData:!1,contentType:!1,type:"POST",dataType:"json"});h.done(function(c){200==c.state&&("min_max"==a?($("#part_location_edit_"+e).find(".open_edit_min_max").attr("min",c.value[0]),$("#part_location_edit_"+e).find(".open_edit_min_max").attr("max",c.value[1]),$("#part_location_edit_"+e).find(".formatted_recommended_min").html(c.formatted_value[0]),$("#part_location_edit_"+e).find(".formatted_recommended_max").html(c.formatted_value[1]),$("#edit_stock_min_max").find(".save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#edit_stock_min_max").find(".recommended_min").val(c.value[0]).attr("ovalue",c.value[0]),$("#edit_stock_min_max").find(".recommended_max").val(c.value[1]).attr("ovalue",c.value[1]),close_edit_min_max()):($("#edit_recommended_move").find(".save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#part_location_edit_"+e).find(".recommended_move").val(c.value).attr("ovalue",c.value),$("#part_location_edit_"+e).find(".formatted_recommended_move").html(c.formatted_value),close_edit_recommended_move($(b).closest("tr").find(".close_move"))))}),h.fail(function(a,b){})}function inventory_transaction_note_changed(){var a=$("#inventory_transaction_note").data("element"),b=$("#inventory_transaction_note").find("textarea");$(a).closest("tr").find(".note").val($(b).val()),""==$(b).val()?$(a).closest("tr").find(".add_note").addClass("fa-sticky-note").removeClass("fa-sticky-note"):$(a).closest("tr").find(".add_note").removeClass("fa-sticky-note").addClass("fa-sticky-note")}function set_inventory_transaction_note(a){if($("#inventory_transaction_note").find("textarea").val($(a).closest("tr").find(".note").val()),$(a).uniqueId(),console.log($(a).attr("id")),$("#inventory_transaction_note").hasClass("hide")||$(a).attr("id")!=$("#inventory_transaction_note").data("id")){$("#inventory_transaction_note").data({element:$(a),id:$(a).attr("id")}),$("#inventory_transaction_note").removeClass("hide");var b=$(a).closest("tr").find(".stock").offset();$("#inventory_transaction_note").css({left:b.left-$("#inventory_transaction_note").width(),top:b.top}),$("#inventory_transaction_note").find("textarea").focus()}else $("#inventory_transaction_note").addClass("hide")}function set_as_picking_location(a,b){var c="/ar_edit_stock.php?tipo=set_as_picking_location&part_sku="+a+"&location_key="+b;$.getJSON(c,function(a){if(200==a.state){for(i in a.part_locations_data){console.log(a.part_locations_data[i]);var b=$("#part_location_edit_"+a.part_locations_data[i].location_key),c=b.find(".picking_location_icon i");"Yes"==a.part_locations_data[i].can_pick?(c.removeClass("super_discreet_on_hover button").attr("title",a.part_locations_data[i].label),b.find(".open_edit_min_max").removeClass("hide"),b.find(".open_edit_recommended_move").addClass("hide")):(c.addClass("super_discreet_on_hover button").attr("title",a.part_locations_data[i].label),b.find(".open_edit_min_max").addClass("hide"),b.find(".open_edit_recommended_move").removeClass("hide"))}"part.locations"==state.tab&&rows.fetch({reset:!0})}})}function set_part_location_note_bis(a){var a=$(a),b=a.offset();$("#set_part_location_note_bis").removeClass("hide").attr("key",a.attr("key")).offset({top:b.top-7.5,left:b.left+a.width()-$("#set_part_location_note_bis").width()-20}).data("element",a).find("textarea").val(a.closest("span").find(".picking_location_note_value").html())}function close_part_location_notes_bis(a){$("#set_part_location_note_bis").addClass("hide")}function save_part_location_notes_bis(){if($("#set_part_location_note_bis").find("i.save").hasClass("valid")){$("#set_part_location_note_bis").find("i.save").addClass("fa-spinner fa-spin").removeClass("valid changed");var a="/ar_edit_stock.php?tipo=edit_part_location_note&part_location_code="+$("#set_part_location_note_bis").attr("key")+"&note="+$("#set_part_location_note_bis").find("textarea").val();$.getJSON(a,function(a){close_part_location_notes_bis(),console.log(a),$("#set_part_location_note_bis").find("i.save").removeClass("fa-spinner fa-spin"),element=$("#set_part_location_note_bis").data("element"),element.closest("span").find(".picking_location_note_value").html(a.value),""==a.value?element.addClass("super_discreet_on_hover far").removeClass("fas"):element.addClass("fas").removeClass("super_discreet_on_hover far"),"part.locations"==state.tab&&rows.fetch({reset:!0})})}}function process_part_locations_changed(){var a=0;$("#locations_table  locations").each(function(a,b){});var b="";editable_locations<2&&$(".move_trigger").addClass("invisible"),1==a?b='<i class="fa fa-unlink" aria-hidden="true"></i> ':a>1&&(b=a+'<i class="fa fa-unlink" aria-hidden="true"></i>'),1==set_as_audit?b+=' <i class="far fa-dot-circle" aria-hidden="true"></i> ':set_as_audit>1&&(b+=set_as_audit+' <i class="far fa-dot-circle" aria-hidden="true"></i>'),0!=diff_down&&(b+=" ("+diff_down.toFixed(2).replace(/[.,]00$/,"")+") "),0!=diff_up&&(b+=" (+"+diff_up.toFixed(2).replace(/[.,]00$/,"")+") "),$("#new_stock").html(total_new_stock),$("#stock_diff").html(b),has_invalid?$("#edit_stock_saving_buttons").removeClass("valid changed").addClass("invalid"):($("#edit_stock_saving_buttons").removeClass("invalid"),0!=diff_down||0!=diff_up||set_as_audit>0||a>0?$("#edit_stock_saving_buttons").addClass("valid changed"):$("#edit_stock_saving_buttons").removeClass("valid changed"))}function open_part_edit_locations(){$(".Part_Cost_in_Warehouse_info_set_up").addClass("invisible"),$(".edit_stock_close_button").removeClass("hide"),$(".showcase_component").addClass("super_discreet"),process_edit_stock(),open_add_location(),$(".location_to_be_disassociated_icon").removeClass("hide"),$(".location_code").removeClass("link"),$(".undo_unlink_operations").removeClass("hide"),$(".picking_location_note").addClass("hide"),$(".last_audit_days").addClass("hide"),$(".set_as_audit").addClass("hide"),$(".recommendations").addClass("hide"),$(".picking_location_icon").addClass("hide"),$(".disassociate_info").removeClass("hide"),$("input.stock").addClass("hide"),$("#locations_table .formatted_stock").addClass("hide"),$("#locations_table .stock_input").removeClass("hide"),$("#add_location_tr").removeClass("hide"),$(".edit_stock_open_button").addClass("hide"),$(".part_locations_edit_locations_button").removeClass("hide")}function close_part_location_edit(){var a=new FormData;a.append("tipo","get_part_locations_html"),a.append("part_sku",$("#locations_table").attr("part_sku"));var b=$.ajax({url:"/ar_edit_stock.php",data:a,processData:!1,contentType:!1,type:"POST",dataType:"json"});b.done(function(a){$("#part_locations").html(a.part_locations),$("#add_location_tr").addClass("hide"),$(".edit_stock_open_button").removeClass("hide"),$(".edit_stock_close_button").addClass("hide"),$(".edit_stock_save_button").addClass("hide"),$(".Part_Cost_in_Warehouse_info_set_up").removeClass("invisible"),$(".showcase_component").removeClass("super_discreet")}),b.fail(function(a,b){})}function disassociate_location(a){if(!$(a).hasClass("fa")){var b=$(a).closest("tr");$(a).removeClass("very_discreet_on_hover fal").addClass("fa"),b.find(".location_to_be_disassociated_icon").removeClass("hide"),b.find(".disassociate_warning").removeClass("hide"),b.find(".disassociate_info").addClass("hide"),b.find(".location_code").addClass("strikethrough"),b.find(".add_note").removeClass("invisible"),b.find(".stock_change").html("("+-1*b.find(".stock").val()+")"),b.find(".undo_unlink_operations i").removeClass("hide"),part_locations_edit_locations_look_for_changes()}}function undo_disassociate_location(a){var b=$(a).closest("tr");b.find(".location_to_be_disassociated_icon").addClass("very_discreet_on_hover fal").removeClass("fa"),b.find(".disassociate_warning").addClass("hide"),b.find(".disassociate_info").removeClass("hide"),b.find(".location_code").removeClass("strikethrough"),b.find(".add_note").addClass("invisible"),b.find(".stock_change").html(""),b.find(".undo_unlink_operations i").addClass("hide"),part_locations_edit_locations_look_for_changes()}function open_add_location(){$("#add_location_label").hasClass("hide")?close_add_location():($("#add_location_label").addClass("hide"),$("#add_location").removeClass("hide").focus(),$("#save_add_location").removeClass("hide"))}function close_add_location(){$("#add_location_label").removeClass("hide"),$("#add_location").addClass("hide").val(""),$("#save_add_location").addClass("hide")}function delayed_on_change_add_location_field(a,b){window.clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){get_locations_select()},b))}function get_locations_select(){$("#add_location_tr").removeClass("invalid");var a="/ar_find.php?tipo=find_objects&query="+fixedEncodeURIComponent($("#add_location").val())+"&scope=locations&state="+JSON.stringify(state);$.getJSON(a,function(a){a.number_results>0?$("#add_location_results_container").removeClass("hide").addClass("show"):($("#add_location_results_container").addClass("hide").removeClass("show"),""!=$("#add_location").val()&&$("#add_location_tr").addClass("invalid")),$("#add_location_results .result").remove();var b=!0;for(var c in a.results){var d=$("#add_location_search_result_template").clone();d.prop("id","add_location_result_"+c),d.addClass("result").removeClass("hide"),d.attr("value",a.results[c].value),d.attr("formatted_value",a.results[c].formatted_value),b&&(d.addClass("selected"),b=!1),d.children(".label").html(a.results[c].description),$("#add_location_results").append(d)}})}function select_add_location_option(a){var b=$("#add_location_template").clone().removeClass("hide").addClass("locations").attr("id","part_location_edit_"+$(a).attr("value")).attr("location_key",$(a).attr("value"));b.find(".location_code").html($(a).attr("formatted_value")),b.find(".unlink_operations").html('<i class="fal fa-fw button fa-trash-alt" onclick="remove_new_associated_location(this)" ></i>'),b.find(".location_to_be_associated_icon").removeClass("hide").data("location_key",$(a).attr("value")),b.find(".move_trigger").addClass("hide"),$("#part_locations").append(b),$("#add_location").val(""),$("#add_location_results_container").addClass("hide").removeClass("show"),part_locations_edit_locations_look_for_changes()}function delete_new_associated_location(a){$(a).closest("tr").remove()}function part_locations_edit_locations_look_for_changes(){locations_changes=get_part_locations_edit_get_modified_locations(),0==locations_changes.to_add.length&&0==locations_changes.to_remove.length?$(".part_locations_edit_locations_button").removeClass("changed valid"):($(".part_locations_edit_locations_button").addClass("changed valid"),locations_changes.to_add.length>0&&locations_changes.to_remove.length>0?$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").save_changes):locations_changes.to_add.length>0?1==locations_changes.to_add.length?$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").add_location):$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").add_locations):locations_changes.to_remove.length>0&&(1==locations_changes.to_remove.length?$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").remove_location):$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").remove_locations)))}function get_part_locations_edit_get_modified_locations(){return locations_to_add=[],locations_to_remove=[],$(".locations  .location_to_be_disassociated_icon.fa").each(function(a,b){console.log($(b).data("location_key")),locations_to_remove.push($(b).data("location_key"))}),$(".locations  .location_to_be_associated_icon").each(function(a,b){locations_to_add.push($(b).data("location_key"))}),{to_add:locations_to_add,to_remove:locations_to_remove}}function save_part_locations_edit_locations(a){if($(a).hasClass("valid")){var b=$(a).find("i");b.removeClass("fa-cloud").addClass("fa-spinner fa-spin "),locations_to_add=[],locations_to_remove=[],$(".locations  .location_to_be_disassociated_icon.fa").each(function(a,b){console.log($(b).data("location_key")),locations_to_remove.push($(b).data("location_key"))}),$(".locations  .location_to_be_associated_icon").each(function(a,b){locations_to_add.push($(b).data("location_key"))});var c=new FormData;c.append("tipo","edit_part_linked_locations"),c.append("part_sku",$("#locations_table").attr("part_sku")),c.append("locations_to_add",JSON.stringify(locations_to_add)),c.append("locations_to_remove",JSON.stringify(locations_to_remove));var d=$.ajax({url:"/ar_edit_stock.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(a){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab&&"part.locations"!=state.tab||rows.fetch({reset:!0}),$("#part_locations").html(a.part_locations),$("#add_location_tr").addClass("hide"),$(".edit_stock_open_button").removeClass("hide"),$(".edit_stock_close_button").addClass("hide"),$(".part_locations_edit_locations_button").addClass("hide"),$("#stock_table").removeClass("super_discreet");for(var c in a.updated_fields)$("."+c).html(a.updated_fields[c]);0!=a.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),$("#Part_Unknown_Location_Stock").attr("qty",a.Part_Unknown_Location_Stock),$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").no_change),$(".part_locations_edit_locations_button").removeClass("changed valid"),b.addClass("fa-cloud").removeClass("fa-spinner fa-spin ")}),d.fail(function(a,b){})}}function open_part_stock_check(){$(".Part_Cost_in_Warehouse_info_set_up").addClass("invisible"),$(".edit_stock_close_button").removeClass("hide"),$(".showcase_component").addClass("super_discreet"),process_edit_stock(),$(".location_to_be_disassociated_icon").addClass("hide"),$(".location_code").removeClass("link"),$(".undo_unlink_operations").css("width","0px"),$(".picking_location_note").addClass("hide"),$(".move_trigger").addClass("hide"),$(".recommendations").addClass("hide"),$(".picking_location_icon").addClass("hide"),$("input.stock").removeClass("hide"),$("#locations_table .formatted_stock").addClass("hide"),$("#locations_table .stock_input").removeClass("hide"),$(".edit_stock_open_button").addClass("hide"),$(".part_locations_stock_check_button").removeClass("hide")}function set_as_audit(a){$(a).hasClass("super_discreet_on_hover")?($(a).removeClass("super_discreet_on_hover"),$(a).closest("tr").find("input").prop("readonly",!0),$(a).closest("tr").find(".add_note").removeClass("invisible").addClass("visible")):($(a).addClass("super_discreet_on_hover"),$(a).closest("tr").find("input").prop("readonly",!1),$(a).closest("tr").find(".add_note").addClass("invisible").removeClass("visible")),process_edit_stock(),part_locations_stock_check_look_for_changes()}function stock_field_changed(a){stock_changed(a),process_edit_stock(),part_locations_stock_check_look_for_changes()}function stock_changed(a){var b=a.val();""==b&&(b=0);var c=validate_number(b,0,999999999);if(c||(c={"class":"valid",type:"valid"}),a.closest("tr").removeClass("valid invalid").addClass(c["class"]),a.attr("ovalue")!=b)if("invalid"==c["class"])a.closest("tr").find(".stock_change").html(""),a.closest("tr").find(".set_as_audit").addClass("super_discreet_on_hover").addClass("hide");else{var d=parseFloat(b)-parseFloat(""==a.attr("ovalue")?0:a.attr("ovalue")),e=d.toFixed(2).replace(/[.,]00$/,"");d>0&&(e="+"+e);var f="("+e+")";a.closest("tr").find(".stock_change").html(f),a.closest("tr").find(".set_as_audit").addClass("super_discreet_on_hover").addClass("hide"),a.closest("tr").find(".add_note").removeClass("super_discreet invisible").addClass("visible")}else a.closest("tr").find(".stock_change").html(""),a.closest("tr").find(".set_as_audit").removeClass("hide"),a.closest("tr").find(".add_note").addClass("very_discreet_on_hover invisible").removeClass("visible")}function get_part_locations_edit_get_modified_stock_check_locations(){return locations_to_confirm_stock=[],locations_to_update_stock=[],$(".locations  .set_as_audit:not(.super_discreet_on_hover)").each(function(a,b){locations_to_confirm_stock.push($(b).closest("tr").attr("location_key"))}),$(".locations  input.stock").each(function(a,b){$(b).attr("ovalue")!=$(b).val()&&locations_to_update_stock.push($(b).closest("tr").attr("location_key"))}),{to_confirm:locations_to_confirm_stock,to_update:locations_to_update_stock}}function part_locations_stock_check_look_for_changes(){var a=get_part_locations_edit_get_modified_stock_check_locations();0==a.to_confirm.length&&0==a.to_update.length?$(".part_locations_stock_check_button").removeClass("changed valid"):($(".part_locations_stock_check_button").addClass("changed valid"),$(".part_locations_stock_check_button span").html($(".part_locations_stock_check_button span").data("labels").save_changes))}function save_part_locations_stock_check(a){if($(a).hasClass("valid")){var b=$(a).find("i");b.removeClass("fa-cloud").addClass("fa-spinner fa-spin ");var c=[];$(".locations  input.stock").each(function(a,b){$(b).attr("ovalue")!=$(b).val()?c.push({location_key:$(b).closest("tr").attr("location_key"),stock:$(b).val(),note:$(b).closest("tr").find(".add_note").data("note"),stock_confirm:!1}):$(b).closest("tr").find(".set_as_audit").hasClass("super_discreet_on_hover")||c.push({location_key:$(b).closest("tr").attr("location_key"),stock:$(b).val(),note:$(b).closest("tr").find(".add_note").data("note"),stock_confirm:!0})});var d=new FormData;d.append("tipo","edit_part_stock_check"),d.append("part_sku",$("#locations_table").attr("part_sku")),d.append("stock_to_update",JSON.stringify(c));var e=$.ajax({url:"/ar_edit_stock.php",data:d,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(a){if(b.addClass("fa-cloud").removeClass("fa-spinner fa-spin "),200==a.state){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab&&"part.locations"!=state.tab||rows.fetch({reset:!0}),$("#part_locations").html(a.part_locations),$(".edit_stock_open_button").removeClass("hide"),$(".edit_stock_close_button").addClass("hide"),$(".part_locations_stock_check_button").addClass("hide"),$(".showcase_component").removeClass("super_discreet");for(var c in a.updated_fields)console.log(c),console.log(a.updated_fields[c]),$("."+c).html(a.updated_fields[c]);0!=a.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),$("#Part_Unknown_Location_Stock").attr("qty",a.Part_Unknown_Location_Stock),$(".part_locations_edit_locations_button span").html($(".part_locations_edit_locations_button span").data("labels").no_change),$(".part_locations_edit_locations_button").removeClass("changed valid")}else swal(a.status,a.msg,"error")}),e.fail(function(a,b){})}}function open_part_edit_move_stock(){$(".Part_Cost_in_Warehouse_info_set_up").addClass("invisible"),$(".edit_stock_close_button").removeClass("hide"),$(".showcase_component").addClass("super_discreet"),process_part_location_move_locations(),$(".location_to_be_disassociated_icon").addClass("hide"),$(".location_code").removeClass("link"),$(".undo_unlink_operations").css("width","0px"),$(".picking_location_note").addClass("hide"),$(".add_note").addClass("hide"),$(".set_as_audit").addClass("hide"),$(".picking_location_icon").addClass("hide"),$("input.stock").removeClass("hide").prop("readonly",!0),$("#locations_table .formatted_stock").addClass("hide"),$("#locations_table .stock_input").removeClass("hide"),$(".edit_stock_open_button").addClass("hide"),$(".part_locations_move_stock_button").removeClass("hide")}function move(a){if($(".locations  far.fa-dot-circle ").each(function(a,b){$(b).addClass("invisible")}),$(a).hasClass("fa-flip-horizontal"))$(a).addClass("to"),$("#move_to").html($(a).closest("tr").find(".location_code").html()),$(".locations  .move_trigger ").each(function(a,b){$(b).addClass("invisible")}),$("#move_stock_qty").focus(),move_qty_changed($("#move_stock_qty")),console.log(movements);else{console.log("xxx"),movements=!1,$("#move_from").html($(a).closest("tr").find(".location_code").html()),$("#locations_table  .fa-unlink ").addClass("invisible"),$("#add_location_tr").addClass("hide"),$("#locations_table  input.stock ").prop("readonly",!0),$(a).addClass("invisible").addClass("from"),$("#move_stock_tr").removeClass("hide").attr("max",$(a).closest("tr").find("input").val());var b,c=0;$(".locations  .move_trigger ").each(function(a,d){$(d).hasClass("from")||($(d).removeClass("super_discreet  invisible").addClass("fa-flip-horizontal"),c++,b=d)}),console.log(c),1==c&&move(b),$("#move_stock_qty").focus()}}function close_move(){var a=$("#move_stock_tr").data("movements");$("#edit_stock_saving_buttons").removeClass("hide"),$("#move_from").html(""),$("#move_to").html(""),$("#locations_table  input.stock ").prop("readonly",!1),$("#move_stock_tr").removeClass("valid invalid"),$("#move_stock_qty").val(""),a={};var b=$("#locations_table  .from ").closest("tr").find("input.stock");b.val(b.attr("ovalue"));var c=$("#locations_table  .to ").closest("tr").find("input.stock");c.val(c.attr("ovalue")),stock_changed($(b)),stock_changed(c),process_part_location_move_locations(),$("#locations_table .move_trigger").removeClass("fa-flip-horizontal from to").addClass("very_discreet"),$("#move_stock_tr").addClass("hide"),$(".locations  .move_trigger ").each(function(a,b){$(b).addClass("super_discreet"),$(b).closest("tr").find("input.stock").val()>0&&$(b).addClass("visible")}),$("#move_stock_tr").data("movements",a),part_locations_move_stock_look_for_changes()}function move_qty_changed(a){var b=$("#move_stock_tr").data("movements"),c=a.val();if(""==c)$("#move_stock_tr").removeClass("valid invalid");else if(validation=client_validation("numeric_unsigned",!1,c,""),"valid"==validation["class"]&&parseInt(c)>parseInt($(".locations  .from ").closest("tr").find("input.stock").attr("ovalue"))&&(validation["class"]="invalid"),$("#move_stock_tr").removeClass("valid invalid").addClass(validation["class"]),"valid"==validation["class"]){var d=parseFloat($("#move_stock_qty").val());if(isNaN(d))return;var e=$(".locations   .from ").closest("tr").find("input.stock");old_from_input=e.attr("ovalue"),e.val(parseFloat(e.attr("ovalue"))-d),stock_changed($(e));var f=$(".locations  .to ").closest("tr").find("input.stock");old_to_input=f.attr("ovalue"),f.val(parseFloat(f.attr("ovalue"))+d),stock_changed(f),process_part_location_move_locations(),b={part_sku:$("#locations_table").attr("part_sku"),from_location_key:e.attr("location_key"),from_location_stock:old_from_input,to_location_key:f.attr("location_key"),to_location_stock:old_to_input,move_qty:d}}else{b={};var e=$("#locations_table  .from ").closest("tr").find("input.stock");e.val(e.attr("ovalue"));var f=$("#locations_table  .to ").closest("tr").find("input.stock");f.val(f.attr("ovalue")),stock_changed($(e)),stock_changed(f),process_part_location_move_locations()}$("#move_stock_tr").data("movements",b),part_locations_move_stock_look_for_changes()}function process_part_location_move_locations(){var a=0,b=0,c=0,d=!1,e=0,f=0;$("#part_locations  input.stock ").each(function(g,h){var i=!0,j=!0;$(h).closest("tr").hasClass("invalid")&&(d=!0,i=!1,j=!1),0!=$(h).val()&&""!=$(h).val()||(i=!1);var k=$(h).val(),l=$(h).attr("ovalue");""==k&&(k=0),""==l&&(l=0),k=parseFloat(k),l=parseFloat(l);var m=k-l;m>0?b+=m:c+=m,a+=k,i&&e++,j?(f++,$("#move_stock_tr").hasClass("hide")&&($(h).closest("tr").find("input.stock").val()<=0?$(h).closest("tr").find(".move_trigger").addClass("invisible"):$(h).closest("tr").find(".move_trigger").removeClass("invisible"))):$(h).closest("tr").find(".move_trigger").addClass("invisible")});var g="";f<2&&$(".move_trigger").addClass("invisible"),0!=c&&(g+=" ("+c.toFixed(2).replace(/[.,]00$/,"")+") "),0!=b&&(g+=" (+"+b.toFixed(2).replace(/[.,]00$/,"")+") "),$("#new_stock").html(a),$("#stock_diff").html(g)}function part_locations_move_stock_look_for_changes(){var a=$("#move_stock_tr").data("movements");a.from_location_key>0&&a.to_location_key>0&&a.move_qty>0?($(".part_locations_move_stock_button").addClass("changed valid"),$(".part_locations_move_stock_button span").html($(".part_locations_move_stock_button span").data("labels").save_changes)):$(".part_locations_move_stock_button").removeClass("changed valid")}function save_part_locations_move_stock(a){if($(a).hasClass("valid")){var b=$(a).find("i");b.removeClass("fa-cloud").addClass("fa-spinner fa-spin ");var c=$("#move_stock_tr").data("movements"),d=new FormData;d.append("tipo","edit_part_move_stock"),d.append("part_sku",$("#locations_table").attr("part_sku")),d.append("movements",JSON.stringify(c));var e=$.ajax({url:"/ar_edit_stock.php",data:d,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(a){if(console.log(a),b.addClass("fa-cloud").removeClass("fa-spinner fa-spin "),200==a.state){"part.stock.transactions"!=state.tab&&"part.stock"!=state.tab&&"part.locations"!=state.tab||rows.fetch({reset:!0}),$("#part_locations").html(a.part_locations),$(".edit_stock_open_button").removeClass("hide"),$(".edit_stock_close_button").addClass("hide"),$(".part_locations_stock_check_button").addClass("hide"),$(".showcase_component").removeClass("super_discreet");for(var c in a.updated_fields)$("."+c).html(a.updated_fields[c]);0!=a.Part_Unknown_Location_Stock&&$("#unknown_location_tr").removeClass("hide"),$("#Part_Unknown_Location_Stock").attr("qty",a.Part_Unknown_Location_Stock),$(".edit_stock_save_button").addClass("hide"),$(".part_locations_move_stock_button span").html($(".part_locations_move_stock_button span").data("labels").no_change),$(".part_locations_move_stock_button").removeClass("changed valid"),$("#move_stock_qty").val(""),$("#move_from").html(""),$("#move_to").html(""),$("#move_stock_tr").addClass("hide")}else swal(a.state.toString(),a.msg,"error")}),e.fail(function(a,b){})}}function on_field_to_check_changed(a){var b=parseFloat($(".order_data_entry_picking_aid_state_after_save").val());if("set_dn_weight"==$(a).attr("id"))if(""==$(a).val())$(a).removeClass("invalid").addClass("valid");else{var c=validate_number($(a).val(),0);$(a).removeClass("invalid valid").addClass(c["class"])}if(b>0){if("set_dn_parcels"==$(a).attr("id")){var c=validate_integer($(a).val(),0);$(a).removeClass("invalid valid").addClass(c["class"])}}else if(""==$(a).val())$(a).removeClass("invalid").addClass("valid");else{var c=validate_integer($(a).val(),0);$(a).removeClass("invalid valid").addClass(c["class"])}if("set_tracking_number"==$(a).attr("id")){var d=$(a).val();""!=d&&0==d.replace(/\s/g,"").length?$(a).removeClass("valid").addClass("invalid"):$(a).removeClass("invalid").addClass("valid")}validate_data_entry_picking_aid()}function fast_track_packing_qty_changed(a){if($(a).val()==$(a).attr("ovalue"))$(a).closest("span").find("i.plus").removeClass("fa-exclamation-circle error fa-lock fa-plus"),$(a).closest("span").find("i.minus").removeClass("invisible"),$(a).val()>=$(a).data("quantity_on_location")&&$(a).data("quantity_on_location_locked")?$(a).closest("span").find("i.plus").addClass("fa-lock"):$(a).closest("span").find("i.plus").addClass("fa-plus");else{var b=$("body").data("labels"),c=Math.min($(a).data("max"),$(a).data("to_pick"));validate_number($(a).val(),0,c)&&""!=$(a).val()?$(a).closest("span").find("i.plus").removeClass("fa-plus fa-lock").addClass("fa-exclamation-circle error").prop("title",b.invalid_val):($(a).closest("span").find("i.plus").removeClass("fa-plus fa-exclamation-circle error").prop("title",b.save),$(a).addClass("discreet"),$(a).val()>=$(a).data("quantity_on_location")&&$(a).data("quantity_on_location_locked")?$(a).closest("span").find("i.plus").addClass("fa-lock error"):$(a).closest("span").find("i.plus").addClass("fa-plus"))}var d=$(a).val(),e=$(a).closest(".picked_quantity_components"),f=e.data("pending"),g=$(a).closest("tr").find(".picked_offline_status"),h=$(a).closest("tr").find(".picked_offline_status_notes"),i=d-f;console.log(i),i<0?(h.html(parseFloat(i.toFixed(4))).data("no_picked_qty",-i),g.addClass("error fa-exclamation-circle").removeClass("success  fa-check-circle")):i>0?(h.html("+"+parseFloat(i.toFixed(4))).data("no_picked_qty",0),g.addClass("error fa-exclamation-circle").removeClass("success  fa-check-circle")):(h.html("").data("no_picked_qty",0),g.removeClass("error fa-exclamation-circle").addClass("success  fa-check-circle")),validate_data_entry_picking_aid(),update_no_picked_info()}function data_entry_delivery_note(a){$("#tabs").html(""),change_view(state.request+"&tab=order.input_picking_sheet",{dn_key:a})}function close_data_entry_delivery_note(){change_view(state.request+"&tab=order.items")}function show_other_part_locations_for_input_delivery_note_packing(a){$.post("/ar_edit_orders.php",{tipo:"get_input_delivery_note_packing_all_locations",metadata:JSON.stringify($(a).data("metadata"))},null,"json").done(function(b){if(console.log(b),200==b.state){var c=$(a).closest("tr"),d=c.find(".fast_track_packing"),e=d.data("location_key"),f=d.val();c.find(".picked_quantity_components").html(b.picked_offline_input),c.find(".location_components").html(b.locations),console.log(e),$(".picked_quantity_components input.fast_track_packing",c).each(function(a,b){$(b).data("location_key")==e?($(b).attr("value",f),$(b).attr("ovalue",f)):($(b).attr("value",""),$(b).attr("ovalue",""))})}else 400==b.state&&swal($("#_labels").data("labels").error,b.msg,"error")})}function delivery_note_fast_track_packing_qty_change(a){var b,c,d=$(a).closest("span").find("input"),e=$("body").data("labels");if(console.log("hola2"),$(a).hasClass("fa-plus")){c="add";var f="fa-plus";if(isNaN(d.val())||""==d.val())var g=1;else g=parseFloat(d.val())+1;var h=$(a).closest(".picked_quantity").find(".fast_track_packing");if(g>=h.data("quantity_on_location")&&h.data("quantity_on_location_locked"))return $(a).removeClass("fa-spinner fa-spin"),void $(a).addClass("fa-lock").removeClass("fa-plus")}else if($(a).hasClass("fa-minus")){if(c="remove",isNaN(d.val())||""==d.val()||0==d.val())var g=0;else g=parseFloat(d.val())-1;var f="fa-minus"}else{if(!$(a).hasClass("fa-undo")){if($(a).hasClass("fa-lock")){if($(a).removeClass("fa-spinner fa-spin"),isNaN(parseFloat(d.val()))||""==d.val()||0==d.val())var g=0;else g=parseFloat(d.val());
return _labels=$(".input_picking_sheet_table").data("labels"),console.log(_labels.title_no_stock),void swal({title:_labels.title_no_stock,text:_labels.text_no_stock,type:"warning",showCloseButton:!0,showCancelButton:!0,cancelButtonText:_labels.no_text_no_stock,confirmButtonText:_labels.yes_text_no_stock}).then(function(b){if(console.log(b),b.value){$(a).removeClass("fa-lock error").addClass("fa-plus");var c=$(a).closest(".picked_quantity").find(".fast_track_packing");c.data("quantity_on_location_locked",!1),console.log(c),console.log($(a)),fast_track_packing_qty_changed(c)}})}return}c="undo",g=d.attr("ovalue");var f="fa-minus"}var i=d.closest(".picked_quantity_components"),j=0;i.find("input.fast_track_packing").each(function(a,c){console.log(c),$(c).data("location_key")!=d.data("location_key")&&(console.log($(c).val()),b=parseFloat($(c).val()),console.log(b),isNaN(b)||(j+=b,console.log("x "+b)))});var k=g+j,l=i.data("pending");k>l&&(g=l-j),g>d.data("max")&&(g=d.data("max")),$(a).addClass(f),""==g&&(g=0);var m=$(a).closest("tr").find(".picked_offline_status"),n=$(a).closest("tr").find(".picked_offline_status_notes");"add"==c&&0==g?d.val(""):d.val(g),$(a).closest("span").find("i.plus").removeClass("fa-spinner fa-spin  error fa-exclamation-circle").addClass("fa-plus").prop("title",e.add),$(a).closest("span").find("i.minus").removeClass("fa-spinner fa-spin invisible fa-undo very_discreet").addClass("fa-minus").prop("title",e.remove);var o=0;i.find("input.fast_track_packing").each(function(a,c){b=parseFloat($(c).val()),isNaN(b)||(o+=b,console.log(b))});var p=o-l;p<0?(n.html(parseFloat(p.toFixed(4))).data("no_picked_qty",-p),m.addClass("error fa-exclamation-circle").removeClass("success  fa-check-circle")):p>0?(n.html("+"+parseFloat(p.toFixed(4))).data("no_picked_qty",0),m.addClass("error fa-exclamation-circle").removeClass("success  fa-check-circle")):(n.html("").data("no_picked_qty",0),m.removeClass("error fa-exclamation-circle").addClass("success  fa-check-circle")),validate_data_entry_picking_aid(),update_no_picked_info()}function update_no_picked_info(){var a=$(".not_picked_info"),b=0,c=0;$("i.picked_offline_status").each(function(a,c){$(c).hasClass("fa-check-circle")||b++}),$(".picked_offline_status_notes").each(function(a,b){c+=$(b).data("no_picked_qty")*$(b).data("value_per_qty")}),b>0?a.removeClass("hide"):a.addClass("hide"),a.find(".items_with_problems").html(b),a.find(".percentage_items_with_problems").html("("+Number(b/a.data("total_items")).toLocaleString(void 0,{style:"percent",minimumFractionDigits:1})+")"),a.find(".items_with_problems_amount").html(Number(c).toLocaleString(void 0,{style:"currency",currency:a.data("currency")})),a.find(".percentage_items_with_problems_amount").html("("+Number(c/a.data("total_items_amount")).toLocaleString(void 0,{style:"percent",minimumFractionDigits:1})+")")}function select_dropdown_handler_for_fast_track_packing(a,b){field=$(b).attr("field"),value=$(b).attr("value"),0!=value&&(formatted_value=$(b).attr("formatted_value"),$("#"+field+"_dropdown_select_label").val(formatted_value),$("#"+field).val(value),$("#"+field+"_results_container").addClass("hide").removeClass("show"),validate_data_entry_picking_aid())}function change_order_data_entry_picking_aid_state_after_save(a){var b=$(a).find("i");console.log($(a).data("level"));var c=0;switch($(a).data("level")){case"L10":b.hasClass("fa-check-square")?(b.removeClass("fa-check-square").addClass("fa-square"),$(".L20 i").removeClass("fa-check-square").addClass("fa-square"),$(".L30 i").removeClass("fa-check-square").addClass("fa-square"),c=0):(b.addClass("fa-check-square").removeClass("fa-square"),c=10);break;case"L20":b.hasClass("fa-check-square")?(b.removeClass("fa-check-square").addClass("fa-square"),$(".L30 i").removeClass("fa-check-square").addClass("fa-square"),c=10):(b.addClass("fa-check-square").removeClass("fa-square"),$(".L10 i").addClass("fa-check-square").removeClass("fa-square"),c=20);break;case"L30":b.hasClass("fa-check-square")?(b.removeClass("fa-check-square").addClass("fa-square"),c=20):(b.addClass("fa-check-square").removeClass("fa-square"),$(".L10 i").addClass("fa-check-square").removeClass("fa-square"),$(".L20 i").addClass("fa-check-square").removeClass("fa-square"),c=30)}$(".order_data_entry_picking_aid_state_after_save").val(c),on_field_to_check_changed($("#set_dn_parcels")),validate_data_entry_picking_aid()}function validate_data_entry_picking_aid(){check_list={picker:{filled:!1,valid:!0},packer:{filled:!1,valid:!0},weight:{filled:!1,valid:!0},parcels:{filled:!1,valid:!0},shipper:{filled:!1,valid:!0},tracking_number:{filled:!1,valid:!0},items:{filled:!0,valid:!0},items_errors:{filled:!0,valid:!0}},$("#set_picker").val()&&(check_list.picker.filled=!0),$("#set_packer").val()&&(check_list.packer.filled=!0),""!=$("#set_dn_weight").val()?check_list.weight.filled=!0:check_list.weight.filled=!1,$("#set_dn_weight").hasClass("invalid")?check_list.weight.valid=!1:check_list.weight.valid=!0,""!=$("#set_dn_parcels").val()?check_list.parcels.filled=!0:check_list.parcels.filled=!1,$("#set_dn_parcels").hasClass("invalid")?check_list.parcels.valid=!1:check_list.parcels.valid=!0,"__none__"!=$("#set_shipper").val()&&(check_list.shipper.filled=!0),""!=$("#set_tracking_number").val()?check_list.tracking_number.filled=!0:check_list.tracking_number.filled=!1,$("#set_tracking_number").hasClass("invalid")?check_list.tracking_number.valid=!1:check_list.tracking_number.valid=!0,$(".picked_quantity_components i.plus").each(function(a,b){if($(b).hasClass("error"))return check_list.items_errors.valid=!1,!1}),$("i.picked_offline_status").each(function(a,b){if(!$(b).hasClass("fa-check-circle"))return check_list.items.filled=!1,!1});var a=!0,b=!1,c="final_save";$.each(check_list,function(b,c){c.valid||(a=!1)});var d=parseFloat($(".order_data_entry_picking_aid_state_after_save").val());b=!(!check_list.picker.filled||!check_list.picker.filled),check_list.items.filled||(c="confirm_save"),d>=10&&(check_list.parcels.filled||(b=!1),check_list.items.filled||(c="confirm_save")),d>=30&&(check_list.shipper.filled||(b=!1),check_list.tracking_number.filled||(c="confirm_save")),b?$(".input_picking_sheet_table .save").addClass("changed"):$(".input_picking_sheet_table .save").removeClass("changed"),a?($(".input_picking_sheet_table .save").removeClass("invalid"),b?$(".input_picking_sheet_table .save").addClass("valid"):$(".input_picking_sheet_table .save").removeClass("valid")):$(".input_picking_sheet_table .save").removeClass("valid").addClass("changed invalid"),"confirm_save"==c?$(".input_picking_sheet_table .save i").removeClass("fas").addClass("far"):$(".input_picking_sheet_table .save i").removeClass("far").addClass("fas")}function confirm_save_data_entry_picking_aid(a){if(!$(a).hasClass("invalid")){if(!$(a).hasClass("changed")){var b=$(".input_picking_sheet_table").data("labels"),c=parseFloat($(".order_data_entry_picking_aid_state_after_save").val());return missing_fields="",check_list.picker.filled||(missing_fields+=b.picker+"<br>"),check_list.packer.filled||(missing_fields+=b.packer+"<br>"),c>=10&&(check_list.parcels.filled||(missing_fields+=b.parcels+"<br>")),c>=30&&(check_list.shipper.filled||(missing_fields+=b.shipper+"<br>")),void swal({title:b.missing_fields,type:"error",html:missing_fields})}if($(a).find("i").hasClass("far")){var b=$(".input_picking_sheet_table").data("labels");console.log(b),issues_list="";var c=parseFloat($(".order_data_entry_picking_aid_state_after_save").val());return check_list.items.filled||(issues_list+=b.out_of_stock+"<br/>"),c>=30&&(check_list.tracking_number.filled||(issues_list+=b.tracking_number+"<br/>")),issues_list+="<br/>"+b.are_you_sure,void swal.fire({title:b.issues,html:issues_list,type:"warning",showCancelButton:!0,confirmButtonText:b.confirm_button_text}).then(function(a){a.value&&save_data_entry_picking_aid()})}save_data_entry_picking_aid()}}function save_data_entry_picking_aid(){if(!$(".save_data_entry_picking_aid_icon").hasClass("wait")){$(".save_data_entry_picking_aid_icon").removeClass("fa-cloud").addClass("fa-spin fa-spinner wait");var a={},b={};$(".input_field").each(function(a,c){b[$(c).data("field")]=$(c).val()}),$(".picked_quantity_components input.fast_track_packing").each(function(b,c){var d=$(c).closest(".picked_quantity").data("settings");void 0==a[d.item_key]?a[d.item_key]=[{location_key:$(c).data("location_key"),part_sku:d.item_key,itf_key:d.transaction_key,qty:$(c).val()}]:a[d.item_key].push({location_key:$(c).data("location_key"),part_sku:d.item_key,itf_key:d.transaction_key,qty:$(c).val()})}),console.log(b),console.log(a),$.post("/ar_edit_orders.php",{tipo:"data_entry_picking_aid",order_key:$(".input_picking_sheet_table").data("order_key"),delivery_note_key:$(".input_picking_sheet_table").data("delivery_note_key"),level:$(".order_data_entry_picking_aid_state_after_save").val(),fields:JSON.stringify(b),items:JSON.stringify(a)},null,"json").done(function(a){console.log(a),200==a.state?change_tab("order.items",{reload_showcase:1}):($(".save_data_entry_picking_aid_icon").addClass("fa-cloud").removeClass("fa-spin fa-spinner wait"),swal(a.msg))})}}function save_sticky_note(a){console.log(a);var b=$(".sticky_notes ."+a),c=b.data("object"),d=b.data("key"),e=b.data("field"),f=b.find(".sticky_note").html(),g="/ar_edit.php?tipo=edit_field&object="+c+"&key="+d+"&field="+e+"&value="+f+"&metadata={}";console.log(g);var h=new FormData;h.append("tipo","edit_field"),h.append("field",e),h.append("object",c),h.append("key",d),h.append("value",f);var g=$.ajax({url:"/ar_edit.php",data:h,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(a){200==a.state?$(b).find(".save").removeClass("fa-cloud").addClass("fa-check"):400==a.state&&sweetAlert(a.msg)}),g.fail(function(a,b){console.log(b),console.log(a.responseText)})}function select_dropdown_handler(a,b){if(field=$(b).attr("field"),value=$(b).attr("value"),0!=value){formatted_value=$(b).attr("formatted_value"),$("#"+field+"_dropdown_select_label").val(formatted_value),$("#"+field).val(value),$("#"+field+"_results_container").addClass("hide").removeClass("show");var c="/ar_edit_orders.php?tipo=set_"+a+"&delivery_note_key="+$("#dn_data").attr("dn_key")+"&staff_key="+value;console.log(c),$.getJSON(c,function(b){200==b.state&&$("#dn_data").attr(a+"_key",b.staff_key)})}}function select_courier(a){var b="/ar_edit.php?tipo=edit_field&object=DeliveryNote&key="+$("#delivery_note").attr("dn_key")+"&field=Delivery_Note_Shipper_Key&value="+a+"&metadata={}";console.log(b);var c=new FormData;c.append("tipo","edit_field"),c.append("field","Delivery_Note_Shipper_Key"),c.append("object","DeliveryNote"),c.append("key",$("#delivery_note").attr("dn_key")),c.append("value",a);var b=$.ajax({url:"/ar_edit.php",data:c,processData:!1,contentType:!1,type:"POST",dataType:"json"});b.done(function(a){if(200==a.state){console.log(a),$("#shipper_options").addClass("hide"),$("#shipper").removeClass("hide");for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);for(var b in a.update_metadata.title)$("."+b).attr("title",a.update_metadata.title[b]);$("#shipper_options .option").removeClass("selected"),$("#shipper_option_"+a.value).addClass("selected"),$("#dispatch_save_buttons").removeClass("very_discreet"),a.value>0?$("#edit_shipper_tracking_tr").removeClass("hide"):$("#edit_shipper_tracking_tr").addClass("hide")}else 400==a.state&&(sweetAlert(a.msg),input.val(input.attr("ovalue")))}),b.fail(function(a,b){console.log(b),console.log(a.responseText)})}function save_number_parcels(a){$(a).addClass("fa-spinner fa-spin");var b=$(a).prev("input"),c=$(a);if($(a).hasClass("fa-plus")){if(isNaN(b.val())||""==b.val())var d=1;else d=parseFloat(b.val())+1;b.val(d).addClass("discreet")}else if($(a).hasClass("fa-minus")){if(isNaN(b.val())||""==b.val()||0==b.val())var d=0;else d=parseFloat(b.val())-1;b.val(d).addClass("discreet")}else d=parseFloat(b.val());""==d&&(d=0);var e="/ar_edit.php?tipo=edit_field&object=DeliveryNote&key="+$("#delivery_note").attr("dn_key")+"&field=Delivery_Note_Number_Parcels&value="+d+"&metadata={}";console.log(e);var f=new FormData;f.append("tipo","edit_field"),f.append("field","Delivery_Note_Number_Parcels"),f.append("object","DeliveryNote"),f.append("key",$("#delivery_note").attr("dn_key")),f.append("value",d);var e=$.ajax({url:"/ar_edit.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(d){if($(a).removeClass("fa-spinner fa-spin"),200==d.state){b.attr("ovalue",d.value),c.addClass("hide");for(var e in d.update_metadata.class_html)$("."+e).html(d.update_metadata.class_html[e])}else 400==d.state&&(sweetAlert(d.msg),b.val(b.attr("ovalue")))}),e.fail(function(a,b){console.log(b),console.log(a.responseText)})}function save_delivery_note_weight(a){var b=$(a).closest("td").find("input"),c=$(a);if(c.hasClass("save")&&!c.hasClass("wait")){$(a).addClass("fa-spinner fa-spin"),qty=parseFloat(b.val()),""==qty&&(qty=0);var d="/ar_edit.php?tipo=edit_field&object=DeliveryNote&key="+$("#delivery_note").attr("dn_key")+"&field=Delivery_Note_Weight&value="+qty+"&metadata={}";console.log(d);var e=new FormData;e.append("tipo","edit_field"),e.append("field","Delivery_Note_Weight"),e.append("object","DeliveryNote"),e.append("key",$("#delivery_note").attr("dn_key")),e.append("value",qty);var d=$.ajax({url:"/ar_edit.php",data:e,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(d){if($(a).removeClass("fa-spinner fa-spin wait"),200==d.state){b.attr("ovalue",d.value),c.addClass("hide");for(var e in d.update_metadata.class_html)$("."+e).html(d.update_metadata.class_html[e])}else 400==d.state&&(sweetAlert(d.msg),b.val(b.attr("ovalue")))}),d.fail(function(a,b){console.log(b),console.log(a.responseText)})}}function save_delivery_note_tracking(a){var b=$(a).closest("td").find("input"),c=$(a);if(c.hasClass("save")&&!c.hasClass("wait")){$(a).addClass("fa-spinner fa-spin");var d="/ar_edit.php?tipo=edit_field&object=DeliveryNote&key="+$("#delivery_note").attr("dn_key")+"&field=Delivery_Note_Weight&value="+b.val()+"&metadata={}";console.log(d);var e=new FormData;e.append("tipo","edit_field"),e.append("field","Delivery_Note_Shipper_Tracking"),e.append("object","DeliveryNote"),e.append("key",$("#delivery_note").attr("dn_key")),e.append("value",b.val());var d=$.ajax({url:"/ar_edit.php",data:e,processData:!1,contentType:!1,type:"POST",dataType:"json"});d.done(function(d){if($(a).removeClass("fa-spinner fa-spin wait"),200==d.state){b.attr("ovalue",d.value),c.addClass("hide");for(var e in d.update_metadata.class_html)$("."+e).html(d.update_metadata.class_html[e])}else 400==d.state&&(sweetAlert(d.msg),b.val(b.attr("ovalue")))}),d.fail(function(a,b){console.log(b),console.log(a.responseText)})}}function dispatch_delivery_note(){var a="/ar_edit_orders.php?tipo=set_state&object=delivery_note&key="+$("#dn_data").attr("dn_key")+"&value=Dispatched";$.getJSON(a,function(a){200==a.state})}function print_label(){$("#printframe").remove();var a=$("<iframe></iframe>");a.attr("id","printframe").attr("name","printframe").attr("src","about:blank").css("width","0").css("height","0").css("position","absolute").css("left","-9999px").appendTo($("body:first"));var b="test";null!=a&&null!=b&&(a.attr("src",b),a.load(function(){var a=$("#printframe")[0],b=a.contentWindow?a.contentWindow:a.contentDocument.defaultView;b.focus(),b.print()}))}function show_shipper_options(){$("#shipper_options").removeClass("hide"),$("#shipper").addClass("hide")}function save_dispatch_dn(a){if($(a).hasClass("very_discreet"))return void swal("Courier not set","Select a courier","error");var b=$(a).data("data");console.log(b);var c=$("#object_showcase div.order").data("object"),d=b.dialog_name,e=b.field,f=b.value,g=c.object,h=c.key;if(!$("#"+d+"_save_buttons").hasClass("button"))return void console.log("#"+d+"_save_buttons");$("#"+d+"_save_buttons").removeClass("button"),$("#"+d+"_save_buttons i").addClass("fa-spinner fa-spin"),$("#"+d+"_save_buttons .label").addClass("hide");var i={};$("#"+d+"_dialog  .option_input_field").each(function(){var a=$(this).data("settings");"datetime"==a.type&&(i[a.field]=$("#"+a.id).val()+" "+$("#"+a.id+"_time").val())}),console.log(e),"Replacement State"==e&&(i["Delivery Note Key"]=b.replacement_key);var j="/ar_edit.php?tipo=edit_field&object="+g+"&key="+h+"&field="+e+"&value="+f+"&metadata="+JSON.stringify(i),k=new FormData;k.append("tipo","edit_field"),k.append("object",g),k.append("key",h),k.append("field",e),k.append("value",f),k.append("metadata",JSON.stringify(i));var j=$.ajax({url:"/ar_edit.php",data:k,processData:!1,contentType:!1,type:"POST",dataType:"json"});j.done(function(a){if($("#"+d+"_save_buttons").addClass("button"),$("#"+d+"_save_buttons i").removeClass("fa-spinner fa-spin"),$("#"+d+"_save_buttons .label").removeClass("hide"),200==a.state){close_dialog(d),"Cancelled"==a.value&&change_view(state.request,{reload_showcase:!0});for(var b in a.update_metadata.class_html)$("."+b).html(a.update_metadata.class_html[b]);$(".order_operation").addClass("hide");for(var b in a.update_metadata.operations)console.log("#"+a.update_metadata.operations[b]),$("#"+a.update_metadata.operations[b]).removeClass("hide");$(".timeline .li").removeClass("complete"),$("#order_node").addClass("complete"),a.update_metadata.state_index>=20&&$("#start_picking_node").addClass("complete"),a.update_metadata.state_index>=30&&$("#picked_node").addClass("complete"),a.update_metadata.state_index>=70&&$("#packed_node").addClass("complete"),a.update_metadata.state_index>=80&&$("#packed_done_node").addClass("complete"),a.update_metadata.state_index>=90&&$("#dispatch_approved_node").addClass("complete"),a.update_metadata.state_index>=100&&$("#dispatched_node").addClass("complete"),a.update_metadata.state_index>10?$(".delivery_note_handling_fields").removeClass("hide"):$(".delivery_note_handling_fields").addClass("hide"),$("#Delivery_Note_State_Index").val(a.update_metadata.state_index),$(".final_info_block").removeClass("hide"),$(".info_block").addClass("hide"),$("._items_cost").css("border-bottom","none")}else 400==a.state&&swal($("#_labels").data("labels").error,a.msg,"error")}),j.fail(function(a,b){console.log(b),console.log(a.responseText)})}function show_other_part_locations_for_picking(a){$.post("/ar_edit_orders.php",{tipo:"get_picked_offline_input_all_locations",metadata:JSON.stringify($(a).data("metadata"))},null,"json").done(function(b){console.log(b),200==b.state?($(a).closest("tr").find(".picked_quantity_components").html(b.picked_offline_input),$(a).closest("tr").find(".location_components").html(b.locations)):400==b.state&&swal($("#_labels").data("labels").error,b.msg,"error")})}function picked_offline_items_qty_change(a){var b=$(a).closest("span").find("input");if($(a).hasClass("fa-plus")){var c="fa-plus";if(isNaN(b.val())||""==b.val())var d=1;else d=parseFloat(b.val())+1}else if($(a).hasClass("fa-minus")){if(isNaN(b.val())||""==b.val()||0==b.val())var d=0;else d=parseFloat(b.val())-1;var c="fa-minus"}else{d=parseFloat(b.val());var c="fa-cloud"}var e=b.closest(".picked_quantity_components");console.log(d);var f=0;e.find("input.picked_offline").each(function(a,c){$(c).data("location_key")!=b.data("location_key")&&(f+=parseFloat($(c).val()))});var g=d+f;console.log(g),g>e.data("pending")&&(d=e.data("pending")-f),console.log(d),d>b.data("max")&&(d=b.data("max")),b.val(d).addClass("discreet"),$(a).addClass(c),""==d&&(d=0)}function get_delivery_notes_table(a,b,c){switch($(".delivery_note_flow").removeClass("selected"),$(".blue").removeClass("blue"),console.log(a),a){case"ready_to_pick":$("#delivery_note_flow_ready_to_pick").addClass("selected"),widget="delivery_notes.ready_to_pick.wget",$(".Delivery_Notes_Ready_to_Pick_Number").addClass("blue"),$(".Delivery_Notes_Ready_to_Pick_Weight").addClass("blue");break;case"assigned":$("#delivery_note_flow_assigned").addClass("selected"),widget="delivery_notes.assigned.wget",$(".Delivery_Notes_Assigned_Number").addClass("blue"),$(".Delivery_Notes_Assigned_Weight").addClass("blue");break;case"website_mailshots":$("#delivery_note_flow_website").addClass("selected"),widget="orders.website.mailshots.wget",$(".Orders_In_Basket_Number").addClass("blue"),$(".Orders_In_Basket_Amount").addClass("blue");break;case"submitted_not_paid":$("#delivery_note_flow_submitted").addClass("selected").find(""),widget="orders.in_process.not_paid.wget",$(".Orders_In_Process_Not_Paid_Number").addClass("blue"),$(".Orders_In_Process_Not_Paid_Amount").addClass("blue");break;case"submitted":$("#delivery_note_flow_submitted").addClass("selected"),widget="orders.in_process.paid.wget",$(".Orders_In_Process_Paid_Number").addClass("blue"),$(".Orders_In_Process_Paid_Amount").addClass("blue");break;case"in_warehouse":$("#delivery_note_flow_in_warehouse").addClass("selected"),widget="orders.in_warehouse_no_alerts.wget",$(".Orders_In_Warehouse_No_Alerts_Number").addClass("blue"),$(".Orders_In_Warehouse_No_Alerts_Amount").addClass("blue");break;case"in_warehouse_with_alerts":$("#delivery_note_flow_in_warehouse").addClass("selected"),widget="orders.in_warehouse_with_alerts.wget",$(".Orders_In_Warehouse_With_Alerts_Number").addClass("blue"),$(".Orders_In_Warehouse_With_Alerts_Amount").addClass("blue");break;case"packed_done":$("#delivery_note_flow_packed").addClass("selected"),widget="orders.packed_done.wget",$(".Orders_Packed_Number").addClass("blue"),$(".Orders_Packed_Amount").addClass("blue");break;case"approved":$("#delivery_note_flow_packed").addClass("selected"),widget="orders.approved.wget",$(".Orders_Dispatch_Approved_Number").addClass("blue"),$(".Orders_Dispatch_Approved_Amount").addClass("blue");break;case"dispatched_today":$("#delivery_note_flow_dispatched").addClass("selected"),widget="orders.dispatched_today.wget",$(".Orders_Dispatched_Today_Number").addClass("blue"),$(".Orders_Dispatched_Today_Amount").addClass("blue");break;default:$("#delivery_note_flow_ready_to_pick").addClass("selected"),widget="delivery_notes.ready_to_pick.wget",$(".Delivery_Notes_Ready_to_Pick_Number").addClass("blue"),$(".Delivery_Notes_Ready_to_Pick_Weight").addClass("blue")}if($("#delivery_note_flow_ready_to_pick").data("current_delivery_note_flow")!=a||"Yes"==c){$("#delivery_note_flow_ready_to_pick").data("current_delivery_note_flow",a);var d=window.location.pathname.replace(/pending_delivery_notes.*$/,"")+"pending_delivery_notes/"+a;window.top.history.pushState({request:d},null,d);var e="/ar_views.php?tipo=widget_details&widget="+widget+"&metadata="+JSON.stringify(b);$.getJSON(e,function(a){$("#widget_details").html(a.widget_details).removeClass("hide")})}}function isMobile(){try{return document.createEvent("TouchEvent"),!0}catch(a){return!1}}function change_browser_history_state(a){if(void 0!=a&&("/"!==a.charAt(0)&&(a="/"+a),old_state_request!=a)){if(console.log(old_state_request+" -> "+a),!$("#is_devel").val()){var b=$("#account_name");ga("set","contentGroup1",state.module.replace("_"," ").capitalize()),ga("set","contentGroup2",state.section.replace("_"," ").capitalize()),ga("set","contentGroup3",b.data("user_handle").capitalize()+" "+b.data("account_code")),ga("set","page",a),ga("send","pageview")}window.top.history.pushState({request:a},"",a),old_state_request=a}}function change_tab(a,b){$("#maintabs .tab").removeClass("selected"),$("#tab_"+a.replace(/(:|\.|\[|\])/g,"$1")).addClass("selected"),change_view(state.request+"&tab="+a,b)}function change_subtab(a){$("#maintabs .subtab").removeClass("selected"),$("#subtab_"+a.replace(/(:|\.|\[|\])/g,"$1")).addClass("selected"),change_view(state.request+"&subtab="+a)}function get_widget_details(a,b,c){void 0==c&&(c={}),$(".widget").css("opacity",.4),$(a).css("opacity",1);var d="/ar_views.php?tipo=widget_details&widget="+b+"&metadata="+JSON.stringify(c);$.getJSON(d,function(a){$("#widget_details").html(a.widget_details).removeClass("hide")})}function change_menu_view(a){switch(a){case"_dashboard":change_view("/dashboard");break;case"customers":change_view(state.current_store&&jQuery.inArray(state.current_store,state.stores)!==-1?"customers/"+state.current_store+"/dashboard":"customers/all");break;case"orders":change_view(state.current_store?"orders/"+state.current_store+"/dashboard":"orders/all/by_store");break;case"delivery_notes":change_view("delivery_notes/all/");break;case"products":change_view(state.current_store?"store/"+state.current_store:"stores");break;case"websites":change_view(state.current_website?"website/"+state.current_website:"websites");break;case"warehouses":change_view(state.current_warehouse?"warehouse/"+state.current_warehouse+"/dashboard":"warehouses");break;case"accounting":change_view("invoices/per_store");break;case"inventory":change_view("inventory/dashboard");break;case"suppliers":change_view("suppliers/dashboard");break;case"production":change_view(state.current_production?"production/"+state.current_production:"production/all");break;case"hr":case"reports":case"profile":case"account":case"users":case"agent_parts":change_view(a);break;case"agent_client_orders":change_view("orders");break;case"agent_client_deliveries":change_view("agent_deliveries");break;case"agent_suppliers":change_view("suppliers");break;case"agent_profile":change_view("profile")}}function change_view_if_has_link_class(a,b,c){$(a).hasClass("link")&&change_view(b,c)}function change_view(a,b){$.urlParam=function(a,b){var c=new RegExp("[?&]"+a+"=([^&#]*)").exec(b);return null==c?null:c[1]||0};var c="?__R__="+a;$("#tabs").removeClass("hide"),a=$.urlParam("__R__",c);var d=$.urlParam("tab",c),e=$.urlParam("subtab",c);void 0!=b&&b||(b={});var f={tipo:"views",request:a,metadata:JSON.stringify(b),old_state:JSON.stringify(state)};null!=d&&(f.tab=d),null!=e&&(f.subtab=e),void 0!=b.tab?f.tab=b.tab:void 0!=b.subtab&&(f.subtab=b.subtab),$.ajax({url:"/ar_views.php",type:"GET",dataType:"json",data:f,success:function(a){200==a.state?(state=a.app_state,console.log(state),"undefined"!=typeof a.navigation&&null!==a.navigation&&""!=a.navigation&&$("#navigation").html(a.navigation),"undefined"!=typeof a.web_navigation&&null!==a.web_navigation&&""!=a.web_navigation?$("#web_navigation").html(a.web_navigation):$("#web_navigation").html(""),"undefined"!=typeof a.tabs&&null!==a.tabs&&$("#tabs").html(a.tabs),"undefined"!=typeof a.menu&&null!==a.menu&&$("#menu").html(a.menu),"undefined"!=typeof a.logout_label&&null!==a.logout_label&&$("#logout_label").html(a.logout_label),"undefined"!=typeof a.view_position&&null!==a.view_position&&$("#view_position").html(a.view_position),"undefined"!=typeof a.object_showcase&&null!==a.object_showcase&&("_"==a.object_showcase?$("#object_showcase").addClass("hide").html(""):($("#object_showcase").removeClass("hide"),$("#object_showcase").html(a.object_showcase))),"undefined"!=typeof a.tab&&null!==a.tab&&$("#tab").html(a.tab),"undefined"!=typeof a.structure&&null!==a.structure&&(structure=a.structure),""==old_state_request&&(old_state_request=a.app_state.request),"delivery_note.fast_track_packing"==b.post_operations?($("#maintabs .tab").addClass("hide"),$("div[id='tab_delivery_note.fast_track_packing']").removeClass("hide")):"delivery_note.fast_track_packing_off"==b.post_operations&&($("#maintabs .tab").removeClass("hide"),$("div[id='tab_delivery_note.fast_track_packing']").addClass("hide")),void 0!=state.title&&""!=state.title?document.title=state.title:document.title="Aurora",change_browser_history_state(a.app_state.request),show_side_content($("#notifications").data("current_side_view"))):swal({title:"Error A123"})}})}function logout(){window.location.href="/logout.php"}function decodeEntities(a){return a}function htmlEncode(a){return $("<div/>").text(a).html()}function fixedEncodeURIComponent(a){return encodeURIComponent(a).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}function truncateWithEllipses(a,b){return a.substr(0,b-1)+(a.length>b?"&hellip;":"")}function connect_websocket(){if(websocket_connected_connecting=!0,"au.bali"==location.host)var a="ws://"+location.hostname+"/ws";else if("au.geko"==location.host)var a="ws://"+location.hostname+"/ws180718";else var a=("http:"===document.location.protocol?"ws:":"wss:")+"//"+location.hostname+"/ws180718";ws_connection=new ab.Session(a,function(){websocket_connected_connecting=!1,websocket_connected=!0,console.log("real_time."+$("#account_name").data("account_code").toLowerCase()),ws_connection.subscribe("real_time."+$("#account_name").data("account_code").toLowerCase(),function(a,b){void 0!=b.iu&&render_real_time_users_table(b.iu);for(var c in b.d3)"current_website_users"==b.d3[c].type&&"website.analytics"==state.tab&&state.key==b.d3[c].website_key&&(website_analytics_render_website_users_pie(b.d3[c].website_key,b.d3[c].data.total_users,b.d3[c].data.users),website_analytics_render_website_users_table(b.d3[c].website_key,b.d3[c].data.users_data));for(var c in b.objects)if(state.object==b.objects[c].object&&state.key==b.objects[c].key){for(var d in b.objects[c].update_metadata.class_html)console.log("."+d),console.log(b.objects[c].update_metadata.class_html[d]),$("."+d).html(b.objects[c].update_metadata.class_html[d]);for(var d in b.objects[c].update_metadata.titles)$("."+d).attr("title",b.objects[c].update_metadata.titles[d]);for(var e in b.objects[c].update_metadata.hide)$("."+b.objects[c].update_metadata.hide[e]).addClass("hide");for(var e in b.objects[c].update_metadata.show)$("."+b.objects[c].update_metadata.show[e]).removeClass("hide");for(var d in b.objects[c].update_metadata.add_class)$("."+d).addClass(b.objects[c].update_metadata.add_class[d])}for(var c in b.sections)if(state.section==b.sections[c].section){for(var d in b.sections[c].update_metadata.class_html)$("."+d).html(b.sections[c].update_metadata.class_html[d]);for(var e in b.sections[c].update_metadata.hide)$("."+b.sections[c].update_metadata.hide[e]).addClass("hide");for(var e in b.sections[c].update_metadata.show)$("."+b.sections[c].update_metadata.show[e]).removeClass("hide");for(var d in b.sections[c].update_metadata.add_class)$("."+d).addClass(b.sections[c].update_metadata.add_class[d])}for(var c in b.tabs)if(state.tab==b.tabs[c].tab){void 0!=b.tabs[c].rtext&&$("#rtext").html(b.tabs[c].rtext);for(var d in b.tabs[c].cell)$("#table ."+d).html(b.tabs[c].cell[d])}}),ws_connection.subscribe("real_time."+$("#account_name").data("account_code").toLowerCase()+"."+$("#hello_user").data("user_key"),function(a,b){for(var c in b.progress_bar){var d=b.progress_bar[c];"In Process"==d.state?($("#"+d.id+" .export_download").addClass("hide"),$("#"+d.id+" .export_progress_bar_bg").removeClass("hide").html("&nbsp;"+d.progress_info),$("#"+d.id+" .export_progress_bar").css("width",d.percentage).removeClass("hide").attr("title",d.progress).html("&nbsp;"+d.progress_info)):"Finish"==d.state&&($("#"+d.id+" .download_export").attr("href","/download.php?file="+d.download_key),$("#"+d.id+" .export_download").removeClass("hide").attr("title",d.result_info).on("click",function(){download_exported_file(this)}),$("#"+d.id+" .export_progress_bar_bg").addClass("hide").html(""),$("#"+d.id+" .export_progress_bar").css("width","0px").removeClass("hide").attr("title","").html(""),$("#"+d.id+" .export_button").addClass("link").removeClass("disabled"),$("#"+d.id+" .field_export").addClass("button").removeClass("disabled"),$("#"+d.id+" .stop_export").addClass("hide"))}})},function(){websocket_connected_connecting=!1,websocket_connected=!1},{skipSubprotocolCheck:!0})}function website_analytics_render_website_users_pie(a,b,c){function d(a){return a.data.device}function e(a,b,c,d){var e;if(e=f(a,b,c,d)){var h=i(e);return h.startAngle=e.endAngle,h}if(e=g(a,b,c,d)){var h=i(e);return h.endAngle=e.startAngle,h}return null}function f(a,b,c,d){for(var e=b.length;--a>=0;)for(var f=d(c[a]),g=0;g<e;++g)if(d(b[g])===f)return b[g]}function g(a,b,c,d){for(var e=c.length,f=b.length;++a<e;)for(var g=d(c[a]),h=0;h<f;++h)if(d(b[h])===g)return b[h]}function h(a){var b=d3.interpolate(this._current,a);return this._current=b(0),
function(a){return arc(b(a))}}function i(a){var b={};for(var c in a)b[c]=a[c];return b}var j=$(".current_website_users_"+a).data("svg"),k=$(".current_website_users_"+a).data("pie");j.selectAll("text").text(b);var l=j.selectAll("path"),m=l.data(),n=k(c);l=l.data(n,d),l.transition().duration(myDuration).attrTween("d",h),l.enter().append("path").each(function(a,b){var c=e(b,m,n,d);c?(this._current=c,this._previous=c):this._current=a}).attr("fill",function(a,b){return color(a.data.device)}).transition().duration(myDuration).attrTween("d",h),l.exit().transition().duration(myDuration).attrTween("d",function(a,b){var c=(this._previous.data.device,d3.interpolateObject(a,this._previous));return function(a){return arc(c(a))}}).remove()}function website_analytics_render_website_users_table(a,b){var c=$(".current_website_users_table_"+a),d=[];$(".current_website_users_table_"+a+" tr").each(function(a){d.push($(this).data("customer_key"))}),console.log(d),$.each(b,function(a,b){d.splice($.inArray(b.customer_key,d),1);var e=c.find("tr.rt_wu_"+b.customer_key);e.length?(e.find(".webpage").html(b.webpage_label),e.find(".amount").html(b.order_net_formatted)):c.append('<tr data-customer_key="'+b.customer_key+'"  class="rt_wu_'+b.customer_key+'"><td class="device">'+b.device_label+'</td><td class="location">'+b.location+'</td><td class="customer">'+b.customer_label+'</td><td class="amount" data-amount="'+b.order_net+'">'+b.order_net_formatted+'</td><td class="webpage"> '+b.webpage_label+"</td></tr>")}),$.each(d,function(a,b){c.find(".rt_wu_"+b).remove()})}function render_real_time_users_table(a){var b=$(".real_time_users_table"),c=[];$(".real_time_users_table  tr").each(function(a){c.push($(this).data("user_key"))}),$.each(a,function(a,d){c.splice($.inArray(d.user_key,c),1);var e=b.find("tr.rt_u_"+d.user_key);e.length?(e.find(".icon").html(d.icon),e.find(".web_location").html(d.web_location).attr("onclick","change_view('"+d.request+"')"),e.find(".web_location").html(d.web_location)):b.append('<tr data-user_key="'+d.user_key+'"  class="rt_u_'+d.user_key+'"><td class="icon">'+d.icon+'</td><td class="alias">'+d.alias+'</td><td class="web_location button" onclick="change_view(\''+d.request+"')\" >"+d.web_location+"</td></tr>")}),$.each(c,function(a,c){b.find(".rt_u_"+c).remove()})}function customer_email_width_hack(a){a.text().length>30&&a.css("font-size","90%")}function unauthorized_open_fund_credit(a){var b=$(a).data("labels"),c="/ar_find.php?tipo=users_with_right&right=IS";$.getJSON(c,function(a){var c=[];$.each(a.users_data,function(a,b){"No"==b.UIR&&c.push(b["User Alias"])});var d=c.join(", ");footer_text=b.footer+d,Swal.fire({type:"error",title:b.title,text:b.text,footer:footer_text})})}function close_fund_credit(){$(".add_funds_to_customer_account").addClass("hide"),$(".remove_funds_to_customer_account").addClass("hide")}function show_edit_credit_dialog(a){"add_funds"==a?$(".remove_funds_to_customer_account").addClass("hide"):"remove_funds"==a&&$(".add_funds_to_customer_account").addClass("hide"),$("."+a+"_to_customer_account").hasClass("hide")&&($("."+a+"_to_customer_account").removeClass("hide"),$("."+a+"_to_customer_field").attr("disabled",!0),$("."+a+"_to_customer_fields").addClass("just_hinted").val(""))}function select_fund_type(a){var b=$(a).closest(".edit_funds_to_customer_account").data("operation_type");console.log(b);var c=$(a).closest(".customer_account_type_buttons");c.find(".fund_type_button").removeClass("selected").addClass("very_discreet"),$(a).addClass("selected").removeClass("very_discreet"),$("."+b+"_to_customer_account_type").val($(a).data("type")),$("."+b+"_to_customer_field").attr("disabled",!1),$("."+b+"_to_customer_fields").removeClass("just_hinted"),$("."+b+"_to_customer_field.amount").focus()}function validate_edit_funds_to_customer(a){var b=$(a).closest(".edit_funds_to_customer_account").data("operation_type"),c=!1,d=!1;""!=$("."+b+"_to_customer_field.note").val()&&(d=!0),validate_number($("."+b+"_to_customer_field.amount").val(),0,999999999)?(c=!0,d=!1,$("."+b+"_to_customer_field.amount").addClass("invalid")):$("."+b+"_to_customer_field.amount").removeClass("invalid"),$(".save_"+b+"_to_customer_account").addClass("changed"),c?$(".save_"+b+"_to_customer_account").addClass("invalid ").removeClass("valid"):d?$(".save_"+b+"_to_customer_account").addClass("valid").removeClass("invalid"):$(".save_"+b+"_to_customer_account").removeClass("invalid valid")}function save_edit_funds_to_customer_account(a){if(!$(".save_"+a+"_to_customer_account").hasClass("wait")&&$(".save_"+a+"_to_customer_account").hasClass("valid")){$(".save_"+a+"_to_customer_account").addClass("wait"),$(".save_"+a+"_to_customer_account i").removeClass("fa-cloud").addClass("fa-spinner fa-spin");var b=new FormData;b.append("tipo",""+a+"_to_customer_account"),b.append("customer_key",$("#customer").attr("key")),b.append("credit_transaction_type",$("."+a+"_to_customer_account_type").val()),b.append("amount",$("."+a+"_to_customer_field.amount").val()),b.append("note",$("."+a+"_to_customer_field.note").val()),$.ajax({url:"/ar_edit.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(b){$(".save_"+a+"_to_customer_account").removeClass("wait"),"200"==b.state?(close_fund_credit(),change_view(state.request,{reload_showcase:1}),"customer.credit_blockchain"!=state.tab&&"customer.history"!=state.tab||rows.fetch({reset:!0}),$(".save_"+a+"_to_customer_account i").addClass("fa-cloud").removeClass("fa-spinner fa-spin")):"400"==b.state&&($(".save_"+a+"_to_customer_account i").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),swal("Error!",b.msg,"error"))},error:function(){$(".save_"+a+"_to_customer_account").removeClass("wait"),$(".save_"+a+"_to_customer_account i").addClass("fa-cloud").removeClass("fa-spinner fa-spin")}})}}function open_new_order(){$("#take_order i").hasClass("fa-shopping-cart")&&($("#take_order i").removeClass("fa-shopping-cart").addClass("fa-spinner fa-spin"),new_order())}function new_order(){var a="Order",b="customer",c=$("#customer").attr("key"),d={},e="/ar_edit.php?tipo=new_object&object="+a+"&parent="+b+"&parent_key="+c+"&fields_data="+JSON.stringify(d);console.log(e);var f=new FormData;f.append("tipo","new_object"),f.append("object",a),f.append("parent",b),f.append("parent_key",c),f.append("fields_data",JSON.stringify(d));var e=$.ajax({url:"/ar_edit.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});e.done(function(b){$("#"+a+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200==b.state?change_view("orders/"+$("#customer").attr("store_key")+"/"+b.new_id):400==b.state&&alert(b.msg)}),e.fail(function(b,c){$("#"+a+"_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),$("#inline_new_object_msg").html("Server error please contact Aurora support").addClass("error")})}function new_customer_client_order(){const a="Order",b="customer_client",c=$("#customer_client").data("customer_client_key"),d={},e=new FormData;e.append("tipo","new_object"),e.append("object",a),e.append("parent",b),e.append("parent_key",c),e.append("fields_data",JSON.stringify(d));const f=$.ajax({url:"/ar_edit.php",data:e,processData:!1,contentType:!1,type:"POST",dataType:"json"});f.done(function(a){$("#Order_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),200===a.state?change_view("orders/"+$("#customer_client").data("store_key")+"/"+a.new_id):400===a.state&&Swal.fire({type:"error",title:a.msg})}),f.fail(function(a,b){$("#Order_save").addClass("fa-cloud").removeClass("fa-spinner fa-spin"),Swal.fire({type:"error",title:"Server error please contact Aurora support"})})}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$(document).ready(function(){$("body").on("click",".question",function(){show_answer($(this))}),$("#whiteboard .content").on("focusin",function(){$(this).data("empty")&&$(this).html("")}),$("#whiteboard").on("input paste",".content",function(a){delayed_save_whiteboard_content($(this),400)})}),$(document).on("click","#book_in_with_barcode,#close_booking_in_barcode_feedback",function(a){$("#booking_in_barcode_feedback").hasClass("hide")?($("#booking_in_barcode_feedback").removeClass("hide"),$("#elements").addClass("hide"),$("#table tr").addClass("hide"),$(".table_info").addClass("hide")):($("#booking_in_barcode_feedback").addClass("hide"),$("#elements").removeClass("hide"),$("#table tr").removeClass("hide"),$(".table_info").removeClass("hide"))}),$(document).on("input propertychange","#booking_in_barcode_qty_input",function(a){booking_in_barcode_qty_input_changed()}),$(document).on("click","#edit_table",function(){change_view(state.request+"&tab="+state.tab+"_edit",{reload_showcase:1})}),$(document).on("click","#exit_edit_table",function(){change_view(state.request+"&tab="+state.tab.replace(/\_edit$/i,""))}),$(document).on("click",".permissions .permission_type",function(a){console.log($(this));var b=$(this).find("i");console.log(b),$(".permissions .save").addClass("changed valid"),$(".permissions .updated_msg").addClass("hide"),b.hasClass("fa-square")?(b.removeClass("fa-square").addClass("fa-check-square"),$(this).removeClass("discreet_on_hover")):b.hasClass("fa-check-square")?(b.addClass("fa-square").removeClass("fa-check-square"),$(this).addClass("discreet_on_hover")):b.hasClass("fa-circle")?($(this).closest("tr").find("i").removeClass("fa-dot-circle").addClass("fa-circle"),$(this).closest("tr").find(".permission_type").addClass("discreet_on_hover"),b.removeClass("fa-circle").addClass("fa-dot-circle"),$(this).removeClass("discreet_on_hover")):b.hasClass("fa-dot-circle")&&($(this).closest("tr").find("i").removeClass("fa-dot-circle").addClass("fa-circle"),$(this).closest("tr").find(".permission_type").addClass("discreet_on_hover"),b.addClass("fa-circle").removeClass("fa-dot-circle"),$(this).addClass("discreet_on_hover"));var c=!1;$(".permissions  .permission_store_scope i").each(function(a,b){($(b).hasClass("fa-check-square")||$(b).hasClass("fa-dot-circle"))&&(c=!0)}),c?$(".permission_stores").removeClass("invisible"):$(".permission_stores").addClass("invisible")}),$(document).on("click",".permissions .permission_store",function(a){var b=$(this).find("i");$(".permissions .save").addClass("changed valid"),$(".permissions .updated_msg").addClass("hide"),b.hasClass("fa-square")?(b.removeClass("fa-square ").addClass("fa-check-square"),$(this).removeClass("discreet_on_hover")):b.hasClass("fa-check-square")&&(b.addClass("fa-square ").removeClass("fa-check-square"),$(this).addClass("discreet_on_hover"))}),$(document).on("click",".locked_show_edit_button",function(a){var b=$(this).data("labels");console.log(b),void 0==b&&(b={footer:"",title:$("body").data("labels").error,text:""}),void 0==b.footer&&(b.footer=""),void 0==b.title&&(b.title=$("body").data("labels").error),void 0==b.text&&(b.text="yy");var c=$(this).data("right_code");if(""!=c){var d="/ar_find.php?tipo=users_with_right&right="+c;$.getJSON(d,function(a){var c=[];$.each(a.users_data,function(a,b){"No"==b.UIR&&c.push(b["User Alias"])});var d=c.join(", ");footer_text=b.footer+d,Swal.fire({type:"error",title:b.title,text:b.text,footer:footer_text})})}else Swal.fire({type:"error",title:b.title,text:b.text,footer:""})}),$(document).on("input propertychange",".external_email_mixed_recipients_value",function(a){var b=$(this).val(),c=client_validation("email",!0,b,"");$(this).removeClass("invalid potentially_valid valid").addClass(c["class"]);var d=$(this).closest(".mixed_recipients_container");validate_mixed_recipients_list(d)}),$(document).on("input propertychange",".mixed_recipients_container .User_Handle_value",function(a){var b=100;window.event&&"propertychange"==event.type&&"value"!=event.propertyName||delayed_on_change_user_recipient_dropdown_select_field($(a.target),b)}),$(document).on("input propertychange","#search",function(){var a=200;window.event&&"propertychange"==event.type&&"value"!=event.propertyName||delayed_search($(this),a)});var HtmlCell=Backgrid.HtmlCell=Backgrid.Cell.extend({className:"html-cell",initialize:function(){Backgrid.Cell.prototype.initialize.apply(this,arguments)},render:function(){this.$el.empty();var a=this.model.get(this.column.get("name")),b=this.formatter.fromRaw(a,this.model);return this.$el.append(b),this.delegateEvents(),this}}),HeaderHtmlCell=Backgrid.HeaderCell.extend({className:"html-cell",render:function(){return this.column.set("label",""),this.constructor.__super__.render.apply(this,arguments),this.column.get("title")&&this.$el.attr("title",this.column.get("title")),this.$el.find("button").html(this.column.get("html_label")+" "+this.$el.find("button").html()),this}}),rightHeaderHtmlCell=Backgrid.HeaderCell.extend({className:"html-cell align-right",render:function(){return this.constructor.__super__.render.apply(this,arguments),this.$el.addClass("align-right"),this.column.get("title")&&this.$el.attr("title",this.column.get("title")),this.column.get("html_label")&&this.$el.find("button").html(this.column.get("html_label")+" "+this.$el.find("button").html()),this}}),integerHeaderCell=Backgrid.HeaderCell.extend({className:"align-right",render:function(){return this.constructor.__super__.render.apply(this,arguments),this.$el.addClass("align-right"),this}}),element_delay=300,element_clicks=0,element_timer=null;$(document).on("click","#elements .element",function(a){element_clicks++;var b=$(this).data("item");1===element_clicks?element_timer=setTimeout(function(){change_table_element("click",b),element_clicks=0},element_delay):(clearTimeout(element_timer),change_table_element("double_click",b),element_clicks=0)}).on("dblclick",function(a){a.preventDefault()}),$(document).on("mousedown",".proforma_button",function(a){$(".proforma_dialog").removeClass("hide").offset({top:$(this).offset().top-1,left:$(this).offset().left})}),$(document).on("click",".create_category_webpage",function(a){var b="/ar_edit_website.php?tipo=create_webpage&parent=category&parent_key="+$(this).find("i").data("category_key");$.getJSON(b,function(a){200==a.state&&change_view(a.request)})}),$(document).on("click",".delete_block",function(a){var b=$("#edit_columns").attr("current_key");$("#edit_mode_"+b).remove(),$("#block_label_"+b).remove(),$("#preview").contents().find("#block_"+b).remove(),exit_edit_webpage_block_column(),$("#save_button").addClass("save button changed valid")}),$(document).on("click",".new_block",function(a){$("#blocks_showcase").removeClass("hide").offset({top:$(this).offset().top-69,left:$(this).offset().left+$(this).width()+30}).data("item",$(this))}),$(document).on("click",".add_webpage_block",function(a){var b="/ar_website.php?tipo=webpage_block&code="+$(this).attr("block")+"&theme=theme_1&store_key="+$("#save_button").data("store_key")+"&webpage_key="+$(".control_panel").data("webpage_key");console.log(b),$.getJSON(b,function(a){console.log(a),$("#blk_control_container").prepend(a.controls),$("#columns ").prepend(a.button),$("#preview").contents().find("#blocks").prepend(a.block),$("#blocks_showcase").addClass("hide"),"static_banner"==a.type?$("#preview")[0].contentWindow.create_static_banner():"one_pack"==a.type||"two_pack"==a.type?$("#preview")[0].contentWindow.set_up_froala_editor("block_"+a.block_key+"_editor"):"text"==a.type?$("#preview")[0].contentWindow.set_up_froala_editor("block_"+a.block_key+"_0_editor"):"blackboard"==a.type?$("#preview")[0].contentWindow.set_up_blackboard(a.block_key):"images"==a.type?$("#preview")[0].contentWindow.set_up_images(a.block_key):"see_also"==a.type&&$("#edit_mode_"+a.block_key+"  .refresh_auto_see_also_items").trigger("click"),$("#save_button").addClass("save button changed valid")})}),$(document).on("click",".slider_preview",function(a){$(this).hasClass("selected")||($(".slider_preview").removeClass("selected"),$(this).addClass("selected"),$(".slider_preview_options").addClass("hide"),$("#slider_preview_options_"+$(this).attr("key")).removeClass("hide"))}),$(document).on("click",".block_show",function(a){if($(this).hasClass("fa-eye")){$(this).removeClass("fa-eye").addClass("fa-eye-slash").closest("li").addClass("very_discreet").attr("key");$("#preview").contents().find("#block_"+$(this).closest(".column").attr("key")).addClass("hide")}else{$(this).addClass("fa-eye").removeClass("fa-eye-slash").closest("li").removeClass("very_discreet").attr("key");$("#preview").contents().find("#block_"+$(this).closest(".column").attr("key")).removeClass("hide"),"iframe"==$(this).closest(".column").attr("block")&&$("#preview")[0].contentWindow.resize_banners()}$("#save_button").addClass("save button changed valid")}),$(document).on("click",".open_edit",function(a){var b=$(this).closest("li").attr("key");$(this).closest("li").find(".block_show").hasClass("fa-eye")&&edit_webpage_block_column(b)}),$(document).on("click",".device_type",function(a){$(this).closest("div").find(".device_type").addClass("very_discreet").removeClass("valid_save"),$(this).removeClass("very_discreet").addClass("valid_save"),$(this).closest(".edit_mode").find(".device_controls").addClass("hide"),$(this).hasClass("desktop")?($("#preview").removeClass("hide"),$(this).closest(".edit_mode").find(".device_controls.desktop").removeClass("hide")):($(this).closest(".edit_mode").find(".device_controls.mobile").removeClass("hide"),$("#preview").addClass("hide"))}),$(document).on("click",".iframe_height",function(a){$(".edit_block").addClass("hide"),$("#iframe_height_edit_block_"+$(this).attr("key")).data("element",$(this)).removeClass("hide").offset({left:$(this).offset().left}).find("input").focus().val($(this).attr("value")).attr("device",$(this).attr("device")).data("element",$(this))}),$(document).on("click",".iframe_src",function(a){$(".edit_block").addClass("hide"),$("#iframe_src_edit_block_"+$(this).attr("key")).data("element",$(this)).removeClass("hide").find("input").focus().val($(this).attr("value")).attr("device",$(this).attr("device")).data("element",$(this))}),$(document).on("click",".apply_changes",function(a){switch($(".edit_block").addClass("hide"),console.log($(this).closest("div").attr("name")),$(this).closest("div").attr("name")){case"iframe_height_edit_block":var b=$(this).prev("input");c=parseInt(b.val()),b.data("element").attr("value",c),"desktop"==b.attr("device")?($(this).closest("div").data("element").html(c+"px").next("span.iframe_ratio").html((1240/c).toFixed(2)),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).attr("h",c),$("#preview")[0].contentWindow.resize_banners()):($(this).closest("div").data("element").html(c+"px").next("span.iframe_ratio").html((420/c).toFixed(2)),console.log("#block_"+$(this).closest(".edit_mode").attr("key")),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).attr("h_mobile",c));break;case"iframe_src_edit_block":var b=$(this).prev("input"),c=b.val();b.data("element").attr("value",c);var d=$("<div>"+c+"</div>").find("iframe").attr("src");c=void 0==d?c.replace(/(^\w+:|^)\/\//,""):d.replace(/(^\w+:|^)\/\//,""),$(this).closest("div").data("element").html("https://"+truncateWithEllipses(c,60)),console.log(b.attr("device")),"desktop"==b.attr("device")?$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("iframe").attr("src","https://"+c):$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).attr("src_mobile","https://"+c)}$("#save_button").addClass("save button changed valid")}),$(document).on("click",".image_link",function(a){$(".edit_block").addClass("hide"),$("#image_link_edit_block_"+$(this).attr("key")).data("element",$(this)).removeClass("hide").offset({left:$(this).offset().left}).find("input").focus()}),$(document).on("click",".image_tooltip",function(a){$(".edit_block").addClass("hide"),$("#image_tooltip_edit_block_"+$(this).attr("key")).data("element",$(this)).removeClass("hide").find("input").focus()}),$(document).on("click",".apply_changes",function(a){switch($(".edit_block").addClass("hide"),$(this).closest("div").attr("name")){case"image_link_edit_block":b=$(this).prev("input").val(),$(this).closest("div").data("element").find("span").html(b),""==b?($(this).closest("div").data("element").find("span").addClass("hide"),$(this).closest("div").data("element").find("i").addClass("very_discreet"),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("img").removeClass("like_button")):($(this).closest("div").data("element").find("span").removeClass("hide"),$(this).closest("div").data("element").find("i").removeClass("very_discreet"),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("img").addClass("like_button")),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("img").attr("link",b);break;case"image_tooltip_edit_block":var b=$(this).prev("input").val();$(this).closest("div").data("element").find("span").html(b),""==b?($(this).closest("div").data("element").find("span").addClass("hide"),$(this).closest("div").data("element").find("i").addClass("very_discreet fa-comment").removeClass("fa-comment")):($(this).closest("div").data("element").find("span").removeClass("hide"),$(this).closest("div").data("element").find("i").removeClass("very_discreet fa-comment").addClass("fa-comment")),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("img").attr("title",b).attr("alt",b)}$("#save_button").addClass("save button changed valid")});var webpage_scope_droppedFiles=!1;$(document).on("change",".image_upload",function(a){var b=new FormData;webpage_scope_droppedFiles&&$.each(webpage_scope_droppedFiles,function(a,c){return b.append("files",c),!1}),$.each($(this).prop("files"),function(a,c){return b.append("files["+a+"]",c),!1});var c=$(this).data("response_type");b.append("tipo","upload_images"),b.append("parent",$(this).data("parent")),b.append("parent_key",$(this).data("parent_key")),b.append("parent_object_scope",$(this).data("parent_object_scope")),""!=$(this).data("metadata")&&b.append("metadata",JSON.stringify($(this).data("metadata"))),""!=$(this).data("options")&&b.append("options",JSON.stringify($(this).data("options"))),b.append("response_type",c);var d=$(this);$.ajax({url:"/ar_upload.php",type:"POST",data:b,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(){},success:function(a){if("200"==a.state)switch(d.attr("name")){case"left_menu_background":$("#website_left_menu_background_mobile").attr("src","/wi.php?id="+a.img_key),$("#preview_mobile").contents().find(".sidebar-header-image.bg-1").css("background-image","url(/wi.php?id="+a.img_key+")"),$("#preview_mobile").contents().find(".sidebar-header-image.bg-1").attr("background-image","url(/wi.php?id="+a.img_key+")"),$("#save_button_mobile").addClass("save button changed valid");break;case"left_menu_logo_mobile":$("#left_menu_logo_mobile").attr("src","/wi.php?id="+a.img_key),$("#preview_mobile").contents().find(".sidebar-header-image .sidebar-logo").css("background-image","url(/wi.php?id="+a.img_key+")"),$("#preview_mobile").contents().find(".sidebar-header-image .sidebar-logo").attr("background-image","url(/wi.php?id="+a.img_key+")"),$("#save_button_mobile").addClass("save button changed valid");break;case"favicon":$("#favicon").attr("src","/wi.php?id="+a.img_key),$("#save_button").addClass("save button changed valid");break;case"logo_mobile":$("#website_logo_mobile").attr("src","/wi.php?id="+a.img_key),$("#preview_mobile").contents().find(".header-logo").css("background-image","url(/wi.php?id="+a.img_key+")"),$("#preview_mobile").contents().find(".header-logo").attr("background-image","url(/wi.php?id="+a.img_key+")"),$("#save_button_mobile").addClass("save button changed valid")}else"400"==a.state&&swal.fire({title:a.title,text:a.msg});d.val("")},error:function(){}})}),$(document).on("click",".counter_link",function(a){console.log($("#counter_link_edit_block_"+$(this).attr("key")+"_"+$(this).attr("column_key"))),console.log($(this).attr("column_key")),$(".edit_block").addClass("hide"),$("#counter_link_edit_block_"+$(this).attr("key")+"_"+$(this).attr("column_key")).data("element",$(this)).removeClass("hide").offset({left:$(this).offset().left}).find("input").focus()}),$(document).on("input propertychange",".counter_number",function(a){value=parseInt($(this).val());var b=$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")+" .counters1 ._counter:eq("+$(this).attr("column_key")+") ").attr("number",value).find("span").attr("id");$("#preview")[0].contentWindow.stop_counter(b),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")+" .counters1 ._counter:eq("+$(this).attr("column_key")+") ").attr("number",value).find("span").html(value),$("#save_button").addClass("save button changed valid")}),$(document).on("click",".apply_changes",function(a){switch($(".edit_block").addClass("hide"),$(this).closest("div").attr("name")){case"counter_link_edit_block":value=$(this).prev("input").val(),console.log(value),""==value?$(this).closest("div").data("element").addClass("very_discreet"):$(this).closest("div").data("element").removeClass("very_discreet"),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")+" .counters1 ._counter:eq("+$(this).closest("div").data("element").attr("column_key")+") ").attr("link",value)}$("#save_button").addClass("save button changed valid")}),$(document).on("click",".button_link",function(a){console.log("xxx"),$(".edit_block").addClass("hide"),$("#button_link_edit_block_"+$(this).attr("key")).data("element",$(this)).removeClass("hide").offset({left:$(this).offset().left}).find("input").focus()}),$(document).on("click",".apply_changes",function(a){switch($(".edit_block").addClass("hide"),$(this).closest("div").attr("name")){case"button_link_edit_block":value=$(this).prev("input").val(),$(this).closest("div").data("element").find("span").html(value),""==value?($(this).closest("div").data("element").find("span").addClass("hide"),$(this).closest("div").data("element").find("i").addClass("very_discreet")):($(this).closest("div").data("element").find("span").removeClass("hide"),$(this).closest("div").data("element").find("i").removeClass("very_discreet")),$("#preview").contents().find("#block_"+$(this).closest(".edit_mode").attr("key")).find("a").attr("link",value)}$("#save_button").addClass("save button changed valid")}),$(document).on("input propertychange",".edit_margin",function(a){if(validate_signed_integer($(this).val(),300))b=0,$(this).addClass("error");else{$(this).removeClass("error");var b=$(this).val()}var c=$(this).closest(".edit_mode").attr("key");"top"==$(this).data("margin")?(console.log($("#preview").contents().find("#block_"+c).attr("top_margin")),$("#preview").contents().find("#block_"+c).attr("top_margin",b).css("padding-top",b+"px"),console.log($("#preview").contents().find("#block_"+c).attr("top_margin"))):"bottom"==$(this).data("margin")&&$("#preview").contents().find("#block_"+c).attr("bottom_margin",b).css("padding-bottom",b+"px"),$("#save_button").addClass("save button changed valid")}),$(document).on("click","#text_layout_ideas img",function(){var a=$(this).attr("template"),b=$("#text_layout_ideas").data("block_key");$("#preview")[0].contentWindow.change_text_template(b,a),$("#text_layout_ideas").addClass("hide"),$("#save_button").addClass("save button changed valid")}),$(document).on("click","#images_layout_ideas img",function(){var a=$(this).attr("template"),b=$("#images_layout_ideas").data("block_key");console.log(a),$("#preview")[0].contentWindow.change_image_template(b,a),$("#images_layout_ideas").addClass("hide"),$("#save_button").addClass("save button changed valid")}),$(document).on("click",".toggle_view_category_categories",function(){var a=$(this).attr("title-alt"),b=$(this).attr("title");if($(this).hasClass("fa-cogs")){$(this).removeClass("fa-cogs").addClass("fa-globe").attr("title",a).attr("title-alt",b);var c="backstage"}else{$(this).addClass("fa-cogs ").removeClass("fa-globe").attr("title",a).attr("title-alt",b);var c="display"}$("#preview")[0].contentWindow.toggle_view_category_categories($(this).closest(".edit_mode").attr("key"),c)}),$(document).on("input propertychange",".order_qty",function(a){if($(this).val()==$(this).attr("ovalue"))$(this).closest("span").find("i.plus").removeClass("fa-cloud fa-exclamation-circle error").addClass("fa-plus"),$(this).closest("span").find("i.minus").removeClass("invisible");else{var b=$("body").data("labels");validate_signed_integer($(this).val(),4294967295)&&""!=$(this).val()?($(this).closest("span").find("i.plus").removeClass("fa-plus fa-cloud").addClass("fa-exclamation-circle error").prop("title",b.invalid_val),$(this).closest("span").find("i.minus").removeClass("fa-minus").addClass("fa-undo very_discreet").prop("title",b.undo)):($(this).closest("span").find("i.plus").removeClass("fa-plus fa-exclamation-circle error").addClass("fa-cloud").prop("title",b.save),$(this).closest("span").find("i.minus").removeClass("fa-minus").addClass("fa-undo very_discreet").prop("title",b.undo),$(this).addClass("discreet"))}}),$(document).on("click",".order_item_percentage_discount",function(a){$(this).addClass("hide").closest("td").find(".order_item_percentage_discount_form").removeClass("hide")}),$(document).on("input propertychange",".order_item_percentage_discount_input",function(a){icon=$(this).closest(".order_item_percentage_discount_form").find("i"),icon.addClass("changed"),percentage=$(this).val().replace("%",""),validate_number(percentage,0,100)&&""!=percentage?icon.removeClass("valid").addClass("error "):icon.addClass("valid").removeClass("error")}),$(document).on("click",".order_item_percentage_discount_form i",function(a){var b=$(this);if(!b.hasClass("wait")&&b.hasClass("valid")){b.removeClass("fa-cloud").addClass("wait fa-spinner fa-spin");var c=$(this).closest(".order_item_percentage_discount_form").data("settings"),d=$(this).closest(".order_item_percentage_discount_form").find("input");value=d.val(),""==value&&(value=0);var e=$("#table").data("metadata"),f=new FormData;f.append("tipo","edit_item_discount"),f.append("field",c.field),f.append("parent_key",e.parent_key),f.append("transaction_key",c.transaction_key),f.append("value",value);var g=$.ajax({url:"/ar_edit_orders.php",data:f,processData:!1,contentType:!1,type:"POST",dataType:"json"});g.done(function(a){if(b.removeClass("fa-spinner fa-spin wait").addClass("fa-cloud"),200==a.state){b.closest("tr").find("._order_item_net").html(a.transaction_data.to_charge),b.closest("tr").find("._item_discounts").html(a.transaction_data.item_discounts),$(".Total_Amount").attr("amount",a.metadata.to_pay),$(".Order_To_Pay_Amount").attr("amount",a.metadata.to_pay),$("#Shipping_Net_Amount_input").val(a.metadata.shipping).attr("ovalue",a.metadata.shipping),$("#Charges_Net_Amount_input").val(a.metadata.charges).attr("ovalue",a.metadata.charges),0==a.metadata.to_pay?($(".Order_Payments_Amount").addClass("hide"),$(".Order_To_Pay_Amount").addClass("hide")):($(".Order_Payments_Amount").removeClass("hide"),$(".Order_To_Pay_Amount").removeClass("hide")),0!=a.metadata.to_pay||0==a.metadata.payments?$(".Order_Paid").addClass("hide"):$(".Order_Paid").removeClass("hide"),a.metadata.to_pay<=0?$(".add_payment_to_order_button").addClass("fa-lock super_discreet").removeClass("fa-plus"):$(".add_payment_to_order_button").removeClass("fa-lock super_discreet").addClass("fa-plus"),0==a.metadata.to_pay?$(".Order_To_Pay_Amount").removeClass("button").attr("amount",a.metadata.to_pay):$(".Order_To_Pay_Amount").addClass("button").attr("amount",a.metadata.to_pay),$("#payment_nodes").html(a.metadata.payments_xhtml);for(var c in a.metadata.class_html)$("."+c).html(a.metadata.class_html[c]);for(var c in a.metadata.hide)$("#"+a.metadata.hide[c]).addClass("hide");for(var c in a.metadata.show)$("#"+a.metadata.show[c]).removeClass("hide");0==a.metadata.items?($(".payments").addClass("hide"),
$("#submit_operation").addClass("hide"),$("#send_to_warehouse_operation").addClass("hide")):($(".payments").removeClass("hide"),$("#submit_operation").removeClass("hide"),$("#send_to_warehouse_operation").removeClass("hide"))}else 400==a.state&&(sweetAlert(a.msg),d.val(d.attr("ovalue")))}),g.fail(function(a,b){console.log(b),console.log(a.responseText)})}}),$(document).on("input propertychange",".new_payment_field",function(a){validate_new_payment()}),$(document).on("click","#Shipping_Net_Amount",function(a){$("#order").data("state_index")>=90||$("#order").data("state_index")<=0||($("#Shipping_Net_Amount").addClass("hide"),$("#Shipping_Net_Amount_form").removeClass("hide"))}),$(document).on("click","#Shipping_Net_Amount_label",function(a){$("#order").data("state_index")>=90||$("#order").data("state_index")<=0||($("#Shipping_Net_Amount").removeClass("hide"),$("#Shipping_Net_Amount_form").addClass("hide"))}),$(document).on("input propertychange","#Shipping_Net_Amount_input",function(a){$("#Shipping_Net_Amount_save").addClass("changed"),validate_number($("#Shipping_Net_Amount_input").val(),0,999999999)&&""!=$("#Shipping_Net_Amount_input").val()?$("#Shipping_Net_Amount_save").removeClass("valid").addClass("error "):$("#Shipping_Net_Amount_save").addClass("valid").removeClass("error")}),$(document).on("click","#Charges_Net_Amount",function(a){$("#order").data("state_index")>=90||$("#order").data("state_index")<=0||($("#Charges_Net_Amount").addClass("hide"),$("#Charges_Net_Amount_form").removeClass("hide"))}),$(document).on("click","#Charges_Net_Amount_label",function(a){$("#order").data("state_index")>=90||$("#order").data("state_index")<=0||($("#Charges_Net_Amount").removeClass("hide"),$("#Charges_Net_Amount_form").addClass("hide"))}),$(document).on("input propertychange","#Charges_Net_Amount_input",function(a){$("#Charges_Net_Amount_save").addClass("changed"),validate_number($("#Charges_Net_Amount_input").val(),0,999999999)&&""!=$("#Charges_Net_Amount_input").val()?$("#Charges_Net_Amount_save").removeClass("valid").addClass("error "):$("#Charges_Net_Amount_save").addClass("valid").removeClass("error")}),$(".clone_order_open_button").on("click",function(){open_clone_order()}),$(document).on("input propertychange","#send_test_email_to",function(){validate_send_test_email_to()}),$(document).on("click","#email_template_text_button,#email_template_html_button",function(){$("#email_template_html_container").hasClass("hide")?($("#email_template_html_container").removeClass("hide"),$("#email_template_text_container").addClass("hide"),$("#email_template_text_button").removeClass("hide"),$("#email_template_html_button").addClass("hide")):($("#email_template_html_container").addClass("hide"),$("#email_template_text_container").removeClass("hide"),$("#email_template_text_button").addClass("hide"),$("#email_template_html_button").removeClass("hide"))}),$(document).on("input propertychange",".template_name",function(){""!=$(this).val()?$(this).next("i").addClass("changed valid"):$(this).next("i").removeClass("changed valid")}),$(document).on("input propertychange",".save_template",function(){$(this).hasClass("valid")&&save_as_another_template($(this).prev("input"))}),$(document).on("input propertychange","#email_template_text",function(){$("#email_template_text_save").addClass("changed valid")}),$(document).on("input propertychange","#email_template_subject",function(){""==$("#email_template_subject").val()?$("#email_template_subject").addClass("error "):$("#email_template_subject").removeClass("error ")}),$(document).on("input propertychange",".new_delivery_field",function(a){var b=$(this).attr("id");if("delivery_number"==b){var c=$(this).val();if(""==c)return void validate_new_supplier_delivery();var d=$("#object_showcase div.order").data("object"),e=d.order_parent,f=d.order_parent_key,g="Supplier Delivery",h="",i="Supplier Delivery Public ID",j="/ar_validation.php?tipo=check_for_duplicates&parent="+e+"&parent_key="+f+"&object="+g+"&key="+h+"&field="+i+"&value="+c+"&metadata="+JSON.stringify({option:"creating_dn_from_po"});console.log(j),$.getJSON(j,function(a){console.log(a),200==a.state?"valid"!=a.validation?$("#delivery_number").addClass("error"):$("#delivery_number").removeClass("error"):$("#delivery_number").addClass("error"),validate_new_supplier_delivery()})}}),$(document).on("input propertychange",".create_delivery_item_qty",function(a){validate_signed_integer($(this).val(),4294967295)&&""!=$(this).val()?($(this).closest("tr").find(".create_delivery_item_qty").val($(this).val()),$(this).closest("tr").find("i.plus").removeClass("fa-plus fa-check-circle").addClass("fa-exclamation-circle error"),$(this).closest("tr").find("i.minus").addClass("invisible"),$(this).closest("tr").find("input.create_delivery_item_qty").addClass("error"),validate_new_supplier_delivery()):($(this).closest("tr").find("i.plus").removeClass("fa-check-circle fa-exclamation-circle error").addClass("fa-plus"),$(this).closest("tr").find("i.minus").removeClass("invisible"),$(this).closest("tr").find("input.create_delivery_item_qty").removeClass("error"),create_delivery_change_quantity($(this).val(),$(this)))}),$(document).on("input propertychange",".item_po_note",function(a){$(this).closest("tr").find(".item_po_note_save").removeClass("hide").addClass("valid changed")}),$(document).on("input propertychange","#part_leakage_qty_input",function(){validate_part_leakage()}),$(document).on("input propertychange","#part_leakage_note_input",function(){validate_part_leakage()}),$(document).on("input propertychange","#part_to_production_qty_input",function(){validate_part_to_production()}),$(document).on("input propertychange","#part_to_production_note_input",function(){validate_part_to_production()}),$(document).on("input propertychange","#set_part_location_note_bis",function(){$("#set_part_location_note_bis").find("i.save").addClass("changed valid")}),$(document).on("input propertychange",".field_to_check",function(a){on_field_to_check_changed(this)}),$(document).on("input propertychange",".fast_track_packing",function(a){fast_track_packing_qty_changed(this)}),$(document).on("click",".open_sticky_note",function(a){if($(this).addClass("hide"),$(this).hasClass("order_sticky_note"))var b="order_sticky_note";else if($(this).hasClass("delivery_note_sticky_note"))var b="delivery_note_sticky_note";else if($(this).hasClass("customer_sticky_note"))var b="customer_sticky_note";else var b="object_sticky_note";$(".sticky_notes").find("."+b).removeClass("hide")}),$(document).on("click",".delete_sticky_note",function(a){var b=$(this).closest(".sticky_note_container").data("scope");$(this).closest(".sticky_note_container").addClass("hide").find(".sticky_note").html(""),$("#header").find("."+b).removeClass("hide"),save_sticky_note(b)}),$(document).on("click",".copy_to_delivery_note_sticky_note",function(a){var b=$(this).closest(".sticky_note_container").find(".sticky_note").html(),c=$(this).closest(".sticky_notes").find(".delivery_note_sticky_note .sticky_note"),d=c.html();$("#header").find(".delivery_note_sticky_note").addClass("hide"),$(".sticky_notes").find(".delivery_note_sticky_note").removeClass("hide"),""==d?c.html(b):c.html(c.html()+"<br>"+b),save_sticky_note("delivery_note_sticky_note")});var key_scope=!1,old_state_request="",websocket_connected=!1,websocket_connected_connecting=!1;$(document).ready(function(){state={module:"",section:"",parent:"",parent_key:"",object:"",key:""},structure={},change_view($("#_request").val()),$(document).on("keydown",function(a){key_press(a)}),connect_websocket(),setInterval(function(){websocket_connected_connecting||websocket_connected||connect_websocket()},1e3),setInterval(function(){websocket_connected&&ws_connection.publish("ping","hi")},6e4)}),window.addEventListener("popstate",function(a){null==a.state?console.log("null state!!!!!!"):change_view(a.state.request)});var isAdvancedUpload=function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&"FormData"in window&&"FileReader"in window}();ArraySort=function(a,b){var c=[],d=[],e={};for(var f in a)a.hasOwnProperty(f)&&c.push({key:f,value:a[f]});return c.sort(function(a,c){return b(a.value,c.value)}),"[object Array]"===Object.prototype.toString.call(a)?($.each(c,function(a,b){d.push(b.value)}),d):"[object Object]"===Object.prototype.toString.call(a)?($.each(c,function(a,b){e[b.key]=b.value}),e):void 0},jQuery.fn.putCursorAtEnd=function(){return this.each(function(){var a=$(this),b=this;if(a.is(":focus")||a.focus(),b.setSelectionRange){var c=2*a.val().length;setTimeout(function(){b.setSelectionRange(c,c)},1)}else a.val(a.val());this.scrollTop=999999})},$(document).on("input propertychange",".edit_funds_to_customer_field",function(a){validate_edit_funds_to_customer(this)}),$(document).on("click","#take_order",function(a){open_new_order()}),$(document).on("click","#take_customer_client_order",function(a){new_customer_client_order()});
//# sourceMappingURL=aurora.min.js.map